<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script id="versionArea" type="text/javascript">
//<![CDATA[
var version = {title: "TiddlyWiki", major: 2, minor: 6, revision: 5, date: new Date("October 6, 2011"), extensions: {}};
//]]>
</script>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="copyright" content="
TiddlyWiki created by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Copyright (c) Jeremy Ruston 2004-2007
Copyright (c) UnaMesa Association 2007-2011

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the UnaMesa Association nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 'AS IS' AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
" />
<!--PRE-HEAD-START-->
<!--{{{-->
<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' />
<!--}}}-->

<!--PRE-HEAD-END-->
<title> Samuel's - Learning notes </title>
<style id="styleArea" type="text/css">
#saveTest {display:none;}
#messageArea {display:none;}
#copyright {display:none;}
#storeArea {display:none;}
#storeArea div {padding:0.5em; margin:1em 0em 0em 0em; border-color:#fff #666 #444 #ddd; border-style:solid; border-width:2px; overflow:auto;}
#shadowArea {display:none;}
#javascriptWarning {width:100%; text-align:center; font-weight:bold; background-color:#dd1100; color:#fff; padding:1em 0em;}
</style>
<!--POST-HEAD-START-->

<!--POST-HEAD-END-->
</head>
<body onload="main();" onunload="if(window.unload) unload();">
<!--PRE-BODY-START-->

<!--PRE-BODY-END-->
<div id="copyright">
Welcome to TiddlyWiki created by Jeremy Ruston; Copyright &copy; 2004-2007 Jeremy Ruston, Copyright &copy; 2007-2011 UnaMesa Association
</div>
<noscript>
<div id="javascriptWarning">
This page requires JavaScript to function properly.<br /><br />If you are using Microsoft Internet Explorer you may need to click on the yellow bar above and select 'Allow Blocked Content'. You must then click 'Yes' on the following security warning.
</div>
</noscript>
<div id="saveTest"></div>
<div id="backstageCloak"></div>
<div id="backstageButton"></div>
<div id="backstageArea"><div id="backstageToolbar"></div></div>
<div id="backstage">
	<div id="backstagePanel"></div>
</div>
<div id="contentWrapper"></div>
<div id="contentStash"></div>
<div id="shadowArea">
<div title="MarkupPreHead">
<pre>&lt;!--{{{--&gt;
&lt;link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' /&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="ColorPalette">
<pre>Background: #fff
Foreground: #000
PrimaryPale: #8cf
PrimaryLight: #18f
PrimaryMid: #04b
PrimaryDark: #014
SecondaryPale: #ffc
SecondaryLight: #fe8
SecondaryMid: #db4
SecondaryDark: #841
TertiaryPale: #eee
TertiaryLight: #ccc
TertiaryMid: #999
TertiaryDark: #666
Error: #f88
</pre>
</div>
<div title="StyleSheetColors">
<pre>/*{{{*/
body {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}

a {color:[[ColorPalette::PrimaryMid]];}
a:hover {background-color:[[ColorPalette::PrimaryMid]]; color:[[ColorPalette::Background]];}
a img {border:0;}

h1,h2,h3,h4,h5,h6 {color:[[ColorPalette::SecondaryDark]]; background:transparent;}
h1 {border-bottom:2px solid [[ColorPalette::TertiaryLight]];}
h2,h3 {border-bottom:1px solid [[ColorPalette::TertiaryLight]];}

.button {color:[[ColorPalette::PrimaryDark]]; border:1px solid [[ColorPalette::Background]];}
.button:hover {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::SecondaryLight]]; border-color:[[ColorPalette::SecondaryMid]];}
.button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::SecondaryDark]];}

.header {background:[[ColorPalette::PrimaryMid]];}
.headerShadow {color:[[ColorPalette::Foreground]];}
.headerShadow a {font-weight:normal; color:[[ColorPalette::Foreground]];}
.headerForeground {color:[[ColorPalette::Background]];}
.headerForeground a {font-weight:normal; color:[[ColorPalette::PrimaryPale]];}

.tabSelected {color:[[ColorPalette::PrimaryDark]];
	background:[[ColorPalette::TertiaryPale]];
	border-left:1px solid [[ColorPalette::TertiaryLight]];
	border-top:1px solid [[ColorPalette::TertiaryLight]];
	border-right:1px solid [[ColorPalette::TertiaryLight]];
}
.tabUnselected {color:[[ColorPalette::Background]]; background:[[ColorPalette::TertiaryMid]];}
.tabContents {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::TertiaryPale]]; border:1px solid [[ColorPalette::TertiaryLight]];}
.tabContents .button {border:0;}

#sidebar {}
#sidebarOptions input {border:1px solid [[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel {background:[[ColorPalette::PrimaryPale]];}
#sidebarOptions .sliderPanel a {border:none;color:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:hover {color:[[ColorPalette::Background]]; background:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:active {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::Background]];}

.wizard {background:[[ColorPalette::PrimaryPale]]; border:1px solid [[ColorPalette::PrimaryMid]];}
.wizard h1 {color:[[ColorPalette::PrimaryDark]]; border:none;}
.wizard h2 {color:[[ColorPalette::Foreground]]; border:none;}
.wizardStep {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];
	border:1px solid [[ColorPalette::PrimaryMid]];}
.wizardStep.wizardStepDone {background:[[ColorPalette::TertiaryLight]];}
.wizardFooter {background:[[ColorPalette::PrimaryPale]];}
.wizardFooter .status {background:[[ColorPalette::PrimaryDark]]; color:[[ColorPalette::Background]];}
.wizard .button {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryLight]]; border: 1px solid;
	border-color:[[ColorPalette::SecondaryPale]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryPale]];}
.wizard .button:hover {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Background]];}
.wizard .button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::Foreground]]; border: 1px solid;
	border-color:[[ColorPalette::PrimaryDark]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryDark]];}

.wizard .notChanged {background:transparent;}
.wizard .changedLocally {background:#80ff80;}
.wizard .changedServer {background:#8080ff;}
.wizard .changedBoth {background:#ff8080;}
.wizard .notFound {background:#ffff80;}
.wizard .putToServer {background:#ff80ff;}
.wizard .gotFromServer {background:#80ffff;}

#messageArea {border:1px solid [[ColorPalette::SecondaryMid]]; background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]];}
#messageArea .button {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::SecondaryPale]]; border:none;}

.popupTiddler {background:[[ColorPalette::TertiaryPale]]; border:2px solid [[ColorPalette::TertiaryMid]];}

.popup {background:[[ColorPalette::TertiaryPale]]; color:[[ColorPalette::TertiaryDark]]; border-left:1px solid [[ColorPalette::TertiaryMid]]; border-top:1px solid [[ColorPalette::TertiaryMid]]; border-right:2px solid [[ColorPalette::TertiaryDark]]; border-bottom:2px solid [[ColorPalette::TertiaryDark]];}
.popup hr {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::PrimaryDark]]; border-bottom:1px;}
.popup li.disabled {color:[[ColorPalette::TertiaryMid]];}
.popup li a, .popup li a:visited {color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:active {background:[[ColorPalette::SecondaryPale]]; color:[[ColorPalette::Foreground]]; border: none;}
.popupHighlight {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
.listBreak div {border-bottom:1px solid [[ColorPalette::TertiaryDark]];}

.tiddler .defaultCommand {font-weight:bold;}

.shadow .title {color:[[ColorPalette::TertiaryDark]];}

.title {color:[[ColorPalette::SecondaryDark]];}
.subtitle {color:[[ColorPalette::TertiaryDark]];}

.toolbar {color:[[ColorPalette::PrimaryMid]];}
.toolbar a {color:[[ColorPalette::TertiaryLight]];}
.selected .toolbar a {color:[[ColorPalette::TertiaryMid]];}
.selected .toolbar a:hover {color:[[ColorPalette::Foreground]];}

.tagging, .tagged {border:1px solid [[ColorPalette::TertiaryPale]]; background-color:[[ColorPalette::TertiaryPale]];}
.selected .tagging, .selected .tagged {background-color:[[ColorPalette::TertiaryLight]]; border:1px solid [[ColorPalette::TertiaryMid]];}
.tagging .listTitle, .tagged .listTitle {color:[[ColorPalette::PrimaryDark]];}
.tagging .button, .tagged .button {border:none;}

.footer {color:[[ColorPalette::TertiaryLight]];}
.selected .footer {color:[[ColorPalette::TertiaryMid]];}

.error, .errorButton {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Error]];}
.warning {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryPale]];}
.lowlight {background:[[ColorPalette::TertiaryLight]];}

.zoomer {background:none; color:[[ColorPalette::TertiaryMid]]; border:3px solid [[ColorPalette::TertiaryMid]];}

.imageLink, #displayArea .imageLink {background:transparent;}

.annotation {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border:2px solid [[ColorPalette::SecondaryMid]];}

.viewer .listTitle {list-style-type:none; margin-left:-2em;}
.viewer .button {border:1px solid [[ColorPalette::SecondaryMid]];}
.viewer blockquote {border-left:3px solid [[ColorPalette::TertiaryDark]];}

.viewer table, table.twtable {border:2px solid [[ColorPalette::TertiaryDark]];}
.viewer th, .viewer thead td, .twtable th, .twtable thead td {background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::Background]];}
.viewer td, .viewer tr, .twtable td, .twtable tr {border:1px solid [[ColorPalette::TertiaryDark]];}

.viewer pre {border:1px solid [[ColorPalette::SecondaryLight]]; background:[[ColorPalette::SecondaryPale]];}
.viewer code {color:[[ColorPalette::SecondaryDark]];}
.viewer hr {border:0; border-top:dashed 1px [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::TertiaryDark]];}

.highlight, .marked {background:[[ColorPalette::SecondaryLight]];}

.editor input {border:1px solid [[ColorPalette::PrimaryMid]];}
.editor textarea {border:1px solid [[ColorPalette::PrimaryMid]]; width:100%;}
.editorFooter {color:[[ColorPalette::TertiaryMid]];}
.readOnly {background:[[ColorPalette::TertiaryPale]];}

#backstageArea {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::TertiaryMid]];}
#backstageArea a {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstageArea a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; }
#backstageArea a.backstageSelTab {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
#backstageButton a {background:none; color:[[ColorPalette::Background]]; border:none;}
#backstageButton a:hover {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstagePanel {background:[[ColorPalette::Background]]; border-color: [[ColorPalette::Background]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]];}
.backstagePanelFooter .button {border:none; color:[[ColorPalette::Background]];}
.backstagePanelFooter .button:hover {color:[[ColorPalette::Foreground]];}
#backstageCloak {background:[[ColorPalette::Foreground]]; opacity:0.6; filter:alpha(opacity=60);}
/*}}}*/</pre>
</div>
<div title="StyleSheetLayout">
<pre>/*{{{*/
* html .tiddler {height:1%;}

body {font-size:.75em; font-family:arial,helvetica; margin:0; padding:0;}

h1,h2,h3,h4,h5,h6 {font-weight:bold; text-decoration:none;}
h1,h2,h3 {padding-bottom:1px; margin-top:1.2em;margin-bottom:0.3em;}
h4,h5,h6 {margin-top:1em;}
h1 {font-size:1.35em;}
h2 {font-size:1.25em;}
h3 {font-size:1.1em;}
h4 {font-size:1em;}
h5 {font-size:.9em;}

hr {height:1px;}

a {text-decoration:none;}

dt {font-weight:bold;}

ol {list-style-type:decimal;}
ol ol {list-style-type:lower-alpha;}
ol ol ol {list-style-type:lower-roman;}
ol ol ol ol {list-style-type:decimal;}
ol ol ol ol ol {list-style-type:lower-alpha;}
ol ol ol ol ol ol {list-style-type:lower-roman;}
ol ol ol ol ol ol ol {list-style-type:decimal;}

.txtOptionInput {width:11em;}

#contentWrapper .chkOptionInput {border:0;}

.externalLink {text-decoration:underline;}

.indent {margin-left:3em;}
.outdent {margin-left:3em; text-indent:-3em;}
code.escaped {white-space:nowrap;}

.tiddlyLinkExisting {font-weight:bold;}
.tiddlyLinkNonExisting {font-style:italic;}

/* the 'a' is required for IE, otherwise it renders the whole tiddler in bold */
a.tiddlyLinkNonExisting.shadow {font-weight:bold;}

#mainMenu .tiddlyLinkExisting,
	#mainMenu .tiddlyLinkNonExisting,
	#sidebarTabs .tiddlyLinkNonExisting {font-weight:normal; font-style:normal;}
#sidebarTabs .tiddlyLinkExisting {font-weight:bold; font-style:normal;}

.header {position:relative;}
.header a:hover {background:transparent;}
.headerShadow {position:relative; padding:4.5em 0 1em 1em; left:-1px; top:-1px;}
.headerForeground {position:absolute; padding:4.5em 0 1em 1em; left:0; top:0;}

.siteTitle {font-size:3em;}
.siteSubtitle {font-size:1.2em;}

#mainMenu {position:absolute; left:0; width:10em; text-align:right; line-height:1.6em; padding:1.5em 0.5em 0.5em 0.5em; font-size:1.1em;}

#sidebar {position:absolute; right:3px; width:16em; font-size:.9em;}
#sidebarOptions {padding-top:0.3em;}
#sidebarOptions a {margin:0 0.2em; padding:0.2em 0.3em; display:block;}
#sidebarOptions input {margin:0.4em 0.5em;}
#sidebarOptions .sliderPanel {margin-left:1em; padding:0.5em; font-size:.85em;}
#sidebarOptions .sliderPanel a {font-weight:bold; display:inline; padding:0;}
#sidebarOptions .sliderPanel input {margin:0 0 0.3em 0;}
#sidebarTabs .tabContents {width:15em; overflow:hidden;}

.wizard {padding:0.1em 1em 0 2em;}
.wizard h1 {font-size:2em; font-weight:bold; background:none; padding:0; margin:0.4em 0 0.2em;}
.wizard h2 {font-size:1.2em; font-weight:bold; background:none; padding:0; margin:0.4em 0 0.2em;}
.wizardStep {padding:1em 1em 1em 1em;}
.wizard .button {margin:0.5em 0 0; font-size:1.2em;}
.wizardFooter {padding:0.8em 0.4em 0.8em 0;}
.wizardFooter .status {padding:0 0.4em; margin-left:1em;}
.wizard .button {padding:0.1em 0.2em;}

#messageArea {position:fixed; top:2em; right:0; margin:0.5em; padding:0.5em; z-index:2000; _position:absolute;}
.messageToolbar {display:block; text-align:right; padding:0.2em;}
#messageArea a {text-decoration:underline;}

.tiddlerPopupButton {padding:0.2em;}
.popupTiddler {position: absolute; z-index:300; padding:1em; margin:0;}

.popup {position:absolute; z-index:300; font-size:.9em; padding:0; list-style:none; margin:0;}
.popup .popupMessage {padding:0.4em;}
.popup hr {display:block; height:1px; width:auto; padding:0; margin:0.2em 0;}
.popup li.disabled {padding:0.4em;}
.popup li a {display:block; padding:0.4em; font-weight:normal; cursor:pointer;}
.listBreak {font-size:1px; line-height:1px;}
.listBreak div {margin:2px 0;}

.tabset {padding:1em 0 0 0.5em;}
.tab {margin:0 0 0 0.25em; padding:2px;}
.tabContents {padding:0.5em;}
.tabContents ul, .tabContents ol {margin:0; padding:0;}
.txtMainTab .tabContents li {list-style:none;}
.tabContents li.listLink { margin-left:.75em;}

#contentWrapper {display:block;}
#splashScreen {display:none;}

#displayArea {margin:1em 17em 0 14em;}

.toolbar {text-align:right; font-size:.9em;}

.tiddler {padding:1em 1em 0;}

.missing .viewer,.missing .title {font-style:italic;}

.title {font-size:1.6em; font-weight:bold;}

.missing .subtitle {display:none;}
.subtitle {font-size:1.1em;}

.tiddler .button {padding:0.2em 0.4em;}

.tagging {margin:0.5em 0.5em 0.5em 0; float:left; display:none;}
.isTag .tagging {display:block;}
.tagged {margin:0.5em; float:right;}
.tagging, .tagged {font-size:0.9em; padding:0.25em;}
.tagging ul, .tagged ul {list-style:none; margin:0.25em; padding:0;}
.tagClear {clear:both;}

.footer {font-size:.9em;}
.footer li {display:inline;}

.annotation {padding:0.5em; margin:0.5em;}

* html .viewer pre {width:99%; padding:0 0 1em 0;}
.viewer {line-height:1.4em; padding-top:0.5em;}
.viewer .button {margin:0 0.25em; padding:0 0.25em;}
.viewer blockquote {line-height:1.5em; padding-left:0.8em;margin-left:2.5em;}
.viewer ul, .viewer ol {margin-left:0.5em; padding-left:1.5em;}

.viewer table, table.twtable {border-collapse:collapse; margin:0.8em 1.0em;}
.viewer th, .viewer td, .viewer tr,.viewer caption,.twtable th, .twtable td, .twtable tr,.twtable caption {padding:3px;}
table.listView {font-size:0.85em; margin:0.8em 1.0em;}
table.listView th, table.listView td, table.listView tr {padding:0 3px 0 3px;}

.viewer pre {padding:0.5em; margin-left:0.5em; font-size:1.2em; line-height:1.4em; overflow:auto;}
.viewer code {font-size:1.2em; line-height:1.4em;}

.editor {font-size:1.1em;}
.editor input, .editor textarea {display:block; width:100%; font:inherit;}
.editorFooter {padding:0.25em 0; font-size:.9em;}
.editorFooter .button {padding-top:0; padding-bottom:0;}

.fieldsetFix {border:0; padding:0; margin:1px 0px;}

.zoomer {font-size:1.1em; position:absolute; overflow:hidden;}
.zoomer div {padding:1em;}

* html #backstage {width:99%;}
* html #backstageArea {width:99%;}
#backstageArea {display:none; position:relative; overflow: hidden; z-index:150; padding:0.3em 0.5em;}
#backstageToolbar {position:relative;}
#backstageArea a {font-weight:bold; margin-left:0.5em; padding:0.3em 0.5em;}
#backstageButton {display:none; position:absolute; z-index:175; top:0; right:0;}
#backstageButton a {padding:0.1em 0.4em; margin:0.1em;}
#backstage {position:relative; width:100%; z-index:50;}
#backstagePanel {display:none; z-index:100; position:absolute; width:90%; margin-left:3em; padding:1em;}
.backstagePanelFooter {padding-top:0.2em; float:right;}
.backstagePanelFooter a {padding:0.2em 0.4em;}
#backstageCloak {display:none; z-index:20; position:absolute; width:100%; height:100px;}

.whenBackstage {display:none;}
.backstageVisible .whenBackstage {display:block;}
/*}}}*/
</pre>
</div>
<div title="StyleSheetLocale">
<pre>/***
StyleSheet for use when a translation requires any css style changes.
This StyleSheet can be used directly by languages such as Chinese, Japanese and Korean which need larger font sizes.
***/
/*{{{*/
body {font-size:0.8em;}
#sidebarOptions {font-size:1.05em;}
#sidebarOptions a {font-style:normal;}
#sidebarOptions .sliderPanel {font-size:0.95em;}
.subtitle {font-size:0.8em;}
.viewer table.listView {font-size:0.95em;}
/*}}}*/</pre>
</div>
<div title="StyleSheetPrint">
<pre>/*{{{*/
@media print {
#mainMenu, #sidebar, #messageArea, .toolbar, #backstageButton, #backstageArea {display: none !important;}
#displayArea {margin: 1em 1em 0em;}
noscript {display:none;} /* Fixes a feature in Firefox 1.5.0.2 where print preview displays the noscript content */
}
/*}}}*/</pre>
</div>
<div title="PageTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='header' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'&gt;
&lt;div class='headerShadow'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;div class='headerForeground'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id='mainMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;
&lt;div id='sidebar'&gt;
&lt;div id='sidebarOptions' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;
&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id='displayArea'&gt;
&lt;div id='messageArea'&gt;&lt;/div&gt;
&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="ViewTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::ViewToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='subtitle'&gt;&lt;span macro='view modifier link'&gt;&lt;/span&gt;, &lt;span macro='view modified date'&gt;&lt;/span&gt; (&lt;span macro='message views.wikified.createdPrompt'&gt;&lt;/span&gt; &lt;span macro='view created date'&gt;&lt;/span&gt;)&lt;/div&gt;
&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;
&lt;div class='tagged' macro='tags'&gt;&lt;/div&gt;
&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;
&lt;div class='tagClear'&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="EditTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::EditToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit title'&gt;&lt;/div&gt;
&lt;div macro='annotations'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit text'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit tags'&gt;&lt;/div&gt;&lt;div class='editorFooter'&gt;&lt;span macro='message views.editor.tagPrompt'&gt;&lt;/span&gt;&lt;span macro='tagChooser excludeLists'&gt;&lt;/span&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="GettingStarted">
<pre>To get started with this blank [[TiddlyWiki]], you'll need to modify the following tiddlers:
* [[SiteTitle]] &amp; [[SiteSubtitle]]: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)
* [[MainMenu]]: The menu (usually on the left)
* [[DefaultTiddlers]]: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened
You'll also need to enter your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;</pre>
</div>
<div title="OptionsPanel">
<pre>These [[InterfaceOptions]] for customising [[TiddlyWiki]] are saved in your browser

Your username for signing your edits. Write it as a [[WikiWord]] (eg [[JoeBloggs]])

&lt;&lt;option txtUserName&gt;&gt;
&lt;&lt;option chkSaveBackups&gt;&gt; [[SaveBackups]]
&lt;&lt;option chkAutoSave&gt;&gt; [[AutoSave]]
&lt;&lt;option chkRegExpSearch&gt;&gt; [[RegExpSearch]]
&lt;&lt;option chkCaseSensitiveSearch&gt;&gt; [[CaseSensitiveSearch]]
&lt;&lt;option chkAnimate&gt;&gt; [[EnableAnimations]]

----
Also see [[AdvancedOptions]]</pre>
</div>
<div title="ImportTiddlers">
<pre>&lt;&lt;importTiddlers&gt;&gt;</pre>
</div>
</div>
<!--POST-SHADOWAREA-->
<div id="storeArea">
<div title="#pragma" creator="Samuel" modifier="Samuel" created="201210090259" modified="201212260749" changecount="47">
<pre>*{{normal{@@color(blue):''#pragma message(&quot;hello&quot;)''@@
编译时输出信息
}}}
*{{normal{@@color(blue):''#pragma warning ''@@
&lt;code c&gt;
#pragma   warning( disable: 4507  34; once : 4385; error : 164   )   
 /* is equal to   */
#pragma   warning(disable:4507   34)    //不显示4507和34号警告信息 
#pragma   warning(once:4385)            //4385号警告信息仅报告一次   
#pragma   warning(error:164)            //把164号警告信息作为一个错误
#pragma   warning( push )               //保存所有警告信息的现有的警告状态
#pragma   warning( push,n)              //保存所有警告信息的现有的警告状态，并且把全局警告等级设定为n(1,2,3,4四个级别)。  
#pragma   warning( pop )                //向栈中弹出最后一个警告信息，在入栈和出栈之间所作的一切改动取消
&lt;/code&gt;
}}}
*{{normal{@@color(blue):''#pragma comment''@@
*''#pragma comment(lib,&quot;windows.lib&quot;)''
}}}
*{{normal{@@color(blue):''#符号''@@
#变量引用 : #define  sample(a)  ##a=10
#字符串化 :  #define  a(b) #b 将b变成字符
}}}

</pre>
</div>
<div title="$()与``" creator="Samuel" modifier="Samuel" created="201206290532" modified="201206290620" tags="_SHELL_ _SHELL_COMMAND_" changecount="7">
<pre>*@@bgcolor(green):功能@@
**命令替换符，在括号和引号里可以执行命令, 将其结果作为其他的输入</pre>
</div>
<div title="Adaboost" creator="Samuel" modifier="Samuel" created="201303120911" modified="201304170101" changecount="8">
<pre>[[Real AdaBoost]]
[[Discreate Adaboost]]
[[Cascade Adaboost]]</pre>
</div>
<div title="AdvancedOptions" creator="YourName" modifier="YourName" created="201206180447" modified="201206180447" changecount="2">
<pre>&lt;&lt;options&gt;&gt;</pre>
</div>
<div title="Branches and merging" creator="Samuel" modifier="Samuel" created="201207190811" modified="201208220659" tags="_GIT_" changecount="5">
<pre>*''git branch'' 
:列出所有本地的分支， 带*表示当前活动的分支
:-a 列出所有本地和远程的分支
:后接branch-nameA       通过本地创建branch-nameA分支
:-d  branch-nameA  删除分支branch-nameA                
*''git checkout'' 
:branch-nameA  :   切换到branch-nameA 分支
:-b branch-nameA  [master/origin/.] 
:从master/origin或当前建立新branch-nameA 的分支并切换到branch-nameA 
*''git merge branch-nameA''
:合并分支到主干，需要先切换到主干
*''git checkout commit-name [filename / dir / 默认为所有文件当前目录文件]''
:commit-name为commitID的前四位。
:{{normal{@@bgcolor(red):Attention：@@
1、git checkout . 以后当前的head就会变成是checkout的那个版本 ，提交的话会删掉这版本向后的版本 
2、应该只git checkout  某个版本的某个文件
}}}
*''git revert  commit-name''
:revert与reset的区别？
*''git reset  commit-name''
:git reset –mixed：此为默认方式，不带任何参数的git reset，即时这种方式，它回退到某个版本，只保留源码，回退commit和index信息
:git reset –soft：回退到某个版本，只回退了commit的信息，不会恢复到index file一级。如果还要提交，直接commit即可
:git reset –hard：彻底回退到某个版本，本地的源码也会变为上一个版本的内容</pre>
</div>
<div title="C++ class" creator="Samuel" modifier="samuel" created="201302190710" modified="201303280305" changecount="20">
<pre>*{{normal{@@color(blue):''构造函数''@@
@@color(red):c++中不可以， c++的构造函数或其他方法调用其他构造函数时没有this指针的， 只是临时生成一个对象， 调用完就撤消了，相当于没有效果@@
}}}
*C++有隐式类型转换和显式类型转换。其中显式类型转换中的dynamic_cast是运行时进行转换
*{{normal{''@@color(blue):static@@成员函数和变量''
*类中成员不能初始化，只有const static可以
*{{normal{static成员变量必须需在声明体外初始化， @@color(red):否则是只有声明没有定义的@@
&lt;code c&gt;
class Test
{
private :
      int   var1;
//    int   var11= 4; 错误的初始化方法
      const int   var2 ;
//    const int   var22 =22222; 错误的初始化方法
      static int   var3;
//    static int   var3333=33333; 错误，只有静态常量成员才能直接赋值来初始化
      static const int   var4=4444; //正确，静态常量成员可以直接初始化
      static const int   var44;
public:
      Test(void);
       ~Test(void);
};
--------------------Test.cpp-----------------------------------

#include &quot;.\test.h&quot;
int Test::var3 = 3333333; //静态成员的 正确的初始化方法
//    int Test::var1 = 11111;; 错误 静态成员才能初始化
&lt;/code&gt;
}}}
*静态方法(不含有this指针)不可以调用实例方法和变量
}}}
*{{normal{类中const方法
&lt;code c&gt;
class A{
void foo() const;
}
&lt;/code&gt;
*不能修改类成员
*不调用非const的类方法
}}}
</pre>
</div>
<div title="C/C++" creator="Samuel" modifier="Samuel" created="201210090257" modified="201304161026" changecount="23">
<pre>!C++
[[#pragma]]
[[c++ template]]
[[C++ class]]
[[class 类型转换]]-@@color(red):''important''@@
!C
[[函数指针]]
[[allignment  C/C++]]
[[round函数]]
[[FILE IO]]</pre>
</div>
<div title="C/C++ optimize" creator="Samuel" modifier="Samuel" created="201302050613" changecount="1">
<pre>*{{normal{@@color(green):指令集@@
*{{normal{取数据时用临时变量来暂存一下。可以减少等待时间
&lt;code c&gt;
dst[tId] = (src1[tId] + src2[tId] + src3[tId] + src4[tId])&gt;&gt;4;
/*'' 改为&gt;&gt;''*/
        val1 = src1[tId]; //使用prefetch是不是会更好
	val2 = src2[tId];
	val3 = src3[tId];
	val4 = src4[tId];
	dst[tId] = (val1 + val2 + val3 + val4)&gt;&gt;4;      
&lt;/code&gt;
 
}}}
}}}</pre>
</div>
<div title="Cascade Adaboost" creator="samuel" modifier="Samuel" created="201304030554" modified="201304110619" changecount="66">
<pre>''说明''
#正样本集是固定的，负样本集每次是需要更新的
#@@color(red):验证集需要另外指定吗？@@
#@@color(red):cascade 可以用于多类吗？@@
#@@color(red):''有一层判断不是就不是了吗，还是需要多层的阈值相加判断（real adaboost是这样）''@@
#@@color(red):''为什么每一层没有负样本的检测率''@@
''Step''
#{{normal{@@color(blue):''设置每一层的:''@@
\(f --- \) 每一层的最大正样本误检率 @@color(red):如何统计@@
\(d---\)每一层的最小正样本检测率
}}}
#@@color(blue):''设置最终的正样本误检率\(F_{target}\)''@@
#{{normal{@@color(blue):''设置正负样本集''@@
\(P --- \) 正样本集
\(N --- \)负样本集
}}}
#{{normal{@@color(blue):''初始化参数''@@
\(F_0 = 1.0\) ;  \(D_0 = 1.0\) ; \(i = 0\);
}}}
#{{normal{@@color(blue):''while \(F_i &gt; F_{target}\)''@@
#\(i = i+1\); \(F_i = F_(i-1)\);
#\(n_i = 0 --- \) 特征的维数 
#{{normal{while \(F_i &gt; f*F_{i-1}\)
#\(n_i = n_i+1\) @@color(red):此处的\(n_i\)应该是~AdaBoost的T吗， 每次加一，每次只是算下一个弱分类器@@
#基于\(P,N\)使用\(n_i\)维特征通过~AdaBoost得到一个分类器
#使用当前的@@color(red):cascaded分类器@@在@@color(red):验证集@@上得到\(F_i,D_i\)
#降低@@color(red):\(i\)th分类器@@的阈值，直到当前的@@color(red):cascaded分类器@@\(D_i&gt;d*D_{i-1}\), 同时需要更新\(F_i\)
}}}
}}}
#@@color(blue):''清空负样本集\(N\)''@@
#@@color(blue):''如果\(F_i&gt;F_{target}\),将当前cascade检测器应用到负样本集上，将检测错误的负样本放到\(N\)中''@@@@color(red):（上面用于训练的样本需要检测一下加入吗）@@</pre>
</div>
<div title="Cmake" creator="Samuel" modifier="Samuel" created="201206180614" modified="201211270130" tags="_CMAKE_" changecount="145">
<pre>*[[cmake FAQ]]

*[[cmake variable]]

*[[cmake command]]

</pre>
</div>
<div title="ColorPalette" creator="YourName" modifier="Samuel" created="201206180441" modified="201206180450" changecount="2">
<pre>Background: #fff
Foreground: #000
PrimaryPale: #8cf
PrimaryLight: #18f
PrimaryMid: #04b
PrimaryDark: #014
SecondaryPale: #ffc
SecondaryLight: #fe8
SecondaryMid: #db4
SecondaryDark: #841
TertiaryPale: #eee
TertiaryLight: #ccc
TertiaryMid: #999
TertiaryDark: #666
Error: #f88
</pre>
</div>
<div title="ConfigParser" creator="samuel" modifier="samuel" created="201208130603" modified="201209110543" tags="_PYTHON_ _PYTHON_MODULE_ _CONFIGPARSER_" changecount="15">
<pre>@@bgcolor(green): The ~ConfigParser module has been renamed to configparser in Python 3.0@@
*{{normal{@@color(blue):''配置文件格式''@@
配置文件分为几个段[sectionName]  
variable :/=  value
其中 ‘#’, ';' 在@@color(red):行首@@是被忽略，可以写注释语言
}}}
*{{normal{@@color(blue):''函数''@@
&gt;''config = ~ConfigParser()'' : 获取配置传递句柄 
&gt;''config.read''(&quot;/path/config.txt&quot;) : 读取配置文件
&gt;''variable = config.get''('sectionName', 'variable') : 获取值
}}}</pre>
</div>
<div title="DefaultTiddlers" creator="YourName" modifier="Samuel" created="201206180441" modified="201206180448" changecount="6">
<pre></pre>
</div>
<div title="Discreate Adaboost" creator="samuel" modifier="Samuel" created="201304030317" modified="201304170126" changecount="126">
<pre>''说明''
#Discreate ~AdaBoost的弱分类器可以参考@@color(red):''Robust ~Real-Time Face Detection''@@
#@@color(red):(重新分配权重，后其不影响前面分对的吗)@@
''Step - 多类''
#{{normal{@@color(blue):''Input''@@ :
 \((x_1,y_1)... (x_n, y_n)  \hspace{8mm} y_i\in Y(1, 2, ...k)  \). 
}}}
#{{normal{@@color(blue):''初始化权重值w(也是概率分布D)''@@
\( 
w_i = 1/n    ...........  (n为样本的个数 )\\
(Cascade \hspace{4mm} Adaboost二类中 wp_i = 1/2m, wn_i=1/2l,m,l分别为正负样本的个数 )
\)
}}}
#{{normal{@@color(blue):''For t=0, 1...T:''
@@@@color(red):（T如何选取，可以根据正检率和误检率中间跳出吗?每次都更新一下正检率和误检率是不是很影响性能）@@
#{{normal{''归一化权重值''
\(
\LARGE w_{t,i} = \frac{w_{t,i}}{\sum\limits_{j=1}^nw_{t,j}}
\)
}}}
#{{normal{''对不同的特征训练若干弱分类器\(h_j\),寻找最小的误差值\({err}_t\)的弱分类器作为\(h_t\)''
@@color(green):\({err}_t\)''(是所有的错误率，所以多类也是0.5)''必须小于0.5,大于0.5需要退出循环。如果大于0.5 则下一步\(\beta_t\)就会大于1，无法减小分对的权重@@
\(
\Large  {err}_j = \sum\limits_i^nw_i|h_j(x_i)-y_i|
\)
}}}
#{{normal{''更新权重\(w\)''
@@color(green):减小分对的权重,  分类错误的样本可以除以\beta_t变大或不变@@
\(
\Large w_{t+1,i} =w_{t,i}*\begin{cases}
\beta_t  \hspace{16mm}if\hspace{4mm}  h_t(x_i)=y_i\\
1 or \beta_t^{-1}\hspace{16mm} otherwise
\end{cases} \\
\beta_t = {err}_t / (1-{err}_t)
\)
}}}
}}}
#{{normal{@@color(blue):''最终的强分类器''@@
\(
\Large h_{final}(x) = max\sum\limits_{t:h_t(x)==y}log(1/\beta_t)
\)
@@color(green):寻找使(h(x)=y的情况下,log(1/B)之和)最大者即是输出分类y。 误差越小log(1/B)越大,二类情况下只要大于所有和的一半即可@@
}}}</pre>
</div>
<div title="Emacs" creator="Samuel" modifier="samuel" created="201207100654" modified="201208140817" tags="_EMACS_" changecount="6">
<pre>[[Emacs GDB]]
[[Emacs Edit]]</pre>
</div>
<div title="Emacs Edit" creator="Samuel" modifier="Samuel" created="201207130549" modified="201301080329" tags="_EMACS_ _EMACS_EDIT_" changecount="68">
<pre>@@color(red):''C =Ctrl    
M=Alt (或先按一下 ESC 键然后放开，再输入 &lt;chr&gt;)''@@
@@color(red):''C-x d'' @@ : emacs进入目录模式，q退出
!
*@@color(blue):''光标的移动''@@
&gt;{{normal{''C-v''    : 向前移动一屏(可用pagedown和pageup代替)
''M-v''  :   向后移动一屏
''C-l''    :  重绘屏幕，并将光标所在行置于屏幕的中央
''C-f''   :  向右移动一个字符
''C-b'' : 向左移动一个字符
''M-f''  : 向右移动一个词（对中文是移动到下一个标点符号）
''M-b''   :  向左移动一个词（对中文是移动到上一个标点符号）
''C-n''  :   移动到下一行
''C-p''   :  移动到上一行
''C-a''   :  移动到行首
''C-e''   :  移动到行尾
''M-a''  :   移动到句首
''M-e''  :   移动到句尾
''M-&lt;''  :（META 小于号）可以将光标移动到所有文字的最开头
''M-&gt;'' : （META 大于号）可以将光标移动到所有文字的最末尾。（这里需要esc键）
''C-u''  : 输入数字参数给后续命令。 对大多数命令为指定命令的执行次数。
''C-g''  : 如果 Emacs 对你的命令失去响应，你可以用 C-g 来安全地终止这条命令。也可以终止一条执行过久的命令还可以取消数字参数和只输入到一半的命令。
''ESC''可以退出递归编辑，C-g只能退出本层的命令,如果你不小心按了一下 &lt;ESC&gt;，你也可以用 C-g 来取消它，最好连按两次ESC）}}}
*@@color(blue):''删除粘贴操作''@@
&gt;{{normal{''&lt;Backspace&gt;''  :      删除光标前的一个字符
''M-&lt;Backspace&gt;''   : 移除光标前的一个词
''C-d''               :       删除光标后的一个字符
''M-d''               :       移除光标后的一个词
''C-k''               :        移除从光标到“行尾”间的字符
''M-k''               :       移除从光标到“句尾”间的字, 需要先按''C-k''，再用''M-k''进行选择
''@@color(red):C-x  h@@''               :       选中buffer中所有文件
''移除一段文字：''C-@ 或 ~C-SPC（最好使用C-@）。然后将光标移动到另一端，再按 C-w 就可以把位于这两点之间的所有文字移除了
''粘贴一段文字：''C-@ 或 ~C-SPC（最好使用C-@）。然后将光标移动到另一端，再按 M-w，然后在需要粘贴的地方C-y
''C-y'' : 召回最近一次移除的内容
''M-y'' : 召回前几次移除的内容
@@color(red):''注意''@@  移除（kill）和删除（delete）的不同在于被移除的东西可以找回来，而被删除的就不行
'' C-_/C-x u '' :  消除一个命令所造成的所有改变 (在撤销输入字符时，他会以20个字符为一个单位撤销)}}}
*@@color(blue):''保存文件''@@
&gt;{{normal{''C-x C-f ''  :  寻找一个文件
''C-x 4 C-f '' :  新窗格中寻找一个文件
''C-x 5 C-f''  : 新emacs进程中寻找一个文件
''C-x C-s''   :  储存这个文件 （每次都会备份）
''C-x s''      :  保存多个缓冲区
''M-x customize-variable &lt;Enter&gt; make-backup-files &lt;Enter&gt;''  : 关掉文件备份
''M-x recover file&lt;Enter&gt;'' :  来恢复你的自动保存文件
自动保存：Emacs 会定期将正在编辑的文件写入一个“自动保存”文件中。自动保存文件的文件名的头尾各有一个“#”字符，比如你正在编辑的文件叫“hello.c”，那么它的自动保存文件就叫“#hello.c#”      
''最开头的星号（*）表示你已经对文字做过改动。刚刚打开的文件肯定没有被改动过，所以状态栏上显示的不是星号而是短线（-）''}}}
*@@color(blue):''文字编辑/查找''@@
&gt;{{normal{''M-x **-mode''  :  模式切换
''M-x auto fill mode&lt;Enter&gt; '' : 启动自动折行模式。再用一次这条命令，自动折行模式被关闭。行边界default为 70 个英文字符，输入空格进行断行。
''C-x f '' : 并传递参数 20 (C-u 2 0): C-x f修改70个字符的限制。
''M-q''  :  手动折行
''M-x replace-string &lt;Enter&gt; changed &lt;Enter&gt; altered''  :  字符串替换
''C-s''  : 是向下搜索 &lt;Enter&gt;结束搜索，继续C-s搜索下一个
''C-r '' : 是向上搜索  &lt;Enter&gt;结束搜索，继续C-r搜索下一个}}}
*@@color(blue):''buffer操作''@@
&gt;{{normal{''C-x C-b''  :   列出缓冲区   在前面加d ，然后按x就可以执行
''C-x  b     buffer1'' : 切换到buffer1并关闭当前buffer
''@@color(red):C-x 4 b   buffer1@@'' : 切换到buffer1不关闭当前buffer
''C-x 5 b   buffer1'' : 新emacs进程中打开buffer1
''C-x k'' :       删除光标所在的那个buffer
''M-x revert-buffer'' : 缓冲区重新从硬盘读取文件
}}}
*@@color(blue):''多屏操作''@@
&gt;{{normal{@@color(green):一个屏以另一个屏为参考时比较有用@@
''C-x 2 '' :     它会将屏幕水平划分成两个窗格,显示相同内容
''C-x 3'' :      它会将屏幕垂直划分成两个窗格,显示相同内容
''~C-M-v ''     :滚动下方的窗格 （如果没有Meta（Alt）键，你必须先输入 ESC ，然后再输入 ~CONTROL-v）
''~C-M-shift-v '' :   相反方向 滚动下方的窗格
''C-x  o(other) '' :光标切换到另一个窗格(多窗格时才有用)
''C-x C-c '' :  退出Emacs（退出之前提醒存盘）}}}
</pre>
</div>
<div title="Emacs GDB" creator="Samuel" modifier="Samuel" created="201207100655" modified="201207130557" tags="_EMACS_ _EMACS_GDB_" changecount="27">
<pre>*@@color(blue):''外部启动与执行命令''@@
&gt;''M-x gdb''           :启动GDB
&gt;''M-x gdb-many-windows'' : 在多窗口和单窗口之间切换
&gt;''help(h)''            : 帮助
&gt;''run(r) [arglist]''  : 执行程序     
&gt;''file  fileName''    : 加载可执行文件   
&gt;''C-c C-c''   :   退出正在运行的程序
&gt;''C-x k''    :   关闭GDB buffer
*@@color(blue):''内部调试命令''@@
&gt;''until(u) [function][line][+line]'' : 执行到指定行数或后几行或函数
&gt;''next(n)  [para]'' : 默认执行下一行，无视函数
&gt;''step'' : 单步运行 进入函数(加行数也进入函数)
&gt;''continue(c) '': 到达下一个断点
&gt;''finish(fin)''   : 从当前的函数中返回
&gt;@@bgcolor(green):''直接按&lt;Return/Enter&gt;可以执行上一条命令''@@
*@@color(blue):''断点操作''@@
&gt;''break(b)  [函数名] [行号]'': 设置断点  @@color(green): 如： b file1.cpp : main    b file1.cpp : 12 (文件名可省略)@@
&gt;''C-x space '' :在光标处设置断点
&gt;''b +/-2 '' : 执行到某一行,+表示向后，-表示向前2两行设置断点
&gt;''info        breakpoints''   显示断点信息
&gt;''enable    breakpoints    number''  :使断点有效
&gt;''disable   breakpoints    number''  :是断点无效
&gt;''delete    breakpoints    number''   : 删除断点
*@@color(blue):''查看信息''@@
&gt;''print(p)   exression''  :    表达式可以是变量val，函数调用f(a,b)  
&gt;''backtrace(bt)'' : 显示到当前的函数调用记录
&gt;''gud-watch'' : 增加到查看列表
&gt;''gud-tooltip-mode'' :光标放在变量上时，会显示变量值
&gt;''gdb-use-separate-io-buffer'' :会显示一个单独的IO buffer
&gt;''info '' :显示各类信息 
*@@color(blue):''退出调试''@@
&gt;''kill(k)''    结束当前程序
&gt;''quit(q)''  退出GDB调试
</pre>
</div>
<div title="FFT" creator="YourName" modifier="Samuel" created="201208200746" modified="201208200747" changecount="2">
<pre>Type the text for 'FFT'</pre>
</div>
<div title="FILE IO" creator="Samuel" modifier="Samuel" created="201304161027" modified="201304161027" changecount="4">
<pre>*{{normal{@@color(blue): ''fgets'' @@
会把\n也读进来
}}}</pre>
</div>
<div title="Feature Extraction" creator="Samuel" modifier="Samuel" created="201207160245" modified="201303201031" tags="_IMAGE_ALGORITHM_ _FEATURE_" changecount="18">
<pre>[[HOG (Histogram of oriented gradient)]]
[[Haar]]

</pre>
</div>
<div title="GettingStarted" creator="Samuel" modifier="Samuel" created="201206270532" modified="201206270533" changecount="3">
<pre>To get started with this blank [[TiddlyWiki]], you'll need to modify the following tiddlers:
* [[SiteTitle]] &amp; [[SiteSubtitle]]: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)
* [[MainMenu]]: The menu (usually on the left)
* [[DefaultTiddlers]]: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened
You'll also need to enter your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;</pre>
</div>
<div title="Git" creator="Samuel" modifier="Samuel" created="201206200611" modified="201210190805" tags="_GIT_" changecount="120">
<pre>*@@color(blue):''Initializing''@@
**''git init :''
***初始化本地仓库，并生成.git目录 
***{{{--}}}bare 创建纯仓库
***-q , {{{--}}}quiet只输出错误和警告信息
***@@color(red): {{{--}}}shared {{{--}}}template ??@@
*@@color(blue):''[[Operating of local repository]]''@@

*@@color(blue):''[[Operating of remote repository]]''@@

*@@color(blue):''[[Branches and merging]]''@@

*@@color(blue):''[[Git tag]]''@@

*@@color(blue):''[[Others]]''@@

*使用gitosis的来配置管理的git服务器端

</pre>
</div>
<div title="Git tag" creator="Samuel" modifier="Samuel" created="201207190815" modified="201207190817" tags="_GIT_" changecount="3">
<pre>*''git tag''  （不带-a选项,轻量级标签（lightweight）和带注释的标签（annotated）
:列出所有tag
:-a  创建一个annotated标签
:-d  &lt;tagName&gt; 删除tag
:-l  &lt;pattern&gt;根据表达式列出所有tag
:-m 注释                 
*''git tag version1.6 -m 'version 1.6'''
:创建新tag
*''git checkout  &lt;tag_name&gt;''
*''git show &lt;tag_name&gt;''
</pre>
</div>
<div title="HOG (Histogram of oriented gradient)" creator="Samuel" modifier="Samuel" created="201207160247" modified="201303200749" tags="_IMAGE_ALGORITHM_ _FEATURE_ _HOG_" changecount="52">
<pre>@@bgcolor(green):说明@@
:Hog是一种局部特征，Dalal和Triggs发现在人的检测实验中，把方向分为9个通道效果最好
pHog是金字塔的hog特征
@@bgcolor(green):步骤@@
#''图像灰度化''[size:40*80]
#{{normal{''gamma归一化''@@bgcolor(green):(影响不大可省略)@@
output = input^gamma 即对输入进行幂指数的压缩（gamma = 1/2）
}}}
#{{normal{ ''将图像划分成小的cell单元（如5*5 cells），统计其梯度方向的直方图（9个bin最佳）''
:Gx (x,y)=H (x+1,y)-H (x-1,y)
:Gy (x,y)=H (x,y+1)-H (x,y-1)
式中,Gx(x,y)、Gy(x,y)、H(x,y)分别表示水平方向梯度、垂直方向梯度和像素值
像素点(x,y)处的梯度幅值和梯度方向为
:G(x,y) = sqrt( Gx(x,y)^2 +Gy(x,y)^2 )
:a(x,y)  = atan( Gy (x,y)/Gx(x,y))
在进行9bin的方向统计时，可以用梯度幅值直接作为权重，或幅值的函数如（取平方根， 取整）
}}}
#{{normal{ ''划分成不同的block（如：10*20 pixels，block步长为（5*10））''
这样每个block中有(10/5)*(20/5)*9=2*4*9bin的特征。 由于block的步长小于block的宽度，这样一个cell会在多个block中出现。
本例中可以有7*7个block(计算方法：((imageW-blockW)/blockStrideX+1) * ((imageH-blockH)/blockStrideY+1))
}}}
# ''对每一个block内的特征向量进行归一化(每个block单独进行，找到最大最小值，归一化)''
</pre>
</div>
<div title="Howto hide the left MainMenu" creator="Samuel" modifier="Samuel" created="201207170828" modified="201303010225" changecount="7">
<pre>1.隐藏 mainMenu
a.可将 PageTemplate 中的 &lt;div id=’mainMenu’ …&gt; 移除或是改成 &lt;div id=’mainMenu’ …style=”display:none;”….&gt;
b.另外需修改 &lt;div id=’displayArea’ style=’margin: 1em 17em 0em 1em;’&gt;
2.同时修改 sideBar 宽度
a.另建一 tiddler (MyStyle) 内容如下,
#displayArea { margin: 1em 17em 0em 1em; }
#sidebar {width: 17em;}
#sidebarTabs .tabContents {width: 16em;}
b.在 StyleSheet 或 StyleSheetLaouts 中加入[[MyStyle]]</pre>
</div>
<div title="Img format convertion" creator="Samuel" modifier="samuel" created="201207180853" modified="201209270111" tags="_IMG_FORMAT_" changecount="15">
<pre>*@@color(blue):''RGB  -&gt; GRAY''@@
:Gray= R*0.229 + G*0.587 + B*0.114
*@@color(blue):''RGB  -&gt; ~YCrCb''@@
:Y=0.299*R + 0.587*G + 0.114*B
:Cr=(R - Y)*0.713 + 128
:Cb=(B - Y)*0.564 + 128
*@@color(blue):''RGB  -&gt; HSV HSL''@@



</pre>
</div>
<div title="Img processing" creator="samuel" modifier="Samuel" created="201209270110" modified="201301170726" changecount="18">
<pre>[[Img format convertion]]
[[Manhattan Distance]]
[[形态学的腐蚀和膨胀]]
[[直方图均衡化(Histogram Equalization)]]
[[协方差-方差-标准差]]
[[寻找角点]]
[[梯度]]
[[coherent enhancing diffusion]]
[[watershed]]
[[PCA]]
[[最小二乘法直线拟合]]</pre>
</div>
<div title="Java" creator="Samuel" modifier="Samuel" created="201210170117" modified="201304070617" changecount="15">
<pre>[[Java Datatype]]
[[Java Method]]
[[Java Class]]
[[Java Exception]]
[[Java  GUI]]
[[Java 泛型]]
[[java Miscellaneous]]
</pre>
</div>
<div title="Java  GUI" creator="Samuel" modifier="Samuel" created="201210190515" modified="201210190516" changecount="3">
<pre>*''@@color(blue):javax.swing.~JFileChooser@@''
&gt;创建文件选择对话框</pre>
</div>
<div title="Java Class" creator="Samuel" modifier="Samuel" created="201210180735" modified="201302261030" changecount="61">
<pre>@@color(red):说明@@
&gt;一个java源文件中只能最多有一个public类。
&gt;java源文件的名字必须和public类相同，没有public类不要求
&gt;java中main函数必须在公用类中吗
&gt;java中类变量可以初始化。@@color(red):C++不行（类定义是是抽象的没有实例化， java实例化了吗）@@
*{{normal{''构造函数''
*没有返回类型
*构造函数支持重载
*当类没有提供构造函数的时候@@color(red):(提供了就不会)@@，会隐含定义一个方法体为空的无参构造函数
*在构造函数使用@@color(blue):this（参数列表）@@调用其他构造函数@@color(red):（c++中不可以， c++的构造函数或其他方法调用其他构造函数时没有this指针的， 只是临时生成一个对象， 调用完就撤消了，相当于没有效果）@@
}}}
*{{normal{''匿名对象''
*类似于匿名数组
}}}
*{{normal{''@@color(blue):static@@变量和方法''
*所有对象共享的。可以通过@@color(red):引用变量或类名@@来访问
*@@color(red):实例变量和方法不能被静态变量和方法访问@@，反之可以
*类中的实例变量或静态变量可以初始化， @@color(red):C/C++不可以必须是const static才可以@@
}}}
*{{normal{''包package'' -@@color(red):外面用文件夹管理，必须创建文件夹吗?@@
*没有使用则使用默认的包
*package package_father.name; 放在类名前面语句@@color(green):''必须顶行''@@， 不同地方可以使用相同的包名。表示属于同一个包,可以有多层包
*使用package以后，其中的类可以和其他package中的类同名。相当于namespace
}}}
*{{normal{''可见性修饰符-四种p319''
*default@@color(red):(什么也不加，有包的概念)@@ ： 可以被同一个包@@color(green):(package)@@中的任何类访问， @@color(red):不能被其他包中的类访问， 子类也不能访问@@
*public  ： 可以被任意包@@color(green):(package)@@中的任何类访问
*private  ： 只能在自己的类中被访问
*protected:不同包中的类对象不能访问@@color(red):(同一个包中的其他类是可以访问的)@@，子类可以访问。
}}}
*{{normal{''继承、覆盖''
*java不支持多重继承 使用@@color(blue):''extents''@@ 关键字，只能public继承
*如果子类中没有显式的调用super，java会自动调用super(), @@color(red):所以最好为每个类定义一个无参的构造方法@@
*@@color(red):如过对象没有定义继承，则默认是继承object的@@。object中''tostring''方法，返回类的描述
*父类中被覆盖的静态函数需要使用superclassname.func而不是super.func
*使用@@color(blue):''final''@@定义类是不能被继承的

}}}
*{{normal{@@color(blue):''instanceof''@@
#判断是否为一个对象的实例的关键字 ： a instanceof  b
#判断是否是一个类的实例，子类对象可以是父类对象的实例，因为它可以调用父类的所有方法和数据
}}}
*{{normal{@@color(blue):''接口''@@
#接口里面的变量都是final的， 函数都是abstract。 默认关键字可以省略。
#接口可以继承多个接口
}}}</pre>
</div>
<div title="Java Datatype" creator="Samuel" modifier="Samuel" created="201210170119" modified="201302260955" changecount="64">
<pre>@@color(red):''说明：''@@
&gt;''java中数组和以new创建的对象是在堆中，其余在栈中''
&gt;''当没有引用指向数组和对象时，其会被java自动释放，@@color(red):后面再用就不保险了@@''
&gt;''当某些对象不想用的时侯，@@color(red):可以将该对象的引用赋null@@，如果没有其他的引用指向它的时候就会被释放''
*{{normal{@@color(blue):''常量用final 而不是const''@@
@@color(blue):final static int@@ a;
}}}
*{{normal{@@color(blue):''char''@@
#Java中char默认是Unicode型的，所以占有两个字节@@color(green):（Character.SIZE/8） @@
#与其他类型的转换问题 （基本程序设计 p37）
}}}
*{{normal{@@color(blue):''string''@@
*''string是对象''
&gt; Java中将字符串默认为string对象， 所有String str=“welcome” 是合法的 
*''string对象是不可改变的，可以使用~StringBuffer或~StringBuilder替代''
&gt;~StringBuffer的修改缓冲区是同步的，实用于多任务。其他~StringBuffer和~StringBuilder可以互用
*''可以转换成数组''
&gt;char[] array = &quot;welcome&quot;.toCharArray()
*''数组构造string''
&gt; 用valueOf @@color(green):(也可以转换数字)@@或者构造函数
*''格式化字符串''
&gt;format函数
}}}
*{{normal{@@color(blue):''数组''@@
@@color(red):java中数组被看做是对象@@
*''定义方式''
&gt;@@color(blue):double@@[] arrary1 = @@color(blue):new double@@[10];
&gt;@@color(blue):double@@[] arrary1 = {1.0,2.0};
*@@color(blue):''支持for-each语法''@@
&gt;@@color(blue):for@@(@@color(blue):double@@ u : array1): ''缺点无法知道是第几个值，且其必须是顺序访问''
*{{normal{''数组复制''
#可以使用@@color(blue):''java.lang.System''@@中的@@color(blue):arraycopy@@
#循环
#@@color(red):clone(见14章)@@
}}}
*''匿名数组'': new int []{1,2,3,4}
&gt;因为是匿名无法使用其他引用指向它， 一般都只是用一次
*''二维以及n维数组可以支持锯齿数组''
&gt;每个n-1维的数组长度可以不同
*''其他数组类''
&gt;@@color(blue):''java.util.Arrays''@@类中包含很多对数组操作的函数。如：search，sort
&gt;''使用~ArrayList类来创建存储个数不定的对象，相当于vector''
}}}
*{{normal{@@color(blue):''数据类型包装类''@@
@@color(red):Java对每一个数据类型都有包装类@@，其中有很多是静态方法如：
Character , Boolean, Byte, Short, Integer,Long , Float 和 Double
}}}</pre>
</div>
<div title="Java Exception" creator="Samuel" modifier="Samuel" created="201210220236" modified="201303180535" changecount="8">
<pre>*Java不允许编写代码捕获或声明免检异常？
*如果方法声明了一个必捡异常，调用是必须用try-catch？？
*catch中throw的会怎么样？ 看一下p362的答应结果
</pre>
</div>
<div title="Java Method" creator="Samuel" modifier="Samuel" created="201210170453" modified="201302190314" changecount="19">
<pre>*{{normal{@@color(blue):''main函数''@@
main函数返回值必须为void
}}}
*{{normal{@@color(blue):''可变参数列表''@@
*@@color(red):可变参数必须放在最后且只能有一个@@， 会将其当着数组对待。所以可以传数组
&gt;@@color(blue):public static void @@method（@@color(blue):int @@a, @@color(blue):double...@@ bs） 
*与数组参数的区别: 1)可变参数既可以传数组也可以传多个变量, 更灵活
}}}
*{{normal{@@color(blue):''java只有值传递没有引用传递''@@
*对象和数组相当于C/C++中的指针也是值传递
}}}
*{{normal{@@color(blue):''java支持函数重载''@@
*必须具有不同的参数列表，不能基于不同的修饰符或返回值类型来重载方法
}}}
*{{normal{@@color(blue):''java方法中的变量的默认值''@@
*java不会为方法中的局部变量提供默认值， 使用时会出现编译错误
*java为类中的变量提供了默认值，引用类型为null，数值类型为0，boolean为false，char为'\u0000'
}}}</pre>
</div>
<div title="Java 泛型" creator="samuel" modifier="samuel" created="201210230854" modified="201210230934" changecount="12">
<pre>*{{normal{@@color(blue):''泛型的用处''@@
*泛型的数据类型是在编译阶段检测的，所有更安全。 @@color(red):提高软件的可靠性@@
*@@color(red):泛型的数据类型必须是引用@@，即是类而不能是int，short这样的基本类型
*当使用泛型类没有指定具体类型时， 相当于使用Object类型
}}}
*{{normal{@@color(blue):''泛型定义方法''@@
*class：放在类名之后。如：public class classname&lt;E&gt;
*method : 放在方法返回类型之前。如：public &lt;E&gt; void function()
}}}
*{{normal{@@color(blue):''受限泛型''@@
*泛型是某个类的子类型： &lt;E extents  className&gt;
*非受限泛型是某object的子类型： &lt;E&gt; = &lt;E extends Object&gt;
}}}
*{{normal{@@color(blue):''泛型的使用限制''@@
*不能用new E()和new E[]@@color(red):(可以使用折中方法见p10)@@
*@@color(red):静态方法和静态变量不允许是泛型类型@@,静态的方法和类是属于所有类的实例的
*异常类不能是泛型
}}}
</pre>
</div>
<div title="K-means" creator="samuel" modifier="samuel" created="201209270617" modified="201209270723" changecount="6">
<pre>*{{normal{@@color(blue):''算法''@@
#从N个文档@@color(green):''随机选''@@取K个文档作为质心可以@@color(red):(可以多跑几边，取最小值)@@
#对剩余的每个文档测量其到每个质心的距离，并把它归到最近的质心的类
#重新计算已经得到的各个类的质心@@color(red):(每个类的平均值)@@
#迭代2～3步直至新的质心与原质心相等或小于指定阀值，算法结束
}}}
*{{normal{@@color(blue):''缺点''@@
#k的大小对结果影响比较大
}}}</pre>
</div>
<div title="LATEX" creator="Samuel" modifier="samuel" created="201211260252" modified="201304030527" changecount="78">
<pre>*{{normal{''换行与空格''
\\或\newline
\hspace{8mm}
}}}
*{{normal{''字体大小''
|!点数(pt) |!中文字号|!控制命令|
|25  |一号      |\Huge  |
|20  |二号      |\huge  |
|17  |三号      |\LARGE |
|14  |四号      |\Large |
|12  |小四号  |\large |
|10  |五号      |\normalsize |
|9    |小五号  |\small |
|8    |六号      |\footnotesize |
|7    |小六号  |\scriptsize |
|5    |七号      |\tiny |
}}}
*{{normal{''上下标''
用^来表示上标, 用_来表示下标. 如果上标的内容多于一个字符, 注意用{ } 把上标括起来
}}}
*{{normal{''符号''
|!符号 |表示方法|
| $$\sideset{^1_2}{^3_4}\sum   \sum\limits_{k=1}^n $$ | \sum |
| $$\sideset{^1_2}{^3_4}\prod$$ | \prod |
| $$\sideset{^1_2}{^3_4}\bigotimes$$ | \bigotimes|
| $$\in$$ | \in|
}}}

*{{normal{''sample''
$$
\left( \begin{array}{c}
\left |\begin{array}{cc}
a+b&amp;b+c\\c+d&amp;d+a
\end{array}
\right |\\
y\\z
\end{array}\right )
$$

\[\int_a^b x = \frac{1}{2}(b^2-a^2)\] 

$$ c_2=\begin{cases} 
gamma+(1-gamma)*exp(-lambda/(mi1-mi2)^m ) \\ 
 gamma 
\end{cases}$$
}}}
*{{normal{''右对齐''
 \(y\)
}}}</pre>
</div>
<div title="Linux" creator="Samuel" modifier="Samuel" created="201207160840" modified="201304080128" tags="_LINUX_COMMAND_" changecount="9">
<pre>[[Linux FAQ]]
[[Linux 命令]]
[[Linux 技巧 ]]
</pre>
</div>
<div title="Linux FAQ" creator="Samuel" modifier="Samuel" created="201212050335" modified="201212140320" changecount="22">
<pre>#{{normal{''Q:远程运行opengl程序无法显示窗口''
''A:'' : #export ~LIBGL_ALWAYS_INDIRECT=yes
#也可以加到代码中#include &lt;stdlib.h&gt;  setenv (&quot;~LIBGL_ALWAYS_INSIRECT&quot;, &quot;yes&quot;, 1);
#将export ~LIBGL_ALWAYS_INDIRECT=yes加到自己的目录下的.bashrc或.bash_profile
refer to : https://bugs.freedesktop.org/show_bug.cgi?id=24226
}}}
#{{normal{''Q:环境配置''
''A:'' :可以在/etc/profile@@color(green):(对所有人有效)@@或~/.profile@@color(green):(对自己有效)@@中进行环境设置. 如：export val= PATH=等
}}}
#{{normal{''Q:加共享库到搜索路径中''
# export ~LD_LIBRARY_PATH = \PATH  @@color(geen):(也可以设置到.bashrc或.bash_profile中去)@@
#增加编译选项'' -Wl,-rpath, /path1:/path2''
#在/etc/ld.so.conf中加入路径，一行一个路径。 然后运行 sudo ldconfig使修改后的配置生效

*{{normal{''搜索路径''
#编译目标代码时指定的动态库搜索路径;
#环境变量~LD_LIBRARY_PATH指定的动态库搜索路径;
#配置文件/etc/ld.so.conf中指定的动态库搜索路径;
#默认的动态库搜索路径/lib;
#默认的动态库搜索路径/usr/lib
}}}
}}}</pre>
</div>
<div title="Linux 命令" creator="Samuel" modifier="Samuel" created="201212050334" modified="201304080128" changecount="4">
<pre>&gt;[[shift]]   : 移动shell脚本传入的参数位置
&gt;[[$()与``]] :命令替换符， 在其中执行命令并作为输入
&gt;[[’ ‘与“ ”]]  : 单引号防止字符扩展
&gt;[[eval]] : 对参数求值
&gt;[[tr]] : 转换字符
&gt;[[export]] : 设置环境变量
&gt;[[tar]] : 解压或压缩文件
&gt;[[rm]] : 删除文件
&gt;[[ln]] : 建立链接
&gt;[[xargs]]:将前一输入转换为后面命令的输入参数。多用于管道
&gt;[[find]] : 查找文件和文件夹</pre>
</div>
<div title="Linux 技巧" creator="Samuel" modifier="Samuel" created="201304080129" changecount="1">
<pre>*{{normal{获取文件的绝对路径
find $(pwd)/ -type f
}}}</pre>
</div>
<div title="MainMenu" creator="YourName" modifier="samuel" created="201206180446" modified="201303280243" changecount="82">
<pre>!Tools
[[Git]]
[[Emacs]]
[[Linux]]
[[TiddlyWiki Turior]]
!Languages
[[Python]]
[[Shell]]
[[OpenCL]]
[[OpenGL]]
[[Object C]]
[[C/C++]]
[[Java]]
!Compiler Tools
[[Cmake]]
[[Make]]
!Math
[[sort]]
!Image Processing
[[terminology-术语]]
[[Feature Extraction]]
[[Img processing]]
[[Training&amp;detection]]
[[FFT]]
! Miscellaneous 
[[Todo]]
</pre>
</div>
<div title="Make" creator="Samuel" modifier="Samuel" created="201206190153" modified="201301230048" tags="_Make_" changecount="17">
<pre>*[[gcc&amp;g++]]
*[[make learning]]

</pre>
</div>
<div title="Manhattan Distance" creator="Samuel" modifier="Samuel" created="201301080732" modified="201301080736" changecount="12">
<pre>http://ostermiller.org/dilate_and_erode.html
*{{normal{1-D
&lt;code c&gt;
// O(n) solution to find the distance to &quot;on&quot; pixels in a single dimension array
int[] distance(int[] arr){
    // traverse forwards
    for (int i=0; i&lt;arr.length; i++){
        if (arr[i] == 1){
            // first pass and pixel was on, it gets a zero
            arr[i] = 0;
        } else {
            // pixel was off
            // It is at most the length of array
            // away from a pixel that is on
            arr[i] = arr.length;
            // One more than the pixel to the left
            if (i&gt;0) arr[i] = Math.min(arr[i], arr[i-1]+1);
        }
    }
    // traverse backwards
    for (int i=arr.length-1; i&gt;=0; i--){
        // what we had on the first pass
        // or one more than the pixel to the right
        if (i+1&lt;arr.length) arr[i] = Math.min(arr[i], arr[i+1]+1);
    }
    return arr;
}
&lt;/code&gt;
}}}
*{{normal{2-D
&lt;code c&gt;
int[][] manhattan(int[][] image){
    // traverse from top left to bottom right
    for (int i=0; i&lt;image.length; i++){
        for (int j=0; j&lt;image[i].length; j++){
            if (image[i][j] == 1){
                // first pass and pixel was on, it gets a zero
                image[i][j] = 0;
            } else {
                // pixel was off
                // It is at most the sum of the lengths of the array
                // away from a pixel that is on
                image[i][j] = image.length + image[i].length;
                // or one more than the pixel to the north
                if (i&gt;0) image[i][j] = Math.min(image[i][j], image[i-1][j]+1);
                // or one more than the pixel to the west
                if (j&gt;0) image[i][j] = Math.min(image[i][j], image[i][j-1]+1);
            }
        }
    }
    // traverse from bottom right to top left
    for (int i=image.length-1; i&gt;=0; i--){
        for (int j=image[i].length-1; j&gt;=0; j--){
            // either what we had on the first pass
            // or one more than the pixel to the south
            if (i+1&lt;image.length) image[i][j] = Math.min(image[i][j], image[i+1][j]+1);
            // or one more than the pixel to the east
            if (j+1&lt;image[i].length) image[i][j] = Math.min(image[i][j], image[i][j+1]+1);
        }
    }
    return image;
}
&lt;/code&gt;
}}}</pre>
</div>
<div title="MarkupPostBody" creator="YourName" modifier="YourName" created="201206180442" changecount="1">
<pre></pre>
</div>
<div title="MathJaxPlugin" creator="Samuel" modifier="Samuel" created="201207180919" modified="201207180934" tags="systemConfig" changecount="7">
<pre>/***
|''Name:''|MathJaxPlugin|
|''Description:''|Enable LaTeX formulas for TiddlyWiki|
|''Version:''|1.0.1|
|''Date:''|Feb 11, 2012|
|''Source:''|http://www.guyrutenberg.com/2011/06/25/latex-for-tiddlywiki-a-mathjax-plugin|
|''Author:''|Guy Rutenberg|
|''License:''|[[BSD open source license]]|
|''~CoreVersion:''|2.5.0|
 
!! Changelog
!!! 1.0.1 Feb 11, 2012
* Fixed interoperability with TiddlerBarPlugin
!! How to Use
Currently the plugin supports the following delemiters:
* &quot;&quot;&quot;\(&quot;&quot;&quot;..&quot;&quot;&quot;\)&quot;&quot;&quot; - Inline equations
* &quot;&quot;&quot;$$&quot;&quot;&quot;..&quot;&quot;&quot;$$&quot;&quot;&quot; - Displayed equations
* &quot;&quot;&quot;\[&quot;&quot;&quot;..&quot;&quot;&quot;\]&quot;&quot;&quot; - Displayed equations
!! Demo
This is an inline equation \(P(E)   = {n \choose k} p^k (1-p)^{ n-k}\) and this is a displayed equation:
\[J_\alpha(x) = \sum_{m=0}^\infty \frac{(-1)^m}{m! \, \Gamma(m + \alpha + 1)}{\left({\frac{x}{2}}\right)}^{2 m + \alpha}\]
This is another displayed equation $$e=mc^2$$
!! Code
***/
//{{{
config.extensions.MathJax = {
  mathJaxScript : &quot;http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML&quot;,
  // uncomment the following line if you want to access MathJax using SSL
  // mathJaxScript : &quot;https://d3eoax9i5htok0.cloudfront.net/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML&quot;,
  displayTiddler: function(TiddlerName) {
    config.extensions.MathJax.displayTiddler_old.apply(this, arguments);
    MathJax.Hub.Queue([&quot;Typeset&quot;, MathJax.Hub]);
  }
};
 
jQuery.getScript(config.extensions.MathJax.mathJaxScript, function(){
    MathJax.Hub.Config({
      extensions: [&quot;tex2jax.js&quot;],
      &quot;HTML-CSS&quot;: { scale: 100 }
    });
 
    MathJax.Hub.Startup.onload();
    config.extensions.MathJax.displayTiddler_old = story.displayTiddler;
    story.displayTiddler = config.extensions.MathJax.displayTiddler;
});
 
config.formatters.push({
	name: &quot;mathJaxFormula&quot;,
	match: &quot;\\\\\\[|\\$\\$|\\\\\\(&quot;,
	//lookaheadRegExp: /(?:\\\[|\$\$)((?:.|\n)*?)(?:\\\]|$$)/mg,
	handler: function(w)
	{
		switch(w.matchText) {
		case &quot;\\[&quot;: // displayed equations
			this.lookaheadRegExp = /\\\[((?:.|\n)*?)(\\\])/mg;
			break;
		case &quot;$$&quot;: // inline equations
			this.lookaheadRegExp = /\$\$((?:.|\n)*?)(\$\$)/mg;
			break;
		case &quot;\\(&quot;: // inline equations
			this.lookaheadRegExp = /\\\(((?:.|\n)*?)(\\\))/mg;
			break;
		default:
			break;
		}
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,&quot;span&quot;,null,null,lookaheadMatch[0]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
});
//}}}</pre>
</div>
<div title="Object C" creator="Samuel" modifier="Samuel" created="201209180324" modified="201209210754" changecount="10">
<pre>[[Object C FAQ]]
[[Object C : Class]]
[[Object C : Protocol]]
[[Object C : Category]]</pre>
</div>
<div title="Object C : Category" creator="Samuel" modifier="Samuel" created="201209200718" modified="201209200718" changecount="2">
<pre>*{{normal{@@color(blue):''功能''@@
对类进行扩展
}}}</pre>
</div>
<div title="Object C : Class" creator="YourName" modifier="Samuel" created="201209200156" modified="201302230819" tags="_OBJECT_C_LEARNING_" changecount="105">
<pre>  1)[self class]指向的是接受消息的对象。
      所以如果在父类A中的[self class].在子类B中调用时返回的是子类B对象而不是基类A对象。通过A调用返回的是A对象
   2)同(1)[self superclass]指向的是接受消息的对象的福对象.
     所以如果在父类A中的[self superclass].在子类B中调用时返回的是A对象。通过A调用返回的是A的父对象
   3)[super class]结果同（1）相同。@@color(red):class是类的实例方法。内部应该返回的是[self class]。所以调用效果类似于[self class]@@


*{{normal{@@color(blue):''key''@@
*@@color(red):''类中方法有相同的名字的时候，一定要有相同的参数名和函数名''@@(learning object -C 2.0  105的例子 )
*''overwrite copywithzone'' 函数时一定要小心，使用 [self class] 而不是直接写类名（learning object -C 140）@@color(red):''任何类中使用自己类名时，都要使用self''@@
*''intialized'' : 在发送alloc消息的时候，会调用intialized。当子类继承父类没有overwrite的时候，@@color(red):会产生两次调用@@ (learning object -C 2.0 150)
*object c是不允许在栈上创建类对象的，@@color(red):所以你只能创建类指针在堆上面@@
*每个对象都会自动增加一个实例isa变量，用来指向类结构信息；发送消息时会增加self和cmd（方法名）两个变量（learning object -C 106 ： under the hood）
*''forwardInvocation'' : 当方法没有找到时，会抛出错误。 你可以重写这个方法， 这样你就可以把出错的消息发给其他对象来执行
*''IMP'' :  消息的发送是比纯C 慢的， 如果你的消息发送是在上千次的循环中， 可以使用IMP来获取函数指针（learning object -C 109 ： efficiency）@@color(red):''（写一个例子????）''@@
*''respondsToSelector'': 判断协议是否被实现，当协议被实现但是没在头文件声明的时候也会返回false
*{{normal{''class'' 和 ''superclass''方法可以返回类和超类如：
&lt;code c&gt;
Class objectsClass;
Class objectsSuperClass;
id anObject;
objectsClass = [anObject class];
objectsSuperClass = [anObject superclass];
&lt;/code&gt;
}}}
*''isMemberOfClass: and isKindOfClass'' : 判断是否为一个类的实例(learning object -C 2.0  145)
}}}

*{{normal{@@color(blue):''关键字''@@
object c中使用@@color(blue):@interface@@， 而不是@@color(blue):@class@@。 @@color(blue):''@class''@@是一个''前向声明''
**{{normal{''前向声明''
#''用法1''  :  当类A和B互相引用时，如A引用B，但此时B没有定义需要使用前向声明。前向声明中不能定义对象 @@color(red):(无法得到对象的具体信息，析构的时候，将无法析构参数类存泄露)@@，只能定义指针或引用
#''用法2''  :  前向声明可以将少编译时间, 当头文件发生改变时，所有引用这个头文件的都要重编译，使用@@color(blue):@class@@则不需要(learning object -C 2.0: 117)
}}}
}}}
*{{normal{@@color(blue):''static属性''@@
*''static变量''
&gt;1、c++中static变量必须在类外面初始化@@color(green):(如：int class::var=0)@@,否则类中其他函数不可引用。是类变量，只能由类中函数调用
&gt;2、object c中不支持。static会被忽略。可以定义全局static变量， 然后使用类方法来访问实现
*''static函数''
&gt;1、c++中static函数不可访问类成员变量及类函数@@color(green):(只能访问static的变量和函数,其不包含this指针)@@，不能被定义成virtual和const函数@@color(green):(类中const函数表示此函数不能修改类成员的值)@@
&gt;2、object c中使用+放在函数前面来实现
}}}
*{{normal{@@color(blue):''@public, @private, @protected @package''@@
#object c中只有变量有这3个属性@@color(green):(默认是protected)@@，函数没有@@color(green):(全是public)@@。(@@color(red):''说明''@@：private不能被类对象和''派生类''访问. protected可以被派生类访问。这就是protected存在的用处)
#可以不再头文件中定义，但在源文件中实现来模拟private，但是也是可以调用只不过在头文件中隐藏了
}}}
*{{normal{@@color(blue):''继承''@@
继承只能是public，且一个类只能继承一个父类， @@color(red):即不允许多重继承，而是通过协议来做@@ 
}}}
*{{normal{@@color(blue):''重载''@@
函数和C一样不能重载，但方法(类中的函数)可以根据label重载。
}}}</pre>
</div>
<div title="Object C : Protocol" creator="Samuel" modifier="Samuel" created="201209200601" modified="201209200717" changecount="10">
<pre>*{{normal{@@color(blue):''关键字''@@
#object c中使用@@color(blue):@protocol@@ 和 @@color(blue):@end@@来实现协议 。 
#类实现时使用''&lt;...&gt;''表明
#~Objective-C 2.0 提出了新的关键字@@color(blue):@optional@@ 和 @@color(blue):@required@@
}}}
*{{normal{@@color(blue):''正式协议''@@
#协议中不能有变量
#类必须实现协议中的所有方法
#一个类可以实现多个协议
#一个类也可以不经过协议声明，直接实现协议规定的方法。但是，conformsToProtocol: 方法依然返回 NO。
}}}
*{{normal{@@color(blue):''非正式协议''@@
#其实就是一个分类，可以让代码可读。object c2以后都应该用正式协议的optional
}}}</pre>
</div>
<div title="Object C FAQ" creator="Samuel" modifier="Samuel" created="201209180325" modified="201209210754" changecount="9">
<pre></pre>
</div>
<div title="OpenCL" creator="YourName" modifier="Samuel" created="201208280252" modified="201302050613" tags="__OPENCL__ __LANGUAGE__" changecount="11">
<pre>[[OpenCL Learning]]
[[OpenCL update 1.0-1.2]]
[[Optimized Stradegy]]
[[C/C++ optimize]]</pre>
</div>
<div title="OpenCL Learning" creator="Samuel" modifier="Samuel" created="201208280328" modified="201301180849" changecount="63">
<pre>*{{normal{@@color(blue):''cl_context''@@
*可以和@@color(red):''N''@@个device联系到一起创建@@color(red):''一个''@@context, 创建cotext的时候可以创建一个回调函数来打印错误。
}}}
*{{normal{@@color(blue):''cl_command_queue''@@
*必须和一个context和一个device联系到一起，一个ct有@@color(red):''N''@@个devices就可以有创建@@color(red):''N''@@个cq, 可以通过多线程是这@@color(red):''N''@@个cq同时运行
}}}
*{{normal{@@color(blue):''constant memory''@@
*可以再主机端动态分配，主机端：''Read / Write''. 
*constant memory是来自global memory的，所以是否有加速就需要看硬件的设计了
}}}
*{{normal{@@color(blue):''synchronization''@@
*host : commands之间的同步有两种Command-queue barrier（''clEnqueueBarrier'',只适合single command-queue）和Waiting on an event
*device : block之间是无法同步的
}}}
*{{normal{@@color(blue):''clEnqueueTask ''@@
*clEnqueueTask 相当于clEnqueueNDRangeKernel 的work_dim = 1,global_work_offset = NULL, global_work_size[0] set to 1 and local_work_size[0] set to 1.即占用一个block，@@color(red):其他block不是浪费了吗？@@
}}}
*{{normal{@@color(blue):''kernel''@@
*当enqueue一个kernel时，函数是立即返回的
*kernel的二进制编译码可以通过clGetProgramInfo获取
*可以执行不是通过opencl编译的在主机端的C/C++代码@@color(green):(clEnqueueNativeKernel)@@ @@color(red):（try）@@
}}}
*@@color(blue):''支持typedef''@@

</pre>
</div>
<div title="OpenCL update 1.0-1.2" creator="Samuel" modifier="Samuel" created="201208280254" modified="201212070200" changecount="72">
<pre>*@@color(blue):''~OpenCL-1.0''@@
*@@color(blue):''~OpenCL-1.1''@@
**{{normal{''Platform Mixed Version Support''(spec3.1.1):
#支持不同的平台，不同的device，以及不同的~OpenCL版本的混合编程
}}}
**{{normal{''buffer''(Spec5.2.1)
#增加了''clCreateSubBuffer''函数来获取@@color(green):sub-buffer@@.
#增加了''clEnqueueRead/Write/~CopyBufferRect''函数来来操作2-D或3-D图像区域
}}}
**{{normal{''event'')
#增加了''clSetEventCallback''函数来获取@@color(green):sub-buffer@@.
}}}
**{{normal{''数据类型''
#增加3维的矢量支持， @@color(red):数据对齐是还是以vector4对齐的， 是以pow（2）对齐的@@
}}}
**{{normal{''global和local之间的内存异步copy''
#增加了async_work_group_strided_copy函数
}}}
**{{normal{''原子操作''
#变成了内建操作， 但是其修饰符（如：cl_khr_local_int32_base_atomics）任然支持
}}}
*@@color(blue):''~OpenCL-1.2''@@
**{{normal{''Partitioning a Device'' (Spec4.3)
#创建sub-device，''clReleaseDevice''只在1.2以后有定义
}}}
**{{normal''{context''(Spec4.4)
#增加了''~CL_CONTEXT_INTEROP_USER''属性，同外部的API数据共享时谁负责同步（见extention spec）
}}}
**{{normal{''buffer (buffer/image object)''(Spec5.2.1)
#增加了''~CL_MEM_HOST_WRITE_ONLY, ~CL_MEM_HOST_READ_ONLY,(优化数据的读写) ~CL_MEM_HOST_NO_ACCESS''三个属性.
#增加了''clEnqueueFillBuffer''函数来设置buffer的值.
#改变了分配~ImageObject的方法， 可以分配一维的image buffer(将buffer映射到image)，以及1D, 2D的image  和image array.
#增加了''clEnqueueFillImage''函数来设置image的值.
#@@color(red):增加clEnqueueMigrateMemObjects来显式使buffer迁移到一个设备上, 减少第一次使用时的隐式初始化的延迟(隐式第一次使用他是根据command来选择需要在哪个设备上的。)@@(spec5.4.4)
#在kernel中读写image时支持Sampler-less的read/write_image. 具有默认的sampler
}}}
**{{normal{''program''
#增加了clCreateProgramWithBuiltInKernels函数
#增加了clLinkProgram和clCompileProgram将编译和链接分开
}}}
**{{normal{''kernel''
#增加了clGetKernelArgInfo函数
}}}
**{{normal{''event''
#clEnqueueMarker/Barrier被改为clEnqueueMarker/~BarrierWithWaitList
#clEnqueueWaitForEvents被删除，可以用clEnqueueBarrierWithWaitList来完成
}}}
**{{normal{''数据类型''
#double为内建的标量Scalar和矢量Vector
#增加了image1d_buffer_t，image1d_array_t等内建类型
#支持@@color(blue):typedef, extern 和static@@
}}}
**{{normal{''增加了printf功能''
}}}
</pre>
</div>
<div title="OpenCV" creator="samuel" modifier="samuel" created="201303280242" modified="201303280242" changecount="2">
<pre>*[[opencv内存分配]]</pre>
</div>
<div title="OpenCV Cascade AdaBoost" creator="Samuel" modifier="Samuel" created="201303120911" changecount="1">
<pre></pre>
</div>
<div title="OpenGL" creator="YourName" modifier="Samuel" created="201210240147" modified="201212070130" changecount="22">
<pre>*临时修改一些状态时，需使用push和pop操作，这比直接修改效率更高
*在渲染多边形的顶点不在一个平面上的时候，应该使用三角形来代替。三角形始终在一个平面上
*{{normal{计算多边形的正面和背面的公式：
$$
\LARGE
a = \frac{1}{2}\sum\limits_{i=0}^{n-1}x_iy_{(i+1)\%n} - x_{(i+1)\%n}y_i  \\
-------指定了GL\_CCW，a&gt;0为正面
$$
}}}
*glBegin和glEnd之间不要修改数据。无法知道是渲染修改后的数据还是修改前的数据

[[OpenGL版本支持]]</pre>
</div>
<div title="OpenGL版本支持" creator="Samuel" modifier="Samuel" created="201212070131" modified="201212070134" changecount="5">
<pre>*{{normal{''~OpenGL2.1''
#支持在缓冲区对象存储像素数据
}}}
*{{normal{''~OpenGL1.5''
#支持缓冲区对象
}}}
*{{normal{''~OpenGL1.4''
#支持glMutilDrawElement
}}}
</pre>
</div>
<div title="Operating of local repository" creator="Samuel" modifier="Samuel" created="201207190808" modified="201207260257" tags="_GIT_" changecount="6">
<pre>*''git add  [file/directories]'' 
: 后面接文件和目录表示增加文件或改变到git仓库，否则只表示增加改变
:@@bgcolor(green):参数@@
: &lt;filepattern&gt;  e.g : ''git add ./*.c''
:  -A / {{{--}}}all （如果指定file pattern，也会增加file pattern没有指定的文件）
:增加所有的新文件，文件的改动，以及没有通过git rm的文件的删除
*''git ls-files''
:列出仓库中的文件
*''git rm  &lt;file&gt;''
:删除仓库中,index中的文件
:{{{--}}}cached只删除add的index的文件
* ''git commit -m &quot;message&quot; ''
:提交改变到本地目录（每次提交必须用git add先更新改变，在提交）
:git add . &amp;&amp;  git commit -m &quot;message&quot;  更新所有改变，并提交。
:git commit -am &quot;message&quot; 只更新提交改变的文件，不增加新文件             
:git commit {{{--}}}amend -m &quot;mesage&quot;
:修改最后一次提交的 &quot;message&quot;
:@@bgcolor(red):Attention@@:当没有使用git rm而是直接rm删除文件的时候需要使用一下两种方式提交
:git add  -A[{{{--}}}all]. &amp;&amp;  git commit -m &quot;message&quot;  / git commit -a -m &quot;message&quot;
*''git log  / gitk {{{--}}}all ''
:查看提交信息
*''git whatchanged ''
:比git log 更详细
*''git diff'' 
:查看工作拷贝和仓库的改变
*''git clean''
:删除没有被加到git中的文件</pre>
</div>
<div title="Operating of remote repository" creator="Samuel" modifier="Samuel" created="201207190813" modified="201208310908" tags="_GIT_" changecount="14">
<pre>*''git clone''  
:1、NULL 显示当前所有的远程仓库名 
:2、{{{--}}}bare  [src-directory]  [dst-directory[如gitlearn.git]] 创建远程
:3、[remote-repository.git]  [dst-directory]拷贝远程到另一个目录                   
*''git remote''
:1、NULL ：显示当前的远程仓库
:2、add [short-name]   [remote-repository.git] 
:: 一个名字只能对应一个远程， 一个远程可以对应多个名字
*''git push  [remote-repository.git / short-name]''
:如果没有dst，则默认push到origin对应的远程仓库，没有设置origin则会出错
:-all ,push所有的改变(默认不会push tag)
:-tags push tags
*''git pull  [remote-repository.git / short-name]''
: 获取远程仓库中的文件， 并merge
*''git fetch'' 
:获取远程仓库中的文件，@@color(red):(放在哪)但是不merge@@</pre>
</div>
<div title="Optimized Stradegy" creator="Samuel" modifier="Samuel" created="201209040248" modified="201302050613" tags="__OPENCL__" changecount="31">
<pre>@@bgcolor(green):''optimized stradegy''@@
*{{normal{@@color(green):host@@
*当enqueue一个kernel时，函数是立即返回的，@@color(green):可以在enqueuekernel后面来执行一些CPU的代码来进行CPU和GPU的同步优化@@
*视频的数据可以用两个command， 一个负责数据传输，一个负责执行kernel
}}}
*{{normal{@@color(green):device@@
*global和local之间的内存copy可以异步执行@@color(green):(async_work_group_copy)@@
*prefetch来预先读global的的数据到cache中， 应该是异步的否则就没有意义了@@color(green):(大多数GPU不支持)@@
}}}
*{{normal{@@color(green):指令集@@
*{{normal{取数据时用临时变量来暂存一下。可以减少等待时间
&lt;code c&gt;
dst[tId] = (src1[tId] + src2[tId] + src3[tId] + src4[tId])&gt;&gt;4;
/*'' 改为&gt;&gt;''*/
        val1 = src1[tId]; //使用prefetch是不是会更好
	val2 = src2[tId];
	val3 = src3[tId];
	val4 = src4[tId];
	dst[tId] = (val1 + val2 + val3 + val4)&gt;&gt;4;      
&lt;/code&gt;
 
}}}
}}}

</pre>
</div>
<div title="OptionsPanel" creator="Samuel" modifier="Samuel" created="201207180824" modified="201207180834" changecount="15">
<pre>These [[InterfaceOptions]] for customising [[TiddlyWiki]] are saved in your browser

Your username for signing your edits. Write it as a [[WikiWord]] (eg [[JoeBloggs]])

&lt;&lt;option txtUserName &gt;&gt;
&lt;&lt;option chkSaveBackups&gt;&gt; [[SaveBackups]]
&lt;&lt;option chkAutoSave&gt;&gt; [[AutoSave]]
&lt;&lt;option chkRegExpSearch&gt;&gt; [[RegExpSearch]]
&lt;&lt;option chkCaseSensitiveSearch&gt;&gt; [[CaseSensitiveSearch]]
&lt;&lt;option chkAnimate&gt;&gt; [[EnableAnimations]]

----
Also see [[AdvancedOptions]]</pre>
</div>
<div title="Others" creator="Samuel" modifier="Samuel" created="201207190819" modified="201207190820" tags="_Git_" changecount="4">
<pre>*''define alias''（定义别名）
:git config  {{{--}}}global  alias.add-commit ' !git add . -A &amp;&amp; git commit'
:git config  {{{--}}}global  core.autocrlf
:git config  {{{--}}}global  core.autocrlf false
*''Untrack a file / dir''
:将需要忽略的文件加到.gitignore文件中
*''Git Bundle'' 
:git bundle create  &lt;bundle-name&gt;   {{{--}}}all/&lt;branch-name1(master) ...&gt;

</pre>
</div>
<div title="PCA" creator="Samuel" modifier="Samuel" created="201301170637" modified="201301170638" changecount="3">
<pre>#对于一个训练集，20个sample(i=1,2,3,...,20)，特征Xi是100维[Xi1,Xi2,Xi3,...Xij,...,Xi100](j=1,2,..,100)，那么它可以建立一个20*100的样本矩阵M。
#{{normal{紧接着我们开始求这个样本的协方差矩阵，得到一个20*20的协方差矩阵，计算过程如下:
#先求解出Xi的平均Xav=(∑xi)/20;
#对每一个Xi,计算~Xi-Xav,即Mi(第 i 行)变为 ~Mi-Xav,记为Mn;
#则容易得到协方差矩阵Z为Mn*Mn'( ' 表示转置 ) 。
}}}
#然后求出这个协方差矩阵Z20x20的特征值和特征向量，一般情况下应该有20个特征值和特征向量，现在根据特征值的大小，取出较大的特征值以及其所对应的特征向量，（假设提取的特征值为较大的5个特征值），那么这5个特征向量就会构成一个20*5的矩阵V，这个矩阵就是我们要求的特征矩阵。
#用Mn'去乘以V，得到一个base矩阵（*），大小为100x5。
#任取一个样本1x100,乘上这个100*5的特征矩阵，就得到了一个1*5的新的样本，显然每个sample的维数下降了，然后再用这个1x5向量去比较相似性。

PS:上述3）过程中特征值的选取在不确定具体要降到多少维的情况下，一般还可以根据n个特征值之和大于总和的90%进行选取。上面的（*）处base矩阵的求解不唯一，也可以自行修正
</pre>
</div>
<div title="PageTemplate" creator="Samuel" modifier="Samuel" created="201207180832" changecount="1">
<pre>&lt;!--{{{--&gt;
&lt;div class='header' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'&gt;
&lt;div class='headerShadow'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;div class='headerForeground'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id='mainMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;
&lt;div id='sidebar'&gt;
&lt;div id='sidebarOptions' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;
&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id='displayArea'&gt;
&lt;div id='messageArea'&gt;&lt;/div&gt;
&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="PluginManager" creator="Samuel" modifier="Samuel" created="201207020527" modified="201207020528" changecount="3">
<pre>&lt;&lt;plugins&gt;&gt;</pre>
</div>
<div title="Python" creator="Samuel" modifier="Samuel" created="201206290703" modified="201302280922" tags="_SCRIPT_LANGUAGE_ _PYTHON_" changecount="32">
<pre>@@color(green):''类似于Java，Python实际上是字节编译的，其结果就是可以生成一种近似机器语言的中间形式''@@
&gt;[[Python FAQ]]
&gt;[[Python数据结构]]
&gt;[[Python控制结构]]
&gt;[[Python函数]]
&gt;[[Python生成器]]
&gt;[[Python类]]
&gt;[[Python模块]]
&gt;[[Python File IO]]
&gt;[[Python Build-in Function]]
&gt;[[Python Internet]]
&gt;[[Python Exception]]
&gt;[[Python Miscellaneous]]
&gt;[[python todo]]</pre>
</div>
<div title="Python Build-in Function" creator="Samuel" modifier="samuel" created="201210110906" modified="201210150131" changecount="15">
<pre>*@@color(blue):''input 和 raw_input''@@
&gt;raw_input:将所有输入当成原始输入，不会把数字变成int等
*@@color(blue):''dir()''@@
&gt; 显示属性
*@@color(blue):''help()''@@
&gt;显示帮助文档
*@@color(blue):''eval()/ exec()''@@
&gt;eval():计算表达式的值， 可以返回repr字符串的的本来对象
&gt;exec(): 执行字符串中的命令
*@@color(blue):''isinstance()''@@
&gt;判断是否为某个对象的实例，如：isinstance(1, int)
*@@color(blue):''cmp(var1, var2)''@@
&gt;判断两个对象大小
*@@color(blue):''coerce(var1, var2)''@@
&gt;将2个数据转换为相同类型，遵循转换规则
*@@color(blue):''int(), float()等''@@
&gt;@@color(red):可以直接将字符串转换为数字@@
*@@color(blue):''abs()''@@
&gt;如果是复数则返回复数的模； 不用借助这个实现可以自己来写
*@@color(blue):''divmod()''@@
&gt;返回元组，保存除数和余数
*@@color(blue):''round(flt, ndig=0)''@@
&gt;接受一个浮点数 flt 并对其四舍五入，保存 ndig位小数
*@@color(blue):''zip(var1, var2)''@@
&gt;取var1和var2中的第一个元素组成一个元素，创建字典时也比较有用
</pre>
</div>
<div title="Python Debug" creator="samuel" modifier="samuel" created="201210100928" modified="201210110125" changecount="12">
<pre>*{{normal{@@color(blue):''pdb''@@
#{{normal{命令行启动目标程序，加上-m参数，这样调用myscript.py的话断点就是程序的执行第一行之前 
&gt;python -m pdb myscript.py
}}}
#{{normal{pdb.set_trace(): 在需要的地方设置断点， 程序运行到此处进入pdb环境，然后类似于GDB进行调试
&gt;''!'' : 感叹号后面跟着语句，可以直接改变某个变量
}}}
#{{normal{pdb.run(&quot;function&quot;):启动pdb
&gt;''b model.function()''设置断点， 否则提示end of file 然后在''b linenum''来设置断点
}}}

}}}</pre>
</div>
<div title="Python Exception" creator="samuel" modifier="Samuel" created="201210100827" modified="201210150305" changecount="10">
<pre>*@@color(blue):''引发异常''@@
&gt;raise Exception(&quot;info&quot;) : 可以引发很多其他异常
*{{normal{@@color(blue):''捕捉异常''@@
&lt;code py&gt;
try:
    statements
excep (ZeroDivsionError,  TypeError): #捕获2个异常
    statements
excep :  #捕获所有异常
    statements
else : #加个子句，没有异常时执行
    statement
finally : 
    statement
&lt;/code&gt;
}}}
*{{normal{@@color(blue):''异常参数''@@
&lt;code py&gt;
try:
    statements
excep (ZeroDivsionError,  TypeError), reason: #reason异常参数
    statements
excep IOError, reason :  #reason异常参数
&lt;/code&gt;
}}}
*{{normal{@@color(blue):''with字句''@@
它仅能工作于支持上下文管理协议的对象, @@color(green):Python2.6支持，见python核心编程10.4@@,
&lt;code py&gt;
with open('/etc/passwd', 'r') as f:
    for eachLine in f:
      do stuff with eachLine or f...
&lt;/code&gt;
}}}
</pre>
</div>
<div title="Python FAQ" creator="Samuel" modifier="samuel" created="201207020638" modified="201209130904" tags="_PYTHON_ _PYTHON_FAQ_" changecount="23">
<pre>*@@color(blue):''全局变量的访问''@@
:使用@@color(blue):''global''@@关键字，在函数内部访问全局变量时，先用global声明一下，否则会当场局部变量
*@@color(blue):''获取CPU的数量''@@
: multiprocessing.cpu_count()

</pre>
</div>
<div title="Python File IO" creator="samuel" modifier="samuel" created="201210150149" modified="201210150155" changecount="5">
<pre>*@@color(blue):''文件操作中使用通用换行符 ''@@
&gt;打开方式使用U选项， 表示提供通用换行符支持
*@@color(blue):''writeline和readline  ''@@
&gt;readline函数会读取回车符;  writeline不会写回车符到文件中
*@@color(blue):''文件操作使用迭代器 和 xreadlines()''@@
&gt;for eachLine in f: 文件迭代更为高效 @@color(green):(Python 2.3支持)@@
&gt;xreadlines(): 每次只读取固定的块， 减少内存的使用； iter有相同的功能，所有可以放弃这个函数</pre>
</div>
<div title="Python Internet" creator="samuel" modifier="samuel" created="201209060220" modified="201209060656" changecount="10">
<pre>*@@color(blue):获取地址@@
: ''socket.gethostbyname''(&quot;www.google.com&quot;)
: ''socket.getservbyname''('domain')
: 使用''socket.connect()''@@color(green):(使用connect以后，客户机只和connect的地址交互)@@以后使用''socket.getpeername()''
</pre>
</div>
<div title="Python Miscellaneous" creator="samuel" modifier="Samuel" created="201209130328" modified="201210170458" changecount="31">
<pre>*@@color(blue):''运算符''@@
&gt;** :平方
&gt;{{{//}}} : 浮点除法（四舍五入），from __future__ import division ： / 将使用真正的浮点除法，不会管是否整数
&gt;不支持++， -- .。++和-- 等价于 -（-） 没有效果还是原值
*@@color(blue):''内存管理''@@
&gt;python中不需要关注类存管理。 但可以显式的使用del x将引用计数-1， 其x不能再用
*@@color(blue):''判断id是否相同''@@
&gt;python通过传递引用来处理对象：float时 a=1.1 b=1.1 指向不同的对象， 但是int str时 ， 只要值相同就指向相同的对象 (a is b  id(a)==id(b))@@color(red):(整数对象和字符串对象是不可变对象，所以Python 会很高效的缓存它们，只会对一个小范围内的数值进行缓存如：（-1,100）范围版本不一样会变，不要依赖这个)@@
*@@color(blue):''long型数据''@@
&gt;python中long可以表示非常大的数据，@@color(red):与你的类存有关@@，只要在数字后面加上大写L
*@@color(blue):''print语句会自动加一个回车符''@@
&gt;print语句后加逗号取消换行
</pre>
</div>
<div title="Python函数" creator="Samuel" modifier="Samuel" created="201206290716" modified="201210220256" changecount="46">
<pre>*@@color(blue):''Python不支持函数或方法的重载''@@
&gt;后定义的函数或方法@@color(red):会覆盖@@前面的定义的同名函数或方法
*@@color(blue):''添加函数说明''@@
**{{normal{@@bgcolor(green):示例@@
&lt;code python&gt;
def test():             
    'for test'                     访问方式1：test.__doc__   
    print('test')                  访问方式2：help(test)
&lt;/code&gt;
}}}
*@@color(blue):''函数的参数''@@
:列表相当于数组即指针，在函数内是可以改变参数的值的。而字符串、数字、元组是不可以变的。即内部不会影响外部
*{{normal{@@color(blue):''函数的传参数方式''@@
*@@color(blue):apply(func [, args [, kwargs ]]) @@ @@color(red):''（Python 3没有了）''@@
:函数用于当函数参数已经存在于一个元组或字典中时，间接地调用函数。@@color(green):在python3中可以使用在列表和字典前加星号来进行传递@@（参数两种方式传递：直接传和用关键字传）
&lt;code python&gt;
#1、关键字参数 ，不需要按顺序传参数，相当于字典
    func(para2='val2', para1 = 'val1') 
#2、默认参数值
   def  func(para1='val1', para2 = 'val2') :
#3、传元组、列表或字典作为参数，在函数中自己需要知道， 参考如下：4
&lt;/code&gt;
}}}
*{{normal{@@color(blue):''函数的可变参数个数''@@
#参数加* ： 任意的非关键字参数将被放到元组里面， 还可以传元组需加*
#参数加** ： 任意的关键字参数将被放到字典里面，还可以传字典需加**； @@color(red):这样传递是无法修改字典的值的@@可以3的方式传递字典或列表，或者可以在函数中返回列表和字典
&lt;code python&gt;
#4、可变参数
def foo(arg1, arg2, *TuplePara, **Dictpara) :
     statement
#调用
aTuple = (6, 7, 8)
aDict = {'z': 9}
newfoo(1, 2, 3,'hello' , x=4, y=5, *aTuple, **aDict)
#3,hello,aTuple将被放到TuplePara中
#x=4, y=5,aDict将被放到Dictpara中   
&lt;/code&gt;
}}}
*@@color(blue):''函数的返回''@@
:return 后可以不接变量。 作用为结束函数
*@@color(blue):''闭包''@@
:函数内声明的函数称为闭包
*{{normal{@@color(blue):''函数装饰器''-可用来实现静态函数@@
其实也是一个函数，装饰器的作用就是为已经存在的对象添加额外的功能。 如看一下下面时间测试函数:
&lt;code python&gt;
def timeit(func):
    def wrapper(*a , ** aa): #函数的参数
        start = time.clock()
        func(*a , **aa) 
        end =time.clock()
        print 'used:', end - start
    return wrapper  #注意此处一定要返回函数
 
@timeit
def foo():
    print 'in foo()' 
foo()

#带参数的装饰器, 可以用于判断来选择修饰器。 就是多定义了一层函数
def decoWithArgs(arg): 
    print str(arg)
    def newDeco(func):    
        print str(func)
        def replaceFunc(*a,**b):    
            print &quot;Enter decorator&quot;   
            print &quot;para:&quot; + str(arg)
            if arg == &quot;test&quot;:      
                return None
            return func(*a,**b)  
        replaceFunc.__name__ = func.__name__
        return replaceFunc
    return newDeco 

@decoWithArgs('test')
def test(para):
    print para

if __name__ == &quot;__main__&quot;:
    test('abcd')
&lt;/code&gt;
}}}
</pre>
</div>
<div title="Python控制结构" creator="Samuel" modifier="samuel" created="201206290847" modified="201210150139" tags="_PYTHON_" changecount="60">
<pre>@@bgcolor(green):''python中没有switch-case, 可以用if-elif 或 字典来实现''@@
*@@color(blue):''控制结构可以用在list的赋值中''@@
&gt;sqdEvens = [x ** 2 for x in range(8) if x&gt;2 ]
*@@color(blue):''while &amp; for''@@
*{{normal{
&lt;code python&gt;
    while condition :
        statements
        break | continue
        ...

    for condition :
        statements
        ...
&lt;/code&gt;
}}}
*@@color(blue):''break &amp; continue''@@
:跳出本次或所有的循环
*@@color(blue):''while &amp; for的else子句''@@
:只要循环是正常结束的(不是通过 break ), else 子句就会执行
*@@color(blue):''if''@@
*{{normal{
&lt;code python&gt;
    if condition1 :
        statements
    elif condition2:
       statements
    else: 
       statements
&lt;/code&gt;
}}}
*@@color(blue):''条件运算符''@@
*{{normal{
&lt;code python&gt;
    a = trueVal if condition else falseVal
&lt;/code&gt;
}}}
*@@color(blue):''and， or， not''@@
:条件连接符
*@@color(blue):''assert''@@
*{{normal{
&lt;code python&gt;
    assert   0 &lt; age &lt; 100 , 'help notes'
&lt;/code&gt;
}}}
</pre>
</div>
<div title="Python数据结构" creator="Samuel" modifier="Samuel" created="201206290908" modified="201212240302" tags="_PYTHON_ _PYTHON_DATASTRUCTURE_" changecount="15">
<pre>&gt;[[python 数字类型]]
&gt;[[列表与元组]]
&gt;[[字符串]]
&gt;[[字典]]
&gt;[[集合]]
&gt;[[堆]] , [[双端队列]]</pre>
</div>
<div title="Python模块" creator="Samuel" modifier="samuel" created="201206290836" modified="201211050128" tags="_PYTHON_ _PYTHON_MODULE_" changecount="52">
<pre>*@@color(blue):''导入方法''@@
&gt;使用sys.path.append()或insert(),增加路径
&gt;''import os as myModel''
&gt;1、可以从zip文件中导入模块
&gt;2、可以定义自己的导入方法
&gt;3、@@color(red):模块可以使用包来管理， 每个包目录下使用__init__.py文件。在里面定义__all__变量@@
*@@color(blue):''循环导入'':  当A导入B， B又导入A时会出现其中一个模块导入不存在@@
&gt;1.可以将其中一条导入放在最后，但是如果在这之前使用了函数的话就不可以了
&gt;2.在需要使用这个模块的函数的内部导入这个模块
*@@color(blue):''作用域''@@
&gt;使用from ** import *时，模块中的变量被赋值的时候，会被当成局部变量 
&gt;使用globals和locals函数查看作用域
*@@color(blue):''编码格式''@@
&gt;在代码开始处写上(''# -*- coding: ~UTF-8 -*-'')
*[[models_python]]

</pre>
</div>
<div title="Python生成器" creator="Samuel" modifier="Samuel" created="201210220254" modified="201210220254" changecount="2">
<pre>*{{normal{使用yield实现 (详细见python-core p445)
#有next方法
}}}</pre>
</div>
<div title="Python类" creator="Samuel" modifier="Samuel" created="201206290725" modified="201211080841" tags="_PYTHON_ _PYTHON_CLASS_" changecount="72">
<pre>*{{normal{@@color(red):''使用新式类'' @@
#Python 3.0以后不用注意，否则在使用新式类时， @@color(red):最好是继承object类@@，而不是type
#在多重继承中。新式类使用广度优先搜索，旧式类使用深度优先搜索
#{{{__metaclass__}}}@@color(red):(难点)@@
}}}
*@@color(red):''类中函数的参数self'' @@
:类中的函数的第一参数需写上是self， 因为在函数的调用的时候，第一个参数默认帮你传了self
*@@color(blue):''查看文档信息'' @@
:使用className.{{{__doc__}}}查看， 在类中使用文档说明，同函数
*@@color(blue):''创建私有函数和变量'' @@ @@color(green):(外部其实还是可以访问,Python没有真正的私有化支持)@@
&gt;在函数和变量前面使用{{{__}}}(双下划线)，这样函数(变量)名在被翻译时变成&quot;_+类名+变量名“ 如：_className{{{__}}}function
&gt;使用{{{__}}}(双下划线)后，子类中的变量不会影响父类中变量
&gt;在函数和变量前面使用{{{_}}}(单下划线)，这样函数(变量)名就不会被import *导入，也可以导入import classname
*@@color(blue):''检查继承的基类'' @@ 
:使用特性{{{__}}}bases{{{__}}},如，className.{{{__}}}bases{{{__}}}
*@@color(blue):''{{{__}}}all{{{__}}}变量'' @@ 
:定义{{{__all__}}}, 这样import只能导入定义的，否则可以导入所有未加双下划线的全局名。而且可以查看
*{{normal{@@color(red):''操作所有对象的变量'' @@ 
&lt;code python&gt;
class test:
    &quot;The UI of Login&quot;
    mem = 0
    def init__(self) :
        test.mem +=1  #使用test而不是self来访问mem, 这样是对所有对象的mem来操作
&lt;/code&gt;
}}}
*{{normal{@@color(blue):''{{{__init__/__new__. __del__}}}'' @@ 
&gt;初始化函数， 子类需要调用父类的__init__， 需要传递self这个参数。 且init函数是没有返回值的
&gt;@@color(red):在__init__函数中可以动态的增加属性@@
&gt;__new__比init调用更早，需要返回一个实例
&gt;在使用累计数来增加应用时， 需要在__del__函数减
}}}
*{{normal{@@color(blue):''{{{__call__}}}'' @@ 
:将实例化后的类当函数来使用。
}}}
*{{normal{@@color(blue):''{{{vars()}}}'' @@ 
#返回一个字典保存了所有的属性和其值。也可以使用class.{{{__dict__}}}来访问
#python新式类中所有的的属性都是放在{{{__dict__}}}中的@@color(green):(inst.foo等价于inst.__dict__['foo'])@@， 字典是比较占类存的，可以使用{{{__slots__}}}来定义
}}}
*{{normal{@@color(blue):''方法'' @@ 
&gt;方法必须使用实例来访问, 
}}}
*{{normal{@@color(blue):''static方法和变量'' @@ 
&gt;static变量：定义变量使用类名来调用，最好加下划线，这样就可以防止用对象名来调用
&gt;static方法：使用函数修饰符来实现，详细见函数中的介绍@@color(red):（TODO: 写个例子）或者使用staticmethod内建函数@@
}}}

</pre>
</div>
<div title="Random" creator="samuel" modifier="samuel" created="201209060337" modified="201209110542" tags="_PYTHON_ _PYTHON_MODULE_ _RANDOM_" changecount="5">
<pre>*@@bgcolor(green):函数@@
&gt; ''randint(a,b)'' : 返回[a,b]之间的整数。randint(0,1)返回0或1模拟50%的概率
&gt; ''uniform(a,b)'' : 返回[a,b)之间的浮点数</pre>
</div>
<div title="Real AdaBoost" creator="Samuel" modifier="samuel" created="201304170103" modified="201304170224" changecount="38">
<pre>''说明''

''Step 二类''
#{{normal{@@color(blue):''Input''@@ :
 \((x_1,y_1)... (x_n, y_n)  \hspace{8mm} y_i\in Y(1, -1)  \). 

}}}
#{{normal{@@color(blue):''初始化权重值w(也是概率分布D)''@@
\( 
w_i = 1/n    ...........  (n为样本的个数 )
\)
@@color(green):(正负样本数不等可以参考Cascade \hspace{4mm} Adaboost二类中 wp_i = 1/2m, wn_i=1/2l,m,l分别为正负样本的个数 )@@

}}}
#{{normal{@@color(blue):''For t=0, 1...T:''
@@@@color(red):（T如何选取，可以根据正检率和误检率中间跳出吗?每次都更新一下正检率和误检率是不是很影响性能）@@
#{{normal{''在每个特征维上''
#{{normal{将样本特征分为n个空间

}}}
#{{normal{在每个空间中计算正负样本的权重和

\(
\Large  {W}^j_l = P(x_i \in X_j, y_i=l) = \sum\limits_{i}D_t(i)  \hspace{8mm} l=±1  
\)
}}}
#{{normal{其空间上的判决函数为\(h\)

\(
\large   x \in X_j, h(x) =\frac{1}{2}ln(\frac{W_{+1}^j+\epsilon}{W_{-1}^j+\epsilon}) \hspace{8mm}  \epsilon 为一个小整数。防止除0
\)
@@color(red):判决函数前面的\(\frac{1}{2}\)的意义, 减小对权重的影响吗@@

}}}
#{{normal{计算归一化因子

\(
Z=2\sum\limits_j\sqrt{W_{+1}^jW_{-1}^j}
\)
@@color(red):系数2有什么用, 只用于选取最小值吗？还是有其他用处@@
}}}
}}}
#{{normal{''挑选最小的\(Z_t\)的分类函数作为这一层的\(h_t\)''

}}}
#{{normal{''更新权重''
#{{normal{
\(
\Large  D_{t+1}(i) = D_t(i)exp[-y_ih_t(x_j)]
\)
}}}
#归一化权重，可参考''discreet adaboost''
}}}
}}}
#{{normal{@@color(blue):''最终分类器''@@
\(
H(x) = sign[\sum\limits_{t=1}^Th_t(x)-b]  \hspace{8mm} b是个阈值默认为0    
\)
或者写成自信度函数
\(
Conf_H(x) = |\sum\limits_{t=1}^Th_t(x)-b|
\)
}}}</pre>
</div>
<div title="SVM" creator="Samuel" modifier="Samuel" created="201207240628" modified="201302230616" tags="_TRAINING_ _DETECTION_ _SVM_" changecount="31">
<pre>SVM的基本思想就是通过用内积函数定义的非线性变换将输入空间变换到一个高维空间，然后再在这个空间求最优分类面的分类方法
@@bgcolor(green):''Refer to the libSVM''@@
*@@color(blue):''归一化样本''@@
:归一化feature数据，默认y方向归一化到[-1,1]，即每一列求最大值和最小值(有n列个最大值和最小值)。如果归一化后的非0值大于归一化前。最好使用[-1,0]。
*@@color(blue):''训练样本''@@
**{{normal{''数据结构''
&lt;code c++&gt;
struct svm_problem
{
	int l;                            //样本的总数
	double *y;                        //样本所属的类别，如-1、1
	struct svm_node **x;              //特征数据， x存放所有node的指针
}；

enum { C_SVC, NU_SVC, ONE_CLASS, EPSILON_SVR, NU_SVR };/* svm_type */
//EPSILON_SVR, NU_SVR 回归方法


enum { LINEAR, POLY, RBF, SIGMOID }; /* kernel_type */

struct svm_parameter
{
	int svm_type; 
	int kernel_type; 
	int degree;	/* for poly */
	double gamma;	/* for poly/rbf/sigmoid */
	double coef0;	/* for poly/sigmoid */

	/* these are for training only */
	double cache_size; /* in MB */
	double eps;	/* stopping criteria */
	double C;	/* for C_SVC, EPSILON_SVR and NU_SVR */
	int nr_weight;		/* for C_SVC */
	int *weight_label;	/* for C_SVC */
	double* weight;		/* for C_SVC */
	double nu;	/* for NU_SVC, ONE_CLASS, and NU_SVR */
	double p;	/* for EPSILON_SVR */
	int shrinking;	/* use the shrinking heuristics */
	int probability; /* do probability estimates */
};
&lt;/code&gt;
}}}
**{{normal{''训练过程''

case 1（回归方法和~ONE_CLASS只有2类）
case 2（C_SVC, NU_SVC）
     
svm_group_classes ： 将样本整理排列起来， 即同类的放在一起
}}}</pre>
</div>
<div title="Shell" creator="Samuel" modifier="Samuel" created="201206290240" modified="201207160841" tags="_SCRIPT_LANGUAGE_ _SHELL_" changecount="63">
<pre>*@@color(blue):''Shell 变量''@@
&gt;$0 : shell脚本的名字
&gt;$1, $2 ... : shell脚本程序的参数
&gt;$@、$* : 所有参数的值， 一般使用$@.因为$*中变量需要IFS中的分隔符来分隔
&gt;$? : 用于检查上一个命令,函数或者脚本执行是否正确.非0值为出错
*@@color(blue):''Shell 控制结构''@@
&gt;[[case]]
&gt;[[if,else]]
&gt;[[for]]
&gt;[[while]]

</pre>
</div>
<div title="SiteSubtitle" creator="YourName" modifier="YourName" created="201206180437" modified="201206180439" changecount="3">
<pre>Learning notes
</pre>
</div>
<div title="SiteTitle" creator="YourName" modifier="YourName" created="201206180437" modified="201206180443" changecount="2">
<pre>Samuel's</pre>
</div>
<div title="SiteUrl" creator="YourName" modifier="YourName" created="201206180439" modified="201206180439" changecount="2">
<pre></pre>
</div>
<div title="StyleSheet" creator="YourName" modifier="Samuel" created="201206180441" modified="201207020341" changecount="3">
<pre>[[StyleSheetSyntaxHighlighter]]</pre>
</div>
<div title="StyleSheetSyntaxHighlighter" creator="Samuel" modifier="Samuel" created="201207020339" modified="201207020537" changecount="10">
<pre>/***
StyleSheet for ~SyntaxHighlighter
***/

/*{{{*/
.dp-highlighter
{
	font-family: &quot;Consolas&quot;, &quot;Courier New&quot;, Courier, mono, serif;
	font-size: 12px;
	background-color: #E7E5DC;
	width: 99%;
	overflow: auto;
	margin: 18px 0 18px 0 !important;
	padding-top: 1px; /* adds a little border on top when controls are hidden */
}

/* clear styles */
.dp-highlighter ol,
.dp-highlighter ol li,
.dp-highlighter ol li span 
{
	margin: 0;
	padding: 0;
	border: none;
}

.dp-highlighter a,
.dp-highlighter a:hover
{
	background: none;
	border: none;
	padding: 0;
	margin: 0;
}

.dp-highlighter .bar
{
	padding-left: 45px;
}

.dp-highlighter.collapsed .bar,
.dp-highlighter.nogutter .bar
{
	padding-left: 0px;
}

.dp-highlighter ol
{
	list-style: decimal; /* for ie */
	background-color: #fff;
	margin: 0px 0px 1px 45px !important; /* 1px bottom margin seems to fix occasional Firefox scrolling */
	padding: 0px;
	color: #5C5C5C;
}

.dp-highlighter.nogutter ol,
.dp-highlighter.nogutter ol li
{
	list-style: none !important;
	margin-left: 0px !important;
}

.dp-highlighter ol li,
.dp-highlighter .columns div
{
	list-style: decimal-leading-zero; /* better look for others, override cascade from OL */
	list-style-position: outside !important;
	border-left: 3px solid #6CE26C;
	background-color: #F8F8F8;
	color: #5C5C5C;
	padding: 0 3px 0 10px !important;
	margin: 0 !important;
	line-height: 14px;
}

.dp-highlighter.nogutter ol li,
.dp-highlighter.nogutter .columns div
{
	border: 0;
}

.dp-highlighter .columns
{
	background-color: #F8F8F8;
	color: gray;
	overflow: hidden;
	width: 100%;
}

.dp-highlighter .columns div
{
	padding-bottom: 5px;
}

.dp-highlighter ol li.alt
{
	background-color: #FFF;
	color: inherit;
}

.dp-highlighter ol li span
{
	color: black;
	background-color: inherit;
}

/* Adjust some properties when collapsed */

.dp-highlighter.collapsed ol
{
	margin: 0px;
}

.dp-highlighter.collapsed ol li
{
	display: none;
}

/* Additional modifications when in print-view */

.dp-highlighter.printing
{
	border: none;
}

.dp-highlighter.printing .tools
{
	display: none !important;
}

.dp-highlighter.printing li
{
	display: list-item !important;
}

/* Styles for the tools */

.dp-highlighter .tools
{
	padding: 3px 8px 3px 10px;
	font: 9px Verdana, Geneva, Arial, Helvetica, sans-serif;
	color: silver;
	background-color: #f8f8f8;
	padding-bottom: 10px;
	border-left: 3px solid #6CE26C;
}

.dp-highlighter.nogutter .tools
{
	border-left: 0;
}

.dp-highlighter.collapsed .tools
{
	border-bottom: 0;
}

.dp-highlighter .tools a
{
	font-size: 9px;
	color: #a0a0a0;
	background-color: inherit;
	text-decoration: none;
	margin-right: 10px;
}

.dp-highlighter .tools a:hover
{
	color: red;
	background-color: inherit;
	text-decoration: underline;
}

/* About dialog styles */

.dp-about { background-color: #fff; color: #333; margin: 0px; padding: 0px; }
.dp-about table { width: 100%; height: 100%; font-size: 11px; font-family: Tahoma, Verdana, Arial, sans-serif !important; }
.dp-about td { padding: 10px; vertical-align: top; }
.dp-about .copy { border-bottom: 1px solid #ACA899; height: 95%; }
.dp-about .title { color: red; background-color: inherit; font-weight: bold; }
.dp-about .para { margin: 0 0 4px 0; }
.dp-about .footer { background-color: #ECEADB; color: #333; border-top: 1px solid #fff; text-align: right; }
.dp-about .close { font-size: 11px; font-family: Tahoma, Verdana, Arial, sans-serif !important; background-color: #ECEADB; color: #333; width: 60px; height: 22px; }

/* Language specific styles */

.dp-highlighter .comment, .dp-highlighter .comments { color: #008200; background-color: inherit; }
.dp-highlighter .string { color: blue; background-color: inherit; }
.dp-highlighter .keyword { color: #069; font-weight: bold; background-color: inherit; }
.dp-highlighter .preprocessor { color: gray; background-color: inherit; }

/*}}}*/</pre>
</div>
<div title="SyntaxHighlighterPlugin" creator="Samuel" modifier="Samuel" created="201207020529" modified="201207020539" tags="systemConfig" changecount="3">
<pre>/***
!Metadata:
|''Name:''|SyntaxHighlighterPlugin|
|''Description:''|Code Syntax Highlighter Plugin for TiddlyWiki.|
|''Version:''|1.1.3|
|''Date:''|Oct 24, 2008|
|''Source:''|http://www.coolcode.cn/show-310-1.html|
|''Author:''|Ma Bingyao (andot (at) ujn (dot) edu (dot) cn)|
|''License:''|[[GNU Lesser General Public License|http://www.gnu.org/licenses/lgpl.txt]]|
|''~CoreVersion:''|2.4.1|
|''Browser:''|Firefox 1.5+; InternetExplorer 6.0; Safari; Opera; Chrome; etc.|

!Syntax:
{{{
&lt;code options&gt;
codes
&lt;/code&gt;
}}}

!Examples:
{{{
&lt;code java&gt;
public class HelloWorld {
    public static void main(String args[]) {
        System.out.println(&quot;HelloWorld!&quot;);
    }
}
&lt;/code&gt;
}}}

!Revision History:
|''Version''|''Date''|''Note''|
|1.1.2|Oct 15, 2008|Optimize Highlight|
|1.0.0|Oct 13, 2008|Initial release|

!Code section:
***/
//{{{
var dp={sh:{Toolbar:{},Utils:{},RegexLib:{},Brushes:{},Strings:{AboutDialog:&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;About...&lt;/title&gt;&lt;/head&gt;&lt;body class=\&quot;dp-about\&quot;&gt;&lt;table cellspacing=\&quot;0\&quot;&gt;&lt;tr&gt;&lt;td class=\&quot;copy\&quot;&gt;&lt;p class=\&quot;title\&quot;&gt;dp.SyntaxHighlighter&lt;/div&gt;&lt;div class=\&quot;para\&quot;&gt;Version: {V}&lt;/p&gt;&lt;p&gt;&lt;a href=\&quot;http://www.dreamprojections.com/syntaxhighlighter/?ref=about\&quot; target=\&quot;_blank\&quot;&gt;http://www.dreamprojections.com/syntaxhighlighter&lt;/a&gt;&lt;/p&gt;&amp;copy;2004-2007 Alex Gorbatchev.&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=\&quot;footer\&quot;&gt;&lt;input type=\&quot;button\&quot; class=\&quot;close\&quot; value=\&quot;OK\&quot; onClick=\&quot;window.close()\&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;&quot;},ClipboardSwf:null,Version:&quot;1.5.1&quot;}};dp.SyntaxHighlighter=dp.sh;dp.sh.Toolbar.Commands={ExpandSource:{label:&quot;+ expand source&quot;,check:function($){return $.collapse},func:function($,_){$.parentNode.removeChild($);_.div.className=_.div.className.replace(&quot;collapsed&quot;,&quot;&quot;)}},ViewSource:{label:&quot;view plain&quot;,func:function($,_){var A=dp.sh.Utils.FixForBlogger(_.originalCode).replace(/&lt;/g,&quot;&amp;lt;&quot;),B=window.open(&quot;&quot;,&quot;_blank&quot;,&quot;width=750, height=400, location=0, resizable=1, menubar=0, scrollbars=0&quot;);B.document.write(&quot;&lt;textarea style=\&quot;width:99%;height:99%\&quot;&gt;&quot;+A+&quot;&lt;/textarea&gt;&quot;);B.document.close()}},CopyToClipboard:{label:&quot;copy to clipboard&quot;,check:function(){return window.clipboardData!=null||dp.sh.ClipboardSwf!=null},func:function($,A){var B=dp.sh.Utils.FixForBlogger(A.originalCode).replace(/&amp;lt;/g,&quot;&lt;&quot;).replace(/&amp;gt;/g,&quot;&gt;&quot;).replace(/&amp;amp;/g,&quot;&amp;&quot;);if(window.clipboardData)window.clipboardData.setData(&quot;text&quot;,B);else if(dp.sh.ClipboardSwf!=null){var _=A.flashCopier;if(_==null){_=document.createElement(&quot;div&quot;);A.flashCopier=_;A.div.appendChild(_)}_.innerHTML=&quot;&lt;embed src=\&quot;&quot;+dp.sh.ClipboardSwf+&quot;\&quot; FlashVars=\&quot;clipboard=&quot;+encodeURIComponent(B)+&quot;\&quot; width=\&quot;0\&quot; height=\&quot;0\&quot; type=\&quot;application/x-shockwave-flash\&quot;&gt;&lt;/embed&gt;&quot;}alert(&quot;The code is in your clipboard now&quot;)}},PrintSource:{label:&quot;print&quot;,func:function($,B){var _=document.createElement(&quot;IFRAME&quot;),A=null;_.style.cssText=&quot;position:absolute;width:0px;height:0px;left:-500px;top:-500px;&quot;;document.body.appendChild(_);A=_.contentWindow.document;dp.sh.Utils.CopyStyles(A,window.document);A.write(&quot;&lt;div class=\&quot;&quot;+B.div.className.replace(&quot;collapsed&quot;,&quot;&quot;)+&quot; printing\&quot;&gt;&quot;+B.div.innerHTML+&quot;&lt;/div&gt;&quot;);A.close();_.contentWindow.focus();_.contentWindow.print();alert(&quot;Printing...&quot;);document.body.removeChild(_)}},About:{label:&quot;?&quot;,func:function(_){var A=window.open(&quot;&quot;,&quot;_blank&quot;,&quot;dialog,width=300,height=150,scrollbars=0&quot;),$=A.document;dp.sh.Utils.CopyStyles($,window.document);$.write(dp.sh.Strings.AboutDialog.replace(&quot;{V}&quot;,dp.sh.Version));$.close();A.focus()}}};dp.sh.Toolbar.Create=function(B){var A=document.createElement(&quot;DIV&quot;);A.className=&quot;tools&quot;;for(var _ in dp.sh.Toolbar.Commands){var $=dp.sh.Toolbar.Commands[_];if($.check!=null&amp;&amp;!$.check(B))continue;A.innerHTML+=&quot;&lt;a href=\&quot;#\&quot; onclick=\&quot;dp.sh.Toolbar.Command('&quot;+_+&quot;',this);return false;\&quot;&gt;&quot;+$.label+&quot;&lt;/a&gt;&quot;}return A};dp.sh.Toolbar.Command=function(_,$){var A=$;while(A!=null&amp;&amp;A.className.indexOf(&quot;dp-highlighter&quot;)==-1)A=A.parentNode;if(A!=null)dp.sh.Toolbar.Commands[_].func($,A.highlighter)};dp.sh.Utils.CopyStyles=function(A,_){var $=_.getElementsByTagName(&quot;link&quot;);for(var B=0;B&lt;$.length;B++)if($[B].rel.toLowerCase()==&quot;stylesheet&quot;)A.write(&quot;&lt;link type=\&quot;text/css\&quot; rel=\&quot;stylesheet\&quot; href=\&quot;&quot;+$[B].href+&quot;\&quot;&gt;&lt;/link&gt;&quot;)};dp.sh.Utils.FixForBlogger=function($){return(dp.sh.isBloggerMode==true)?$.replace(/&lt;br\s*\/?&gt;|&amp;lt;br\s*\/?&amp;gt;/gi,&quot;\n&quot;):$};dp.sh.RegexLib={MultiLineCComments:new RegExp(&quot;/\\*[\\s\\S]*?\\*/&quot;,&quot;gm&quot;),SingleLineCComments:new RegExp(&quot;//.*$&quot;,&quot;gm&quot;),SingleLinePerlComments:new RegExp(&quot;#.*$&quot;,&quot;gm&quot;),DoubleQuotedString:new RegExp(&quot;\&quot;(?:\\.|(\\\\\\\&quot;)|[^\\\&quot;\&quot;\\n])*\&quot;&quot;,&quot;g&quot;),SingleQuotedString:new RegExp(&quot;'(?:\\.|(\\\\\\')|[^\\''\\n])*'&quot;,&quot;g&quot;)};dp.sh.Match=function(_,$,A){this.value=_;this.index=$;this.length=_.length;this.css=A};dp.sh.Highlighter=function(){this.noGutter=false;this.addControls=true;this.collapse=false;this.tabsToSpaces=true;this.wrapColumn=80;this.showColumns=true};dp.sh.Highlighter.SortCallback=function($,_){if($.index&lt;_.index)return-1;else if($.index&gt;_.index)return 1;else if($.length&lt;_.length)return-1;else if($.length&gt;_.length)return 1;return 0};dp.sh.Highlighter.prototype.CreateElement=function(_){var $=document.createElement(_);$.highlighter=this;return $};dp.sh.Highlighter.prototype.GetMatches=function(_,B){var $=0,A=null;while((A=_.exec(this.code))!=null)this.matches[this.matches.length]=new dp.sh.Match(A[0],A.index,B)};dp.sh.Highlighter.prototype.AddBit=function($,A){if($==null||$.length==0)return;var C=this.CreateElement(&quot;SPAN&quot;);$=$.replace(/ /g,&quot;&amp;nbsp;&quot;);$=$.replace(/&lt;/g,&quot;&amp;lt;&quot;);$=$.replace(/\n/gm,&quot;&amp;nbsp;&lt;br&gt;&quot;);if(A!=null){if((/br/gi).test($)){var _=$.split(&quot;&amp;nbsp;&lt;br&gt;&quot;);for(var B=0;B&lt;_.length;B++){C=this.CreateElement(&quot;SPAN&quot;);C.className=A;C.innerHTML=_[B];this.div.appendChild(C);if(B+1&lt;_.length)this.div.appendChild(this.CreateElement(&quot;BR&quot;))}}else{C.className=A;C.innerHTML=$;this.div.appendChild(C)}}else{C.innerHTML=$;this.div.appendChild(C)}};dp.sh.Highlighter.prototype.IsInside=function(_){if(_==null||_.length==0)return false;for(var A=0;A&lt;this.matches.length;A++){var $=this.matches[A];if($==null)continue;if((_.index&gt;$.index)&amp;&amp;(_.index&lt;$.index+$.length))return true}return false};dp.sh.Highlighter.prototype.ProcessRegexList=function(){for(var $=0;$&lt;this.regexList.length;$++)this.GetMatches(this.regexList[$].regex,this.regexList[$].css)};dp.sh.Highlighter.prototype.ProcessSmartTabs=function(E){var B=E.split(&quot;\n&quot;),$=&quot;&quot;,D=4,A=&quot;\t&quot;;function _(A,E,_){var B=A.substr(0,E),C=A.substr(E+1,A.length),$=&quot;&quot;;for(var D=0;D&lt;_;D++)$+=&quot; &quot;;return B+$+C}function C(B,C){if(B.indexOf(A)==-1)return B;var D=0;while((D=B.indexOf(A))!=-1){var $=C-D%C;B=_(B,D,$)}return B}for(var F=0;F&lt;B.length;F++)$+=C(B[F],D)+&quot;\n&quot;;return $};dp.sh.Highlighter.prototype.SwitchToList=function(){var C=this.div.innerHTML.replace(/&lt;(br)\/?&gt;/gi,&quot;\n&quot;),B=C.split(&quot;\n&quot;);if(this.addControls==true)this.bar.appendChild(dp.sh.Toolbar.Create(this));if(this.showColumns){var A=this.CreateElement(&quot;div&quot;),_=this.CreateElement(&quot;div&quot;),E=10,G=1;while(G&lt;=150)if(G%E==0){A.innerHTML+=G;G+=(G+&quot;&quot;).length}else{A.innerHTML+=&quot;&amp;middot;&quot;;G++}_.className=&quot;columns&quot;;_.appendChild(A);this.bar.appendChild(_)}for(var G=0,D=this.firstLine;G&lt;B.length-1;G++,D++){var $=this.CreateElement(&quot;LI&quot;),F=this.CreateElement(&quot;SPAN&quot;);$.className=(G%2==0)?&quot;alt&quot;:&quot;&quot;;F.innerHTML=B[G]+&quot;&amp;nbsp;&quot;;$.appendChild(F);this.ol.appendChild($)}this.div.innerHTML=&quot;&quot;};dp.sh.Highlighter.prototype.Highlight=function(C){function A($){return $.replace(/^\s*(.*?)[\s\n]*$/g,&quot;$1&quot;)}function $($){return $.replace(/\n*$/,&quot;&quot;).replace(/^\n*/,&quot;&quot;)}function _(B){var E=dp.sh.Utils.FixForBlogger(B).split(&quot;\n&quot;),C=new Array(),D=new RegExp(&quot;^\\s*&quot;,&quot;g&quot;),$=1000;for(var F=0;F&lt;E.length&amp;&amp;$&gt;0;F++){if(A(E[F]).length==0)continue;var _=D.exec(E[F]);if(_!=null&amp;&amp;_.length&gt;0)$=Math.min(_[0].length,$)}if($&gt;0)for(F=0;F&lt;E.length;F++)E[F]=E[F].substr($);return E.join(&quot;\n&quot;)}function D(A,$,_){return A.substr($,_-$)}var F=0;if(C==null)C=&quot;&quot;;this.originalCode=C;this.code=$(_(C));this.div=this.CreateElement(&quot;DIV&quot;);this.bar=this.CreateElement(&quot;DIV&quot;);this.ol=this.CreateElement(&quot;OL&quot;);this.matches=new Array();this.div.className=&quot;dp-highlighter&quot;;this.div.highlighter=this;this.bar.className=&quot;bar&quot;;this.ol.start=this.firstLine;if(this.CssClass!=null)this.ol.className=this.CssClass;if(this.collapse)this.div.className+=&quot; collapsed&quot;;if(this.noGutter)this.div.className+=&quot; nogutter&quot;;if(this.tabsToSpaces==true)this.code=this.ProcessSmartTabs(this.code);this.ProcessRegexList();if(this.matches.length==0){this.AddBit(this.code,null);this.SwitchToList();this.div.appendChild(this.bar);this.div.appendChild(this.ol);return}this.matches=this.matches.sort(dp.sh.Highlighter.SortCallback);for(var E=0;E&lt;this.matches.length;E++)if(this.IsInside(this.matches[E]))this.matches[E]=null;for(E=0;E&lt;this.matches.length;E++){var B=this.matches[E];if(B==null||B.length==0)continue;this.AddBit(D(this.code,F,B.index),null);this.AddBit(B.value,B.css);F=B.index+B.length}this.AddBit(this.code.substr(F),null);this.SwitchToList();this.div.appendChild(this.bar);this.div.appendChild(this.ol)};dp.sh.Highlighter.prototype.GetKeywords=function($){return&quot;\\b&quot;+$.replace(/ /g,&quot;\\b|\\b&quot;)+&quot;\\b&quot;};dp.sh.BloggerMode=function(){dp.sh.isBloggerMode=true};dp.sh.HighlightAll=function(N,B,K,I,O,E){function A(){var $=arguments;for(var _=0;_&lt;$.length;_++){if($[_]==null)continue;if(typeof($[_])==&quot;string&quot;&amp;&amp;$[_]!=&quot;&quot;)return $[_]+&quot;&quot;;if(typeof($[_])==&quot;object&quot;&amp;&amp;$[_].value!=&quot;&quot;)return $[_].value+&quot;&quot;}return null}function J($,_){for(var A=0;A&lt;_.length;A++)if(_[A]==$)return true;return false}function L(A,B,C){var _=new RegExp(&quot;^&quot;+A+&quot;\\[(\\w+)\\]$&quot;,&quot;gi&quot;),$=null;for(var D=0;D&lt;B.length;D++)if(($=_.exec(B[D]))!=null)return $[1];return C}function C(B,A,_){var $=document.getElementsByTagName(_);for(var C=0;C&lt;$.length;C++)if($[C].getAttribute(&quot;name&quot;)==A)B.push($[C])}var T=[],P=null,M={},$=&quot;innerHTML&quot;;C(T,N,&quot;pre&quot;);C(T,N,&quot;textarea&quot;);if(T.length==0)return;for(var R in dp.sh.Brushes){var F=dp.sh.Brushes[R].Aliases;if(F==null)continue;for(var G=0;G&lt;F.length;G++)M[F[G]]=R}for(G=0;G&lt;T.length;G++){var _=T[G],U=A(_.attributes[&quot;class&quot;],_.className,_.attributes[&quot;language&quot;],_.language),Q=&quot;&quot;;if(U==null)continue;U=U.split(&quot;:&quot;);Q=U[0].toLowerCase();if(M[Q]==null)continue;P=new dp.sh.Brushes[M[Q]]();_.style.display=&quot;none&quot;;P.noGutter=(B==null)?J(&quot;nogutter&quot;,U):!B;P.addControls=(K==null)?!J(&quot;nocontrols&quot;,U):K;P.collapse=(I==null)?J(&quot;collapse&quot;,U):I;P.showColumns=(E==null)?J(&quot;showcolumns&quot;,U):E;var D=document.getElementsByTagName(&quot;head&quot;)[0];if(P.Style&amp;&amp;D){var S=document.createElement(&quot;style&quot;);S.setAttribute(&quot;type&quot;,&quot;text/css&quot;);if(S.styleSheet)S.styleSheet.cssText=P.Style;else{var H=document.createTextNode(P.Style);S.appendChild(H)}D.appendChild(S)}P.firstLine=(O==null)?parseInt(L(&quot;firstline&quot;,U,1)):O;P.Highlight(_[$]);P.source=_;_.parentNode.insertBefore(P.div,_)}};version.extensions.SyntaxHighLighterPlugin={major:1,minor:1,revision:3,date:new Date(2008,10,24)};dp.sh.ClipboardSwf=&quot;clipboard.swf&quot;;dp.sh.Highlight=function(_,Q,B,J,H,M,D){function A(){var $=arguments;for(var _=0;_&lt;$.length;_++){if($[_]==null)continue;if(typeof($[_])==&quot;string&quot;&amp;&amp;$[_]!=&quot;&quot;)return $[_]+&quot;&quot;;if(typeof($[_])==&quot;object&quot;&amp;&amp;$[_].value!=&quot;&quot;)return $[_].value+&quot;&quot;}return null}function I($,_){for(var A=0;A&lt;_.length;A++)if(_[A]==$)return true;return false}function K(A,B,C){var _=new RegExp(&quot;^&quot;+A+&quot;\\[(\\w+)\\]$&quot;,&quot;gi&quot;),$=null;for(var D=0;D&lt;B.length;D++)if(($=_.exec(B[D]))!=null)return $[1];return C}var N=null,$=&quot;innerHTML&quot;;if(this.registered==undefined){var L={};for(var O in dp.sh.Brushes){var E=dp.sh.Brushes[O].Aliases;if(E==null)continue;for(var F=0;F&lt;E.length;F++)L[E[F]]=O}this.registered=L}Q=Q.split(&quot;:&quot;);language=Q[0].toLowerCase();if(this.registered[language]==null)return;N=new dp.sh.Brushes[this.registered[language]]();_.style.display=&quot;none&quot;;N.noGutter=(B==null)?I(&quot;nogutter&quot;,Q):!B;N.addControls=(J==null)?!I(&quot;nocontrols&quot;,Q):J;N.collapse=(H==null)?I(&quot;collapse&quot;,Q):H;N.showColumns=(D==null)?I(&quot;showcolumns&quot;,Q):D;var C=document.getElementsByTagName(&quot;head&quot;)[0],P=document.getElementById(N.CssClass);if(N.Style&amp;&amp;C&amp;&amp;!P){P=document.createElement(&quot;style&quot;);P.setAttribute(&quot;id&quot;,N.CssClass);P.setAttribute(&quot;type&quot;,&quot;text/css&quot;);if(P.styleSheet)P.styleSheet.cssText=N.Style;else{var G=document.createTextNode(N.Style);P.appendChild(G)}C.appendChild(P)}N.firstLine=(M==null)?parseInt(K(&quot;firstline&quot;,Q,1)):M;N.Highlight(_[$]);N.source=_;_.parentNode.insertBefore(N.div,_)};config.formatters.push({name:&quot;SyntaxHighlighter&quot;,match:&quot;^&lt;code[\\s]+[^&gt;]+&gt;\\n&quot;,element:&quot;pre&quot;,handler:function(_){this.lookaheadRegExp=/&lt;code[\s]+([^&gt;]+)&gt;\n((?:^[^\n]*\n)+?)(^&lt;\/code&gt;$\n?)/mg;this.lookaheadRegExp.lastIndex=_.matchStart;var $=this.lookaheadRegExp.exec(_.source);if($&amp;&amp;$.index==_.matchStart){var C=$[1],B=$[2];if(config.browser.isIE)B=B.replace(/\n/g,&quot;\r&quot;);var A=createTiddlyElement(_.output,this.element,null,null,B);dp.sh.Highlight(A,C);_.nextMatch=$.index+$[0].length}}});config.formatterHelpers.enclosedTextHelper=function(_){this.lookaheadRegExp.lastIndex=_.matchStart;var $=this.lookaheadRegExp.exec(_.source);if($&amp;&amp;$.index==_.matchStart){var B=$[1];if(config.browser.isIE)B=B.replace(/\n/g,&quot;\r&quot;);var A=createTiddlyElement(_.output,this.element,null,null,B);switch(_.matchText){case&quot;/*{{{*/\n&quot;:dp.sh.Highlight(A,&quot;css&quot;);break;case&quot;//{{{\n&quot;:dp.sh.Highlight(A,&quot;js&quot;);break;case&quot;&lt;!--{{{--&gt;\n&quot;:dp.sh.Highlight(A,&quot;xml&quot;);break}_.nextMatch=$.index+$[0].length}};dp.sh.Brushes.AS3=function(){var _=&quot;class interface package&quot;,$=&quot;Array Boolean Date decodeURI decodeURIComponent encodeURI encodeURIComponent escape &quot;+&quot;int isFinite isNaN isXMLName Number Object parseFloat parseInt &quot;+&quot;String trace uint unescape XML XMLList &quot;+&quot;Infinity -Infinity NaN undefined &quot;+&quot;as delete instanceof is new typeof &quot;+&quot;break case catch continue default do each else finally for if in &quot;+&quot;label return super switch throw try while with &quot;+&quot;dynamic final internal native override private protected public static &quot;+&quot;...rest const extends function get implements namespace set &quot;+&quot;import include use &quot;+&quot;AS3 flash_proxy object_proxy &quot;+&quot;false null this true &quot;+&quot;void Null&quot;;this.regexList=[{regex:dp.sh.RegexLib.SingleLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.MultiLineCComments,css:&quot;blockcomment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;^\\s*#.*&quot;,&quot;gm&quot;),css:&quot;preprocessor&quot;},{regex:new RegExp(this.GetKeywords(_),&quot;gm&quot;),css:&quot;definition&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;},{regex:new RegExp(&quot;var&quot;,&quot;gm&quot;),css:&quot;variable&quot;}];this.CssClass=&quot;dp-as&quot;;this.Style=&quot;.dp-as .comment { color: #009900; font-style: italic; }&quot;+&quot;.dp-as .blockcomment { color: #3f5fbf; }&quot;+&quot;.dp-as .string { color: #990000; }&quot;+&quot;.dp-as .preprocessor { color: #0033ff; }&quot;+&quot;.dp-as .definition { color: #9900cc; font-weight: bold; }&quot;+&quot;.dp-as .keyword { color: #0033ff; }&quot;+&quot;.dp-as .variable { color: #6699cc; font-weight: bold; }&quot;};dp.sh.Brushes.AS3.prototype=new dp.sh.Highlighter();dp.sh.Brushes.AS3.Aliases=[&quot;as&quot;,&quot;actionscript&quot;,&quot;ActionScript&quot;,&quot;as3&quot;,&quot;AS3&quot;];dp.sh.Brushes.Bash=function(){var _=&quot;alias bg bind break builtin cd command compgen complete continue &quot;+&quot;declare dirs disown echo enable eval exec exit export fc fg &quot;+&quot;getopts hash help history jobs kill let local logout popd printf &quot;+&quot;pushd pwd read readonly return set shift shopt source &quot;+&quot;suspend test times trap type typeset ulimit umask unalias unset wait&quot;,$=&quot;case do done elif else esac fi for function if in select then &quot;+&quot;time until while&quot;;this.regexList=[{regex:dp.sh.RegexLib.SingleLinePerlComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;[()[\\]{}]&quot;,&quot;g&quot;),css:&quot;delim&quot;},{regex:new RegExp(&quot;\\$\\w+&quot;,&quot;g&quot;),css:&quot;vars&quot;},{regex:new RegExp(&quot;\\w+=&quot;,&quot;g&quot;),css:&quot;vars&quot;},{regex:new RegExp(&quot;\\s-\\w+&quot;,&quot;g&quot;),css:&quot;flag&quot;},{regex:new RegExp(this.GetKeywords(_),&quot;gm&quot;),css:&quot;builtin&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;}];this.CssClass=&quot;dp-bash&quot;;this.Style=&quot;.dp-bash .builtin {color: maroon; font-weight: bold;}&quot;+&quot;.dp-bash .comment {color: gray;}&quot;+&quot;.dp-bash .delim {font-weight: bold;}&quot;+&quot;.dp-bash .flag {color: green;}&quot;+&quot;.dp-bash .string {color: red;}&quot;+&quot;.dp-bash .vars {color: blue;}&quot;};dp.sh.Brushes.Bash.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Bash.Aliases=[&quot;bash&quot;,&quot;sh&quot;];dp.sh.Brushes.Batch=function(){var _=&quot;APPEND ATTRIB CD CHDIR CHKDSK CHOICE CLS COPY DEL ERASE DELTREE &quot;+&quot;DIR EXIT FC COMP FDISK FIND FORMAT FSUTIL HELP JOIN &quot;+&quot;LABEL LOADFIX MK MKDIR MEM MEMMAKER MORE MOVE MSD PCPARK &quot;+&quot;PRINT RD RMDIR REN SCANDISK SHARE SORT SUBST SYS &quot;+&quot;TIME DATE TREE TRUENAME TYPE UNDELETE VER XCOPY&quot;,$=&quot;DO ELSE FOR IN CALL CHOICE GOTO SHIFT PAUSE ERRORLEVEL &quot;+&quot;IF NOT EXIST LFNFOR START SETLOCAL ENDLOCAL ECHO SET&quot;;this.regexList=[{regex:new RegExp(&quot;REM.*$&quot;,&quot;gm&quot;),css:&quot;comment&quot;},{regex:new RegExp(&quot;::.*$&quot;,&quot;gm&quot;),css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;[()[\\]{}]&quot;,&quot;g&quot;),css:&quot;delim&quot;},{regex:new RegExp(&quot;%\\w+%&quot;,&quot;g&quot;),css:&quot;vars&quot;},{regex:new RegExp(&quot;%%\\w+&quot;,&quot;g&quot;),css:&quot;vars&quot;},{regex:new RegExp(&quot;\\w+=&quot;,&quot;g&quot;),css:&quot;vars&quot;},{regex:new RegExp(&quot;@\\w+&quot;,&quot;g&quot;),css:&quot;keyword&quot;},{regex:new RegExp(&quot;:\\w+&quot;,&quot;g&quot;),css:&quot;keyword&quot;},{regex:new RegExp(&quot;\\s/\\w+&quot;,&quot;g&quot;),css:&quot;flag&quot;},{regex:new RegExp(this.GetKeywords(_),&quot;gm&quot;),css:&quot;builtin&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;}];this.CssClass=&quot;dp-batch&quot;;this.Style=&quot;.dp-batch .builtin {color: maroon; font-weight: bold;}&quot;+&quot;.dp-batch .comment {color: gray;}&quot;+&quot;.dp-batch .delim {font-weight: bold;}&quot;+&quot;.dp-batch .flag {color: green;}&quot;+&quot;.dp-batch .string {color: red;}&quot;+&quot;.dp-batch .vars {color: blue;font-weight: bold;}&quot;};dp.sh.Brushes.Batch.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Batch.Aliases=[&quot;batch&quot;,&quot;dos&quot;];dp.sh.Brushes.ColdFusion=function(){this.CssClass=&quot;dp-coldfusion&quot;;this.Style=&quot;.dp-coldfusion { font: 13px \&quot;Courier New\&quot;, Courier, monospace; }&quot;+&quot;.dp-coldfusion .tag, .dp-coldfusion .tag-name { color: #990033; }&quot;+&quot;.dp-coldfusion .attribute { color: #990033; }&quot;+&quot;.dp-coldfusion .attribute-value { color: #0000FF; }&quot;+&quot;.dp-coldfusion .cfcomments { background-color: #FFFF99; color: #000000; }&quot;+&quot;.dp-coldfusion .cfscriptcomments { color: #999999; }&quot;+&quot;.dp-coldfusion .keywords { color: #0000FF; }&quot;+&quot;.dp-coldfusion .mgkeywords { color: #CC9900; }&quot;+&quot;.dp-coldfusion .numbers { color: #ff0000; }&quot;+&quot;.dp-coldfusion .strings { color: green; }&quot;;this.mgKeywords=&quot;setvalue getvalue addresult viewcollection viewstate&quot;;this.keywords=&quot;var eq neq gt gte lt lte not and or true false &quot;+&quot;abs acos addsoaprequestheader addsoapresponseheader &quot;+&quot;arrayappend arrayavg arrayclear arraydeleteat arrayinsertat &quot;+&quot;arrayisempty arraylen arraymax arraymin arraynew &quot;+&quot;arrayprepend arrayresize arrayset arraysort arraysum &quot;+&quot;arrayswap arraytolist asc asin atn binarydecode binaryencode &quot;+&quot;bitand bitmaskclear bitmaskread bitmaskset bitnot bitor bitshln &quot;+&quot;bitshrn bitxor ceiling charsetdecode charsetencode chr cjustify &quot;+&quot;compare comparenocase cos createdate createdatetime createobject &quot;+&quot;createobject createobject createobject createobject createodbcdate &quot;+&quot;createodbcdatetime createodbctime createtime createtimespan &quot;+&quot;createuuid dateadd datecompare dateconvert datediff dateformat &quot;+&quot;datepart day dayofweek dayofweekasstring dayofyear daysinmonth &quot;+&quot;daysinyear de decimalformat decrementvalue decrypt decryptbinary &quot;+&quot;deleteclientvariable directoryexists dollarformat duplicate encrypt &quot;+&quot;encryptbinary evaluate exp expandpath fileexists find findnocase &quot;+&quot;findoneof firstdayofmonth fix formatbasen generatesecretkey &quot;+&quot;getauthuser getbasetagdata getbasetaglist getbasetemplatepath &quot;+&quot;getclientvariableslist getcontextroot getcurrenttemplatepath &quot;+&quot;getdirectoryfrompath getencoding getexception getfilefrompath &quot;+&quot;getfunctionlist getgatewayhelper gethttprequestdata gethttptimestring &quot;+&quot;getk2serverdoccount getk2serverdoccountlimit getlocale &quot;+&quot;getlocaledisplayname getlocalhostip getmetadata getmetricdata &quot;+&quot;getpagecontext getprofilesections getprofilestring getsoaprequest &quot;+&quot;getsoaprequestheader getsoapresponse getsoapresponseheader &quot;+&quot;gettempdirectory gettempfile gettemplatepath gettickcount &quot;+&quot;gettimezoneinfo gettoken hash hour htmlcodeformat htmleditformat &quot;+&quot;iif incrementvalue inputbasen insert int isarray isbinary isboolean &quot;+&quot;iscustomfunction isdate isdebugmode isdefined isk2serverabroker &quot;+&quot;isk2serverdoccountexceeded isk2serveronline isleapyear islocalhost &quot;+&quot;isnumeric isnumericdate isobject isquery issimplevalue issoaprequest &quot;+&quot;isstruct isuserinrole isvalid isvalid isvalid iswddx isxml &quot;+&quot;isxmlattribute isxmldoc isxmlelem isxmlnode isxmlroot javacast &quot;+&quot;jsstringformat lcase left len listappend listchangedelims listcontains &quot;+&quot;listcontainsnocase listdeleteat listfind listfindnocase listfirst &quot;+&quot;listgetat listinsertat listlast listlen listprepend listqualify &quot;+&quot;listrest listsetat listsort listtoarray listvaluecount &quot;+&quot;listvaluecountnocase ljustify log log10 lscurrencyformat lsdateformat &quot;+&quot;lseurocurrencyformat lsiscurrency lsisdate lsisnumeric lsnumberformat &quot;+&quot;lsparsecurrency lsparsedatetime lsparseeurocurrency lsparsenumber &quot;+&quot;lstimeformat ltrim max mid min minute month monthasstring now &quot;+&quot;numberformat paragraphformat parameterexists parsedatetime pi &quot;+&quot;preservesinglequotes quarter queryaddcolumn queryaddrow querynew &quot;+&quot;querysetcell quotedvaluelist rand randomize randrange refind &quot;+&quot;refindnocase releasecomobject removechars repeatstring replace &quot;+&quot;replacelist replacenocase rereplace rereplacenocase reverse right &quot;+&quot;rjustify round rtrim second sendgatewaymessage setencoding &quot;+&quot;setlocale setprofilestring setvariable sgn sin spanexcluding &quot;+&quot;spanincluding sqr stripcr structappend structclear structcopy &quot;+&quot;structcount structdelete structfind structfindkey structfindvalue &quot;+&quot;structget structinsert structisempty structkeyarray structkeyexists &quot;+&quot;structkeylist structnew structsort structupdate tan timeformat &quot;+&quot;tobase64 tobinary toscript tostring trim ucase urldecode urlencodedformat &quot;+&quot;urlsessionformat val valuelist week wrap writeoutput xmlchildpos &quot;+&quot;xmlelemnew xmlformat xmlgetnodetype xmlnew xmlparse xmlsearch xmltransform &quot;+&quot;xmlvalidate year yesnoformat&quot;;this.stringMatches=new Array();this.attributeMatches=new Array()};dp.sh.Brushes.ColdFusion.prototype=new dp.sh.Highlighter();dp.sh.Brushes.ColdFusion.Aliases=[&quot;coldfusion&quot;,&quot;cf&quot;];dp.sh.Brushes.ColdFusion.prototype.ProcessRegexList=function(){function B(_,$){_[_.length]=$}function A(A,$){for(var _=0;_&lt;A.length;_++)if(A[_]==$)return _;return-1}var _=null,$=null;this.GetMatches(new RegExp(&quot;\\b(\\d+)&quot;,&quot;gm&quot;),&quot;numbers&quot;);this.GetMatches(new RegExp(this.GetKeywords(this.mgKeywords),&quot;igm&quot;),&quot;mgkeywords&quot;);this.GetMatches(dp.sh.RegexLib.SingleLineCComments,&quot;cfscriptcomments&quot;);this.GetMatches(dp.sh.RegexLib.MultiLineCComments,&quot;cfscriptcomments&quot;);this.GetMatches(new RegExp(&quot;(&amp;lt;|&lt;)!---[\\s\\S]*?---(&amp;gt;|&gt;)&quot;,&quot;gm&quot;),&quot;cfcomments&quot;);$=new RegExp(&quot;(cfset\\s*)?([:\\w-.]+)\\s*=\\s*(\&quot;.*?\&quot;|'.*?')*&quot;,&quot;gm&quot;);while((_=$.exec(this.code))!=null){if(_[1]!=undefined&amp;&amp;_[1]!=&quot;&quot;)continue;if(_[3]!=undefined&amp;&amp;_[3]!=&quot;&quot;&amp;&amp;_[3]!=&quot;\&quot;\&quot;&quot;&amp;&amp;_[3]!=&quot;''&quot;){B(this.matches,new dp.sh.Match(_[2],_.index,&quot;attribute&quot;));B(this.matches,new dp.sh.Match(_[3],_.index+_[0].indexOf(_[3]),&quot;attribute-value&quot;));B(this.stringMatches,_[3]);B(this.attributeMatches,_[2])}}this.GetMatches(new RegExp(&quot;(&amp;lt;|&lt;)/*\\?*(?!\\!)|/*\\?*(&amp;gt;|&gt;)&quot;,&quot;gm&quot;),&quot;tag&quot;);$=new RegExp(&quot;(?:&amp;lt;|&lt;)/*\\?*\\s*([:\\w-.]+)&quot;,&quot;gm&quot;);while((_=$.exec(this.code))!=null)B(this.matches,new dp.sh.Match(_[1],_.index+_[0].indexOf(_[1]),&quot;tag-name&quot;));$=new RegExp(this.GetKeywords(this.keywords),&quot;igm&quot;);while((_=$.exec(this.code))!=null)if(A(this.attributeMatches,_[0])==-1)B(this.matches,new dp.sh.Match(_[0],_.index,&quot;keywords&quot;));$=new RegExp(&quot;cfset\\s*.*(\&quot;.*?\&quot;|'.*?')&quot;,&quot;gm&quot;);while((_=$.exec(this.code))!=null)if(_[1]!=undefined&amp;&amp;_[1]!=&quot;&quot;){B(this.matches,new dp.sh.Match(_[1],_.index+_[0].indexOf(_[1]),&quot;strings&quot;));B(this.stringMatches,_[1])}while((_=dp.sh.RegexLib.DoubleQuotedString.exec(this.code))!=null)if(A(this.stringMatches,_[0])==-1)B(this.matches,new dp.sh.Match(_[0],_.index,&quot;strings&quot;));while((_=dp.sh.RegexLib.SingleQuotedString.exec(this.code))!=null)if(A(this.stringMatches,_[0])==-1)B(this.matches,new dp.sh.Match(_[0],_.index,&quot;strings&quot;))};dp.sh.Brushes.Cpp=function(){var _=&quot;ATOM BOOL BOOLEAN BYTE CHAR COLORREF DWORD DWORDLONG DWORD_PTR &quot;+&quot;DWORD32 DWORD64 FLOAT HACCEL HALF_PTR HANDLE HBITMAP HBRUSH &quot;+&quot;HCOLORSPACE HCONV HCONVLIST HCURSOR HDC HDDEDATA HDESK HDROP HDWP &quot;+&quot;HENHMETAFILE HFILE HFONT HGDIOBJ HGLOBAL HHOOK HICON HINSTANCE HKEY &quot;+&quot;HKL HLOCAL HMENU HMETAFILE HMODULE HMONITOR HPALETTE HPEN HRESULT &quot;+&quot;HRGN HRSRC HSZ HWINSTA HWND INT INT_PTR INT32 INT64 LANGID LCID LCTYPE &quot;+&quot;LGRPID LONG LONGLONG LONG_PTR LONG32 LONG64 LPARAM LPBOOL LPBYTE LPCOLORREF &quot;+&quot;LPCSTR LPCTSTR LPCVOID LPCWSTR LPDWORD LPHANDLE LPINT LPLONG LPSTR LPTSTR &quot;+&quot;LPVOID LPWORD LPWSTR LRESULT PBOOL PBOOLEAN PBYTE PCHAR PCSTR PCTSTR PCWSTR &quot;+&quot;PDWORDLONG PDWORD_PTR PDWORD32 PDWORD64 PFLOAT PHALF_PTR PHANDLE PHKEY PINT &quot;+&quot;PINT_PTR PINT32 PINT64 PLCID PLONG PLONGLONG PLONG_PTR PLONG32 PLONG64 POINTER_32 &quot;+&quot;POINTER_64 PSHORT PSIZE_T PSSIZE_T PSTR PTBYTE PTCHAR PTSTR PUCHAR PUHALF_PTR &quot;+&quot;PUINT PUINT_PTR PUINT32 PUINT64 PULONG PULONGLONG PULONG_PTR PULONG32 PULONG64 &quot;+&quot;PUSHORT PVOID PWCHAR PWORD PWSTR SC_HANDLE SC_LOCK SERVICE_STATUS_HANDLE SHORT &quot;+&quot;SIZE_T SSIZE_T TBYTE TCHAR UCHAR UHALF_PTR UINT UINT_PTR UINT32 UINT64 ULONG &quot;+&quot;ULONGLONG ULONG_PTR ULONG32 ULONG64 USHORT USN VOID WCHAR WORD WPARAM WPARAM WPARAM &quot;+&quot;char bool short int __int32 __int64 __int8 __int16 long float double __wchar_t &quot;+&quot;clock_t _complex _dev_t _diskfree_t div_t ldiv_t _exception _EXCEPTION_POINTERS &quot;+&quot;FILE _finddata_t _finddatai64_t _wfinddata_t _wfinddatai64_t __finddata64_t &quot;+&quot;__wfinddata64_t _FPIEEE_RECORD fpos_t _HEAPINFO _HFILE lconv intptr_t &quot;+&quot;jmp_buf mbstate_t _off_t _onexit_t _PNH ptrdiff_t _purecall_handler &quot;+&quot;sig_atomic_t size_t _stat __stat64 _stati64 terminate_function &quot;+&quot;time_t __time64_t _timeb __timeb64 tm uintptr_t _utimbuf &quot;+&quot;va_list wchar_t wctrans_t wctype_t wint_t signed&quot;,$=&quot;break case catch class const __finally __exception __try &quot;+&quot;const_cast continue private public protected __declspec &quot;+&quot;default delete deprecated dllexport dllimport do dynamic_cast &quot;+&quot;else enum explicit extern if for friend goto inline &quot;+&quot;mutable naked namespace new noinline noreturn nothrow &quot;+&quot;register reinterpret_cast return selectany &quot;+&quot;sizeof static static_cast struct switch template this &quot;+&quot;thread throw true false try typedef typeid typename union &quot;+&quot;using uuid virtual void volatile whcar_t while&quot;;this.regexList=[{regex:dp.sh.RegexLib.SingleLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.MultiLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;^ *#.*&quot;,&quot;gm&quot;),css:&quot;preprocessor&quot;},{regex:new RegExp(this.GetKeywords(_),&quot;gm&quot;),css:&quot;datatypes&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;}];this.CssClass=&quot;dp-cpp&quot;;this.Style=&quot;.dp-cpp .datatypes { color: #2E8B57; font-weight: bold; }&quot;};dp.sh.Brushes.Cpp.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Cpp.Aliases=[&quot;cpp&quot;,&quot;c&quot;,&quot;c++&quot;];dp.sh.Brushes.CSharp=function(){var $=&quot;abstract as base bool break byte case catch char checked class const &quot;+&quot;continue decimal default delegate do double else enum event explicit &quot;+&quot;extern false finally fixed float for foreach get goto if implicit in int &quot;+&quot;interface internal is lock long namespace new null object operator out &quot;+&quot;override params private protected public readonly ref return sbyte sealed set &quot;+&quot;short sizeof stackalloc static string struct switch this throw true try &quot;+&quot;typeof uint ulong unchecked unsafe ushort using virtual void while&quot;;this.regexList=[{regex:dp.sh.RegexLib.SingleLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.MultiLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;^\\s*#.*&quot;,&quot;gm&quot;),css:&quot;preprocessor&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;}];this.CssClass=&quot;dp-c&quot;;this.Style=&quot;.dp-c .vars { color: #d00; }&quot;};dp.sh.Brushes.CSharp.prototype=new dp.sh.Highlighter();dp.sh.Brushes.CSharp.Aliases=[&quot;c#&quot;,&quot;c-sharp&quot;,&quot;csharp&quot;];dp.sh.Brushes.CSS=function(){var _=&quot;ascent azimuth background-attachment background-color background-image background-position &quot;+&quot;background-repeat background baseline bbox border-collapse border-color border-spacing border-style border-top &quot;+&quot;border-right border-bottom border-left border-top-color border-right-color border-bottom-color border-left-color &quot;+&quot;border-top-style border-right-style border-bottom-style border-left-style border-top-width border-right-width &quot;+&quot;border-bottom-width border-left-width border-width border cap-height caption-side centerline clear clip color &quot;+&quot;content counter-increment counter-reset cue-after cue-before cue cursor definition-src descent direction display &quot;+&quot;elevation empty-cells float font-size-adjust font-family font-size font-stretch font-style font-variant font-weight font &quot;+&quot;height letter-spacing line-height list-style-image list-style-position list-style-type list-style margin-top &quot;+&quot;margin-right margin-bottom margin-left margin marker-offset marks mathline max-height max-width min-height min-width orphans &quot;+&quot;outline-color outline-style outline-width outline overflow padding-top padding-right padding-bottom padding-left padding page &quot;+&quot;page-break-after page-break-before page-break-inside pause pause-after pause-before pitch pitch-range play-during position &quot;+&quot;quotes richness size slope src speak-header speak-numeral speak-punctuation speak speech-rate stemh stemv stress &quot;+&quot;table-layout text-align text-decoration text-indent text-shadow text-transform unicode-bidi unicode-range units-per-em &quot;+&quot;vertical-align visibility voice-family volume white-space widows width widths word-spacing x-height z-index&quot;,$=&quot;above absolute all always aqua armenian attr aural auto avoid baseline behind below bidi-override black blink block blue bold bolder &quot;+&quot;both bottom braille capitalize caption center center-left center-right circle close-quote code collapse compact condensed &quot;+&quot;continuous counter counters crop cross crosshair cursive dashed decimal decimal-leading-zero default digits disc dotted double &quot;+&quot;embed embossed e-resize expanded extra-condensed extra-expanded fantasy far-left far-right fast faster fixed format fuchsia &quot;+&quot;gray green groove handheld hebrew help hidden hide high higher icon inline-table inline inset inside invert italic &quot;+&quot;justify landscape large larger left-side left leftwards level lighter lime line-through list-item local loud lower-alpha &quot;+&quot;lowercase lower-greek lower-latin lower-roman lower low ltr marker maroon medium message-box middle mix move narrower &quot;+&quot;navy ne-resize no-close-quote none no-open-quote no-repeat normal nowrap n-resize nw-resize oblique olive once open-quote outset &quot;+&quot;outside overline pointer portrait pre print projection purple red relative repeat repeat-x repeat-y rgb ridge right right-side &quot;+&quot;rightwards rtl run-in screen scroll semi-condensed semi-expanded separate se-resize show silent silver slower slow &quot;+&quot;small small-caps small-caption smaller soft solid speech spell-out square s-resize static status-bar sub super sw-resize &quot;+&quot;table-caption table-cell table-column table-column-group table-footer-group table-header-group table-row table-row-group teal &quot;+&quot;text-bottom text-top thick thin top transparent tty tv ultra-condensed ultra-expanded underline upper-alpha uppercase upper-latin &quot;+&quot;upper-roman url visible wait white wider w-resize x-fast x-high x-large x-loud x-low x-slow x-small x-soft xx-large xx-small yellow&quot;,A=&quot;[mM]onospace [tT]ahoma [vV]erdana [aA]rial [hH]elvetica [sS]ans-serif [sS]erif&quot;;this.regexList=[{regex:dp.sh.RegexLib.MultiLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;\\#[a-zA-Z0-9]{3,6}&quot;,&quot;g&quot;),css:&quot;value&quot;},{regex:new RegExp(&quot;(-?\\d+)(.\\d+)?(px|em|pt|:|%|)&quot;,&quot;g&quot;),css:&quot;value&quot;},{regex:new RegExp(&quot;!important&quot;,&quot;g&quot;),css:&quot;important&quot;},{regex:new RegExp(this.GetKeywordsCSS(_),&quot;gm&quot;),css:&quot;keyword&quot;},{regex:new RegExp(this.GetValuesCSS($),&quot;g&quot;),css:&quot;value&quot;},{regex:new RegExp(this.GetValuesCSS(A),&quot;g&quot;),css:&quot;value&quot;}];this.CssClass=&quot;dp-css&quot;;this.Style=&quot;.dp-css .value { color: black; }&quot;+&quot;.dp-css .important { color: red; }&quot;};dp.sh.Highlighter.prototype.GetKeywordsCSS=function($){return&quot;\\b([a-z_]|)&quot;+$.replace(/ /g,&quot;(?=:)\\b|\\b([a-z_\\*]|\\*|)&quot;)+&quot;(?=:)\\b&quot;};dp.sh.Highlighter.prototype.GetValuesCSS=function($){return&quot;\\b&quot;+$.replace(/ /g,&quot;(?!-)(?!:)\\b|\\b()&quot;)+&quot;:\\b&quot;};dp.sh.Brushes.CSS.prototype=new dp.sh.Highlighter();dp.sh.Brushes.CSS.Aliases=[&quot;css&quot;];dp.sh.Brushes.Delphi=function(){var $=&quot;abs addr and ansichar ansistring array as asm begin boolean byte cardinal &quot;+&quot;case char class comp const constructor currency destructor div do double &quot;+&quot;downto else end except exports extended false file finalization finally &quot;+&quot;for function goto if implementation in inherited int64 initialization &quot;+&quot;integer interface is label library longint longword mod nil not object &quot;+&quot;of on or packed pansichar pansistring pchar pcurrency pdatetime pextended &quot;+&quot;pint64 pointer private procedure program property pshortstring pstring &quot;+&quot;pvariant pwidechar pwidestring protected public published raise real real48 &quot;+&quot;record repeat set shl shortint shortstring shr single smallint string then &quot;+&quot;threadvar to true try type unit until uses val var varirnt while widechar &quot;+&quot;widestring with word write writeln xor&quot;;this.regexList=[{regex:new RegExp(&quot;\\(\\*[\\s\\S]*?\\*\\)&quot;,&quot;gm&quot;),css:&quot;comment&quot;},{regex:new RegExp(&quot;{(?!\\$)[\\s\\S]*?}&quot;,&quot;gm&quot;),css:&quot;comment&quot;},{regex:dp.sh.RegexLib.SingleLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;\\{\\$[a-zA-Z]+ .+\\}&quot;,&quot;g&quot;),css:&quot;directive&quot;},{regex:new RegExp(&quot;\\b[\\d\\.]+\\b&quot;,&quot;g&quot;),css:&quot;number&quot;},{regex:new RegExp(&quot;\\$[a-zA-Z0-9]+\\b&quot;,&quot;g&quot;),css:&quot;number&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;}];this.CssClass=&quot;dp-delphi&quot;;this.Style=&quot;.dp-delphi .number { color: blue; }&quot;+&quot;.dp-delphi .directive { color: #008284; }&quot;+&quot;.dp-delphi .vars { color: #000; }&quot;};dp.sh.Brushes.Delphi.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Delphi.Aliases=[&quot;delphi&quot;,&quot;pascal&quot;];dp.sh.Brushes.Java=function(){var $=&quot;abstract assert boolean break byte case catch char class const &quot;+&quot;continue default do double else enum extends &quot;+&quot;false final finally float for goto if implements import &quot;+&quot;instanceof int interface long native new null &quot;+&quot;package private protected public return &quot;+&quot;short static strictfp super switch synchronized this throw throws true &quot;+&quot;transient try void volatile while&quot;;this.regexList=[{regex:dp.sh.RegexLib.SingleLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.MultiLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;\\b([\\d]+(\\.[\\d]+)?|0x[a-f0-9]+)\\b&quot;,&quot;gi&quot;),css:&quot;number&quot;},{regex:new RegExp(&quot;(?!\\@interface\\b)\\@[\\$\\w]+\\b&quot;,&quot;g&quot;),css:&quot;annotation&quot;},{regex:new RegExp(&quot;\\@interface\\b&quot;,&quot;g&quot;),css:&quot;keyword&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;}];this.CssClass=&quot;dp-j&quot;;this.Style=&quot;.dp-j .annotation { color: #646464; }&quot;+&quot;.dp-j .number { color: #C00000; }&quot;};dp.sh.Brushes.Java.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Java.Aliases=[&quot;java&quot;];dp.sh.Brushes.JScript=function(){var $=&quot;abstract boolean break byte case catch char class const continue debugger &quot;+&quot;default delete do double else enum export extends false final finally float &quot;+&quot;for function goto if implements import in instanceof int interface long native &quot;+&quot;new null package private protected public return short static super switch &quot;+&quot;synchronized this throw throws transient true try typeof var void volatile while with&quot;;this.regexList=[{regex:dp.sh.RegexLib.SingleLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.MultiLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;^\\s*#.*&quot;,&quot;gm&quot;),css:&quot;preprocessor&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;}];this.CssClass=&quot;dp-c&quot;};dp.sh.Brushes.JScript.prototype=new dp.sh.Highlighter();dp.sh.Brushes.JScript.Aliases=[&quot;js&quot;,&quot;jscript&quot;,&quot;javascript&quot;];dp.sh.Brushes.Lua=function(){var $=&quot;break do end else elseif function if local nil not or repeat return and then until while this&quot;,_=&quot;math\\.\\w+ string\\.\\w+ os\\.\\w+ debug\\.\\w+ io\\.\\w+ error fopen dofile coroutine\\.\\w+ arg getmetatable ipairs loadfile loadlib loadstring longjmp print rawget rawset seek setmetatable assert tonumber tostring&quot;;this.regexList=[{regex:new RegExp(&quot;--\\[\\[[\\s\\S]*\\]\\]--&quot;,&quot;gm&quot;),css:&quot;comment&quot;},{regex:new RegExp(&quot;--[^\\[]{2}.*$&quot;,&quot;gm&quot;),css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;},{regex:new RegExp(this.GetKeywords(_),&quot;gm&quot;),css:&quot;func&quot;},];this.CssClass=&quot;dp-lua&quot;};dp.sh.Brushes.Lua.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Lua.Aliases=[&quot;lua&quot;];dp.sh.Brushes.Mxml=function(){this.CssClass=&quot;dp-mxml&quot;;this.Style=&quot;.dp-mxml .cdata { color: #000000; }&quot;+&quot;.dp-mxml .tag { color : #0000ff; }&quot;+&quot;.dp-mxml .tag-name { color: #0000ff; }&quot;+&quot;.dp-mxml .script { color: green; }&quot;+&quot;.dp-mxml .metadata { color: green; }&quot;+&quot;.dp-mxml .attribute { color: #000000; }&quot;+&quot;.dp-mxml .attribute-value { color: #990000; }&quot;+&quot;.dp-mxml .trace { color: #cc6666; }&quot;+&quot;.dp-mxml .var { color: #6699cc; }&quot;+&quot;.dp-mxml .comment { color: #009900; }&quot;+&quot;.dp-mxml .string { color: #990000; }&quot;+&quot;.dp-mxml .keyword { color: blue; }&quot;};dp.sh.Brushes.Mxml.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Mxml.Aliases=[&quot;mxml&quot;];dp.sh.Brushes.Mxml.prototype.ProcessRegexList=function(){function H(_,$){_[_.length]=$}function B(B,_){var A=0,$=false;for(A=0;A&lt;B.length;A++)if(_.index&gt;B[A].firstIndex&amp;&amp;_.index&lt;B[A].lastIndex)$=true;return $}var $=0,F=null,D=null,A=null,C=&quot;&quot;,E=new Array(),_=&quot;abstract boolean break byte case catch char class const continue debugger &quot;+&quot;default delete do double else enum export extends false final finally float &quot;+&quot;for function goto if implements import in instanceof int interface long native &quot;+&quot;new null package private protected public return short static super switch &quot;+&quot;synchronized this throw throws transient true try typeof var void volatile while with&quot;,G=[{regex:dp.sh.RegexLib.SingleLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.MultiLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;^\\s*#.*&quot;,&quot;gm&quot;),css:&quot;preprocessor&quot;},{regex:new RegExp(this.GetKeywords(&quot;trace&quot;),&quot;gm&quot;),css:&quot;trace&quot;},{regex:new RegExp(this.GetKeywords(_),&quot;gm&quot;),css:&quot;keyword&quot;}];A=new RegExp(&quot;&amp;lt;\\!\\[CDATA\\[(.|\\s)*?\\]\\]&amp;gt;&quot;,&quot;gm&quot;);while((F=A.exec(this.code))!=null){C=F[0].substr(0,12);H(this.matches,new dp.sh.Match(C,F.index,&quot;cdata&quot;));C=F[0].substr(12,F[0].length-12-6);for(var I=0;I&lt;G.length;I++)while((D=G[I].regex.exec(C))!=null)H(this.matches,new dp.sh.Match(D[0],F.index+12+D.index,G[I].css));C=F[0].substr(F[0].length-6,6);H(this.matches,new dp.sh.Match(C,F.index+F[0].length-6,&quot;cdata&quot;));E.push({firstIndex:F.index,lastIndex:F.index+F[0].length-1})}this.GetMatches(new RegExp(&quot;(&amp;lt;|&lt;)!--\\s*.*?\\s*--(&amp;gt;|&gt;)&quot;,&quot;gm&quot;),&quot;comments&quot;);A=new RegExp(&quot;([:\\w-.]+)\\s*=\\s*(\&quot;.*?\&quot;|'.*?'|\\w+)*|(\\w+)&quot;,&quot;gm&quot;);while((F=A.exec(this.code))!=null){if(F[1]==null)continue;if(B(E,F))continue;H(this.matches,new dp.sh.Match(F[1],F.index,&quot;attribute&quot;));if(F[2]!=undefined)H(this.matches,new dp.sh.Match(F[2],F.index+F[0].indexOf(F[2]),&quot;attribute-value&quot;))}A=new RegExp(&quot;(?:&amp;lt;|&lt;)/*\\?*\\s*([:\\w-.]+)&quot;,&quot;gm&quot;);while((F=A.exec(this.code))!=null){if(B(E,F))continue;C=F[0].substr(4,F[0].length-4);switch(C){case&quot;mx:Script&quot;:case&quot;/mx:Script&quot;:H(this.matches,new dp.sh.Match(F[0]+&quot;&amp;gt;&quot;,F.index,&quot;script&quot;));break;case&quot;mx:Metadata&quot;:case&quot;/mx:Metadata&quot;:H(this.matches,new dp.sh.Match(F[0]+&quot;&amp;gt;&quot;,F.index,&quot;metadata&quot;));break;default:H(this.matches,new dp.sh.Match(F[0],F.index,&quot;tag-name&quot;));break}}A=new RegExp(&quot;\\?&amp;gt;|&amp;gt;|/&amp;gt;&quot;,&quot;gm&quot;);while((F=A.exec(this.code))!=null){if(B(E,F))continue;H(this.matches,new dp.sh.Match(F[0],F.index,&quot;tag&quot;))}};dp.sh.Brushes.Perl=function(){var _=&quot;abs accept alarm atan2 bind binmode bless caller chdir chmod chomp chop chown chr chroot close closedir connect cos crypt dbmclose dbmopen defined delete dump each endgrent endhostent endnetent endprotoent endpwent endservent eof exec exists exp fcntl fileno flock fork format formline getc getgrent getgrgid getgrnam gethostbyaddr gethostbyname gethostent getlogin getnetbyaddr getnetbyname getnetent getpeername getpgrp getppid getpriority getprotobyname getprotobynumber getprotoent getpwent getpwnam getpwuid getservbyname getservbyport getservent getsockname getsockopt glob gmtime grep hex import index int ioctl join keys kill lc lcfirst length link listen localtime lock log lstat m map mkdir msgctl msgget msgrcv msgsnd no oct open opendir ord pack pipe pop pos print printf prototype push q qq quotemeta qw qx rand read readdir readline readlink readpipe recv ref rename reset reverse rewinddir rindex rmdir scalar seek seekdir semctl semget semop send setgrent sethostent setnetent setpgrp setpriority setprotoent setpwent setservent setsockopt shift shmctl shmget shmread shmwrite shutdown sin sleep socket socketpair sort splice split sprintf sqrt srand stat study sub substr symlink syscall sysopen sysread sysseek system syswrite tell telldir tie tied time times tr truncate uc ucfirst umask undef unlink unpack unshift untie utime values vec waitpid wantarray warn write qr&quot;,$=&quot;s select goto die do package redo require return continue for foreach last next wait while use if else elsif eval exit unless switch case&quot;,A=&quot;my our local&quot;;this.regexList=[{regex:dp.sh.RegexLib.SingleLinePerlComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;(\\$|@|%)\\w+&quot;,&quot;g&quot;),css:&quot;vars&quot;},{regex:new RegExp(this.GetKeywords(_),&quot;gmi&quot;),css:&quot;func&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;},{regex:new RegExp(this.GetKeywords(A),&quot;gm&quot;),css:&quot;declarations&quot;}];this.CssClass=&quot;dp-perl&quot;};dp.sh.Brushes.Perl.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Perl.Aliases=[&quot;perl&quot;];dp.sh.Brushes.Php=function(){var _=&quot;abs acos acosh addcslashes addslashes &quot;+&quot;array_change_key_case array_chunk array_combine array_count_values array_diff &quot;+&quot;array_diff_assoc array_diff_key array_diff_uassoc array_diff_ukey array_fill &quot;+&quot;array_filter array_flip array_intersect array_intersect_assoc array_intersect_key &quot;+&quot;array_intersect_uassoc array_intersect_ukey array_key_exists array_keys array_map &quot;+&quot;array_merge array_merge_recursive array_multisort array_pad array_pop array_product &quot;+&quot;array_push array_rand array_reduce array_reverse array_search array_shift &quot;+&quot;array_slice array_splice array_sum array_udiff array_udiff_assoc &quot;+&quot;array_udiff_uassoc array_uintersect array_uintersect_assoc &quot;+&quot;array_uintersect_uassoc array_unique array_unshift array_values array_walk &quot;+&quot;array_walk_recursive atan atan2 atanh base64_decode base64_encode base_convert &quot;+&quot;basename bcadd bccomp bcdiv bcmod bcmul bindec bindtextdomain bzclose bzcompress &quot;+&quot;bzdecompress bzerrno bzerror bzerrstr bzflush bzopen bzread bzwrite ceil chdir &quot;+&quot;checkdate checkdnsrr chgrp chmod chop chown chr chroot chunk_split class_exists &quot;+&quot;closedir closelog copy cos cosh count count_chars date decbin dechex decoct &quot;+&quot;deg2rad delete ebcdic2ascii echo empty end ereg ereg_replace eregi eregi_replace error_log &quot;+&quot;error_reporting escapeshellarg escapeshellcmd eval exec exit exp explode extension_loaded &quot;+&quot;feof fflush fgetc fgetcsv fgets fgetss file_exists file_get_contents file_put_contents &quot;+&quot;fileatime filectime filegroup fileinode filemtime fileowner fileperms filesize filetype &quot;+&quot;floatval flock floor flush fmod fnmatch fopen fpassthru fprintf fputcsv fputs fread fscanf &quot;+&quot;fseek fsockopen fstat ftell ftok getallheaders getcwd getdate getenv gethostbyaddr gethostbyname &quot;+&quot;gethostbynamel getimagesize getlastmod getmxrr getmygid getmyinode getmypid getmyuid getopt &quot;+&quot;getprotobyname getprotobynumber getrandmax getrusage getservbyname getservbyport gettext &quot;+&quot;gettimeofday gettype glob gmdate gmmktime ini_alter ini_get ini_get_all ini_restore ini_set &quot;+&quot;interface_exists intval ip2long is_a is_array is_bool is_callable is_dir is_double &quot;+&quot;is_executable is_file is_finite is_float is_infinite is_int is_integer is_link is_long &quot;+&quot;is_nan is_null is_numeric is_object is_readable is_real is_resource is_scalar is_soap_fault &quot;+&quot;is_string is_subclass_of is_uploaded_file is_writable is_writeable mkdir mktime nl2br &quot;+&quot;parse_ini_file parse_str parse_url passthru pathinfo readlink realpath rewind rewinddir rmdir &quot;+&quot;round str_ireplace str_pad str_repeat str_replace str_rot13 str_shuffle str_split &quot;+&quot;str_word_count strcasecmp strchr strcmp strcoll strcspn strftime strip_tags stripcslashes &quot;+&quot;stripos stripslashes stristr strlen strnatcasecmp strnatcmp strncasecmp strncmp strpbrk &quot;+&quot;strpos strptime strrchr strrev strripos strrpos strspn strstr strtok strtolower strtotime &quot;+&quot;strtoupper strtr strval substr substr_compare&quot;,$=&quot;and or xor __FILE__ __LINE__ array as break case &quot;+&quot;cfunction class const continue declare default die do else &quot;+&quot;elseif empty enddeclare endfor endforeach endif endswitch endwhile &quot;+&quot;extends for foreach function include include_once global if &quot;+&quot;new old_function return static switch use require require_once &quot;+&quot;var while __FUNCTION__ __CLASS__ &quot;+&quot;__METHOD__ abstract interface public implements extends private protected throw&quot;;this.regexList=[{regex:dp.sh.RegexLib.SingleLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.MultiLineCComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;\\$\\w+&quot;,&quot;g&quot;),css:&quot;vars&quot;},{regex:new RegExp(this.GetKeywords(_),&quot;gmi&quot;),css:&quot;func&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;}];this.CssClass=&quot;dp-c&quot;};dp.sh.Brushes.Php.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Php.Aliases=[&quot;php&quot;];dp.sh.Brushes.Python=function(){var $=&quot;and assert break class continue def del elif else &quot;+&quot;except exec finally for from global if import in is &quot;+&quot;lambda not or pass print raise return try yield while&quot;,_=&quot;None True False self cls class_&quot;;this.regexList=[{regex:dp.sh.RegexLib.SingleLinePerlComments,css:&quot;comment&quot;},{regex:new RegExp(&quot;^\\s*@\\w+&quot;,&quot;gm&quot;),css:&quot;decorator&quot;},{regex:new RegExp(&quot;(['\&quot;]{3})([^\\1])*?\\1&quot;,&quot;gm&quot;),css:&quot;comment&quot;},{regex:new RegExp(&quot;\&quot;(?!\&quot;)(?:\\.|\\\\\\\&quot;|[^\\\&quot;\&quot;\\n\\r])*\&quot;&quot;,&quot;gm&quot;),css:&quot;string&quot;},{regex:new RegExp(&quot;'(?!')*(?:\\.|(\\\\\\')|[^\\''\\n\\r])*'&quot;,&quot;gm&quot;),css:&quot;string&quot;},{regex:new RegExp(&quot;\\b\\d+\\.?\\w*&quot;,&quot;g&quot;),css:&quot;number&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;},{regex:new RegExp(this.GetKeywords(_),&quot;gm&quot;),css:&quot;special&quot;}];this.CssClass=&quot;dp-py&quot;;this.Style=&quot;.dp-py .builtins { color: #ff1493; }&quot;+&quot;.dp-py .magicmethods { color: #808080; }&quot;+&quot;.dp-py .exceptions { color: brown; }&quot;+&quot;.dp-py .types { color: brown; font-style: italic; }&quot;+&quot;.dp-py .commonlibs { color: #8A2BE2; font-style: italic; }&quot;};dp.sh.Brushes.Python.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Python.Aliases=[&quot;py&quot;,&quot;python&quot;];dp.sh.Brushes.Ruby=function(){var $=&quot;alias and BEGIN begin break case class def define_method defined do each else elsif &quot;+&quot;END end ensure false for if in module new next nil not or raise redo rescue retry return &quot;+&quot;self super then throw true undef unless until when while yield&quot;,_=&quot;Array Bignum Binding Class Continuation Dir Exception FalseClass File::Stat File Fixnum Fload &quot;+&quot;Hash Integer IO MatchData Method Module NilClass Numeric Object Proc Range Regexp String Struct::TMS Symbol &quot;+&quot;ThreadGroup Thread Time TrueClass&quot;;this.regexList=[{regex:dp.sh.RegexLib.SingleLinePerlComments,css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;:[a-z][A-Za-z0-9_]*&quot;,&quot;g&quot;),css:&quot;symbol&quot;},{regex:new RegExp(&quot;(\\$|@@|@)\\w+&quot;,&quot;g&quot;),css:&quot;variable&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;},{regex:new RegExp(this.GetKeywords(_),&quot;gm&quot;),css:&quot;builtin&quot;}];this.CssClass=&quot;dp-rb&quot;;this.Style=&quot;.dp-rb .symbol { color: #a70; }&quot;+&quot;.dp-rb .variable { color: #a70; font-weight: bold; }&quot;};dp.sh.Brushes.Ruby.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Ruby.Aliases=[&quot;ruby&quot;,&quot;rails&quot;,&quot;ror&quot;];dp.sh.Brushes.Sql=function(){var _=&quot;abs avg case cast coalesce convert count current_timestamp &quot;+&quot;current_user day isnull left lower month nullif replace right &quot;+&quot;session_user space substring sum system_user upper user year&quot;,$=&quot;absolute action add after alter as asc at authorization begin bigint &quot;+&quot;binary bit by cascade char character check checkpoint close collate &quot;+&quot;column commit committed connect connection constraint contains continue &quot;+&quot;create cube current current_date current_time cursor database date &quot;+&quot;deallocate dec decimal declare default delete desc distinct double drop &quot;+&quot;dynamic else end end-exec escape except exec execute false fetch first &quot;+&quot;float for force foreign forward free from full function global goto grant &quot;+&quot;group grouping having hour ignore index inner insensitive insert instead &quot;+&quot;int integer intersect into is isolation key last level load local max min &quot;+&quot;minute modify move name national nchar next no numeric of off on only &quot;+&quot;open option order out output partial password precision prepare primary &quot;+&quot;prior privileges procedure public read real references relative repeatable &quot;+&quot;restrict return returns revoke rollback rollup rows rule schema scroll &quot;+&quot;second section select sequence serializable set size smallint static &quot;+&quot;statistics table temp temporary then time timestamp to top transaction &quot;+&quot;translation trigger true truncate uncommitted union unique update values &quot;+&quot;varchar varying view when where with work&quot;,A=&quot;all and any between cross in join like not null or outer some&quot;;this.regexList=[{regex:new RegExp(&quot;--(.*)$&quot;,&quot;gm&quot;),css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:dp.sh.RegexLib.SingleQuotedString,css:&quot;string&quot;},{regex:new RegExp(this.GetKeywords(_),&quot;gmi&quot;),css:&quot;func&quot;},{regex:new RegExp(this.GetKeywords(A),&quot;gmi&quot;),css:&quot;op&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gmi&quot;),css:&quot;keyword&quot;}];this.CssClass=&quot;dp-sql&quot;;this.Style=&quot;.dp-sql .func { color: #ff1493; }&quot;+&quot;.dp-sql .op { color: #808080; }&quot;};dp.sh.Brushes.Sql.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Sql.Aliases=[&quot;sql&quot;];dp.sh.Brushes.Vb=function(){var $=&quot;AddHandler AddressOf AndAlso Alias And Ansi As Assembly Auto &quot;+&quot;Boolean ByRef Byte ByVal Call Case Catch CBool CByte CChar CDate &quot;+&quot;CDec CDbl Char CInt Class CLng CObj Const CShort CSng CStr CType &quot;+&quot;Date Decimal Declare Default Delegate Dim DirectCast Do Double Each &quot;+&quot;Else ElseIf End Enum Erase Error Event Exit False Finally For Friend &quot;+&quot;Function Get GetType GoSub GoTo Handles If Implements Imports In &quot;+&quot;Inherits Integer Interface Is Let Lib Like Long Loop Me Mod Module &quot;+&quot;MustInherit MustOverride MyBase MyClass Namespace New Next Not Nothing &quot;+&quot;NotInheritable NotOverridable Object On Option Optional Or OrElse &quot;+&quot;Overloads Overridable Overrides ParamArray Preserve Private Property &quot;+&quot;Protected Public RaiseEvent ReadOnly ReDim REM RemoveHandler Resume &quot;+&quot;Return Select Set Shadows Shared Short Single Static Step Stop String &quot;+&quot;Structure Sub SyncLock Then Throw To True Try TypeOf Unicode Until &quot;+&quot;Variant When While With WithEvents WriteOnly Xor&quot;;this.regexList=[{regex:new RegExp(&quot;'.*$&quot;,&quot;gm&quot;),css:&quot;comment&quot;},{regex:dp.sh.RegexLib.DoubleQuotedString,css:&quot;string&quot;},{regex:new RegExp(&quot;^\\s*#.*&quot;,&quot;gm&quot;),css:&quot;preprocessor&quot;},{regex:new RegExp(this.GetKeywords($),&quot;gm&quot;),css:&quot;keyword&quot;}];this.CssClass=&quot;dp-vb&quot;};dp.sh.Brushes.Vb.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Vb.Aliases=[&quot;vb&quot;,&quot;vb.net&quot;];dp.sh.Brushes.Xml=function(){this.CssClass=&quot;dp-xml&quot;;this.Style=&quot;.dp-xml .cdata { color: #ff1493; }&quot;+&quot;.dp-xml .tag, .dp-xml .tag-name { color: #069; font-weight: bold; }&quot;+&quot;.dp-xml .attribute { color: red; }&quot;+&quot;.dp-xml .attribute-value { color: blue; }&quot;};dp.sh.Brushes.Xml.prototype=new dp.sh.Highlighter();dp.sh.Brushes.Xml.Aliases=[&quot;xml&quot;,&quot;xhtml&quot;,&quot;xslt&quot;,&quot;html&quot;,&quot;xhtml&quot;];dp.sh.Brushes.Xml.prototype.ProcessRegexList=function(){function B(_,$){_[_.length]=$}var $=0,A=null,_=null;this.GetMatches(new RegExp(&quot;(&amp;lt;|&lt;)\\!\\[[\\w\\s]*?\\[(.|\\s)*?\\]\\](&amp;gt;|&gt;)&quot;,&quot;gm&quot;),&quot;cdata&quot;);this.GetMatches(new RegExp(&quot;(&amp;lt;|&lt;)!--\\s*.*?\\s*--(&amp;gt;|&gt;)&quot;,&quot;gm&quot;),&quot;comments&quot;);_=new RegExp(&quot;([:\\w-.]+)\\s*=\\s*(\&quot;.*?\&quot;|'.*?'|\\w+)*|(\\w+)&quot;,&quot;gm&quot;);while((A=_.exec(this.code))!=null){if(A[1]==null)continue;B(this.matches,new dp.sh.Match(A[1],A.index,&quot;attribute&quot;));if(A[2]!=undefined)B(this.matches,new dp.sh.Match(A[2],A.index+A[0].indexOf(A[2]),&quot;attribute-value&quot;))}this.GetMatches(new RegExp(&quot;(&amp;lt;|&lt;)/*\\?*(?!\\!)|/*\\?*(&amp;gt;|&gt;)&quot;,&quot;gm&quot;),&quot;tag&quot;);_=new RegExp(&quot;(?:&amp;lt;|&lt;)/*\\?*\\s*([:\\w-.]+)&quot;,&quot;gm&quot;);while((A=_.exec(this.code))!=null)B(this.matches,new dp.sh.Match(A[1],A.index+A[0].indexOf(A[1]),&quot;tag-name&quot;))}
//}}}</pre>
</div>
<div title="TiddlyWiki Turior" creator="YourName" modifier="Samuel" created="201206180606" modified="201303010225" changecount="15">
<pre>[[表格]]
[[格式]]
[[Howto hide the left MainMenu]]
[[LATEX]]</pre>
</div>
<div title="Todo" creator="Samuel" modifier="Samuel" created="201207240627" modified="201301180151" changecount="22">
<pre>*测试git fetch命令

*研究一下opencl的内存copy问题, 以及AMD的FFT

*将cmake笔记移过来

*如何生成带版本号的动态库
*pkg-config

*mpi
*GOBJECT / glib

*pragma
*CPPUNIT

~UMLet

图像变形算法：
不规则变形
http://paulbourke.net/miscellaneous/imagewarp/
鼠标拉伸改变图像的
http://www.codeproject.com/KB/graphics/localimagewarper.aspx?q=warp
Photoshop液化工具箱中向前变形工具
http://www.cnblogs.com/xiaotie/archive/2009/12/08/1619046.html

图像分割算法：
1、watershed、 graph cut 、 meanshift</pre>
</div>
<div title="Training&amp;detection" creator="YourName" modifier="samuel" created="201207240627" modified="201304030547" tags="_TRAINING_ _DETECTION_" changecount="10">
<pre>[[SVM]]
[[K-means]]
[[Meanshift]]
[[Adaboost]]</pre>
</div>
<div title="ViewTemplate" creator="Samuel" modifier="Samuel" created="201207180830" modified="201207180830" changecount="2">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::ViewToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='subtitle'&gt;&lt;span macro='view modifier link'&gt;&lt;/span&gt;, &lt;span macro='view modified date'&gt;&lt;/span&gt; (&lt;span macro='message views.wikified.createdPrompt'&gt;&lt;/span&gt; &lt;span macro='view created date'&gt;&lt;/span&gt;)&lt;/div&gt;
&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;
&lt;div class='tagged' macro='tags'&gt;&lt;/div&gt;
&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;
&lt;div class='tagClear'&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="WindowTitle" creator="YourName" modifier="YourName" created="201206180441" changecount="1">
<pre>&lt;&lt;tiddler SiteTitle&gt;&gt; - &lt;&lt;tiddler SiteSubtitle&gt;&gt;</pre>
</div>
<div title="add_definitions" creator="Samuel" modifier="Samuel" created="201211270108" modified="201211270156" changecount="5">
<pre>*@@color(blue):''add_definitions ''@@ (-DFOO &amp;nbsp;-DBAR ...)
**@@bgcolor(green):功能@@
***设置预编译宏
**@@bgcolor(green):说明@@
***对当前目录项目和子目录有效(add_subdirectory命令需放在其下面才有效, @@color(red):平级的add_subdirectory子目录里定义的宏互不相关@@)
</pre>
</div>
<div title="add_dependencies" creator="Samuel" modifier="Samuel" created="201211270132" modified="201211270132" changecount="2">
<pre>*@@color(blue):''add_dependencies''@@ (target-name  depend-target1 depend-target2 ...)
**@@bgcolor(green):功能@@
***确保一个项目在另一个项目之前建立
**@@bgcolor(green):说明@@
***只能用于top-level(由~ADD_EXECUTABLE, ~ADD_LIBRARY, ~ADD_CUSTOM_TARGET命令创建的)的目标之间
</pre>
</div>
<div title="add_executable" creator="samuel" modifier="Samuel" created="201208270711" modified="201211270140" changecount="33">
<pre>*{{normal{@@color(blue):''add_executable''@@(&lt;name&gt; [~WIN32] [~MACOSX_BUNDLE] [~EXCLUDE_FROM_ALL]  source1 source2 ...) 
*@@bgcolor(green):功能@@
**增加一个可执行工程。 
*@@bgcolor(green):用法@@
&gt; (source1 , source2..包含源文件和头文件)
&gt;''~WIN32''  :  设置''~WIN32_EXECYTABLE''属性@@color(green):(即窗口程序MFC， 默认为console) @@(见Properties on Targets 详细说明)
&gt;''~MACOSX_BUNDLE''  :  设置为''~MACOSX_BUNDLE''属性
&gt;''~EXCLUDE_FROM_ALL''  :  设置为''~EXCLUDE_FROM_ALL''属性
}}}
*{{normal{@@color(blue):''add_executable''@@(&lt;name&gt;  IMPORTED)
*@@bgcolor(green):功能@@
**增加一个插入的可执行工程。 
}}}</pre>
</div>
<div title="add_library" creator="Samuel" modifier="Samuel" created="201211270136" modified="201211270143" changecount="9">
<pre>*{{normal{@@color(blue):''add_library''@@(&lt;name&gt; [STATIC | SHARED | MODULE] [~EXCLUDE_FROM_ALL]   source1 source2 ...)
*@@bgcolor(green):功能@@
**增加一个库。 
*@@bgcolor(green):用法@@
&gt;''STATIC''  :   静态库
&gt;''SHARED''  :  动态库
&gt;''MODULE'':   插件
}}}
*{{normal{@@color(blue):''add_library''@@(&lt;name&gt; &lt;SHARED|STATIC|MODULE|UNKNOWN&gt; IMPORTED)
*@@bgcolor(green):功能@@
**增加一个插入的库。 
}}}</pre>
</div>
<div title="allignment  C/C++" creator="samuel" modifier="samuel" created="201303280301" modified="201303280307" changecount="9">
<pre>*{{normal{数字对齐 (16)
(a+16-1)&amp;(-16) ==  (a+16-1)&amp;(~15)
}}}
*{{normal{分配的内存以16位对齐
见OpenCV中fastMalloc，内存的开始保存指向16位的地址空间
&lt;code c&gt;
void* fastMalloc( size_t size )
{
    uchar* udata = (uchar*)malloc(size + sizeof(void*) + CV_MALLOC_ALIGN);//多分配一个指针用来保存地址头用于释放
    if(!udata)
        return OutOfMemoryError(size);
    uchar** adata = alignPtr((uchar**)udata + 1, CV_MALLOC_ALIGN);
    adata[-1] = udata;
    return adata; //返回的地址指向16位对齐的地方
}

void fastFree(void* ptr)
{
    if(ptr)
    {
        uchar* udata = ((uchar**)ptr)[-1];
        CV_DbgAssert(udata &lt; (uchar*)ptr &amp;&amp;
               ((uchar*)ptr - udata) &lt;= (ptrdiff_t)(sizeof(void*)+CV_MALLOC_ALIGN));
        free(udata);
    }
}
&lt;/code&gt;
}}}</pre>
</div>
<div title="aux_source_directory" creator="samuel" modifier="samuel" created="201209190905" modified="201209190911" changecount="4">
<pre>*@@color(blue):''aux_source_directory''@@(&lt;dir&gt; &lt;variable&gt;)
:将dir目录下的所有*.c,*.cpp文件放到variable中，@@color(red):不会覆盖variable的值@@

</pre>
</div>
<div title="c++ template" creator="YourName" modifier="Samuel" created="201210250253" modified="201212260752" changecount="12">
<pre>*{{normal{@@color(blue):''用法1:规定template所支持的方法 显式实例化''@@
&lt;code c++&gt;
template&lt;typename T&gt; struct b{}
template&lt;&gt; struct b&lt;double&gt;{}
/*这样你在定义b&lt;int&gt;时，如果你使用b中的方法和变量时会显示不存在错误*/
&lt;/code&gt;
}}}
</pre>
</div>
<div title="case" creator="Samuel" modifier="Samuel" created="201206290247" modified="201207160757" tags="_SHELL_ _SHELL_CONTROL_STRUCT_" changecount="39">
<pre>*{{normal{@@bgcolor(green):用法@@
&lt;code sh&gt;
case  variable  in
    pattern [ | pattern] ...) statement;; #可以有多个pattern 用 |隔开
    pattern [ | pattern] ...) statement;; #结尾必须有两个分号
    ...   ;;
esac
&lt;/code&gt;
}}}
 </pre>
</div>
<div title="class 类型转换" creator="Samuel" modifier="samuel" created="201302250750" modified="201303280325" changecount="32">
<pre>!@@bgcolor(red):''隐式转换''@@
*{{normal{@@color(blue):''隐式类类型转换''@@
*类类型转换发生在@@color(red):拥有一个可以传一个参数的构造函数@@
*''在构造函数前面加上explict关键字，阻止类类型的转换''
&lt;code c&gt;
#include &lt;string&gt;
#include &lt;iostream&gt;
using namespace std;
class Fruit               //定义一个类，名字叫Fruit
{
 string name;     //定义一个name成员           
 string colour;   //定义一个colour成员
 
public:
 bool isSame(const Fruit &amp;otherFruit)   //期待的形参是另一个Fruit类对象，测试是否同名
 {
  return name == otherFruit.name;
 }

 Fruit(const string &amp;nst,const string &amp;cst = &quot;green&quot;):name(nst),colour(cst){}  //构造函数 
 Fruit(){}
};
int main()
{
 Fruit apple(&quot;apple&quot;);
 Fruit orange(&quot;orange&quot;);
 cout&lt;&lt;&quot;apple = orange ?: &quot;&lt;&lt;apple.isSame(orange)&lt;&lt;endl;  //没有问题，肯定不同
 cout&lt;&lt;&quot;apple = /&quot;apple/&quot; ?:&quot;&lt;&lt;apple.isSame(string(&quot;apple&quot;)); //发生隐式类类型转换
 cout&lt;&lt;&quot;apple = /&quot;apple/&quot; ?:&quot;&lt;&lt;apple.isSame(&quot;apple&quot;); //编译错误不会发生隐式类类型转换， 系统只会进行一次转换：及将字符串格式，转为string
 
    return 0;
}
&lt;/code&gt;
}}}
*{{normal{@@color(blue):''类类型转换为其他类型''（c++ primer p454）@@
&lt;code c&gt;
class foo
{
operator  int() const {return 2;}
}
&lt;/code&gt;
*形参表必须是空
*不能指定返回类型
*转换函数必须是成员函数

}}}
*{{normal{@@color(blue):''隐式类型转换在函数重载中的陷阱''@@
*@@color(red):指针是转换为bool.@@ 如:字符指针是默认转换为booll而不是string，再有string和bool的重载函数中
}}}
!@@bgcolor(yellow):''显式转换''@@
*{{normal{@@color(blue):''dynamic_cast&lt;type&gt;(var)''@@
*需要将将RTTI打开
*可以将基类转换成子类，来引用非@@color(red):''virtual''@@l函数@@color(red):(类型之间用静态转换会报错)@@
*如果转换对象不是需要转换的类型，将返回0（增加安全性）
}}}
</pre>
</div>
<div title="cmake FAQ" creator="Samuel" modifier="Samuel" created="201207130140" modified="201211270130" tags="_CMAKE_ _CMAKE_FAQ_" changecount="15">
<pre>#{{normal{''在vs中设置忽略指定库''
set(~CMAKE_EXE_LINKER_FLAGS /NODEFAULTLIB:LIBC) ;  @@color(red): only work for exe@@
set_target_properties (${target} PROPERTIES ~LINK_FLAGS &quot;/NODEFAULTLIB:LIBC&quot;)   @@color(red):can both work for dll and exe@@
}}}
#''在执行cmake的命令时，定义的变量是存放到~CMakeCache.txt中的, 且变量的值是可以传递到add_subdirectory中的’‘</pre>
</div>
<div title="cmake command" creator="Samuel" modifier="Samuel" created="201207130139" modified="201211270513" tags="_CMAKE_ _CMAKE_COMMAND_" changecount="23">
<pre>*[[add_custom_command]]
*[[add_definitions]]
*[[add_dependencies]]
*[[add_executable]]
*[[add_library]]
*[[aux_source_directory]]
*[[configure_file]]
*[[cmake_minimum_required]]
*[[execute_process]]
*[[file]]
*[[get_filename_component]]
*[[macro、function]]
*[[install]]
*[[include_directories]]
*[[if]]
*[[message]]
*[[set]]
*[[set_source_files_properties]]
*[[source_group]]
</pre>
</div>
<div title="cmake variable" creator="Samuel" modifier="samuel" created="201206270916" modified="201209190902" tags="_CMAKE_ _CMAKE_VARIABLE_" changecount="22">
<pre>**@@color(blue): ''~PROJECT_SOURCE_DIR &amp;  ~PROJECT_BINARY_DIR''@@
***~PROJECT_SOURCE_DIR'   离目前运行的~CMakeLists.txt的最近的project的那个~CMakeLists.txt所在的路径
***~PROJECT_BINARY_DIR   离目前运行的~CMakeLists.txt的最近的project进行out-of-source所建文件夹的那个路径
**@@color(blue):''~CMAKE_CURRENT_SOURCE_DIR &amp;  ~CMAKE_CURRENT_BINARY_DIR'' @@
***~CMAKE_CURRENT_SOURCE_DIR    为当前~CMakeLists.txt文件所在的路径，当文件在最顶层时相当于~CMAKE_SOURCE_DIR 
***~CMAKE_CURRENT_BINARY_DIR     为out-of-source编译时，~CMakeLists.txt在out-of-source所指定的路径里的路径
**@@color(blue):''~CMAKE_SOURCE_DIR &amp;  ~CMAKE_BINARY_DIR ''@@
***~CMAKE_SOURCE_DIR   为最顶层的~CMakeLists.txt文件所在的路径
***~CMAKE_BINARY_DIR   为最顶层的~CMakeLists.txt在进行out-of-source进行编译是所在的路径
**@@color(blue):''~EXECUTABLE_OUTPUT_PATH与 ~LIBRARY_OUTPUT_PATH''@@
***其生成的库和可执行文件的路径
**@@color(blue):''~WIN32_EXECUTABLE''@@
***设为true时，创建的项目入口函数为~WinMain()，不是console程序main()
**@@color(blue):''~CMAKE_MFC_FLAG''@@
*** 设为 1 使用MFC 静态库 ，设为 2使用MFC动态库
**@@color(blue):''~CMAKE_INSTALL_PREFIX''@@
***默认为unix : /usr/local, windows: c:/Program Files, 在使用“make install”或build INSTALL（VS）时加到安装目录的前面
**@@color(blue):''~CMAKE_BUILD_TYPE''@@
***设置build程序为Debug或Release，默认为Debug
**@@color(blue):''~CMAKE_CURRENT_LIST_FILE''@@
***当前正在处理的文件绝对路径（包含文件名）


</pre>
</div>
<div title="cmake_minimum_required" creator="YourName" modifier="Samuel" created="201207200205" modified="201207200211" changecount="5">
<pre>*@@color(blue):''cmake_minimum_required''@@(VERSION major[.minor[.patch[.tweak]]] [~FATAL_ERROR])
**@@bgcolor(green):功能@@
***cmake的版本需求
**@@bgcolor(green):说明@@
***~FATAL_ERROR: 2.6以上支持， 当指定时， 版本低的时候只是给出warning， 而不是error</pre>
</div>
<div title="coherent enhancing diffusion" creator="YourName" modifier="samuel" created="201211260137" modified="201212110342" changecount="205">
<pre>#求x,y方向的梯度grad_x  、grad_y(求梯度之前先gauss模糊一下原图)
#求grad_x^2 ;  grad_x*grad_y , grad_y^2
#对grad_x^2 ;  grad_x*grad_y , grad_y^2  数据进行一下gauss模糊
$$\large
D(S) = \left | \begin{array}{l}
d_{11}=c_1 +c_2+[(c_2-c_1)*(s_{11}-s_{22})/2a]    &amp;    d_{12}=(c_2-c_1)*s_{12}/a \\
d_{12}=(c_2-c_1)*s_{12}/a                              &amp;    d_{22}= c_1+c_2-[(c_2-c_1)*(s_{11}-s_{22})/2a]
\end{array}\right | \\
\large s_{11} = grad\_x^2 \\
\large s_{22} = grad\_y^2 \\
\large s_{12} = grad\_x*grad\_y \\
\large a = \sqrt{ (s_{11}-s_{22})^2 + 4*(s_{12})^2 } \\
\large c_1 = gamma   (gamma = 0.01) \\

\large c_2= \left \{ \begin{array}{l}
gamma+(1-gamma)*exp(-Cm/(a/lamda)^m ) &amp; , a!=0\\
gamma &amp;,a=0
\end{array}\right .\\
$$

| p(x-1,y-1) | p(x,y-1) | p(x+1,y-1) |
| p(x-1,y) | p(x,y) | p(x+1,y) |
| p(x-1,y+1) | p(x,y+1) | p(x+1,y+!) |

\(
p1 = p(x-1, y)*(d_{22}(x-1.y) + d_{22}(x,y)) + p(x+1, y)*(d_{22}(x+1.y) + d_{22}(x,y)) \\
+p(x, y-1)*(d_{11}(x,y-1) + d_{11}(x,y)) + p(x, y+1)*(d_{11}(x,y+1) + d_{11}(x,y))\\
-p(x,y)(d_{11}(x,y-1) + 2*d_{11}(x,y)+d_{11}(x,y+1)  + d_{22}(x-1.y) +2*d_{22}(x,y)+d_{22}(x+1.y))\\

p2= 0.25*( p(x-1, y-1)*((d_{12}(x-1,y)+d_{12}(x,y-1))     +p(x+1, y+1)*((d_{12}(x+1,y)+d_{12}(x,y+1)) \\
-( p(x-1, y+1)*((d_{12}(x,y+1)+d_{12}(x+1,y))  + p(x+1, y11)*((d_{12}(x,y-1)+d_{12}(x-1,y)) ) \\

p(x,y)=0.5*(p1+p2)\\

p(x,y) = p_{src}(x,y)+p(x,y)
\)


</pre>
</div>
<div title="configure_file" creator="Samuel" modifier="Samuel" created="201206270336" modified="201211270143" tags="_CMAKE_ _CMAKE_COMMAND_" changecount="41">
<pre>*@@color(blue):''configure_file''@@(&lt;input&gt; &lt;output&gt;  [COPYONLY] [~ESCAPE_QUOTES] [@ONLY])
**@@bgcolor(green):功能@@
***复制一个文件到其他地方，并改变其内容。 
**@@bgcolor(green):说明@@
***input文件中通过${val}或@val@引用的变量将被替换。如果没定义则为空.
*** #cmakedefine VAR将会被替换成#define VAR(VAR设为真) ，如果VAL没定义或设为假则为 /* #undef VAR */ 
*** #cmakedefine01 VAR将会被替换成#define VAR 1(VAR设为真) ，如果VAL没定义或设为假则为 #define VAR 0
***COPYONLY : 仅拷贝，不修改内容
***~ESCAPE_QUOTES : input文件中不是c_style的引号将被忽略。 @@color(red): 注：quote： 引号@@
***@ONLY : 只替换@val@， 不替换${val}</pre>
</div>
<div title="courting sort" creator="Samuel" modifier="Samuel" created="201212120630" modified="201212120649" changecount="6">
<pre>@@color(green):计数排序@@
*{{normal{''优点''
排序最快的算法
}}}
*{{normal{''缺点''
不适合大数据范围的排序， 需要大量的内存和时间
}}}
*{{normal{''步骤''
#获取数据范围（char [-127-128],  uchar [0-256]）
#统计直方图（对于有负数的）
#根据直方图获取每个数据的位置（相等的数据位置和出现的次序一致）
}}}</pre>
</div>
<div title="eval" creator="Samuel" modifier="Samuel" created="201206290549" modified="201207030552" tags="_SHELL_ _SHELL_COMMAND_" changecount="15">
<pre>*@@bgcolor(green):功能@@
:允许对参数进行求值
*@@bgcolor(green):用法@@
{{{
       foo=10
       x=foo
       eval y='$'${x} 
       echo ${y}  
       输出为10
}}}</pre>
</div>
<div title="execute_process" creator="YourName" modifier="samuel" created="201210120223" modified="201210120223" changecount="2">
<pre>*@@color(blue):''execute_process''@@
**@@bgcolor(green):功能@@
***执行一个或多个子进程，相当于和bash交互。 </pre>
</div>
<div title="export" creator="Samuel" modifier="Samuel" created="201207030551" modified="201210120528" tags="_SHELL_ _SHELL_COMMAND_" changecount="14">
<pre>*@@bgcolor(green):功能@@
:设置或显示环境变量； 将变量导出当前进程， 变量只属于当前的进程需要export来导出
*@@bgcolor(green):用法@@
{{noemal{
&lt;code sh&gt;
      export LANG=en_US.UTF-8
      export LANG=c
      export LANG=zh_CN.UTF-8
      export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/home/lib
      export 查看所有变量
&lt;/code&gt;
}}}</pre>
</div>
<div title="file" creator="samuel" modifier="Samuel" created="201209190914" modified="201211270144" changecount="15">
<pre>*@@bgcolor(green):功能@@
**文件操作指令 
*{{normal{@@bgcolor(green):用法@@
*@@color(blue):file@@(WRITE  filename &quot;message&quot;)
&gt;向filename中写消息，如果文件不存在则创建，如果原文件有内容则覆盖(可以指定路径： e.g.  file(WRITE  &quot;../../a.txt&quot;  &quot;ok&quot;) )
*@@color(blue):file@@(APPEND  filename  &quot;message&quot;)
&gt;将消息内容追加到文件后面
*@@color(blue):file@@(READ filename variable :A [LIMIT  numBytes : N] [OFFSET  offset: O] [HEX])
&gt;读取文件中~O-F的内容到变量A，HEX转换成16进制 (e.g.  file(READ  &quot;a.txt&quot;  valA  OFFSET 0 LIMIT 4))
*{{normal{@@color(blue):file@@(STRINGS  filename  variable : A  [~LIMIT_COUNT  num]
              [~LIMIT_INPUT  numBytes] [~LIMIT_OUTPUT numBytes]
              [~LENGTH_MINIMUM  numBytes]  [~LENGTH_MAXIMUM  numBytes] 
              [~NEWLINE_CONSUME]  [~REGEX  regex]  [~NO_HEX_CONVERSION] )
}}}
&gt;~LIMIT_COUNT : 从文件中读取的最大字符串的个数
&gt;~LIMIT_INPUT  : 从文件中读取的最大字节数    
&gt;~LIMIT_OUTPUT : 存放在变量A中的最大字节数   
&gt;~LENGTH_MINIMUM  : 设置返回字符串的最小长度
&gt;~LENGTH_MAXIMUM  : 设置返回字符串的最大长度
&gt;~NEWLINE_CONSUME : 忽略换行符，遇到换行符不在终止
&gt;~REGEX : 指定一个正则表达式， 其返回的字符串需符合正则表达式
*@@color(blue):file@@(GLOB  variable [RELATIVE  path]  [globbing expressions1 ...])
&gt;e.g.  file(GLOB   src  &quot;src/*.c&quot; &quot;src/*.cpp&quot;  &quot;f[3-5].txt&quot;)
*@@color(blue):file@@(GLOB_RECURSE variable  [RELATIVE  path]    [~FOLLOW_SYMLINKS] [globbing expressions1 ...])
&gt;与GLOB类似，但会寻找所有子目录中相匹配的
*@@color(blue):file@@(RENAME &lt;old name&gt; &lt;new name&gt;)
*@@color(blue):file@@(REMOVE  [file1 ...])
*@@color(blue):file@@(~REMOVE_RECURSE  [file1 ...])
*@@color(blue):file@@(~MAKE_DIRECTORY   [directory1  directory2 ...])
*@@color(blue):file@@(~RELATIVE_PATH variable directory file)
*@@color(blue):file@@(~TO_CMAKE_PATH path result)
*@@color(blue):file@@(~TO_NATIVE_PATH path result)
*@@color(blue):file@@(DOWNLOAD  url  file [TIMEOUT timeout] [STATUS status]  [LOG log] [~EXPECTED_MD5 sum] [~SHOW_PROGRESS])
*{{normal{@@color(blue):file@@(&lt;~COPY|INSTALL&gt; files... DESTINATION &lt;dir&gt;
                 [~FILE_PERMISSIONS permissions...]
                 [~DIRECTORY_PERMISSIONS permissions...]
                 [~NO_SOURCE_PERMISSIONS] [~USE_SOURCE_PERMISSIONS]
                 [~FILES_MATCHING]
                 [[PATTERN &lt;pattern&gt; | ~REGEX &lt;regex&gt;]
                 [EXCLUDE] [PERMISSIONS permissions...]] [...])
}}}
}}}
</pre>
</div>
<div title="find" creator="samuel" modifier="Samuel" created="201208060245" modified="201209290607" changecount="3">
<pre>*@@bgcolor(green):功能@@
:查找文件和文件夹
*{{normal{@@bgcolor(green):举例@@
#find  ./path  -name  &quot;*shen.*&quot;
# find  ./path  会列出路径下所有文件名+路径名
}}}</pre>
</div>
<div title="for" creator="Samuel" modifier="Samuel" created="201207160803" modified="201207160808" tags="_SHELL_ _SHELL_CONTROL_STRUCT_" changecount="2">
<pre>*{{normal{@@bgcolor(green):用法@@
&lt;code sh&gt;
for variable in values
do     
    statement
done
&lt;/code&gt;
}}}
</pre>
</div>
<div title="gcc&amp;g++" creator="Samuel" modifier="samuel" created="201209190133" modified="201210100727" tags="_GCC_ _G++_" changecount="52">
<pre>@@color(blue):''两编译器的区别''@@
*{{normal{@@color(blue):''误区一''@@:gcc只能编译c代码,g++只能编译c++代码
@@bgcolor(green):两者都可以，但是请注意@@
:#@@color(green):后缀为.c的，gcc把它当作是C程序，而g++当作是c++程序@@；后缀为.cpp的，两者都会认为是c++程序，注意，虽然c++是c的超集，但是两者对语法的要求是有区别的。C++的语法规则更加严谨一些。
:#.编译阶段，g++会调用gcc，对于c++代码，两者是等价的，但是因为@@color(red):gcc命令不能自动@@和C＋＋程序使用的库联接，所以通常用g++来完成链接，为了统一起见，干脆编译/链接统统用g++了，这就给人一种错觉，好像cpp程序只能用g++似的。 
}}}
*{{normal{@@color(blue):''误区二''@@:gcc不会定义{{{__}}}cplusplus宏，而g++会@@color(red):(如果是cpp的文件就会定义这个宏)@@
&gt;实际上，这个宏只是标志着编译器将会把代码按C还是C++语法来解释，如上所述，如果后缀为.c，并且采用gcc编译器，则该宏就是未定义的，否则，就是已定义。 
}}}
*{{normal{@@color(blue):''误区三''@@:编译只能用gcc，链接只能用g++
&gt;严格来说，这句话不算错误，但是它混淆了概念，应该这样说：编译可以用gcc/g++，而链接可以用g++或者gcc -lstdc++。@@color(green):因为gcc命令不能自动和C＋＋程序使用的库联接，所以通常使用g++来完成联接@@。但在编译阶段，g++会自动调用gcc，二者等价
}}}
@@color(blue):''编译选项''@@
*{{normal{@@color(blue):''基本选项''@@
&gt;''-E'' : 只进行预处理（一般进行宏的替换，以及将头文件内容拷贝到文件中）
&gt;''-S'':  只进行预处理和编译
&gt;''-c'' : 只进行预处理和编译以及汇编， 即生成.o文件@@color(red):(生成.o文件的时候一定要加上, 不用在指定-o自动输出{{{**.o}}}了)@@
&gt;''-o'' : 进行预处理和编译以及汇编和链接， 即生成可执行文件
&gt;''-g'' : 增加调试信息，调试时有用。最高可以使用''g3'' ，编译时有效.
}}}
*{{normal{@@color(blue):''链接选项''@@
&gt;''-LDIRECTORY'' : 定义连接库文件的目录 
&gt;''-l(小L)LIBRARY'' :连接时搜索指定的函数库LIBRARY
&gt;''-IDIRECTORY''  : 定义C源码的头文件的目录
&gt;''-shared'' :  生成动态连接库，@@color(red):与''-fPic''连用@@
&gt;''-fPIC'' : 生成相对地址的代码，用于最后生成动态连接库
&gt;''-static'' : 链接库时强制使用静态库@@color(red):(''可能会提示你有时候找不到so文件'')@@, @@color(red):运行时就不需要动态库了@@
&gt;''ar crv'' : 生成静态连接库, 静态链接库就是将''.o''文件打包 , @@color(red):然后在运行ranlib libfoo.a @@，并不是必须的 但对于源于Berkley Unix的系统这一步必须做
&gt;''-Wl,option'' : 传递参数到连接器， 以空格结束，以逗号隔开，如：'' -Wl,-Map,output.map''
&gt;''-Wa,option'' : 传递参数到汇编器
&gt;''-Wp,option'' : 传递参数到预处理器
}}}
*{{normal{@@color(blue):''警告选项''@@
&gt;'' -w '' :不生成任何警告信息。
&gt;''-Wall'' : 生成所有警告信息
&gt;''-Werror'' : 在发生警告时取消编译操作，即将警报看作是错误
}}}
*{{normal{@@color(blue):''优化选项''@@
&gt;''-O0'' : 不进行优化处理
&gt;''-O或-O1'' : 进行基本的优化，这些优化在大所属情况下都会使程序执行的更快
&gt;''-O2'' : 除了完成-O1级别的优化外，还需要一些其他的调整工作，如处理器指令调度等，@@color(red):是GNU发布软件的默认优化@@
&gt;''-O3'' : 除了完成-O2级别的优化外，还进行循环的展开（这往往会提高执行速度）以及其他的一些预处理器相关的优化工作。
&gt;''-Os'' : 生成最小的可执行文件，主要用在嵌入式领域。
}}}</pre>
</div>
<div title="get_filename_component" creator="Samuel" modifier="Samuel" created="201206270956" modified="201209180628" tags="_CMAKE_ _CMAKE_COMMAND_" changecount="27">
<pre>*@@color(blue):''get_filename_component''@@(&lt;VAR&gt; ~FileName  PATH|ABSOLUTE|NAME|EXT|~NAME_WE|REALPATH  [CACHE])
**@@bgcolor(green):功能@@
***从一个全路径的文件名中提取子部分， VAR为返回值
**@@bgcolor(green):说明@@
***PATH : 得到路径名
***ABSOLUTE : 获取绝对路径
***NAME : 获取文件名
***EXT : 获取文件扩展名
***~NAME_WE : 获取没有扩展名的文件名
***REALPATH : ~FileName中的文件路径会展开。 如：../ , ./
***CACHE : 将变量值写入cache
*@@color(blue):''get_filename_component''@@(&lt;VAR&gt; ~FileName  PROGRAM [~PROGRAM_ARGS &lt;~ARG_VAL&gt; [CACHE])
**@@bgcolor(green):功能@@
***在系统路径或全路径名的~FileName中寻找程序， VAR为返回值
**@@bgcolor(green):说明@@
*** 当~FileName为文件名时,从系统查找路径中寻找程序。找到将全路径名赋给VAL
*** 当~FileName为全路径的文件名时, 在这个全路径中查找。找到将全路径名赋给VAL
***~FileName不能为纯路径。
***~PROGRAM_ARGS : 将文件明后面的参数传给~ARG_VAL
</pre>
</div>
<div title="if" creator="Samuel" modifier="Samuel" created="201211270147" modified="201211270149" changecount="11">
<pre>*@@color(blue): ''if endif''@@:
**@@bgcolor(green):功能@@
***条件控制语句
**@@bgcolor(green):说明@@
***0,OFF,FALSE,N,IGNORE, &quot;&quot;, 以-NOTFOUND结尾为假；1,ON,YES,TRUE,Y,非0值为真
**{{normal{@@bgcolor(green):用法@@
&lt;code cmake&gt;
if(expression)
   command...
elseif(expression2)
   command...
else(expression)
   command...
endif(expression)
&lt;/code&gt;
}}}

</pre>
</div>
<div title="if,else" creator="Samuel" modifier="Samuel" created="201207160754" modified="201207160804" tags="_SHELL_ _SHELL_CONTROL_STRUCT_" changecount="10">
<pre>*{{normal{@@bgcolor(green):用法@@
&lt;code sh&gt;
if condition 
then
    statement
elif condition ;then #注意此处的冒号是隔开两个命令
    statement
else
    statement
fi
&lt;/code&gt;
}}}
</pre>
</div>
<div title="include_directories" creator="Samuel" modifier="Samuel" created="201211270156" modified="201211270513" changecount="3">
<pre>*@@color(blue):''include_directories ''@@ ([AFTER|BEFORE]  [SYSTEM]  dir1 dir2 dir3...) 
**@@bgcolor(green):功能@@
***添加头文件搜索路径
**{{normal{@@bgcolor(green):说明@@
&gt;AFTER: 其包含顺序为dir1 dir2 dir3... 默认为AFTER
&gt;BEFORE : 其包含顺序为... dir3 dir2 dir1
&gt;SYSTEM： 在某些平台上会被加到系统路径里
}}}
</pre>
</div>
<div title="install" creator="Samuel" modifier="Samuel" created="201206280328" modified="201206280838" changecount="98">
<pre>**@@bgcolor(green):功能@@
***安装时的安装规则
**@@bgcolor(green):说明@@
***DESTINATION  : 安装路径，如果指定的是相对路径，则其会在前面加上~CMAKE_INSTALL_PREFIX
***RENAME : 改变被安装的文件名，只有在仅安装一个文件时才可以使用
***OPTIONAL : 被指定以后，安装文件不存在时不发送错误
***PERMISSIONS : 安装文件的访问权限
***@@bgcolor(red):COMPONENT @@: 当你在make install 增加 -D COMPONENT=A时 那么只有COMPONENT是A的才会安装。 必须是运行cmake_install.cmake.如cmake -D COMPONENT=A  -P  {build_path}/cmake_install.cmake 注：运行make install 所有都安装. http://stackoverflow.com/questions/9190098/for-the-cmake-install-what-can-the-component-argument-do
***CONFIGURATIONS : 指定安装的配置，如：Release、Debug...
**@@bgcolor(green):用法1:安装文件@@ 
{{{
 install(FILES files... DESTINATION &lt;dir&gt;
          [PERMISSIONS permissions...]
          [CONFIGURATIONS [Debug|Release|...]]
          [COMPONENT &lt;component&gt;]
          [RENAME &lt;name&gt;] [OPTIONAL])
}}}
**@@bgcolor(green):用法2:安装非目标文件的可执行程序(脚本之类的), 同file只是默认的PERMISSIONS不同@@&amp;nbsp;
{{{
install(PROGRAMS files... DESTINATION &lt;dir&gt;
          [PERMISSIONS permissions...]
          [CONFIGURATIONS [Debug|Release|...]]
          [COMPONENT &lt;component&gt;]
          [RENAME &lt;name&gt;] [OPTIONAL])
}}}
**@@bgcolor(green):用法3:安装目标文件（exe,lib,dll等@@&amp;nbsp;
{{{
 install(TARGETS targets... [EXPORT &lt;export-name&gt;]
          [[ARCHIVE|LIBRARY|RUNTIME|FRAMEWORK|BUNDLE| PRIVATE_HEADER|PUBLIC_HEADER|RESOURCE]
           [DESTINATION &lt;dir&gt;]
           [PERMISSIONS permissions...]
           [CONFIGURATIONS [Debug|Release|...]]
           [COMPONENT &lt;component&gt;]
           [OPTIONAL] [NAMELINK_ONLY|NAMELINK_SKIP]
          ] [...])

•   RUNTIME  :  可执行文件目标，dll平台上的dll文件
•   BUNDLE  :  在OS X系统上带有MACOSX_BUNDLE属性的目标
•   ARCHIVE  : 静态库， dll平台上的导入库(即dll的导入.lib文件)
•   LIBRARY  : module libraries(.cmake 结尾的文件) ，非dll平台上的共享库
•   FRAMEWORK  :  在OS X系统上带有FRAMEWORK属性的目标
•   PRIVATE_HEADER|PUBLIC_HEADER|RESOURCE  :  在non-apple平台上编译共享库需注意 
•   NAMELINK_ONLY|NAMELINK_SKIP : 忽略则两个属性都有
•   只需指定target的名字不用指定路径
}}}
</pre>
</div>
<div title="java Miscellaneous" creator="Samuel" modifier="Samuel" created="201302040338" modified="201302040427" changecount="8">
<pre>*{{normal{@@color(blue):''java中main函数的输入参数''@@:
*main中String[] args: 可以使用args.length判断长度来控制命令
*{{normal{java程序重定向 ''&gt;,&lt;''
使用system.in/out控制。运行命令如：java  classname  &lt; input.txt  &gt;output.txt
}}}
}}}</pre>
</div>
<div title="ln" creator="YourName" modifier="Samuel" created="201207160153" modified="201207160746" tags="_SHELL_ _SHELL_COMMAND_" changecount="4">
<pre>*@@bgcolor(green):功能@@
:建立连接
*@@bgcolor(green):参数@@
: 默认为硬链接，只能是文件， 相当于文件copy
:''-s'' : 软链接，可以使目录和文件。相当于windows下快捷名
</pre>
</div>
<div title="macro、function" creator="Samuel" modifier="Samuel" created="201206270720" modified="201211270151" tags="_CMAKE_ _CMAKE_COMMAND_" changecount="42">
<pre>*@@color(blue):''macro''@@(&lt;name&gt; [arg1 [arg2...]])  @@color(blue):''endmacro''@@(&lt;name&gt;)
*@@color(blue):''function''@@(&lt;name&gt; [arg1 [arg2...]])  @@color(blue):''function''@@(&lt;name&gt;)
**@@bgcolor(green):功能@@
***定义一个宏或函数，为后面所使用的命令
**@@bgcolor(green):说明@@
***${ARGN}:保存宏参数的list变量.@@color(red):当你在定义macro（function中不知如何）显式指定一个参数后，ARGN中将会将这个参数排除@@
***${ARGC}:宏调用传入参数的个数
***${~ARGV0}, ${~ARGV1}...： 第1个参数， 第2个参数...
***如果传入的是list变量，macro只取第一个值，function可以取所有值
***@@bgcolor(red):macro和function的区别：@@
:::#function传入的是变量，而macro只是字符替换@@color(red):(需验证)@@
:::#function中定义的是局部变量，而macro定义的是全局变量
:::#function在version 2.6以上支持
</pre>
</div>
<div title="make command option" creator="samuel" modifier="Samuel" created="201209190630" modified="201210240329" tags="_MAKE_COMMAND_OPTION_" changecount="8">
<pre>*{{normal{@@color(blue):''命令参数''@@
*''{{{--}}}just-print'' 或 ''-n'' : 只打印过程不执行
*可以再命令行中改变所有makefile中变量的值
*''-f'' : 指定makefile文件
*''-C'' :执行子目录 ： make -C path target
}}}</pre>
</div>
<div title="make learning" creator="Samuel" modifier="samuel" created="201209190320" modified="201209190805" tags="_MAKE_LEARNING_" changecount="53">
<pre>[[make command option]]
[[make rule]]
[[make variable and function]]</pre>
</div>
<div title="make rule" creator="samuel" modifier="Samuel" created="201209190630" modified="201212270806" tags="_MAKE_RULE_" changecount="49">
<pre>*{{normal{@@color(blue):''具体规则''@@
#在make命令行中没有指定目标的话，会将第一个目标指定为默认的目标@@color(green):(一般都在前面制定一个假想的all目标)@@
#{{normal{make中检查更新
#每个文件或中间生成的文件都有一个时间戳。当文件有更新时，时间戳就会更新，@@color(red):这样就可以根据一些中间文件的时间戳是否在园文件之前来判断是否要更新@@
#先检查必要条件的更新， 后检查目标文件的更新， 如果目标没有生成目标文件视为没有更新@@color(red):(这也是clean等目标永远被执行的原因)@@
#如果没有必要条件，将会检查target文件是否有更新(@@color(red):所以文件目标生成的文件必须和target同名， 否则将永远没有更新这也是将clean加入PHONY的原因@@)
}}}
#{{normal{@@color(blue):make的一项规则分为3个部分@@
#@@color(green): 命令前面加@可以阻止make打印命令@@
#@@color(green): 命令前面必须以TAB开始@@
&lt;code  make&gt;
target (工作目标): prereq1 prereq2(必要条件)              hello : hello.c
     commands (命令)                                             gcc  hello.c -o hello  
     #当没有prereq1，只有当target不存在时才会执行命令
&lt;/code&gt;
}}}
#可以有多个目标。 如:tar1 tar2 : a.c b.c &lt;==&gt;两条命令tar1 : a.c b.c  tar2 : a.c b.c
#一个 规则也可以拆开。 如tar : a.c b.c &lt;==&gt;两条命令tar : a.c  tar:b.c @@color(green):(增加可读性当有太多的必要条件时)@@
#通配符(*等，类似于表达式)在@@color(red):目标和条件中是由make进行扩展。 在命令中是由shell进行扩展@@， 最好只用在源文件上
#{{normal{@@color(red):''假想目标''@@可以作为其他假想目标的必要条件（假想目标总是没有更新的）。
#{{normal{如:make clean实现如下
&lt;code  make&gt;
.PHONY : clean
clean:
    rm -rf *
&lt;/code&gt;
这样做的好处是， 如果文件夹中有clean这个文件的时候@@color(red):(不是文件目标)@@，将会出现''make: `facedetect.cpp' is up to date''
}}}
#{{normal{@@color(red):定义shell函数@@
&lt;code  make&gt;
.PHONY : print
print:
   @echo $(log)

build: print
...
&lt;/code&gt;
#定义一个print函数， 任何一个target将其作为必要条件，都可以调用这个函数， 
#phony目标永远都是未更新的，@@color(red):所有将phony目标作为表要条件的target 永远都会被执行@@，所以有时不能将其放在第一个条件而是放在最后
}}}

}}}
#{{normal{@@color(red):工作目标和模式的专有属性@@
&lt;code make&gt;
gui.o : CPPFLAGS += -DVAL=1 #执行完gui.o以后，CPPFLAGS的值就会恢复
gui.o: gui.h
&lt;/code&gt;
}}}
}}}

*{{normal{@@color(blue):''隐藏规则''@@
# {{normal{''.c''-&gt;可执行程序  ''.c''-&gt;''.o''  ''.o''-&gt;可执行程序
}}}
}}}
*{{normal{@@color(blue):''自定义规则''@@
#{{normal{如自定义 ''.c''-&gt; ''.o''
&lt;code make&gt;
%.o :  %.c
$(COMPILE.c) $(OUTPUT_OPTION)  $&lt;   
OUTPUT_OPTION = -o $@
&lt;/code&gt;
}}}
#删除内置的规则，如:  ''%.c''-&gt; ''%.o'' 不加脚本命令就可以了@@color(green):(%相当于*)@@
}}}
*{{normal{@@color(blue):''特殊工作目标''@@
@@color(red):''Todo''@@
}}}</pre>
</div>
<div title="make variable and function" creator="samuel" modifier="Samuel" created="201209190631" modified="201212290714" tags="_MAKE_ _VARIABLE_" changecount="19">
<pre>@@color(green):''变量''@@
*{{normal{@@color(blue):''自动变量''@@
&gt;''$@'' : 工作目标的文件名
&gt;''$*'' :工作目标的文件名， 不包含扩展名
&gt;''$^'' 所有必要条件中文件名， 不包含重复的
&gt;''$+'' 所有必要条件中文件名， 包含重复的
&gt;''$&lt;'' 第一个必要条件中文件名
&gt;''$？'' 时间戳在工作目标之后的所有必要条件
}}}
*{{normal{@@color(blue):''变量设置''@@
*''CPPFLAGS = -I include'' : 设置头文件路径，为gcc设置
*''VPATH = src inc''  : 设置必要条件的搜索路径， ''缺点''@@color(green):(当不同目录有相同文件时，使用第一个找到的)@@
*''vpath  %.cpp %.c src ; vpath  %.h %.hpp inc'' :为特定后缀名的文件指定搜索路径
}}}
*{{normal{@@color(blue):''自定义变量''@@
&gt;''='' : 右边有引用变量的话不会立即扩展
&gt;'':='' : 右边有引用变量的话会立即扩展
&gt;''?='' : 只会在左边变量没有被赋值的情况下使用
&gt;''+='' : 附加操作，将未扩展的值附加到变量中@@color(green):(在使用‘=’时需注意)@@
}}}
@@color(green):''宏''@@
*{{normal{@@color(blue):''自定义宏''@@ : 宏引用是也需要''$()''
&lt;code make&gt;
define  macro
    @command1   #在命令前面加@以后， make就不会再打印这个命令了
    command2
endif 
&lt;/code&gt;
}}}
@@color(green):''函数''@@
*{{normal{@@color(blue):''自定义函数''@@ : 宏引用是也需要''$()''
&lt;code make&gt;
define  function
    command1   $1 $2(表示函数的第一个和第二个参数)
    command2
endif 
$(call function, para1, para2)
&lt;/code&gt;
}}}
*@@color(blue):''内置函数''@@ </pre>
</div>
<div title="message" creator="Samuel" modifier="Samuel" created="201211270515" modified="201211270527" changecount="6">
<pre>*@@color(blue):''message''@@ ([STATUS|WARNING|~AUTHOR_WARNING|~FATAL_ERROR|~SEND_ERROR]      &quot;message to display&quot; ...)
**@@bgcolor(green):功能@@
***打印消息
**{{normal{@@bgcolor(green):说明@@
&gt;''STATUS''                         = 附带信息(在消息前面见两个横线)
&gt;''WARNING''                    = 警告，继续执行
&gt;''~AUTHOR_WARNING'' = 警告(dev)，继续执行
&gt;''~SEND_ERROR''              = 错误，继续执行，但跳过建立项目
&gt;''~FATAL_ERROR ''            = 错误，直接退出执行
}}}</pre>
</div>
<div title="models_python" creator="samuel" modifier="samuel" created="201211050057" changecount="1">
<pre>&gt;[[sys]]
&gt;[[types]]
&gt;[[os]]
&gt;[[subprocess]]
&gt;[[ConfigParser]] : 导入配置文件的内容
&gt;[[Random]] : 随机模块
&gt;[[shelve]] : 模块永久性存储; 将文件当成字典来做
&gt;[[re]] : 正则表达式
&gt;[[thread]]: 多线程
&gt;[[Python Debug]] : 调试模块</pre>
</div>
<div title="os" creator="Samuel" modifier="Samuel" created="201207030108" modified="201210220639" tags="_PYTHON_ _PYTHON_MODULE_ _OS_" changecount="32">
<pre>*{{normal{@@color(blue):''os.system &amp; os.popen''@@
@@bgcolor(green):''执行外部命令''@@}}}
:{{normal{
*''os.system''(command)  返回命令的执行状态。 0表示成功
*''os.popen''(command [, mode [,buffersize]]])    返回个文件句柄。可以读取命令执行的类容mode默认为‘r’.@@color(green):''建议使用subprogress的call和Popen函数''@@
: ''e.g.'' f = ''os.popen''(command)  ; ''print''(f.''read()'')
}}}
*@@color(blue):''os.sep''@@
: 系统路径分隔符
*@@color(blue):''os.chdir(‘path’)''@@
:改变路径
*@@color(blue):''os.getcwd()''@@
:获取当前路径
*@@color(blue):''os.listdir('path')''@@
:列出当前路径下的所有文件
*@@color(blue):'' os.path.isdir/isfile('file')''@@
:判断文件是路径还是文件
*@@color(blue):'' os.path.exists('file')''@@
:判断路径是否存在
</pre>
</div>
<div title="python todo" creator="samuel" modifier="samuel" created="201211050632" changecount="1">
<pre>&gt;513 python核心编程</pre>
</div>
<div title="python 数字类型" creator="samuel" modifier="samuel" created="201210100744" modified="201210100802" changecount="8">
<pre>@@bgcolor(green):五种数字类型：int , long ,  bool , float , complex@@
*{{normal{@@color(blue):''complex''@@
*@@bgcolor(green):表示方法@@
&gt;a = 1+2j 或者 a=complex（1,2）
&gt;*.real: 实部
&gt;*.imag :  虚部
&gt;*.conjugate() : 共轭复数
}}}</pre>
</div>
<div title="re" creator="YourName" modifier="Samuel" created="201209110151" modified="201212240330" tags="_PYTHON_ _PYTHON_MODULE_ _RE_" changecount="51">
<pre>@@bgcolor(green):常用正则表达式符号@@
&gt;''re1 | re2 '' : 匹配正则表达式re1或re2  ''e.g''. foo | bar
&gt;''.'' : 匹配任何字符（换行符除外(可以设置python的编译标示[S or DOTALL]取消这一限制)）   ''e.g''. b.b
&gt;''^'' : 匹配字符串的开始     ''e.g''.^dear @@color(red):(从最开始就必须匹配上)@@
&gt;''$'' : 匹配字符串的结尾    ''e.g''.dear$ @@color(red):(从最后，不包含换行符就必须匹配上)@@
&gt;''*'' : 匹配前面出现的正则表达式0次或多次    ''e.g''.[~A-Z]*
&gt;''+'' : 匹配前面出现的正则表达式1次或多次    ''e.g''.[~A-Z]+
&gt;''?'' : 匹配前面出现的正则表达式0次或1次@@color(red):(第二个含义：紧跟在重复字符后面，表示字符串越短越好. ''非贪婪模式'') @@    ''e.g''.[~A-Z]?
&gt;''{N}'' : 匹配前面出现的正则表达式N次     ''e.g''.[~A-Z]{3}
&gt;''{M,N}'' : 匹配重复出现M次到N次的正则表达式     ''e.g''.[~A-Z]{2， 3}
&gt;''[.....]'' : 匹配字符组里面出现的任意@@color(red):''单个''@@字符  ''e.g''.[aeiou]
&gt;''[^.....]'': 不匹配字符组里面出现的任意@@color(red):''单个''@@字符， 包含某一范围内的字符 ''e.g'' . [^0-9A-Za-z]
&gt;''[..x-y...]'' : 匹配字x到y的任意一个字符  ''e.g''.[0-9], [~A-Za-z]
&gt;''(* | + | ? | {} )?'' : 重复匹配字符集次数符号，@@color(red): 而不是一个字符@@
&gt;@@color(red):''(....)'' @@: 匹配封闭括号中正则表达式，并保存为子组.@@color(red):如果''()''前后有其他字符。则将这整个字符串当成一个patern， 但是把''()''中的匹配的当成子组@@
&gt;@@color(red):''(?&lt;=...)'' @@:  前向界定-表示要匹配字符串的前面应该出现的字符串
&gt;@@color(red):''(?=...)'' @@   : 后向界定-表示要匹配字符串的后面应该出现的字符串@@color(red):(可以使用$这样就可以重字符串末尾开始匹配)@@
@@bgcolor(green):特殊字符@@
&gt;''\'' : 转义符号
&gt;''\d'' : 匹配任何数字， 与[0-9]一样(''/D'':''\d''的反义,任何非数字符)
&gt;''\w'' : 匹配任何数字字符字符， 与[~A-Za-z0-9]一样(''/W'': ''/w''的反义)
&gt;''\s'' : 匹配任何空白字符， 与[\n\t\r\v\f]一样(''/S'': ''/s''的反义) ''e.g'' : of\sThe
&gt;''\b'' : 匹配单词边界(''/B''': ''/b''的反义) ''e.g'' : \bthe\b
&gt;''\nn'' : 匹配以保存的子组，（refer to ''(....)''） ''eg''.price:\18
&gt;''\c'' : 逐一匹配特殊字符（即取消它的特殊含义， 按字面匹配）
&gt;''\A(\Z)'' : 匹配字符串的起始(结束)， 和''^/$''一样: @@color(green):(AZ区别只匹配单行)@@。
@@bgcolor(green):函数方法@@
*{{normal{''compile''(pattern,flags=0)
匹配之前需要先编译}}}
*{{normal{''match'':
匹配字符串，@@color(red):从字符串的开头开始对模式进行匹配@@
}}}
*{{normal{''search'':
查找字符串，@@color(red):从字符串任意位置的地方与给定正则表达式模式进行匹配，和match的区别@@
}}}
*{{normal{''group(num=0) / groups'':
使用group/groups来访问返回的匹配的字符串@@color(red):（也可以使用findall,finditer）@@, group(1)表示子组1. group(0).表示匹配的整个字符 @@color(red):(见‘'()'’)@@
}}}
*{{normal{''sub/ subn(pattern, repl, string, max=0)'':
进行字符串的替换，@@color(red):（subn会返回替换的次数）@@
}}}
*{{normal{''split()'':
进行字符串的分割，@@color(red):（subn会返回替换的次数）@@
}}}
@@color(red):''Attention'':@@''在python中使用原始字符创与ASSIC中的特殊字符区别开''</pre>
</div>
<div title="rm" creator="Samuel" modifier="Samuel" created="201207110210" modified="201207160244" tags="_SHELL_ _SHELL_COMMAND_" changecount="3">
<pre>*@@bgcolor(green):功能@@
:删除文件
*@@bgcolor(green):参数@@
:''-d'' : 删除可能仍有数据的目录 (只限超级用户)
:''-f''  : 略过不存在的文件，不显示任何信息
:''-i''  : 进行任何删除操作前必须先确认
:''-r/R'' : 同时删除该目录下的所有目录层
:''-v'' : 详细显示进行的步骤
</pre>
</div>
<div title="round函数" creator="YourName" modifier="Samuel" created="201304150335" modified="201304150415" changecount="4">
<pre>*{{normal{@@color(blue):''double floor(double x)''@@
返回不大于指定表达式的最大整数
}}}
*{{normal{@@color(blue):''double ceil(double x)''@@
返回不小于指定表达式的最小整数
}}}</pre>
</div>
<div title="set" creator="YourName" modifier="Samuel" created="201206270330" modified="201207200211" tags="_CMAKE_ _CMAKE_COMMAND_" changecount="68">
<pre>*@@color(blue):''set''@@(&lt;variable&gt; &lt;value&gt; [ [CACHE  &lt;type&gt; &lt;docstring&gt; [FORCE] | ~PARENT_SCOPE ])
**@@bgcolor(green):功能@@
***设置变量值
**@@bgcolor(green):说明@@
***CACHE : 值是写入~CMakeCache.txt的，如果没加FORCE选项，值改变是没有效果的(INTERNAL类型除外) 
***@@bgcolor(red):~PARENT_SCOPE?@@
</pre>
</div>
<div title="set_source_files_properties" creator="Samuel" modifier="Samuel" created="201209180625" modified="201211260907" changecount="17">
<pre>*@@color(blue):''set_source_files_properties''@@([file1 [file2 [...]]]   PROPERTIES prop1 value1  [prop2 value2 [...]])
**@@bgcolor(green):功能@@
***设置文件编译的属性
**@@bgcolor(green):说明@@
*** 可以设置多个属性， 使用''键/值对''@@color(red):(详细见property on files)@@</pre>
</div>
<div title="shift" creator="Samuel" modifier="Samuel" created="201206290317" modified="201206290549" tags="_SHELL_ SHELL_COMMAND" changecount="17">
<pre>*@@color(blue):''shift''@@ [Num] ,
**不提供Num时， 默认为1
**将shell脚本的参数个数减去Num， 并将参数前移，及$1变成了后面的第Num个参数的值
</pre>
</div>
<div title="sort" creator="Samuel" modifier="Samuel" created="201212120630" changecount="1">
<pre>[[courting sort]]</pre>
</div>
<div title="source_group" creator="Samuel" modifier="Samuel" created="201211260906" modified="201211270117" changecount="6">
<pre>*@@color(blue):''source_group''@@(name [~REGULAR_EXPRESSION regex] [FILES src1 src2 ...])
**@@bgcolor(green):功能@@
***相当于在Visual Studio项目中创建src、inc这样的文件滤波器，正则表达式可以省略。
**@@bgcolor(green):说明@@
***@@color(red):一定要将头文件加到工程中（通过add_library或add_executable）@@，否则不会创建滤波器
</pre>
</div>
<div title="subprocess" creator="Samuel" modifier="samuel" created="201207030110" modified="201209110542" tags="_PYTHON_ _PYTHON_MODULE_ _SUBPROCESS_" changecount="31">
<pre>*{{normal{@@color(blue):''subprocess.call &amp; subprocess.Popen''@@
@@bgcolor(green):''执行外部命令''@@}}}
:{{normal{
*''subprocess.Popen''(args, bufsize=0, executable=None, stdin=None, stdout=None, stderr=None, preexec_fn=None, close_fds=False, shell=False, cwd=None, env=None, universal_newlines=False, startupinfo=None, creationflags=0)
:''shell'':相当于执行的args,是可以用shell执行的，如ls等shell命令，exe文件不用
:''stdin '': 指定为subprocess.PIPE以后，可以通过subprocess.stdin''文件对象''来向args中的exe传值，如你在exe中调用cin等函数
:''stdout , stderr'' : 指定为subprocess.PIPE以后, 可以用subprocess.stdout , subprocess.stderr''文件对象''来查看；@@color(green): 或者使用Popen.stdout(), 来返回文件句柄@@
:''executable'' : 
*''subprocess.call(*popenargs, **kwargs)''
:@@color(green):不可以和外部交流, 多用Popen@@
:''popenargs'':相当于执行的外部命令和参数。格式''[&quot;ls&quot;, &quot;-l&quot;, &quot;-r&quot;]''
:''kwargs'': 相当于Popen的args后面的参数设置
:''e.g.'' subprocess.call(['ls', '-l'], shell=True)
*''subprocess.check_call(*popenargs, **kwargs) ''
:与subprocess.call(*popenargs, **kwargs)功能一样，只是如果子进程返回的returncode不为0的话，将触发~CalledProcessError异常。在异常对象中，包括进程的returncode信息。
}}}</pre>
</div>
<div title="sys" creator="Samuel" modifier="samuel" created="201206290837" modified="201210150142" tags="_PYTHON_ _PYTHON_MODULE_ _SYS_" changecount="16">
<pre>@@bgcolor(green):包含一些与Python解释器紧密相连的变量和函数@@
*@@color(blue):argv@@
:命令行参数， 包含脚本名称
*@@color(blue):platform@@
:当前的平台名称：“win32” ，“cygwin” ，“darwin” ，“linux2” ...
*@@color(blue):stdout,  stdin, stderror变量@@
:是文件句柄 
</pre>
</div>
<div title="system" creator="Samuel" modifier="Samuel" created="201207160828" changecount="1">
<pre>[[unix]]
[[windows]]</pre>
</div>
<div title="tar" creator="Samuel" modifier="Samuel" created="201207110132" modified="201207110333" tags="_SHELL_ SHELL_COMMAND_" changecount="29">
<pre>*@@bgcolor(green):功能@@
:解压或压缩文件
*@@bgcolor(green):参数@@
:''-c'' : 建立一个压缩文件的参数指令(create 的意思) 
:''-x'' : 解开一个压缩文件的参数指令 
:''-t'' :  查看 tarfile 里面的文件
:@@color(red): c/x/t 仅能存在一个！不可同时存在! 因为不可能同时压缩与解压缩@@ 
:''-z'' : 是否同时具有 gzip 的属性？亦即是否需要用 gzip 压缩？ 
:''-j'' :  是否同时具有 bzip2 的属性？亦即是否需要用 bzip2 压缩？ 
:''-v'' :  压缩的过程中显示文件！这个常用，但不建议用在背景执行过程！ 
:{{normal{''-f'' :  使用档名，注意，在 f 之后要立即接档名喔！不要再加参数！ 
&lt;code sh&gt;
tar -zcvfP tfile sfile  错误 
tar -zcvPf tfile sfile  正确
&lt;/code&gt;
}}}
:''-p'' : 使用原文件的原来属性（属性不会依据使用者而变） 
:''-P'' : 可以使用绝对路径来压缩！ 
:''-N''  : 比后面接的日期(yyyy/mm/dd)还要新的才会被打包进新建的文件中！ 
*{{normal{@@bgcolor(green):用法@@
&lt;code sh&gt;
#压缩
tar -zcvf   dstFile  srcFile
tar -jcvf    dstFile  srcFile
#解压
tar -zxvf   file 
tar -jxvf    file
&lt;/code&gt;
}}}</pre>
</div>
<div title="terminology-术语" creator="Samuel" modifier="Samuel" created="201303010605" modified="201303010606" changecount="6">
<pre>@@bgcolor(green): ''terminology [ˌtɜ:məˈnɔlədʒi:]术语''@@
squared error - 方差 : 与平均值的差的平方的平均值
RMS - 标准差 :  方差的平方根 </pre>
</div>
<div title="thread" creator="samuel" modifier="samuel" created="201209130713" tags="_PYTHON_ _PYTHON_MODULE_ _THREAD_" changecount="1">
<pre>*@@color(blue):''守护线程''@@
&gt;在调用threading.thread.start()之前设置threading.thread.setDaemon(True)默认为False</pre>
</div>
<div title="tr" creator="YourName" modifier="Samuel" created="201207020157" modified="201207030551" tags="_SHELL_ _SHELL_COMMAND_" changecount="14">
<pre>@@bgcolor(green):''不接受指定的文件参数，而只是对标准输入进行翻译''@@
:即只能 echo “string” | tr 或 tr &lt; filename
*@@color(blue):''大小写转换''@@
: tr   [:upper:] [:lower:]  &lt; file.txt 大写到小写
*@@color(blue):''字符转换转换''@@
: tr   srcChar dstChar  &lt; file.txt   将srcChar 装换为dstChar
*@@color(blue):''删除字符''@@
: tr  -d  &quot;sting&quot; &lt; file.txt   删除字符串string中的所有出现的字符
: tr  -s  &quot;sting&quot; &lt; file.txt   删除字符串string中的重复出现的字符
: tr  -s   [a-z] &lt; file.txt </pre>
</div>
<div title="types" creator="Samuel" modifier="samuel" created="201206290932" modified="201209110542" tags="_PYTHON_ _PYTHON_MODULE_ _TYPRS_" changecount="10">
<pre>@@bgcolor(green):元素类型的一些操作@@
*判断类型：type(x) is types.~IntType # 判断是否int 类型</pre>
</div>
<div title="watershed" creator="Samuel" modifier="Samuel" created="201212120700" modified="201212120730" changecount="6">
<pre>*计算梯度大小(sobel, roberts, mutil-scale...)
*梯度后处理(~ClosingByReconstruction 对结果影响很大)
*将梯度四周设上哨兵(如-1等)
*将梯度进行排序()
* 从梯度最低点开始遍历
**寻找其领域内最小的梯度值，设置其label与最小梯度相同的label，没有则跳过
** 遍历被设置label的梯度点，寻找其领域是否有同一梯度点，有则设置其label值
** 遍历这一梯度范围内的点，将没有设置的label的点进行设置，并寻找其领域内的点，将同一个level梯度的点设置同样的label
* 遍历下一个梯度值范围

</pre>
</div>
<div title="while" creator="Samuel" modifier="Samuel" created="201207160807" modified="201207160808" tags="_SHELL_ _SHELL_CONTROL_STRUCT_" changecount="5">
<pre>*{{normal{@@bgcolor(green):用法@@
&lt;code sh&gt;
while condition 
do                     #do可以接在condition后面，但是需要使用冒号隔开
    statement
done
&lt;/code&gt;
}}}
</pre>
</div>
<div title="xargs" creator="Samuel" modifier="samuel" created="201207160746" modified="201208060244" tags="_SHELL_ _SHELL_COMMAND_" changecount="8">
<pre>*@@bgcolor(green):功能@@
:将前一输入转换为后面命令的输入参数。多用于管道
*@@bgcolor(green):举例@@
:ls | xargs unix2dos   @@color(red):如果不加xargs则是将ls打印的类容进行转换@@
</pre>
</div>
<div title="’ ‘与“ ”" creator="Samuel" modifier="Samuel" created="201206290601" modified="201206290603" tags="_SHELL_ _SHELL_COMMAND_" changecount="6">
<pre>*@@color(green):'string'@@ 被单引号用括住的内容，将被视为单一字串。在引号内的代表变数的$符号，没有作用，也就是说，他被视为一般符号处理，防止任何变量替换。
*@@color(green):&quot;string&quot;@@ 被双引号用括住的内容，将被视为单一字串。它防止通配符扩展，但允许变量扩展。这点与单引数的处理方式不同。</pre>
</div>
<div title="函数指针" creator="Samuel" modifier="samuel" created="201212260748" modified="201303280240" changecount="19">
<pre>&lt;code c++&gt;
int  (*f) (int a)   /* 声明一个函数指正变量 f */
typedef  int  (*f) (int a)   /* 声明一个函数指正类型*/
&lt;/code&gt;</pre>
</div>
<div title="列表与元组" creator="Samuel" modifier="Samuel" created="201206290913" modified="201212240303" tags="_PYTHON_ _PYTHON_DATASTRUCTURE_" changecount="62">
<pre>*@@bgcolor(green):说明@@
**列表与元组(list, tuple)的主要@@color(red):区别：@@列表可以修改，元组则不能。 一般情况下元组可以用列表替换，@@color(red): 例外：@@元组作为字典的键（不允许修改）
**列表用''[ ]'', 元组用''( )''
*@@bgcolor(green):操作@@
**@@color(blue):''python中数组下标从负数开始表示反向''@@,  如：a=[1,2,3,4] . a[-1]=4
**@@color(blue):''len, max, min''@@
::求序列的长度、最大值、最小值
**@@color(blue):''in''@@
::判断成员资格，返回true or false
**@@color(blue):''分片  &amp;  分片赋值''@@
:@@bgcolor(green):''分片赋值与分片类似''@@
:{{normal{
访问序列中部分元素。如:
&lt;code python&gt;
tag=[1,2,3,4,5,6,7,8,9]
tag[0:3] 为1 2 3，最后索引为包含最后元素的下一个元素
tag[-3:] 7 8 9, tag[-3: -1] 7 8 后一个索引必须必前一个后出现 
tag[:] 1 2 3 4 5 6 7 8 9
tag[1:4:2] 为2  4。@@color(green):''2为步长， 上面的默认步长为1''@@
&lt;/code&gt;
}}}
*@@color(blue):''控制结构可以用在list的赋值中''@@
&gt;sqdEvens = [x ** 2 for x in range(8) if x&gt;2 ]
*@@color(blue):''单元素元组''@@
&gt;('xyz',) ;需要加逗号，负责会被认为是字符串@@color(red):圆括号被重载了，它也被用作分组操作符@@
*@@color(blue):''注意浅copy和深copy的区别''@@
&gt;深copy是两个对象互不影响， 浅copy是子copy不能影响原来的对象。但原来的对象可以影响copy


</pre>
</div>
<div title="协方差-方差-标准差" creator="samuel" modifier="samuel" created="201209270548" modified="201209270605" changecount="11">
<pre>*@@color(blue):''方差''@@
&gt;''D(X)=E[ (X - E(X)) (X - E(X)) ]''是各个数据与''平均数''之差的平方的平均数。 用来衡量一个样本中，样本值的偏离程度
*@@color(blue):''标准差''@@
&gt;标准差是方差平方根
*@@color(blue):''协方差''@@
&gt;''COV(X，Y)=E[ (X - E(X)) (Y - E(Y)) ]'' : 方差是协方差的特例
*@@color(blue):''相关系数''@@
&gt;协方差/[根号D（X）*根号D（Y）]</pre>
</div>
<div title="字典" creator="Samuel" modifier="Samuel" created="201207020702" modified="201209050106" tags="_PYTHON_ _PYTHON_DATASTRUCTURE_" changecount="28">
<pre>@@bgcolor(green):''键值不唯一，键是唯一的''@@
*{{normal{@@color(blue):''字典的创建''@@
&lt;code python&gt;
d = {'key1' : 'val', 'key2' : 'val'} 
d = dict(key1='val', key2='val')
items = [ ('key1' , 'val'), ('key2' : 'val')]       
d = dict[items]
&lt;/code&gt;
}}}
*@@color(blue):''赋值式与列表的区别''@@
:可以为不存在的键添加值，列表超过索引则不行（可以用append方法）</pre>
</div>
<div title="字符串" creator="Samuel" modifier="Samuel" created="201207020222" modified="201212240303" tags="_PYTHON_ _PYTHON_DATASTRUCTURE_" changecount="65">
<pre>*@@color(blue):''str()和repr()区别''@@
:str和int等是一种类型，而repr是函数，显示时候用： 如list等不能用str，可以用repr来显示其值
*@@color(blue):''python中数组下标从负数开始表示反向''@@,  如：a=[1,2,3,4] . a[-1]=4
*@@color(blue):''原始字符串''@@
: 前面加r/R，字符中的特殊字符将会被当着一般字符
*@@color(blue):''字符串常量''@@
&gt;''string.digits'' ： 0-9的字符串
&gt;''string.letters'' ： 包含所有字母（大小写）的字符串
&gt;''string.lowercase'' ： 包含所有小写字母的字符串
&gt;''string.printable'' ： 包含所有可打印的字符
&gt;''string.punctuation'' ： 包含所有标点的字符串
&gt;''string.uppercase'' ： 包含所有大写字母的字符串
*@@color(blue):''三引号''@@
:三引号中的字符可以换行
*@@color(blue):''format() &amp; %''@@
**@@bgcolor(green):''功能''@@
::格式化字符串.@@color(red):详细见：python核心编程6.4.~String-Only Operators@@
**@@bgcolor(green):''用法''@@
::{{normal{
&lt;code python&gt;
#详细见文档
a = &quot;i am a %s&quot;%sub1
b = &quot;i am a {0:&lt;6}&quot;.format(sub1) #左对齐
b = &quot;i am a {0:&gt;6}&quot;.format(sub1) #右对齐
#字典字符串格式化
c = &quot;with %(kwarg)s!&quot;%{'kwarg':sub2}
d = &quot;with {kwarg}!&quot;.format(kwarg=sub2)
&lt;/code&gt;
}}}
*@@color(blue):''find()''@@
**@@bgcolor(green):''功能''@@
::寻找子字符串的最左端索引， 没找到返回-1
**@@bgcolor(green):''用法''@@
::{{normal{
&lt;code python&gt;
'string'.find('substr')
&lt;/code&gt;
}}}
*@@color(blue):''upper() &amp; lower()''@@
**@@bgcolor(green):''功能''@@
::大小写转换
**@@bgcolor(green):''用法''@@
::{{normal{
&lt;code python&gt;
'string'.lower()  | 'string'.upper()
&lt;/code&gt;
}}}
*@@color(blue):''strip()''@@
**@@bgcolor(green):''功能''@@
::去除字符串两侧的空格字符(不包含内部)
**@@bgcolor(green):''用法''@@
::{{normal{
&lt;code python&gt;
'string'.strip()
&lt;/code&gt;
}}}
*@@color(blue):''replace() &amp; translate()''@@
**@@bgcolor(green):''功能''@@
::replace进行单词替换
::translate进行单个字母的替换
**@@bgcolor(green):''用法''@@
::{{normal{
&lt;code python&gt;
 'string'.replace('is' , 'are')
 'string'.translate('ab' , 'AB')
&lt;/code&gt;
}}}
*@@color(blue):''join() &amp; split()''@@
**@@bgcolor(green):''功能''@@
::join将字符串序列链接成一个字符串
::split将一个字符串拆分成字符串序列
**@@bgcolor(green):''用法''@@
::{{normal{
&lt;code python&gt;
#链接
seq = ['1', '2' , '3' , '4']
res = '+'.join(seq)
#拆分
str = '1+2+3+4'
res = str.split('+')
&lt;/code&gt;
}}}</pre>
</div>
<div title="寻找角点" creator="Samuel" modifier="Samuel" created="201211160324" modified="201211160324" changecount="3">
<pre>*{{normal{@@color(blue):''Harris''@@

}}}

*{{normal{@@color(blue):''~Shi-Tomasi''@@

}}}</pre>
</div>
<div title="形态学的腐蚀和膨胀" creator="samuel" modifier="Samuel" created="201209270115" modified="201212120835" changecount="13">
<pre>*{{normal{@@color(blue):''灰度图像''@@
* 膨胀：若我们把重合区域中所有点灰度值的最大值赋给当前点，就是对灰度图的膨胀操作 @@color(red):(可以分为垂直和水平两个方向来做)@@
&gt;即：(3, 7, 9, 12, 3, 6, 8)-&gt;(7, 9, 12, 12, 12, 8, 8)
* 腐蚀：若我们把重合区域中所有点灰度值的最小值赋给当前点，就是对灰度图的腐蚀操作
&gt;即：(3, 7, 9, 12, 3, 6, 8)-&gt;(3, 3, 7, 3, 3, 3, 6)

}}}
*{{normal{@@color(blue):''二值图像''@@
http://ostermiller.org/dilate_and_erode.html 可以只用一个buffer
* 膨胀：用3x3的结构元素，扫描图像的每一个像素，用结构元素与其覆盖的二值图像做“与”操作，如果都为0，结果图像的该像素为0。否则为1。 @@color(red):结果：使二值图像扩大一圈@@
* 腐蚀：用3x3的结构元素，扫描图像的每一个像素，用结构元素(0 表示未覆盖)与其覆盖的二值图像做“与”操作如果都为1，结果图像的该像素为1。否则为0。 @@color(red):结果：使二值图像减小一圈@@
&gt;{{normal{结构元素如： &amp;nbsp;
 0  1  0
 0  1  0                                                
 0  1  0 }}}
}}}
*{{normal{@@color(blue):''应用''@@
*求边界(二值图像)
**对图像进行腐蚀， 然后用原图减腐蚀图得到边界图
*闭重建
**将原图像A加上一个阈值，得到图像B， 
**将图像A膨胀， 取A和B之间的小值，
**重复上一步多次得C
**将图像A腐蚀， 取A和B之间的大值，
**重复上一步多次得结果图


}}}</pre>
</div>
<div title="最小二乘法直线拟合" creator="Samuel" modifier="Samuel" created="201301170728" modified="201301170838" changecount="29">
<pre>@@bgcolor(green):又名最小平方法，即平方和最小@@
曲线拟合中最基本和最常用的是直线拟合。设x和y之间的函数关系为：
              $$     y＝a+bx$$
式中有两个待定参数，a代表截距，b代表斜率。对于等精度测量所得到的N组数据（xi，yi），i＝1，2……，N，xi值被认为是准确的，所有的误差只联系着yi。
用最小二乘法估计参数时，要求观测值yi的偏差的加权平方和为最小。对于等精度观测值的直线拟合来说，可使下式的值最小：
$$ \sum\limits_{i=1}^N[y_i-(a+bx_i)^2] $$ 
上式分别对a、b求偏导得：
$$
\frac{\partial}{\partial a}\sum\limits_{i=1}^N[y_i-(a+bx_i))^2] = -2\sum\limits_{i=1}^N[y_i-(a+bx_i)] = 0  \\
\frac{\partial}{\partial b}\sum\limits_{i=1}^N[y_i-(a+bx_i))^2] = -2\sum\limits_{i=1}^N[y_i-(a+bx_i)]x_i = 0
$$    
整理后得到方程组
$$
\begin{cases} 
aN + b\sum x_i = \sum y_i \\
a\sum x_i + b\sum x_i^2 = \sum x_iy_i
\end{cases}
$$
解上述方程组便可求得直线参数a和b的最佳估计值。
$$
a=\frac{\sum (x_i^2) (\sum y_i) - (\sum x_i)(\sum x_iy_i)}{N(\sum x_i^2)- (\sum x_i)^2} \\
b=\frac{(\sum x_iy_i)  - (\sum x_i)(\sum y_i)}{N(\sum x_i^2)- (\sum x_i)^2} \\
$$
相关系数r:
最小二乘法处理数据除给出a、b外，常常还给出相关系数r,  r定义为
$$
r = \frac{(\sum x_i-X \sum(y_i-Y)}{\sqrt{\sum(x_i-X)^2}\sqrt{\sum(y_i-Y)^2}} \\
其中X,Y为均值
$$
 |r|&lt;=1, 如果|r|-&gt;0 想x，y无线性关系 拟合无效
</pre>
</div>
<div title="格式" creator="Samuel" modifier="Samuel" created="201206180454" modified="201302280919" tags="TiddlyWilki" changecount="123">
<pre>#使用#添加数字标题
{{{
#number1
#nember2
}}}
*使用*增加标题，几个*号代表是几级标题
{{{
*标题
}}}
&gt;使用&quot;&gt;&quot;表示列表，几个&quot;&gt;&quot;号代表是几级标题，@@color(red):也可以使用一对三个“&gt;“将同层的放在一起@@
{{{
&gt;列表
}}}
*''加粗''字体,使用两对单引号
{{{
''加粗''
}}}
*--中间加划线--
{{{
--text--
}}}
*__下划线__
{{{
__下划线__
}}}
*//斜体字//
{{{
//斜体字//
}}}
*上标^^上标^^ ， 下标~~下标~~
{{{
^^上标^^ ,      ~~下标~~
}}}
*@@color(red):高亮@@ 字体,并可设置颜色
{{{
@@color(red):高亮@@
@@bgcolor(39):背景@@ ，设置背景色
}}}
*~取消关键字解释
{{{
~取消关键字解释
}}}
*定宽字或字块，使用3个大括号
{{{
{{{定宽字和字块}}}
{{normal{
...
}}}
}}}
*首行缩进使用 : (冒号)
{{{
:缩进
}}}
!增加横线标题
{{{
!!!增加横线 !一级， !!二级
}}}
*註解的語法如下：
{{{
/% 不想被看到的內容 %/
}}}
</pre>
</div>
<div title="梯度" creator="YourName" modifier="Samuel" created="201211210252" modified="201301080734" changecount="48">
<pre>@@color(green):''Optional Preprocessing''@@先高斯模糊一下再求梯度， 减少噪声干扰

*{{normal{@@color(green):''Robets operator''@@
|grad_x|-1 : p(x,y)|0| grad_y |0 :  p(x,y)|-1|
|~|0|1|~|1|0|
\(
grad = \sqrt{grad\_x^2 + grad\_y^2}  \approx |grad\_x| + |grad\_y|
\)
}}}

*{{normal{@@color(green):''Sobel operator''@@
|grad_x|-1 |0|1| grad_y |-1|-2|-1|
|~|-2|0|2|~|0|0|0|
|~|-1|0|1|~|1|2|1|
\(
grad = \sqrt{grad\_x^2 + grad\_y^2}  \approx |grad\_x| + |grad\_y|
\)
}}}
*{{normal{@@color(green):''Morphology gradient''@@

\(
grad = dilate(gray) - erode(gray)
\)

''mutil-scale'':
&lt;code c&gt;
//fake code

grad = 0;
for(int l=0; l&lt;level; l++)
{
    diff= dilate(gray) - erode(gray)
    for(int _l=0; _l&lt;l; _l++)
    {
        erode(diff);
    }
    grad += diff
}

if( (average) &amp;&amp; (level&gt;1))
    grad /=level;
&lt;/code&gt;

}}}</pre>
</div>
<div title="直方图均衡化(Histogram Equalization)" creator="samuel" modifier="Samuel" created="201209270115" modified="201212060911" changecount="56">
<pre>* ''step1'' : 直方图统计
$$
p(l) =  \frac{n(l)}{n}      ............. l \in (0,L-1) \\
n(l): 为像素是k的个数\\
n :  所有像素的个数\\
L :  为级数 如：256\\
$$
&lt;code c&gt;
for(int i=0; i&lt;height; i++)
    for(int j=0; j&lt;width; j++)
        hist[src_pixel[i*width+j]]++;
for(int i=0; i&lt;L; i++)
    p[i] = hist[i]/width*height;
&lt;/code&gt;
* ''step2'' : 累计归一化直方图(即对p(k)做一下scan算法)
$$
s(k) = \sum\limits_{l=0}^k p(l)      ............. k \in (0,L-1) \\
$$
&lt;code c&gt;
s[0] = p[0];
for(int i=1; i&lt;L; i++)
    s[i] += s[i-1]+p[i] ;
&lt;/code&gt;
*{{normal{ ''step3'' : 还原到像素级
#找出原图像中的最大值和最小值
#dst_pixel[i][j] = s[src_pixel[i][j]] * (max-min) + min;
}}}

</pre>
</div>
<div title="表格" creator="Samuel" modifier="samuel" created="201206180540" modified="201212110336" tags="TiddlyWilki" changecount="28">
<pre>*表格使用竖线插入表格, 并用 ''@@!@@'' 号点亮标题， @@其中文字两边的空格表示对齐方式@@
|!First column|!Second column|!Third column|
|left | centre | right|
*使用''f''和''h'' 来表示标题和最后一栏
|North West|North|North East|h
|West|Here|East|f
|South West|South|South East|
*@@&quot;&gt;&quot;@@使用合并水平单元格
|!First column|!Second column|!Third column|
|&gt;|&gt;| center |
*@@&quot;~&quot;@@使用合并垂直单元格
| First column|dd|Third column|
|~| centre | right|</pre>
</div>
<div title="集合" creator="samuel" modifier="samuel" created="201209060217" changecount="1">
<pre>*@@bgcolor(green):说明@@
:set是python2.3以后引入的内建类型。
*@@bgcolor(green):方法@@
&gt; ''union'' == ''|''
&gt; ''issubset'', ''issupperset''
&gt;''difference'' == ''-''
&gt;''symmetric_difference'' == ''^''
</pre>
</div>
</div>
<!--POST-STOREAREA-->
<!--POST-BODY-START-->
<!--POST-BODY-END-->
<script id="jsArea" type="text/javascript">
//<![CDATA[
//
// Please note:
//
// * This code is designed to be readable but for compactness it only includes brief comments. You can see fuller comments
//   in the project repository at https://github.com/TiddlyWiki/tiddlywiki
//
// * You should never need to modify this source code directly. TiddlyWiki is carefully designed to allow deep customisation
//   without changing the core code. Please consult the development group at http://groups.google.com/group/TiddlyWikiDev
//
// JSLint directives
/*global jQuery:false, version:false */
/*jslint bitwise:true, browser:true, confusion:true, eqeq:true, evil:true, forin:true, maxerr:100, plusplus:true, regexp:true, sloppy:true, sub:true, undef:true, unparam:true, vars:true, white:true */
//--
//-- Configuration repository
//--

// Miscellaneous options
var config = {
	numRssItems: 20, // Number of items in the RSS feed
	animDuration: 400, // Duration of UI animations in milliseconds
	cascadeFast: 20, // Speed for cascade animations (higher == slower)
	cascadeSlow: 60, // Speed for EasterEgg cascade animations
	cascadeDepth: 5, // Depth of cascade animation
	locale: "en" // W3C language tag
};

// Hashmap of alternative parsers for the wikifier
config.parsers = {};

// Adaptors
config.adaptors = {};
config.defaultAdaptor = null;

// Backstage tasks
config.tasks = {};

// Annotations
config.annotations = {};

// Custom fields to be automatically added to new tiddlers
config.defaultCustomFields = {};

// Messages
config.messages = {
	messageClose: {},
	dates: {},
	tiddlerPopup: {}
};

// Options that can be set in the options panel and/or cookies
config.options = {
	chkRegExpSearch: false,
	chkCaseSensitiveSearch: false,
	chkIncrementalSearch: true,
	chkAnimate: true,
	chkSaveBackups: true,
	chkAutoSave: false,
	chkGenerateAnRssFeed: false,
	chkSaveEmptyTemplate: false,
	chkOpenInNewWindow: true,
	chkToggleLinks: false,
	chkHttpReadOnly: true,
	chkForceMinorUpdate: false,
	chkConfirmDelete: true,
	chkInsertTabs: false,
	chkUsePreForStorage: true, // Whether to use <pre> format for storage
	chkDisplayInstrumentation: false,
	txtBackupFolder: "",
	txtEditorFocus: "text",
	txtMainTab: "tabTimeline",
	txtMoreTab: "moreTabAll",
	txtMaxEditRows: "30",
	txtFileSystemCharSet: "UTF-8",
	txtTheme: ""
	};
config.optionsDesc = {};

config.optionsSource = {};

// Default tiddler templates
var DEFAULT_VIEW_TEMPLATE = 1;
var DEFAULT_EDIT_TEMPLATE = 2;
config.tiddlerTemplates = {
	1: "ViewTemplate",
	2: "EditTemplate"
};

// More messages (rather a legacy layout that should not really be like this)
config.views = {
	wikified: {
		tag: {}
	},
	editor: {
		tagChooser: {}
	}
};

// Backstage tasks
config.backstageTasks = ["save","sync","importTask","tweak","upgrade","plugins"];

// Extensions
config.extensions = {};

// Macros; each has a 'handler' member that is inserted later
config.macros = {
	today: {},
	version: {},
	search: {sizeTextbox: 15},
	tiddler: {},
	tag: {},
	tags: {},
	tagging: {},
	timeline: {},
	allTags: {},
	list: {
		all: {},
		missing: {},
		orphans: {},
		shadowed: {},
		touched: {},
		filter: {}
	},
	closeAll: {},
	permaview: {},
	saveChanges: {},
	slider: {},
	option: {},
	options: {},
	newTiddler: {},
	newJournal: {},
	tabs: {},
	gradient: {},
	message: {},
	view: {defaultView: "text"},
	edit: {},
	tagChooser: {},
	toolbar: {},
	plugins: {},
	refreshDisplay: {},
	importTiddlers: {},
	upgrade: {
		source: "http://tiddlywiki-releases.tiddlyspace.com/upgrade",
		backupExtension: "pre.core.upgrade"
	},
	sync: {},
	annotations: {}
};

// Commands supported by the toolbar macro
config.commands = {
	closeTiddler: {},
	closeOthers: {},
	editTiddler: {},
	saveTiddler: {hideReadOnly: true},
	cancelTiddler: {},
	deleteTiddler: {hideReadOnly: true},
	permalink: {},
	references: {type: "popup"},
	jump: {type: "popup"},
	syncing: {type: "popup"},
	fields: {type: "popup"}
};

// Control of macro parameter evaluation
config.evaluateMacroParameters = "all";

// Basic regular expressions
config.textPrimitives = {
	upperLetter: "[A-Z\u00c0-\u00de\u0150\u0170]",
	lowerLetter: "[a-z0-9_\\-\u00df-\u00ff\u0151\u0171]",
	anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]",
	anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]"
};
if(!((new RegExp("[\u0150\u0170]","g")).test("\u0150"))) {
	config.textPrimitives = {
		upperLetter: "[A-Z\u00c0-\u00de]",
		lowerLetter: "[a-z0-9_\\-\u00df-\u00ff]",
		anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff]",
		anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff]"
	};
}
config.textPrimitives.sliceSeparator = "::";
config.textPrimitives.sectionSeparator = "##";
config.textPrimitives.urlPattern = "(?:file|http|https|mailto|ftp|irc|news|data):[^\\s'\"]+(?:/|\\b)";
config.textPrimitives.unWikiLink = "~";
config.textPrimitives.wikiLink = "(?:(?:" + config.textPrimitives.upperLetter + "+" +
	config.textPrimitives.lowerLetter + "+" +
	config.textPrimitives.upperLetter +
	config.textPrimitives.anyLetter + "*)|(?:" +
	config.textPrimitives.upperLetter + "{2,}" +
	config.textPrimitives.lowerLetter + "+))";

config.textPrimitives.cssLookahead = "(?:(" + config.textPrimitives.anyLetter + "+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:(" + config.textPrimitives.anyLetter + "+):([^;\\|\\n]+);)";
config.textPrimitives.cssLookaheadRegExp = new RegExp(config.textPrimitives.cssLookahead,"mg");

config.textPrimitives.brackettedLink = "\\[\\[([^\\]]+)\\]\\]";
config.textPrimitives.titledBrackettedLink = "\\[\\[([^\\[\\]\\|]+)\\|([^\\[\\]\\|]+)\\]\\]";
config.textPrimitives.tiddlerForcedLinkRegExp = new RegExp("(?:" + config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");
config.textPrimitives.tiddlerAnyLinkRegExp = new RegExp("("+ config.textPrimitives.wikiLink + ")|(?:" +
	config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");

config.glyphs = {
	currBrowser: null,
	browsers: [],
	codes: {}
};

//--
//-- Shadow tiddlers
//--

config.shadowTiddlers = {
	StyleSheet: "",
	MarkupPreHead: "",
	MarkupPostHead: "",
	MarkupPreBody: "",
	MarkupPostBody: "",
	TabTimeline: '<<timeline>>',
	TabAll: '<<list all>>',
	TabTags: '<<allTags excludeLists>>',
	TabMoreMissing: '<<list missing>>',
	TabMoreOrphans: '<<list orphans>>',
	TabMoreShadowed: '<<list shadowed>>',
	AdvancedOptions: '<<options>>',
	PluginManager: '<<plugins>>',
	SystemSettings: '',
	ToolbarCommands: '|~ViewToolbar|closeTiddler closeOthers +editTiddler > fields syncing permalink references jump|\n|~EditToolbar|+saveTiddler -cancelTiddler deleteTiddler|',
	WindowTitle: '<<tiddler SiteTitle>> - <<tiddler SiteSubtitle>>'
};

// Browser detection... In a very few places, there's nothing else for it but to know what browser we're using.
config.userAgent = navigator.userAgent.toLowerCase();
config.browser = {
	isIE: config.userAgent.indexOf("msie") != -1 && config.userAgent.indexOf("opera") == -1,
	isGecko: navigator.product == "Gecko" && config.userAgent.indexOf("WebKit") == -1,
	ieVersion: /MSIE (\d.\d)/i.exec(config.userAgent), // config.browser.ieVersion[1], if it exists, will be the IE version string, eg "6.0"
	isSafari: config.userAgent.indexOf("applewebkit") != -1,
	isBadSafari: !((new RegExp("[\u0150\u0170]","g")).test("\u0150")),
	firefoxDate: /gecko\/(\d{8})/i.exec(config.userAgent), // config.browser.firefoxDate[1], if it exists, will be Firefox release date as "YYYYMMDD"
	isOpera: config.userAgent.indexOf("opera") != -1,
	isChrome: config.userAgent.indexOf('chrome') > -1,
	isLinux: config.userAgent.indexOf("linux") != -1,
	isUnix: config.userAgent.indexOf("x11") != -1,
	isMac: config.userAgent.indexOf("mac") != -1,
	isWindows: config.userAgent.indexOf("win") != -1
};

merge(config.glyphs,{
	browsers: [
		function() {return config.browser.isIE;},
		function() {return true;}
		],
	codes: {
		downTriangle: ["\u25BC","\u25BE"],
		downArrow: ["\u2193","\u2193"],
		bentArrowLeft: ["\u2190","\u21A9"],
		bentArrowRight: ["\u2192","\u21AA"]
	}
});

//--
//-- Translateable strings
//--

// Strings in "double quotes" should be translated; strings in 'single quotes' should be left alone

merge(config.options,{
	txtUserName: "YourName"});

merge(config.tasks,{
	save: {text: "save", tooltip: "Save your changes to this TiddlyWiki"},
	sync: {text: "sync", tooltip: "Synchronise changes with other TiddlyWiki files and servers", content: '<<sync>>'},
	importTask: {text: "import", tooltip: "Import tiddlers and plugins from other TiddlyWiki files and servers", content: '<<importTiddlers>>'},
	tweak: {text: "tweak", tooltip: "Tweak the appearance and behaviour of TiddlyWiki", content: '<<options>>'},
	upgrade: {text: "upgrade", tooltip: "Upgrade TiddlyWiki core code", content: '<<upgrade>>'},
	plugins: {text: "plugins", tooltip: "Manage installed plugins", content: '<<plugins>>'}
});

// Options that can be set in the options panel and/or cookies
merge(config.optionsDesc,{
	txtUserName: "Username for signing your edits",
	chkRegExpSearch: "Enable regular expressions for searches",
	chkCaseSensitiveSearch: "Case-sensitive searching",
	chkIncrementalSearch: "Incremental key-by-key searching",
	chkAnimate: "Enable animations",
	chkSaveBackups: "Keep backup file when saving changes",
	chkAutoSave: "Automatically save changes",
	chkGenerateAnRssFeed: "Generate an RSS feed when saving changes",
	chkSaveEmptyTemplate: "Generate an empty template when saving changes",
	chkOpenInNewWindow: "Open external links in a new window",
	chkToggleLinks: "Clicking on links to open tiddlers causes them to close",
	chkHttpReadOnly: "Hide editing features when viewed over HTTP",
	chkForceMinorUpdate: "Don't update modifier username and date when editing tiddlers",
	chkConfirmDelete: "Require confirmation before deleting tiddlers",
	chkInsertTabs: "Use the tab key to insert tab characters instead of moving between fields",
	txtBackupFolder: "Name of folder to use for backups",
	txtMaxEditRows: "Maximum number of rows in edit boxes",
	txtTheme: "Name of the theme to use",
	txtFileSystemCharSet: "Default character set for saving changes (Firefox/Mozilla only)"});

merge(config.messages,{
	customConfigError: "Problems were encountered loading plugins. See PluginManager for details",
	pluginError: "Error: %0",
	pluginDisabled: "Not executed because disabled via 'systemConfigDisable' tag",
	pluginForced: "Executed because forced via 'systemConfigForce' tag",
	pluginVersionError: "Not executed because this plugin needs a newer version of TiddlyWiki",
	nothingSelected: "Nothing is selected. You must select one or more items first",
	savedSnapshotError: "It appears that this TiddlyWiki has been incorrectly saved. Please see http://www.tiddlywiki.com/#Download for details",
	subtitleUnknown: "(unknown)",
	undefinedTiddlerToolTip: "The tiddler '%0' doesn't yet exist",
	shadowedTiddlerToolTip: "The tiddler '%0' doesn't yet exist, but has a pre-defined shadow value",
	tiddlerLinkTooltip: "%0 - %1, %2",
	externalLinkTooltip: "External link to %0",
	noTags: "There are no tagged tiddlers",
	notFileUrlError: "You need to save this TiddlyWiki to a file before you can save changes",
	cantSaveError: "It's not possible to save changes. Possible reasons include:\n- your browser doesn't support saving (Firefox, Internet Explorer, Safari and Opera all work if properly configured)\n- the pathname to your TiddlyWiki file contains illegal characters\n- the TiddlyWiki HTML file has been moved or renamed",
	invalidFileError: "The original file '%0' does not appear to be a valid TiddlyWiki",
	backupSaved: "Backup saved",
	backupFailed: "Failed to save backup file",
	rssSaved: "RSS feed saved",
	rssFailed: "Failed to save RSS feed file",
	emptySaved: "Empty template saved",
	emptyFailed: "Failed to save empty template file",
	mainSaved: "Main TiddlyWiki file saved",
	mainFailed: "Failed to save main TiddlyWiki file. Your changes have not been saved",
	macroError: "Error in macro <<%0>>",
	macroErrorDetails: "Error while executing macro <<%0>>:\n%1",
	missingMacro: "No such macro",
	overwriteWarning: "A tiddler named '%0' already exists. Choose OK to overwrite it",
	unsavedChangesWarning: "WARNING! There are unsaved changes in TiddlyWiki\n\nChoose OK to save\nChoose CANCEL to discard",
	confirmExit: "--------------------------------\n\nThere are unsaved changes in TiddlyWiki. If you continue you will lose those changes\n\n--------------------------------",
	saveInstructions: "SaveChanges",
	unsupportedTWFormat: "Unsupported TiddlyWiki format '%0'",
	tiddlerSaveError: "Error when saving tiddler '%0'",
	tiddlerLoadError: "Error when loading tiddler '%0'",
	wrongSaveFormat: "Cannot save with storage format '%0'. Using standard format for save.",
	invalidFieldName: "Invalid field name %0",
	fieldCannotBeChanged: "Field '%0' cannot be changed",
	loadingMissingTiddler: "Attempting to retrieve the tiddler '%0' from the '%1' server at:\n\n'%2' in the workspace '%3'",
	upgradeDone: "The upgrade to version %0 is now complete\n\nClick 'OK' to reload the newly upgraded TiddlyWiki",
	invalidCookie: "Invalid cookie '%0'"});

merge(config.messages.messageClose,{
	text: "close",
	tooltip: "close this message area"});

config.messages.backstage = {
	open: {text: "backstage", tooltip: "Open the backstage area to perform authoring and editing tasks"},
	close: {text: "close", tooltip: "Close the backstage area"},
	prompt: "backstage: ",
	decal: {
		edit: {text: "edit", tooltip: "Edit the tiddler '%0'"}
	}
};

config.messages.listView = {
	tiddlerTooltip: "Click for the full text of this tiddler",
	previewUnavailable: "(preview not available)"
};

config.messages.dates.months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November","December"];
config.messages.dates.days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
config.messages.dates.shortMonths = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
config.messages.dates.shortDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
// suffixes for dates, eg "1st","2nd","3rd"..."30th","31st"
config.messages.dates.daySuffixes = ["st","nd","rd","th","th","th","th","th","th","th",
		"th","th","th","th","th","th","th","th","th","th",
		"st","nd","rd","th","th","th","th","th","th","th",
		"st"];
config.messages.dates.am = "am";
config.messages.dates.pm = "pm";

merge(config.messages.tiddlerPopup,{
	});

merge(config.views.wikified.tag,{
	labelNoTags: "no tags",
	labelTags: "tags: ",
	openTag: "Open tag '%0'",
	tooltip: "Show tiddlers tagged with '%0'",
	openAllText: "Open all",
	openAllTooltip: "Open all of these tiddlers",
	popupNone: "No other tiddlers tagged with '%0'"});

merge(config.views.wikified,{
	defaultText: "The tiddler '%0' doesn't yet exist. Double-click to create it",
	defaultModifier: "(missing)",
	shadowModifier: "(built-in shadow tiddler)",
	dateFormat: "DD MMM YYYY",
	createdPrompt: "created"});

merge(config.views.editor,{
	tagPrompt: "Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing",
	defaultText: "Type the text for '%0'"});

merge(config.views.editor.tagChooser,{
	text: "tags",
	tooltip: "Choose existing tags to add to this tiddler",
	popupNone: "There are no tags defined",
	tagTooltip: "Add the tag '%0'"});

merge(config.messages,{
	sizeTemplates:
		[
		{unit: 1024*1024*1024, template: "%0\u00a0GB"},
		{unit: 1024*1024, template: "%0\u00a0MB"},
		{unit: 1024, template: "%0\u00a0KB"},
		{unit: 1, template: "%0\u00a0B"}
		]});

merge(config.macros.search,{
	label: "search",
	prompt: "Search this TiddlyWiki",
	placeholder: "",
	accessKey: "F",
	successMsg: "%0 tiddlers found matching %1",
	failureMsg: "No tiddlers found matching %0"});

merge(config.macros.tagging,{
	label: "tagging: ",
	labelNotTag: "not tagging",
	tooltip: "List of tiddlers tagged with '%0'"});

merge(config.macros.timeline,{
	dateFormat: "DD MMM YYYY"});

merge(config.macros.allTags,{
	tooltip: "Show tiddlers tagged with '%0'",
	noTags: "There are no tagged tiddlers"});

config.macros.list.all.prompt = "All tiddlers in alphabetical order";
config.macros.list.missing.prompt = "Tiddlers that have links to them but are not defined";
config.macros.list.orphans.prompt = "Tiddlers that are not linked to from any other tiddlers";
config.macros.list.shadowed.prompt = "Tiddlers shadowed with default contents";
config.macros.list.touched.prompt = "Tiddlers that have been modified locally";

merge(config.macros.closeAll,{
	label: "close all",
	prompt: "Close all displayed tiddlers (except any that are being edited)"});

merge(config.macros.permaview,{
	label: "permaview",
	prompt: "Link to an URL that retrieves all the currently displayed tiddlers"});

merge(config.macros.saveChanges,{
	label: "save changes",
	prompt: "Save all tiddlers to create a new TiddlyWiki",
	accessKey: "S"});

merge(config.macros.newTiddler,{
	label: "new tiddler",
	prompt: "Create a new tiddler",
	title: "New Tiddler",
	accessKey: "N"});

merge(config.macros.newJournal,{
	label: "new journal",
	prompt: "Create a new tiddler from the current date and time",
	accessKey: "J"});

merge(config.macros.options,{
	wizardTitle: "Tweak advanced options",
	step1Title: "These options are saved in cookies in your browser",
	step1Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='false' name='chkUnknown'>Show unknown options</input>",
	unknownDescription: "//(unknown)//",
	listViewTemplate: {
		columns: [
			{name: 'Option', field: 'option', title: "Option", type: 'String'},
			{name: 'Description', field: 'description', title: "Description", type: 'WikiText'},
			{name: 'Name', field: 'name', title: "Name", type: 'String'}
			],
		rowClasses: [
			{className: 'lowlight', field: 'lowlight'}
			]}
	});

merge(config.macros.plugins,{
	wizardTitle: "Manage plugins",
	step1Title: "Currently loaded plugins",
	step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
	skippedText: "(This plugin has not been executed because it was added since startup)",
	noPluginText: "There are no plugins installed",
	confirmDeleteText: "Are you sure you want to delete these plugins:\n\n%0",
	removeLabel: "remove systemConfig tag",
	removePrompt: "Remove systemConfig tag",
	deleteLabel: "delete",
	deletePrompt: "Delete these tiddlers forever",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Description', field: 'Description', title: "Description", type: 'String'},
			{name: 'Version', field: 'Version', title: "Version", type: 'String'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Forced', field: 'forced', title: "Forced", tag: 'systemConfigForce', type: 'TagCheckbox'},
			{name: 'Disabled', field: 'disabled', title: "Disabled", tag: 'systemConfigDisable', type: 'TagCheckbox'},
			{name: 'Executed', field: 'executed', title: "Loaded", type: 'Boolean', trueText: "Yes", falseText: "No"},
			{name: 'Startup Time', field: 'startupTime', title: "Startup Time", type: 'String'},
			{name: 'Error', field: 'error', title: "Status", type: 'Boolean', trueText: "Error", falseText: "OK"},
			{name: 'Log', field: 'log', title: "Log", type: 'StringList'}
			],
		rowClasses: [
			{className: 'error', field: 'error'},
			{className: 'warning', field: 'warning'}
			]},
	listViewTemplateReadOnly: {
		columns: [
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Description', field: 'Description', title: "Description", type: 'String'},
			{name: 'Version', field: 'Version', title: "Version", type: 'String'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Executed', field: 'executed', title: "Loaded", type: 'Boolean', trueText: "Yes", falseText: "No"},
			{name: 'Startup Time', field: 'startupTime', title: "Startup Time", type: 'String'},
			{name: 'Error', field: 'error', title: "Status", type: 'Boolean', trueText: "Error", falseText: "OK"},
			{name: 'Log', field: 'log', title: "Log", type: 'StringList'}
			],
		rowClasses: [
			{className: 'error', field: 'error'},
			{className: 'warning', field: 'warning'}
			]}
	});

merge(config.macros.toolbar,{
	moreLabel: "more",
	morePrompt: "Show additional commands",
	lessLabel: "less",
	lessPrompt: "Hide additional commands",
	separator: "|"
	});

merge(config.macros.refreshDisplay,{
	label: "refresh",
	prompt: "Redraw the entire TiddlyWiki display"
	});

merge(config.macros.importTiddlers,{
	readOnlyWarning: "You cannot import into a read-only TiddlyWiki file. Try opening it from a file:// URL",
	wizardTitle: "Import tiddlers from another file or server",
	step1Title: "Step 1: Locate the server or TiddlyWiki file",
	step1Html: "Specify the type of the server: <select name='selTypes'><option value=''>Choose...</option></select><br>Enter the URL or pathname here: <input type='text' size=50 name='txtPath'><br>...or browse for a file: <input type='file' size=50 name='txtBrowse'><br><hr>...or select a pre-defined feed: <select name='selFeeds'><option value=''>Choose...</option></select>",
	openLabel: "open",
	openPrompt: "Open the connection to this file or server",
	statusOpenHost: "Opening the host",
	statusGetWorkspaceList: "Getting the list of available workspaces",
	step2Title: "Step 2: Choose the workspace",
	step2Html: "Enter a workspace name: <input type='text' size=50 name='txtWorkspace'><br>...or select a workspace: <select name='selWorkspace'><option value=''>Choose...</option></select>",
	cancelLabel: "cancel",
	cancelPrompt: "Cancel this import",
	statusOpenWorkspace: "Opening the workspace",
	statusGetTiddlerList: "Getting the list of available tiddlers",
	errorGettingTiddlerList: "Error getting list of tiddlers, click Cancel to try again",
	errorGettingTiddlerListHttp404: "Error retrieving tiddlers from url, please ensure the url exists. Click Cancel to try again.",
	errorGettingTiddlerListHttp: "Error retrieving tiddlers from url, please ensure this url exists and is <a href='http://enable-cors.org/'>CORS</a> enabled",
	errorGettingTiddlerListFile: "Error retrieving tiddlers from local file, please make sure the file is in the same directory as your TiddlyWiki. Click Cancel to try again.",
	step3Title: "Step 3: Choose the tiddlers to import",
	step3Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='true' name='chkSync'>Keep these tiddlers linked to this server so that you can synchronise subsequent changes</input><br><input type='checkbox' name='chkSave'>Save the details of this server in a 'systemServer' tiddler called:</input> <input type='text' size=25 name='txtSaveTiddler'>",
	importLabel: "import",
	importPrompt: "Import these tiddlers",
	confirmOverwriteText: "Are you sure you want to overwrite these tiddlers:\n\n%0",
	step4Title: "Step 4: Importing %0 tiddler(s)",
	step4Html: "<input type='hidden' name='markReport'></input>", // DO NOT TRANSLATE
	doneLabel: "done",
	donePrompt: "Close this wizard",
	statusDoingImport: "Importing tiddlers",
	statusDoneImport: "All tiddlers imported",
	systemServerNamePattern: "%2 on %1",
	systemServerNamePatternNoWorkspace: "%1",
	confirmOverwriteSaveTiddler: "The tiddler '%0' already exists. Click 'OK' to overwrite it with the details of this server, or 'Cancel' to leave it unchanged",
	serverSaveTemplate: "|''Type:''|%0|\n|''URL:''|%1|\n|''Workspace:''|%2|\n\nThis tiddler was automatically created to record the details of this server",
	serverSaveModifier: "(System)",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Tags', field: 'tags', title: "Tags", type: 'Tags'}
			],
		rowClasses: [
			]}
	});

merge(config.macros.upgrade,{
	wizardTitle: "Upgrade TiddlyWiki core code",
	step1Title: "Update or repair this TiddlyWiki to the latest release",
	step1Html: "You are about to upgrade to the latest release of the TiddlyWiki core code (from <a href='%0' class='externalLink' target='_blank'>%1</a>). Your content will be preserved across the upgrade.<br><br>Note that core upgrades have been known to interfere with older plugins. If you run into problems with the upgraded file, see <a href='http://www.tiddlywiki.org/wiki/CoreUpgrades' class='externalLink' target='_blank'>http://www.tiddlywiki.org/wiki/CoreUpgrades</a>",
	errorCantUpgrade: "Unable to upgrade this TiddlyWiki. You can only perform upgrades on TiddlyWiki files stored locally",
	errorNotSaved: "You must save changes before you can perform an upgrade",
	step2Title: "Confirm the upgrade details",
	step2Html_downgrade: "You are about to downgrade to TiddlyWiki version %0 from %1.<br><br>Downgrading to an earlier version of the core code is not recommended",
	step2Html_restore: "This TiddlyWiki appears to be already using the latest version of the core code (%0).<br><br>You can continue to upgrade anyway to ensure that the core code hasn't been corrupted or damaged",
	step2Html_upgrade: "You are about to upgrade to TiddlyWiki version %0 from %1",
	upgradeLabel: "upgrade",
	upgradePrompt: "Prepare for the upgrade process",
	statusPreparingBackup: "Preparing backup",
	statusSavingBackup: "Saving backup file",
	errorSavingBackup: "There was a problem saving the backup file",
	statusLoadingCore: "Loading core code",
	errorLoadingCore: "Error loading the core code",
	errorCoreFormat: "Error with the new core code",
	statusSavingCore: "Saving the new core code",
	statusReloadingCore: "Reloading the new core code",
	startLabel: "start",
	startPrompt: "Start the upgrade process",
	cancelLabel: "cancel",
	cancelPrompt: "Cancel the upgrade process",
	step3Title: "Upgrade cancelled",
	step3Html: "You have cancelled the upgrade process"
	});

merge(config.macros.sync,{
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Server Type', field: 'serverType', title: "Server type", type: 'String'},
			{name: 'Server Host', field: 'serverHost', title: "Server host", type: 'String'},
			{name: 'Server Workspace', field: 'serverWorkspace', title: "Server workspace", type: 'String'},
			{name: 'Status', field: 'status', title: "Synchronisation status", type: 'String'},
			{name: 'Server URL', field: 'serverUrl', title: "Server URL", text: "View", type: 'Link'}
			],
		rowClasses: [
			],
		buttons: [
			{caption: "Sync these tiddlers", name: 'sync'}
			]},
	wizardTitle: "Synchronize with external servers and files",
	step1Title: "Choose the tiddlers you want to synchronize",
	step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
	syncLabel: "sync",
	syncPrompt: "Sync these tiddlers",
	hasChanged: "Changed while unplugged",
	hasNotChanged: "Unchanged while unplugged",
	syncStatusList: {
		none: {text: "...", display:'none', className:'notChanged'},
		changedServer: {text: "Changed on server", display:null, className:'changedServer'},
		changedLocally: {text: "Changed while unplugged", display:null, className:'changedLocally'},
		changedBoth: {text: "Changed while unplugged and on server", display:null, className:'changedBoth'},
		notFound: {text: "Not found on server", display:null, className:'notFound'},
		putToServer: {text: "Saved update on server", display:null, className:'putToServer'},
		gotFromServer: {text: "Retrieved update from server", display:null, className:'gotFromServer'}
		}
	});

merge(config.macros.annotations,{
	});

merge(config.commands.closeTiddler,{
	text: "close",
	tooltip: "Close this tiddler"});

merge(config.commands.closeOthers,{
	text: "close others",
	tooltip: "Close all other tiddlers"});

merge(config.commands.editTiddler,{
	text: "edit",
	tooltip: "Edit this tiddler",
	readOnlyText: "view",
	readOnlyTooltip: "View the source of this tiddler"});

merge(config.commands.saveTiddler,{
	text: "done",
	tooltip: "Save changes to this tiddler"});

merge(config.commands.cancelTiddler,{
	text: "cancel",
	tooltip: "Undo changes to this tiddler",
	warning: "Are you sure you want to abandon your changes to '%0'?",
	readOnlyText: "done",
	readOnlyTooltip: "View this tiddler normally"});

merge(config.commands.deleteTiddler,{
	text: "delete",
	tooltip: "Delete this tiddler",
	warning: "Are you sure you want to delete '%0'?"});

merge(config.commands.permalink,{
	text: "permalink",
	tooltip: "Permalink for this tiddler"});

merge(config.commands.references,{
	text: "references",
	tooltip: "Show tiddlers that link to this one",
	popupNone: "No references"});

merge(config.commands.jump,{
	text: "jump",
	tooltip: "Jump to another open tiddler"});

merge(config.commands.syncing,{
	text: "syncing",
	tooltip: "Control synchronisation of this tiddler with a server or external file",
	currentlySyncing: "<div>Currently syncing via <span class='popupHighlight'>'%0'</span> to:</"+"div><div>host: <span class='popupHighlight'>%1</span></"+"div><div>workspace: <span class='popupHighlight'>%2</span></"+"div>", // Note escaping of closing <div> tag
	notCurrentlySyncing: "Not currently syncing",
	captionUnSync: "Stop synchronising this tiddler",
	chooseServer: "Synchronise this tiddler with another server:",
	currServerMarker: "\u25cf ",
	notCurrServerMarker: "  "});

merge(config.commands.fields,{
	text: "fields",
	tooltip: "Show the extended fields of this tiddler",
	emptyText: "There are no extended fields for this tiddler",
	listViewTemplate: {
		columns: [
			{name: 'Field', field: 'field', title: "Field", type: 'String'},
			{name: 'Value', field: 'value', title: "Value", type: 'String'}
			],
		rowClasses: [
			],
		buttons: [
			]}});

merge(config.shadowTiddlers,{
	DefaultTiddlers: "[[GettingStarted]]",
	MainMenu: "[[GettingStarted]]",
	SiteTitle: "My TiddlyWiki",
	SiteSubtitle: "a reusable non-linear personal web notebook",
	SiteUrl: "",
	SideBarOptions: '<<search>><<closeAll>><<permaview>><<newTiddler>><<newJournal "DD MMM YYYY" "journal">><<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel "options \u00bb" "Change TiddlyWiki advanced options">>',
	SideBarTabs: '<<tabs txtMainTab "Timeline" "Timeline" TabTimeline "All" "All tiddlers" TabAll "Tags" "All tags" TabTags "More" "More lists" TabMore>>',
	TabMore: '<<tabs txtMoreTab "Missing" "Missing tiddlers" TabMoreMissing "Orphans" "Orphaned tiddlers" TabMoreOrphans "Shadowed" "Shadowed tiddlers" TabMoreShadowed>>'
	});

merge(config.annotations,{
	AdvancedOptions: "This shadow tiddler provides access to several advanced options",
	ColorPalette: "These values in this shadow tiddler determine the colour scheme of the ~TiddlyWiki user interface",
	DefaultTiddlers: "The tiddlers listed in this shadow tiddler will be automatically displayed when ~TiddlyWiki starts up",
	EditTemplate: "The HTML template in this shadow tiddler determines how tiddlers look while they are being edited",
	GettingStarted: "This shadow tiddler provides basic usage instructions",
	ImportTiddlers: "This shadow tiddler provides access to importing tiddlers",
	MainMenu: "This shadow tiddler is used as the contents of the main menu in the left-hand column of the screen",
	MarkupPreHead: "This tiddler is inserted at the top of the <head> section of the TiddlyWiki HTML file",
	MarkupPostHead: "This tiddler is inserted at the bottom of the <head> section of the TiddlyWiki HTML file",
	MarkupPreBody: "This tiddler is inserted at the top of the <body> section of the TiddlyWiki HTML file",
	MarkupPostBody: "This tiddler is inserted at the end of the <body> section of the TiddlyWiki HTML file immediately after the script block",
	OptionsPanel: "This shadow tiddler is used as the contents of the options panel slider in the right-hand sidebar",
	PageTemplate: "The HTML template in this shadow tiddler determines the overall ~TiddlyWiki layout",
	PluginManager: "This shadow tiddler provides access to the plugin manager",
	SideBarOptions: "This shadow tiddler is used as the contents of the option panel in the right-hand sidebar",
	SideBarTabs: "This shadow tiddler is used as the contents of the tabs panel in the right-hand sidebar",
	SiteSubtitle: "This shadow tiddler is used as the second part of the page title",
	SiteTitle: "This shadow tiddler is used as the first part of the page title",
	SiteUrl: "This shadow tiddler should be set to the full target URL for publication",
	StyleSheetColors: "This shadow tiddler contains CSS definitions related to the color of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",
	StyleSheet: "This tiddler can contain custom CSS definitions",
	StyleSheetLayout: "This shadow tiddler contains CSS definitions related to the layout of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",
	StyleSheetLocale: "This shadow tiddler contains CSS definitions related to the translation locale",
	StyleSheetPrint: "This shadow tiddler contains CSS definitions for printing",
	SystemSettings: "This tiddler is used to store configuration options for this TiddlyWiki document",
	TabAll: "This shadow tiddler contains the contents of the 'All' tab in the right-hand sidebar",
	TabMore: "This shadow tiddler contains the contents of the 'More' tab in the right-hand sidebar",
	TabMoreMissing: "This shadow tiddler contains the contents of the 'Missing' tab in the right-hand sidebar",
	TabMoreOrphans: "This shadow tiddler contains the contents of the 'Orphans' tab in the right-hand sidebar",
	TabMoreShadowed: "This shadow tiddler contains the contents of the 'Shadowed' tab in the right-hand sidebar",
	TabTags: "This shadow tiddler contains the contents of the 'Tags' tab in the right-hand sidebar",
	TabTimeline: "This shadow tiddler contains the contents of the 'Timeline' tab in the right-hand sidebar",
	ToolbarCommands: "This shadow tiddler determines which commands are shown in tiddler toolbars",
	ViewTemplate: "The HTML template in this shadow tiddler determines how tiddlers look"
	});
//--
//-- Main
//--

var params = null; // Command line parameters
var store = null; // TiddlyWiki storage
var story = null; // Main story
var formatter = null; // Default formatters for the wikifier
var anim = typeof Animator == "function" ? new Animator() : null; // Animation engine
var readOnly = false; // Whether we're in readonly mode
var highlightHack = null; // Embarrassing hack department...
var hadConfirmExit = false; // Don't warn more than once
var safeMode = false; // Disable all plugins and cookies
var showBackstage; // Whether to include the backstage area
var installedPlugins = []; // Information filled in when plugins are executed
var startingUp = false; // Whether we're in the process of starting up
var pluginInfo,tiddler; // Used to pass information to plugins in loadPlugins()

// Whether to use the JavaSaver applet
var useJavaSaver = (config.browser.isSafari || config.browser.isOpera) && (document.location.toString().substr(0,4) != "http");

if(!window || !window.console) {
	console = {tiddlywiki:true,log:function(message) {displayMessage(message);}};
}

// Starting up
function main()
{
	var t10,t9,t8,t7,t6,t5,t4,t3,t2,t1,t0 = new Date();
	startingUp = true;
	var doc = jQuery(document);
	jQuery.noConflict();
	window.onbeforeunload = function(e) {if(window.confirmExit) return confirmExit();};
	params = getParameters();
	if(params)
		params = params.parseParams("open",null,false);
	store = new TiddlyWiki({config:config});
	invokeParamifier(params,"oninit");
	story = new Story("tiddlerDisplay","tiddler");
	addEvent(document,"click",Popup.onDocumentClick);
	saveTest();
	var s;
	for(s=0; s<config.notifyTiddlers.length; s++)
		store.addNotification(config.notifyTiddlers[s].name,config.notifyTiddlers[s].notify);
	t1 = new Date();
	loadShadowTiddlers();
	doc.trigger("loadShadows");
	t2 = new Date();
	store.loadFromDiv("storeArea","store",true);
	doc.trigger("loadTiddlers");
	loadOptions();
	t3 = new Date();
	invokeParamifier(params,"onload");
	t4 = new Date();
	readOnly = (window.location.protocol == "file:") ? false : config.options.chkHttpReadOnly;
	var pluginProblem = loadPlugins("systemConfig");
	doc.trigger("loadPlugins");
	t5 = new Date();
	formatter = new Formatter(config.formatters);
	invokeParamifier(params,"onconfig");
	story.switchTheme(config.options.txtTheme);
	showBackstage = showBackstage !== undefined ? showBackstage : !readOnly;
	t6 = new Date();
	var m;
	for(m in config.macros) {
		if(config.macros[m].init)
			config.macros[m].init();
	}
	t7 = new Date();
	store.notifyAll();
	t8 = new Date();
	restart();
	refreshDisplay();
	t9 = new Date();
	if(pluginProblem) {
		story.displayTiddler(null,"PluginManager");
		displayMessage(config.messages.customConfigError);
	}
	if(showBackstage)
		backstage.init();
	t10 = new Date();
	if(config.options.chkDisplayInstrumentation) {
		displayMessage("LoadShadows " + (t2-t1) + " ms");
		displayMessage("LoadFromDiv " + (t3-t2) + " ms");
		displayMessage("LoadPlugins " + (t5-t4) + " ms");
		displayMessage("Macro init " + (t7-t6) + " ms");
		displayMessage("Notify " + (t8-t7) + " ms");
		displayMessage("Restart " + (t9-t8) + " ms");
		displayMessage("Total: " + (t10-t0) + " ms");
	}
	startingUp = false;
	doc.trigger("startup");
}

// Called on unload. All functions called conditionally since they themselves may have been unloaded.
function unload()
{
	if(window.checkUnsavedChanges)
		checkUnsavedChanges();
	if(window.scrubNodes)
		scrubNodes(document.body);
}

// Restarting
function restart()
{
	invokeParamifier(params,"onstart");
	if(story.isEmpty()) {
		story.displayDefaultTiddlers();
	}
	window.scrollTo(0,0);
}

function saveTest()
{
	var s = document.getElementById("saveTest");
	if(s.hasChildNodes())
		alert(config.messages.savedSnapshotError);
	s.appendChild(document.createTextNode("savetest"));
}

function loadShadowTiddlers()
{
	var shadows = new TiddlyWiki();
	shadows.loadFromDiv("shadowArea","shadows",true);
	shadows.forEachTiddler(function(title,tiddler){config.shadowTiddlers[title] = tiddler.text;});
}

function loadPlugins(tag)
{
	if(safeMode)
		return false;
	var tiddlers = store.getTaggedTiddlers(tag);
	tiddlers.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : 1);});
	var toLoad = [];
	var nLoaded = 0;
	var map = {};
	var nPlugins = tiddlers.length;
	installedPlugins = [];
	var i;
	for(i=0; i<nPlugins; i++) {
		var p = getPluginInfo(tiddlers[i]);
		installedPlugins[i] = p;
		var n = p.Name || p.title;
		if(n)
			map[n] = p;
		n = p.Source;
		if(n)
			map[n] = p;
	}
	var visit = function(p) {
		if(!p || p.done)
			return;
		p.done = 1;
		var reqs = p.Requires;
		if(reqs) {
			reqs = reqs.readBracketedList();
			var i;
			for(i=0; i<reqs.length; i++)
				visit(map[reqs[i]]);
		}
		toLoad.push(p);
	};
	for(i=0; i<nPlugins; i++)
		visit(installedPlugins[i]);
	for(i=0; i<toLoad.length; i++) {
		p = toLoad[i];
		pluginInfo = p;
		tiddler = p.tiddler;
		if(isPluginExecutable(p)) {
			if(isPluginEnabled(p)) {
				p.executed = true;
				var startTime = new Date();
				try {
					if(tiddler.text)
						window.eval(tiddler.text);
					nLoaded++;
				} catch(ex) {
					p.log.push(config.messages.pluginError.format([exceptionText(ex)]));
					p.error = true;
					if(!console.tiddlywiki) {
						console.log("error evaluating " + tiddler.title, ex);
					}
				}
				pluginInfo.startupTime = String((new Date()) - startTime) + "ms";
			} else {
				nPlugins--;
			}
		} else {
			p.warning = true;
		}
	}
	return nLoaded != nPlugins;
}

function getPluginInfo(tiddler)
{
	var p = store.getTiddlerSlices(tiddler.title,["Name","Description","Version","Requires","CoreVersion","Date","Source","Author","License","Browsers"]);
	p.tiddler = tiddler;
	p.title = tiddler.title;
	p.log = [];
	return p;
}

// Check that a particular plugin is valid for execution
function isPluginExecutable(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigForce")) {
		plugin.log.push(config.messages.pluginForced);
		return true;
	}
	if(plugin["CoreVersion"]) {
		var coreVersion = plugin["CoreVersion"].split(".");
		var w = parseInt(coreVersion[0],10) - version.major;
		if(w == 0 && coreVersion[1])
			w = parseInt(coreVersion[1],10) - version.minor;
		if(w == 0 && coreVersion[2])
			w = parseInt(coreVersion[2],10) - version.revision;
		if(w > 0) {
			plugin.log.push(config.messages.pluginVersionError);
			return false;
		}
	}
	return true;
}

function isPluginEnabled(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigDisable")) {
		plugin.log.push(config.messages.pluginDisabled);
		return false;
	}
	return true;
}

//--
//-- Paramifiers
//--

function getParameters()
{
	var p = null;
	if(window.location.hash) {
		p = decodeURIComponent(window.location.hash.substr(1));
		if(config.browser.firefoxDate != null && config.browser.firefoxDate[1] < "20051111")
			p = convertUTF8ToUnicode(p);
	}
	return p;
}

function invokeParamifier(params,handler)
{
	if(!params || params.length == undefined || params.length <= 1)
		return;
	var i;
	for(i=1; i<params.length; i++) {
		var p = config.paramifiers[params[i].name];
		if(p && p[handler] instanceof Function)
			p[handler](params[i].value);
		else {
			var h = config.optionHandlers[params[i].name.substr(0,3)];
			if(h && h.set instanceof Function)
				h.set(params[i].name,params[i].value);
		}
	}
}

config.paramifiers = {};

config.paramifiers.start = {
	oninit: function(v) {
		safeMode = v.toLowerCase() == "safe";
	}
};

config.paramifiers.open = {
	onstart: function(v) {
		if(!readOnly || store.tiddlerExists(v) || store.isShadowTiddler(v))
			story.displayTiddler("bottom",v,null,false,null);
	}
};

config.paramifiers.story = {
	onstart: function(v) {
		var list = store.getTiddlerText(v,"").parseParams("open",null,false);
		invokeParamifier(list,"onstart");
	}
};

config.paramifiers.search = {
	onstart: function(v) {
		story.search(v,false,false);
	}
};

config.paramifiers.searchRegExp = {
	onstart: function(v) {
		story.prototype.search(v,false,true);
	}
};

config.paramifiers.tag = {
	onstart: function(v) {
		story.displayTiddlers(null,store.filterTiddlers("[tag["+v+"]]"),null,false,null);
	}
};

config.paramifiers.newTiddler = {
	onstart: function(v) {
		var args = v.parseParams("anon", null, null)[0];
		var title = args.title ? args.title[0] : v;
		var customFields = args.fields ? args.fields[0] : null;
		if(!readOnly) {
			story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE,false,null,customFields);
			story.focusTiddler(title,"text");
			var i,tags = args.tag || [];
			for(i=0;i<tags.length;i++) {
				story.setTiddlerTag(title,tags[i],+1);
			}
		}
	}
};

config.paramifiers.newJournal = {
	onstart: function(v) {
		if(!readOnly) {
			var now = new Date();
			var title = now.formatString(v.trim());
			story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(title,"text");
		}
	}
};

config.paramifiers.readOnly = {
	onconfig: function(v) {
		var p = v.toLowerCase();
		readOnly = p == "yes" ? true : (p == "no" ? false : readOnly);
	}
};

config.paramifiers.theme = {
	onconfig: function(v) {
		story.switchTheme(v);
	}
};

config.paramifiers.upgrade = {
	onstart: function(v) {
		upgradeFrom(v);
	}
};

config.paramifiers.recent= {
	onstart: function(v) {
		var titles=[];
		var i,tiddlers=store.getTiddlers("modified","excludeLists").reverse();
		for(i=0; i<v && i<tiddlers.length; i++)
			titles.push(tiddlers[i].title);
		story.displayTiddlers(null,titles);
	}
};

config.paramifiers.filter = {
	onstart: function(v) {
		story.displayTiddlers(null,store.filterTiddlers(v),null,false);
	}
};

//--
//-- Formatter helpers
//--

function Formatter(formatters)
{
	var n;
	this.formatters = [];
	var pattern = [];
	for(n=0; n<formatters.length; n++) {
		pattern.push("(" + formatters[n].match + ")");
		this.formatters.push(formatters[n]);
	}
	this.formatterRegExp = new RegExp(pattern.join("|"),"mg");
}

config.formatterHelpers = {

	createElementAndWikify: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,this.element),this.termRegExp);
	},

	inlineCssHelper: function(w)
	{
		var styles = [];
		config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var s,v;
			if(lookaheadMatch[1]) {
				s = lookaheadMatch[1].unDash();
				v = lookaheadMatch[2];
			} else {
				s = lookaheadMatch[3].unDash();
				v = lookaheadMatch[4];
			}
			if(s=="bgcolor")
				s = "backgroundColor";
			if(s=="float")
				s = "cssFloat";
			styles.push({style: s, value: v});
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		}
		return styles;
	},

	applyCssHelper: function(e,styles)
	{
		var t;
		for(t=0; t< styles.length; t++) {
			try {
				e.style[styles[t].style] = styles[t].value;
			} catch (ex) {
			}
		}
	},

	enclosedTextHelper: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var text = lookaheadMatch[1];
			if(config.browser.isIE)
				text = text.replace(/\n/g,"\r");
			createTiddlyElement(w.output,this.element,null,null,text);
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
		}
	},

	isExternalLink: function(link)
	{
		if(store.tiddlerExists(link) || store.isShadowTiddler(link)) {
			return false;
		}
		var urlRegExp = new RegExp(config.textPrimitives.urlPattern,"mg");
		if(urlRegExp.exec(link)) {
			return true;
		}
		if(link.indexOf(".")!=-1 || link.indexOf("\\")!=-1 || link.indexOf("/")!=-1 || link.indexOf("#")!=-1) {
			return true;
		}
		return false;
	}

};

//--
//-- Standard formatters
//--

config.formatters = [
{
	name: "table",
	match: "^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",
	lookaheadRegExp: /^\|([^\n]*)\|([fhck]?)$/mg,
	rowTermRegExp: /(\|(?:[fhck]?)$\n?)/mg,
	cellRegExp: /(?:\|([^\n\|]*)\|)|(\|[fhck]?$\n?)/mg,
	cellTermRegExp: /((?:\x20*)\|)/mg,
	rowTypes: {"c":"caption", "h":"thead", "":"tbody", "f":"tfoot"},
	handler: function(w)
	{
		var table = createTiddlyElement(w.output,"table",null,"twtable");
		var prevColumns = [];
		var currRowType = null;
		var rowContainer;
		var rowCount = 0;
		var onmouseover = function() {jQuery(this).addClass("hoverRow");};
		var onmouseout = function() {jQuery(this).removeClass("hoverRow");};
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var nextRowType = lookaheadMatch[2];
			if(nextRowType == "k") {
				table.className = lookaheadMatch[1];
				w.nextMatch += lookaheadMatch[0].length+1;
			} else {
				if(nextRowType != currRowType) {
					rowContainer = createTiddlyElement(table,this.rowTypes[nextRowType]);
					currRowType = nextRowType;
				}
				if(currRowType == "c") {
					// Caption
					w.nextMatch++;
					if(rowContainer != table.firstChild)
						table.insertBefore(rowContainer,table.firstChild);
					rowContainer.setAttribute("align",rowCount == 0?"top":"bottom");
					w.subWikifyTerm(rowContainer,this.rowTermRegExp);
				} else {
					var theRow = createTiddlyElement(rowContainer,"tr",null,rowCount%2?"oddRow":"evenRow");
					theRow.onmouseover = onmouseover;
					theRow.onmouseout = onmouseout;
					this.rowHandler(w,theRow,prevColumns);
					rowCount++;
				}
			}
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	},
	rowHandler: function(w,e,prevColumns)
	{
		var col = 0;
		var colSpanCount = 1;
		var prevCell = null;
		this.cellRegExp.lastIndex = w.nextMatch;
		var cellMatch = this.cellRegExp.exec(w.source);
		while(cellMatch && cellMatch.index == w.nextMatch) {
			if(cellMatch[1] == "~") {
				// Rowspan
				var last = prevColumns[col];
				if(last) {
					last.rowSpanCount++;
					last.element.setAttribute("rowspan",last.rowSpanCount);
					last.element.setAttribute("rowSpan",last.rowSpanCount); // Needed for IE
					last.element.valign = "center";
					if(colSpanCount > 1) {
						last.element.setAttribute("colspan",colSpanCount);
						last.element.setAttribute("colSpan",colSpanCount); // Needed for IE
						colSpanCount = 1;
					}
				}
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if(cellMatch[1] == ">") {
				// Colspan
				colSpanCount++;
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if(cellMatch[2]) {
				// End of row
				if(prevCell && colSpanCount > 1) {
					prevCell.setAttribute("colspan",colSpanCount);
					prevCell.setAttribute("colSpan",colSpanCount); // Needed for IE
				}
				w.nextMatch = this.cellRegExp.lastIndex;
				break;
			} else {
				// Cell
				w.nextMatch++;
				var styles = config.formatterHelpers.inlineCssHelper(w);
				var spaceLeft = false;
				var chr = w.source.substr(w.nextMatch,1);
				while(chr == " ") {
					spaceLeft = true;
					w.nextMatch++;
					chr = w.source.substr(w.nextMatch,1);
				}
				var cell;
				if(chr == "!") {
					cell = createTiddlyElement(e,"th");
					w.nextMatch++;
				} else {
					cell = createTiddlyElement(e,"td");
				}
				prevCell = cell;
				prevColumns[col] = {rowSpanCount:1,element:cell};
				if(colSpanCount > 1) {
					cell.setAttribute("colspan",colSpanCount);
					cell.setAttribute("colSpan",colSpanCount); // Needed for IE
					colSpanCount = 1;
				}
				config.formatterHelpers.applyCssHelper(cell,styles);
				w.subWikifyTerm(cell,this.cellTermRegExp);
				if(w.matchText.substr(w.matchText.length-2,1) == " ") // spaceRight
					cell.align = spaceLeft ? "center" : "left";
				else if(spaceLeft)
					cell.align = "right";
				w.nextMatch--;
			}
			col++;
			this.cellRegExp.lastIndex = w.nextMatch;
			cellMatch = this.cellRegExp.exec(w.source);
		}
	}
},

{
	name: "heading",
	match: "^!{1,6}",
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,"h" + w.matchLength),this.termRegExp);
	}
},

{
	name: "list",
	match: "^(?:[\\*#;:]+)",
	lookaheadRegExp: /^(?:(?:(\*)|(#)|(;)|(:))+)/mg,
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0, currType = null;
		var listLevel, listType, itemType, baseType;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			if(lookaheadMatch[1]) {
				listType = "ul";
				itemType = "li";
			} else if(lookaheadMatch[2]) {
				listType = "ol";
				itemType = "li";
			} else if(lookaheadMatch[3]) {
				listType = "dl";
				itemType = "dt";
			} else if(lookaheadMatch[4]) {
				listType = "dl";
				itemType = "dd";
			}
			if(!baseType)
				baseType = listType;
			listLevel = lookaheadMatch[0].length;
			w.nextMatch += lookaheadMatch[0].length;
			var t;
			if(listLevel > currLevel) {
				for(t=currLevel; t<listLevel; t++) {
					var target = (currLevel == 0) ? stack[stack.length-1] : stack[stack.length-1].lastChild;
					stack.push(createTiddlyElement(target,listType));
				}
			} else if(listType!=baseType && listLevel==1) {
				w.nextMatch -= lookaheadMatch[0].length;
				return;
			} else if(listLevel < currLevel) {
				for(t=currLevel; t>listLevel; t--)
					stack.pop();
			} else if(listLevel == currLevel && listType != currType) {
				stack.pop();
				stack.push(createTiddlyElement(stack[stack.length-1].lastChild,listType));
			}
			currLevel = listLevel;
			currType = listType;
			var e = createTiddlyElement(stack[stack.length-1],itemType);
			w.subWikifyTerm(e,this.termRegExp);
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	}
},

{
	name: "quoteByBlock",
	match: "^<<<\\n",
	termRegExp: /(^<<<(\n|$))/mg,
	element: "blockquote",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "quoteByLine",
	match: "^>+",
	lookaheadRegExp: /^>+/mg,
	termRegExp: /(\n)/mg,
	element: "blockquote",
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0;
		var newLevel = w.matchLength;
		var t,matched;
		do {
			if(newLevel > currLevel) {
				for(t=currLevel; t<newLevel; t++)
					stack.push(createTiddlyElement(stack[stack.length-1],this.element));
			} else if(newLevel < currLevel) {
				for(t=currLevel; t>newLevel; t--)
					stack.pop();
			}
			currLevel = newLevel;
			w.subWikifyTerm(stack[stack.length-1],this.termRegExp);
			createTiddlyElement(stack[stack.length-1],"br");
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
			if(matched) {
				newLevel = lookaheadMatch[0].length;
				w.nextMatch += lookaheadMatch[0].length;
			}
		} while(matched);
	}
},

{
	name: "rule",
	match: "^----+$\\n?|<hr ?/?>\\n?",
	handler: function(w)
	{
		createTiddlyElement(w.output,"hr");
	}
},

{
	name: "monospacedByLine",
	match: "^(?:/\\*\\{\\{\\{\\*/|\\{\\{\\{|//\\{\\{\\{|<!--\\{\\{\\{-->)\\n",
	element: "pre",
	handler: function(w)
	{
		switch(w.matchText) {
		case "/*{{{*/\n": // CSS
			this.lookaheadRegExp = /\/\*\{\{\{\*\/\n*((?:^[^\n]*\n)+?)(\n*^\f*\/\*\}\}\}\*\/$\n?)/mg;
			break;
		case "{{{\n": // monospaced block
			this.lookaheadRegExp = /^\{\{\{\n((?:^[^\n]*\n)+?)(^\f*\}\}\}$\n?)/mg;
			break;
		case "//{{{\n": // plugin
			this.lookaheadRegExp = /^\/\/\{\{\{\n\n*((?:^[^\n]*\n)+?)(\n*^\f*\/\/\}\}\}$\n?)/mg;
			break;
		case "<!--{{{-->\n": //template
			this.lookaheadRegExp = /<!--\{\{\{-->\n*((?:^[^\n]*\n)+?)(\n*^\f*<!--\}\}\}-->$\n?)/mg;
			break;
		default:
			break;
		}
		config.formatterHelpers.enclosedTextHelper.call(this,w);
	}
},

{
	name: "wikifyComment",
	match: "^(?:/\\*\\*\\*|<!---)\\n",
	handler: function(w)
	{
		var termRegExp = (w.matchText == "/***\n") ? (/(^\*\*\*\/\n)/mg) : (/(^--->\n)/mg);
		w.subWikifyTerm(w.output,termRegExp);
	}
},

{
	name: "macro",
	match: "<<",
	lookaheadRegExp: /<<([^>\s]+)(?:\s*)((?:[^>]|(?:>(?!>)))*)>>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[1]) {
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			invokeMacro(w.output,lookaheadMatch[1],lookaheadMatch[2],w,w.tiddler);
		}
	}
},

{
	name: "prettyLink",
	match: "\\[\\[",
	lookaheadRegExp: /\[\[(.*?)(?:\|(~)?(.*?))?\]\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e;
			var text = lookaheadMatch[1];
			if(lookaheadMatch[3]) {
				// Pretty bracketted link
				var link = lookaheadMatch[3];
				e = (!lookaheadMatch[2] && config.formatterHelpers.isExternalLink(link)) ?
						createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);
			} else {
				// Simple bracketted link
				e = createTiddlyLink(w.output,text,false,null,w.isStatic,w.tiddler);
			}
			createTiddlyText(e,text);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "wikiLink",
	match: config.textPrimitives.unWikiLink+"?"+config.textPrimitives.wikiLink,
	handler: function(w)
	{
		if(w.matchText.substr(0,1) == config.textPrimitives.unWikiLink) {
			w.outputText(w.output,w.matchStart+1,w.nextMatch);
			return;
		}
		if(w.matchStart > 0) {
			var preRegExp = new RegExp(config.textPrimitives.anyLetterStrict,"mg");
			preRegExp.lastIndex = w.matchStart-1;
			var preMatch = preRegExp.exec(w.source);
			if(preMatch.index == w.matchStart-1) {
				w.outputText(w.output,w.matchStart,w.nextMatch);
				return;
			}
		}
		if(w.autoLinkWikiWords || store.isShadowTiddler(w.matchText)) {
			var link = createTiddlyLink(w.output,w.matchText,false,null,w.isStatic,w.tiddler);
			w.outputText(link,w.matchStart,w.nextMatch);
		} else {
			w.outputText(w.output,w.matchStart,w.nextMatch);
		}
	}
},

{
	name: "urlLink",
	match: config.textPrimitives.urlPattern,
	handler: function(w)
	{
		w.outputText(createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch);
	}
},

{
	name: "image",
	match: "\\[[<>]?[Ii][Mm][Gg]\\[",
	lookaheadRegExp: /\[([<]?)(>?)[Ii][Mm][Gg]\[(?:([^\|\]]+)\|)?([^\[\]\|]+)\](?:\[([^\]]*)\])?\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e = w.output;
			if(lookaheadMatch[5]) {
				var link = lookaheadMatch[5];
				e = config.formatterHelpers.isExternalLink(link) ? createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);
				jQuery(e).addClass("imageLink");
			}
			var img = createTiddlyElement(e,"img");
			if(lookaheadMatch[1])
				img.align = "left";
			else if(lookaheadMatch[2])
				img.align = "right";
			if(lookaheadMatch[3]) {
				img.title = lookaheadMatch[3];
				img.setAttribute("alt",lookaheadMatch[3]);
			}
			img.src = lookaheadMatch[4];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "html",
	match: "<[Hh][Tt][Mm][Ll]>",
	lookaheadRegExp: /<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span").innerHTML = lookaheadMatch[1];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "commentByBlock",
	match: "/%",
	lookaheadRegExp: /\/%((?:.|\n)*?)%\//mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			w.nextMatch = this.lookaheadRegExp.lastIndex;
	}
},

{
	name: "characterFormat",
	match: "''|//|__|\\^\\^|~~|--(?!\\s|$)|\\{\\{\\{",
	handler: function(w)
	{
		switch(w.matchText) {
		case "''":
			w.subWikifyTerm(w.output.appendChild(document.createElement("strong")),/('')/mg);
			break;
		case "//":
			w.subWikifyTerm(createTiddlyElement(w.output,"em"),/(\/\/)/mg);
			break;
		case "__":
			w.subWikifyTerm(createTiddlyElement(w.output,"u"),/(__)/mg);
			break;
		case "^^":
			w.subWikifyTerm(createTiddlyElement(w.output,"sup"),/(\^\^)/mg);
			break;
		case "~~":
			w.subWikifyTerm(createTiddlyElement(w.output,"sub"),/(~~)/mg);
			break;
		case "--":
			w.subWikifyTerm(createTiddlyElement(w.output,"strike"),/(--)/mg);
			break;
		case "{{{":
			var lookaheadRegExp = /\{\{\{((?:.|\n)*?)\}\}\}/mg;
			lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
				createTiddlyElement(w.output,"code",null,null,lookaheadMatch[1]);
				w.nextMatch = lookaheadRegExp.lastIndex;
			}
			break;
		}
	}
},

{
	name: "customFormat",
	match: "@@|\\{\\{",
	handler: function(w)
	{
		switch(w.matchText) {
		case "@@":
			var e = createTiddlyElement(w.output,"span");
			var styles = config.formatterHelpers.inlineCssHelper(w);
			if(styles.length == 0)
				e.className = "marked";
			else
				config.formatterHelpers.applyCssHelper(e,styles);
			w.subWikifyTerm(e,/(@@)/mg);
			break;
		case "{{":
			var lookaheadRegExp = /\{\{[\s]*([\w]+[\s\w]*)[\s]*\{(\n?)/mg;
			lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			if(lookaheadMatch) {
				w.nextMatch = lookaheadRegExp.lastIndex;
				e = createTiddlyElement(w.output,lookaheadMatch[2] == "\n" ? "div" : "span",null,lookaheadMatch[1]);
				w.subWikifyTerm(e,/(\}\}\})/mg);
			}
			break;
		}
	}
},

{
	name: "mdash",
	match: "--",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = "&mdash;";
	}
},

{
	name: "lineBreak",
	match: "\\n|<br ?/?>",
	handler: function(w)
	{
		createTiddlyElement(w.output,"br");
	}
},

{
	name: "rawText",
	match: "\"{3}|<nowiki>",
	lookaheadRegExp: /(?:\"{3}|<nowiki>)((?:.|\n)*?)(?:\"{3}|<\/nowiki>)/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span",null,null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "htmlEntitiesEncoding",
	match: "(?:(?:&#?[a-zA-Z0-9]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[a-zA-Z0-9]{2,8};)",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = w.matchText;
	}
}

];

//--
//-- Wikifier
//--

function getParser(tiddler,format)
{
	if(tiddler) {
		if(!format)
			format = tiddler.fields["wikiformat"];
		var i;
		if(format) {
			for(i in config.parsers) {
				if(format == config.parsers[i].format)
					return config.parsers[i];
			}
		} else {
			for(i in config.parsers) {
				if(tiddler.isTagged(config.parsers[i].formatTag))
					return config.parsers[i];
			}
		}
	}
	return formatter;
}

function Wikifier(source,formatter,highlightRegExp,tiddler)
{
	this.source = source;
	this.output = null;
	this.formatter = formatter;
	this.nextMatch = 0;
	this.autoLinkWikiWords = tiddler && tiddler.autoLinkWikiWords() == false ? false : true;
	this.highlightRegExp = highlightRegExp;
	this.highlightMatch = null;
	this.isStatic = false;
	if(highlightRegExp) {
		highlightRegExp.lastIndex = 0;
		this.highlightMatch = highlightRegExp.exec(source);
	}
	this.tiddler = tiddler;
}

Wikifier.prototype.wikifyPlain = function()
{
	var e = createTiddlyElement(document.body,"div");
	e.style.display = "none";
	this.subWikify(e);
	var text = jQuery(e).text();
	jQuery(e).remove();
	return text;
};

Wikifier.prototype.subWikify = function(output,terminator)
{
	try {
		if(terminator)
			this.subWikifyTerm(output,new RegExp("(" + terminator + ")","mg"));
		else
			this.subWikifyUnterm(output);
	} catch(ex) {
		showException(ex);
	}
};

Wikifier.prototype.subWikifyUnterm = function(output)
{
	var oldOutput = this.output;
	this.output = output;
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	while(formatterMatch) {
		// Output any text before the match
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		// Set the match parameters for the handler
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		var t;
		for(t=1; t<formatterMatch.length; t++) {
			if(formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.subWikifyTerm = function(output,terminatorRegExp)
{
	var oldOutput = this.output;
	this.output = output;
	terminatorRegExp.lastIndex = this.nextMatch;
	var terminatorMatch = terminatorRegExp.exec(this.source);
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	while(terminatorMatch || formatterMatch) {
		if(terminatorMatch && (!formatterMatch || terminatorMatch.index <= formatterMatch.index)) {
			if(terminatorMatch.index > this.nextMatch)
				this.outputText(this.output,this.nextMatch,terminatorMatch.index);
			this.matchText = terminatorMatch[1];
			this.matchLength = terminatorMatch[1].length;
			this.matchStart = terminatorMatch.index;
			this.nextMatch = this.matchStart + this.matchLength;
			this.output = oldOutput;
			return;
		}
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		var t;
		for(t=1; t<formatterMatch.length; t++) {
			if(formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		terminatorRegExp.lastIndex = this.nextMatch;
		terminatorMatch = terminatorRegExp.exec(this.source);
		formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.outputText = function(place,startPos,endPos)
{
	while(this.highlightMatch && (this.highlightRegExp.lastIndex > startPos) && (this.highlightMatch.index < endPos) && (startPos < endPos)) {
		if(this.highlightMatch.index > startPos) {
			createTiddlyText(place,this.source.substring(startPos,this.highlightMatch.index));
			startPos = this.highlightMatch.index;
		}
		var highlightEnd = Math.min(this.highlightRegExp.lastIndex,endPos);
		createTiddlyElement(place,"span",null,"highlight",this.source.substring(startPos,highlightEnd));
		startPos = highlightEnd;
		if(startPos >= this.highlightRegExp.lastIndex)
			this.highlightMatch = this.highlightRegExp.exec(this.source);
	}
	if(startPos < endPos) {
		createTiddlyText(place,this.source.substring(startPos,endPos));
	}
};

function wikify(source,output,highlightRegExp,tiddler)
{
	if(source) {
		var wikifier = new Wikifier(source,getParser(tiddler),highlightRegExp,tiddler);
		var t0 = new Date();
		wikifier.subWikify(output);
		if(tiddler && config.options.chkDisplayInstrumentation)
			displayMessage("wikify:" +tiddler.title+ " in " + (new Date()-t0) + " ms");
	}
}

function wikifyStatic(source,highlightRegExp,tiddler,format)
{
	var e = createTiddlyElement(document.body,"pre");
	e.style.display = "none";
	var html = "";
	if(source && source != "") {
		if(!tiddler)
			tiddler = new Tiddler("temp");
		var wikifier = new Wikifier(source,getParser(tiddler,format),highlightRegExp,tiddler);
		wikifier.isStatic = true;
		wikifier.subWikify(e);
		html = e.innerHTML;
		jQuery(e).remove();
	}
	return html;
}

function wikifyPlainText(text,limit,tiddler)
{
	if(limit > 0)
		text = text.substr(0,limit);
	var wikifier = new Wikifier(text,formatter,null,tiddler);
	return wikifier.wikifyPlain();
}

function highlightify(source,output,highlightRegExp,tiddler)
{
	if(source) {
		var wikifier = new Wikifier(source,formatter,highlightRegExp,tiddler);
		wikifier.outputText(output,0,source.length);
	}
}

//--
//-- Macro definitions
//--

function invokeMacro(place,macro,params,wikifier,tiddler)
{
	try {
		var m = config.macros[macro];
		if(m && m.handler) {
			var tiddlerElem = story.findContainingTiddler(place);
			window.tiddler = tiddlerElem ? store.getTiddler(tiddlerElem.getAttribute("tiddler")) : null;
			window.place = place;
			var allowEval = true;
			if(config.evaluateMacroParameters=="system") {
				if(!tiddler || tiddler.tags.indexOf("systemAllowEval") == -1) {
					allowEval = false;
				}
			}
			m.handler(place,macro,m.noPreParse?null:params.readMacroParams(!allowEval),wikifier,params,tiddler);
		} else {
			createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,config.messages.missingMacro]));
		}
	} catch(ex) {
		createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,ex.toString()]));
	}
}

config.macros.version.handler = function(place)
{
	jQuery("<span/>").text(formatVersion()).appendTo(place);
};

config.macros.today.handler = function(place,macroName,params)
{
	var now = new Date();
	var text = params[0] ? now.formatString(params[0].trim()) : now.toLocaleString();
	jQuery("<span/>").text(text).appendTo(place);
};

config.macros.list.template = "<<view title link>>";
config.macros.list.handler = function(place,macroName,params,wikifier,paramString)
{
	var list = document.createElement("ul");
	jQuery(list).attr({ refresh: "macro", macroName: macroName }).data("params", paramString);
	place.appendChild(list);
	this.refresh(list);
};

config.macros.list.refresh = function(list) {
	var paramString = jQuery(list).data("params");
	var params = paramString.readMacroParams();
	var args = paramString.parseParams("anon", null, null)[0];
	var type = args.anon ? args.anon[0] : "all";
	jQuery(list).empty().addClass("list list-" + type);
	var template = args.template ? store.getTiddlerText(args.template[0]) : false;
	if(!template) {
		template = config.macros.list.template;
	}
	if(this[type].prompt)
		createTiddlyElement(list,"li",null,"listTitle",this[type].prompt);
	var results;
	if(this[type].handler)
		results = this[type].handler(params);
	var t;
	for(t = 0; t < results.length; t++) {
		var li = document.createElement("li");
		list.appendChild(li);
		var tiddler = results[t];
		if(typeof(tiddler) == 'string') { // deal with missing etc..
				tiddler = store.getTiddler(tiddler) || new Tiddler(tiddler);
		}
		wikify(template, li, null, tiddler);
	}
	if(results.length === 0 && args.emptyMessage) {
		jQuery(list).addClass("emptyList");
		jQuery("<li />").text(args.emptyMessage[0]).appendTo(list);
	}
};

config.macros.list.all.handler = function(params)
{
	return store.reverseLookup("tags","excludeLists",false,"title");
};

config.macros.list.missing.handler = function(params)
{
	return store.getMissingLinks();
};

config.macros.list.orphans.handler = function(params)
{
	return store.getOrphans();
};

config.macros.list.shadowed.handler = function(params)
{
	return store.getShadowed();
};

config.macros.list.touched.handler = function(params)
{
	return store.getTouched();
};

config.macros.list.filter.handler = function(params)
{
	var filter = params[1];
	var results = [];
	if(filter) {
		var tiddlers = store.filterTiddlers(filter);
		var t;
		for(t=0; t<tiddlers.length; t++)
			results.push(tiddlers[t].title);
	}
	return results;
};

config.macros.allTags.handler = function(place,macroName,params)
{
	var tags = store.getTags(params[0]);
	var ul = createTiddlyElement(place,"ul");
	if(tags.length == 0)
		createTiddlyElement(ul,"li",null,"listTitle",this.noTags);
	var t;
	for(t=0; t<tags.length; t++) {
		var title = tags[t][0];
		var info = getTiddlyLinkInfo(title);
		var li = createTiddlyElement(ul,"li");
		var btn = createTiddlyButton(li,title + " (" + tags[t][1] + ")",this.tooltip.format([title]),onClickTag,info.classes);
		btn.setAttribute("tag",title);
		btn.setAttribute("refresh","link");
		btn.setAttribute("tiddlyLink",title);
		if(params[1]) {
			btn.setAttribute("sortby",params[1]);
		}
	}
};

var macro = config.macros.timeline;
merge(macro, {
	handler: function(place,macroName,params, wikifier, paramString, tiddler) {
		var container = jQuery("<div />").attr("params", paramString).
			attr("macroName", macroName).appendTo(place)[0];
		macro.refresh(container);
	},
	refresh: function(container) {
		jQuery(container).attr("refresh", "macro").empty();
		var paramString = jQuery(container).attr("params");
		var args = paramString.parseParams("anon", null, null)[0];
		var params = args.anon || [];

		var field = params[0] || "modified";
		var dateFormat = params[2] || this.dateFormat;
		var groupTemplate = macro.groupTemplate.format(field, dateFormat);
		groupTemplate = args.groupTemplate ? store.getTiddlerText(args.groupTemplate[0]) || groupTemplate :
			groupTemplate;

		var itemTemplate = macro.itemTemplate;
		itemTemplate = args.template ? store.getTiddlerText(args.template[0]) || itemTemplate :
			itemTemplate;

		var tiddlers = args.filter ? store.sortTiddlers(store.filterTiddlers(args.filter[0]), field) :
			store.reverseLookup("tags", "excludeLists", false, field);
		var lastGroup = "", ul;
		var last = params[1] ? tiddlers.length-Math.min(tiddlers.length,parseInt(params[1],10)) : 0;
		var t;
		for(t=tiddlers.length-1; t>=last; t--) {
			var tiddler = tiddlers[t];
			var theGroup = wikifyPlainText(groupTemplate,0,tiddler);
			if(typeof(ul) == "undefined" || theGroup != lastGroup) {
				ul = document.createElement("ul");
				jQuery(ul).addClass("timeline");
				container.appendChild(ul);
				createTiddlyElement(ul,"li",null,"listTitle",theGroup);
				lastGroup = theGroup;
			}
			var item = createTiddlyElement(ul,"li",null,"listLink");
			wikify(itemTemplate,item,null,tiddler);
		}
	},
	groupTemplate: "<<view %0 date '%1'>>", 
	itemTemplate: "<<view title link>>"
});

config.macros.tiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var allowEval = true;
	var stack = config.macros.tiddler.tiddlerStack;
	if(stack.length > 0 && config.evaluateMacroParameters == "system") {
		// included tiddler and "system" evaluation required, so check tiddler tagged appropriately
		var title = stack[stack.length-1];
		var pos = title.indexOf(config.textPrimitives.sectionSeparator);
		if(pos != -1) {
			title = title.substr(0,pos); // get the base tiddler title
		}
		var t = store.getTiddler(title);
		if(!t || t.tags.indexOf("systemAllowEval") == -1) {
			allowEval = false;
		}
	}
	params = paramString.parseParams("name",null,allowEval,false,true);
	var names = params[0]["name"];
	var tiddlerName = names[0];
	var className = names[1] || null;
	var args = params[0]["with"];
	var wrapper = createTiddlyElement(place,"span",null,className,null,{
		refresh: "content", tiddler: tiddlerName
	});
	if(args!==undefined)
		wrapper.setAttribute("args","[["+args.join("]] [[")+"]]");
	this.transclude(wrapper,tiddlerName,args);
};

config.macros.tiddler.transclude = function(wrapper,tiddlerName,args)
{
	var text = store.getTiddlerText(tiddlerName);
	if(!text)
		return;
	var stack = config.macros.tiddler.tiddlerStack;
	if(stack.indexOf(tiddlerName) !== -1)
		return;
	stack.push(tiddlerName);
	try {
		if(typeof args == "string")
			args = args.readBracketedList();
		var n = args ? Math.min(args.length,9) : 0;
		var i;
		for(i=0; i<n; i++) {
			var placeholderRE = new RegExp("\\$" + (i + 1),"mg");
			text = text.replace(placeholderRE,args[i]);
		}
		config.macros.tiddler.renderText(wrapper,text,tiddlerName);
	} finally {
		stack.pop();
	}
};

config.macros.tiddler.renderText = function(place,text,tiddlerName)
{
	wikify(text,place,null,store.getTiddler(tiddlerName));
};

config.macros.tiddler.tiddlerStack = [];

config.macros.tag.handler = function(place,macroName,params)
{
	var btn = createTagButton(place,params[0],null,params[1],params[2]);
	if(params[3]) {
		btn.setAttribute('sortby',params[3]);
	}
};

config.macros.tags.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var ul = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title && store.tiddlerExists(title))
		tiddler = store.getTiddler(title);
	var sep = getParam(params,"sep"," ");
	var lingo = config.views.wikified.tag;
	var label = null;
	var t;
	for(t=0; t<tiddler.tags.length; t++) {
		var tag = store.getTiddler(tiddler.tags[t]);
		if(!tag || !tag.tags.contains("excludeLists")) {
			if(!label)
				label = createTiddlyElement(ul,"li",null,"listTitle",lingo.labelTags.format([tiddler.title]));
			createTagButton(createTiddlyElement(ul,"li"),tiddler.tags[t],tiddler.title);
			if(t<tiddler.tags.length-1)
				createTiddlyText(ul,sep);
		}
	}
	if(!label)
		createTiddlyElement(ul,"li",null,"listTitle",lingo.labelNoTags.format([tiddler.title]));
};

config.macros.tagging.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var ul = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title == "" && tiddler instanceof Tiddler)
		title = tiddler.title;
	var sep = getParam(params,"sep"," ");
	ul.setAttribute("title",this.tooltip.format([title]));
	var sortby = getParam(params,"sortBy",false);
	var tagged = store.getTaggedTiddlers(title,sortby);
	var prompt = tagged.length == 0 ? this.labelNotTag : this.label;
	createTiddlyElement(ul,"li",null,"listTitle",prompt.format([title,tagged.length]));
	var t;
	for(t=0; t<tagged.length; t++) {
		createTiddlyLink(createTiddlyElement(ul,"li"),tagged[t].title,true);
		if(t<tagged.length-1)
			createTiddlyText(ul,sep);
	}
};

config.macros.closeAll.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.closeAll.onClick = function(e)
{
	story.closeAllTiddlers();
	return false;
};

config.macros.permaview.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.permaview.onClick = function(e)
{
	story.permaView();
	return false;
};

config.macros.saveChanges.handler = function(place,macroName,params)
{
	if(!readOnly)
		createTiddlyButton(place,params[0] || this.label,params[1] || this.prompt,this.onClick,null,null,this.accessKey);
};

config.macros.saveChanges.onClick = function(e)
{
	saveChanges();
	return false;
};

config.macros.slider.onClickSlider = function(ev)
{
	var n = this.nextSibling;
	var cookie = n.getAttribute("cookie");
	var isOpen = n.style.display != "none";
	if(config.options.chkAnimate && anim && typeof Slider == "function")
		anim.startAnimating(new Slider(n,!isOpen,null,"none"));
	else
		n.style.display = isOpen ? "none" : "block";
	config.options[cookie] = !isOpen;
	saveOption(cookie);
	return false;
};

config.macros.slider.createSlider = function(place,cookie,title,tooltip)
{
	var c = cookie || "";
	createTiddlyButton(place,title,tooltip,this.onClickSlider);
	var panel = createTiddlyElement(null,"div",null,"sliderPanel");
	panel.setAttribute("cookie",c);
	panel.style.display = config.options[c] ? "block" : "none";
	place.appendChild(panel);
	return panel;
};

config.macros.slider.handler = function(place,macroName,params)
{
	var panel = this.createSlider(place,params[0],params[2],params[3]);
	var text = store.getTiddlerText(params[1]);
	panel.setAttribute("refresh","content");
	panel.setAttribute("tiddler",params[1]);
	if(text)
		wikify(text,panel,null,store.getTiddler(params[1]));
};

// <<gradient [[tiddler name]] vert|horiz rgb rgb rgb rgb... >>
config.macros.gradient.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var panel = wikifier ? createTiddlyElement(place,"div",null,"gradient") : place;
	panel.style.position = "relative";
	panel.style.overflow = "hidden";
	panel.style.zIndex = "0";
	if(wikifier) {
		var styles = config.formatterHelpers.inlineCssHelper(wikifier);
		config.formatterHelpers.applyCssHelper(panel,styles);
	}
	params = paramString.parseParams("color");
	var locolors = [], hicolors = [];
	var t;
	for(t=2; t<params.length; t++) {
		var c = params[t].value;
		if(params[t].name == "snap") {
			hicolors[hicolors.length-1] = c;
		} else {
			locolors.push(c);
			hicolors.push(c);
		}
	}
	drawGradient(panel,params[1].value != "vert",locolors,hicolors);
	if(wikifier)
		wikifier.subWikify(panel,">>");
	if(document.all) {
		panel.style.height = "100%";
		panel.style.width = "100%";
	}
};

config.macros.message.handler = function(place,macroName,params)
{
	if(params[0]) {
		var names = params[0].split(".");
		var lookupMessage = function(root,nameIndex) {
				if(root[names[nameIndex]]) {
					if(nameIndex < names.length-1)
						return (lookupMessage(root[names[nameIndex]],nameIndex+1));
					else
						return root[names[nameIndex]];
				} else
					return null;
			};
		var m = lookupMessage(config,0);
		if(m == null)
			m = lookupMessage(window,0);
		createTiddlyText(place,m.toString().format(params.splice(1)));
	}
};


config.macros.view.depth = 0;
config.macros.view.values = [];
config.macros.view.views = {
	text: function(value,place,params,wikifier,paramString,tiddler) {
		highlightify(value,place,highlightHack,tiddler);
	},
	link: function(value,place,params,wikifier,paramString,tiddler) {
		createTiddlyLink(place,value,true);
	},
	wikified: function(value,place,params,wikifier,paramString,tiddler) {
		if(config.macros.view.depth>50)
			return;
		if(config.macros.view.depth>0) {
			if (value==config.macros.view.values[config.macros.view.depth-1]) {
				return;
			}
		}
		config.macros.view.values[config.macros.view.depth] = value;
		config.macros.view.depth++;
		if(params[2])
			value=params[2].unescapeLineBreaks().format([value]);
		wikify(value,place,highlightHack,tiddler);
		config.macros.view.depth--;
		config.macros.view.values[config.macros.view.depth] = null;
	},
	date: function(value,place,params,wikifier,paramString,tiddler) {
		value = Date.convertFromYYYYMMDDHHMM(value);
		createTiddlyText(place,value.formatString(params[2] || config.views.wikified.dateFormat));
	}
};

config.macros.view.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if((tiddler instanceof Tiddler) && params[0]) {
		var value = store.getValue(tiddler,params[0]);
		if(value) {
			var type = params[1] || config.macros.view.defaultView;
			var handler = config.macros.view.views[type];
			if(handler)
				handler(value,place,params,wikifier,paramString,tiddler);
		}
	}
};

config.macros.edit.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var field = params[0];
	var rows = params[1] || 0;
	var defVal = params[2] || '';
	if((tiddler instanceof Tiddler) && field) {
		story.setDirty(tiddler.title,true);
		var e,v;
		if(field != "text" && !rows) {
			e = createTiddlyElement(null,"input",null,null,null,{
				type: "text", edit: field, size: "40", autocomplete: "off"
			});
			e.value = store.getValue(tiddler,field) || defVal;
			place.appendChild(e);
		} else {
			var wrapper1 = createTiddlyElement(null,"fieldset",null,"fieldsetFix");
			var wrapper2 = createTiddlyElement(wrapper1,"div");
			e = createTiddlyElement(wrapper2,"textarea");
			e.value = v = store.getValue(tiddler,field) || defVal;
			rows = rows || 10;
			var lines = v.match(/\n/mg);
			var maxLines = Math.max(parseInt(config.options.txtMaxEditRows,10),5);
			if(lines != null && lines.length > rows)
				rows = lines.length + 5;
			rows = Math.min(rows,maxLines);
			e.setAttribute("rows",rows);
			e.setAttribute("edit",field);
			place.appendChild(wrapper1);
		}
		if(tiddler.isReadOnly()) {
			e.setAttribute("readOnly","readOnly");
			jQuery(e).addClass("readOnly");
		}
		return e;
	}
};

config.macros.tagChooser.onClick = function(ev)
{
	var e = ev || window.event;
	var lingo = config.views.editor.tagChooser;
	var popup = Popup.create(this);
	var tags = store.getTags(this.getAttribute("tags"));
	if(tags.length == 0)
		jQuery("<li/>").text(lingo.popupNone).appendTo(popup);
	var t;
	for(t=0; t<tags.length; t++) {
		var tag = createTiddlyButton(createTiddlyElement(popup,"li"),tags[t][0],lingo.tagTooltip.format([tags[t][0]]),config.macros.tagChooser.onTagClick);
		tag.setAttribute("tag",tags[t][0]);
		tag.setAttribute("tiddler",this.getAttribute("tiddler"));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
};

config.macros.tagChooser.onTagClick = function(ev)
{
	var e = ev || window.event;
	if(e.metaKey || e.ctrlKey) stopEvent(e); //# keep popup open on CTRL-click
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(!readOnly)
		story.setTiddlerTag(title,tag,0);
	return false;
};

config.macros.tagChooser.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(tiddler instanceof Tiddler) {
		var lingo = config.views.editor.tagChooser;
		var btn = createTiddlyButton(place,lingo.text,lingo.tooltip,this.onClick);
		btn.setAttribute("tiddler",tiddler.title);
		btn.setAttribute("tags",params[0]);
	}
};

config.macros.refreshDisplay.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.refreshDisplay.onClick = function(e)
{
	refreshAll();
	return false;
};

config.macros.annotations.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var title = tiddler ? tiddler.title : null;
	var a = title ? config.annotations[title] : null;
	if(!tiddler || !title || !a)
		return;
	var text = a.format([title]);
	wikify(text,createTiddlyElement(place,"div",null,"annotation"),null,tiddler);
};
//--
//-- NewTiddler and NewJournal macros
//--

config.macros.newTiddler.createNewTiddlerButton = function(place,title,params,label,prompt,accessKey,newFocus,isJournal)
{
	var tags = [];
	var t;
	for(t=1; t<params.length; t++) {
		if((params[t].name == "anon" && t != 1) || (params[t].name == "tag"))
			tags.push(params[t].value);
	}
	label = getParam(params,"label",label);
	prompt = getParam(params,"prompt",prompt);
	accessKey = getParam(params,"accessKey",accessKey);
	newFocus = getParam(params,"focus",newFocus);
	var customFields = getParam(params,"fields","");
	if(!customFields && !store.isShadowTiddler(title))
		customFields = String.encodeHashMap(config.defaultCustomFields);
	var btn = createTiddlyButton(place,label,prompt,this.onClickNewTiddler,null,null,accessKey);
	btn.setAttribute("newTitle",title);
	btn.setAttribute("isJournal",isJournal ? "true" : "false");
	if(tags.length > 0)
		btn.setAttribute("params",tags.join("|"));
	btn.setAttribute("newFocus",newFocus);
	btn.setAttribute("newTemplate",getParam(params,"template",DEFAULT_EDIT_TEMPLATE));
	if(customFields !== "")
		btn.setAttribute("customFields",customFields);
	var text = getParam(params,"text");
	if(text !== undefined)
		btn.setAttribute("newText",text);
	return btn;
};

config.macros.newTiddler.onClickNewTiddler = function()
{
	var title = this.getAttribute("newTitle");
	if(this.getAttribute("isJournal") == "true") {
		title = new Date().formatString(title.trim());
	}
	var params = this.getAttribute("params");
	var tags = params ? params.split("|") : [];
	var focus = this.getAttribute("newFocus");
	var template = this.getAttribute("newTemplate");
	var customFields = this.getAttribute("customFields");
	if(!customFields && !store.isShadowTiddler(title))
		customFields = String.encodeHashMap(config.defaultCustomFields);
	story.displayTiddler(null,title,template,false,null,null);
	var tiddlerElem = story.getTiddler(title);
	if(customFields)
		story.addCustomFields(tiddlerElem,customFields);
	var text = this.getAttribute("newText");
	if(typeof text == "string" && story.getTiddlerField(title,"text"))
		story.getTiddlerField(title,"text").value = text.format([title]);
	var t;
	for(t=0;t<tags.length;t++)
		story.setTiddlerTag(title,tags[t],+1);
	story.focusTiddler(title,focus);
	return false;
};

config.macros.newTiddler.handler = function(place,macroName,params,wikifier,paramString)
{
	if(!readOnly) {
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : this.title;
		title = getParam(params,"title",title);
		this.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"title",false);
	}
};

config.macros.newJournal.handler = function(place,macroName,params,wikifier,paramString)
{
	if(!readOnly) {
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : config.macros.timeline.dateFormat;
		title = getParam(params,"title",title);
		config.macros.newTiddler.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"text",true);
	}
};

//--
//-- Search macro
//--

config.macros.search.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,false,false,false);
	createTiddlyButton(place,this.label,this.prompt,this.onClick,"searchButton");
	var txt = createTiddlyElement(null,"input",null,"txtOptionInput searchField");
	txt.value = getParam(params,"anon","");
	if(config.browser.isSafari) {
		txt.setAttribute("type","search");
		txt.setAttribute("results","5");
	} else {
		txt.setAttribute("type","text");
	}
	place.appendChild(txt);
	txt.onkeyup = this.onKeyPress;
	txt.onfocus = this.onFocus;
	txt.setAttribute("size",this.sizeTextbox);
	txt.setAttribute("accessKey",getParam(params,"accesskey",this.accessKey));
	txt.setAttribute("autocomplete","off");
	txt.setAttribute("lastSearchText","");
	txt.setAttribute("placeholder",getParam(params,"placeholder",this.placeholder));
};

// Global because there's only ever one outstanding incremental search timer
config.macros.search.timeout = null;

config.macros.search.doSearch = function(txt)
{
	if(txt.value.length > 0) {
		story.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);
		txt.setAttribute("lastSearchText",txt.value);
	}
};

config.macros.search.onClick = function(e)
{
	config.macros.search.doSearch(this.nextSibling);
	return false;
};

config.macros.search.onKeyPress = function(ev)
{
	var me = config.macros.search;
	var e = ev || window.event;
	switch(e.keyCode) {
		case 9: // Tab
			return;
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
			me.doSearch(this);
			break;
		case 27: // Escape
			this.value = "";
			clearMessage();
			break;
	}
	if(config.options.chkIncrementalSearch) {
		if(this.value.length > 2) {
			if(this.value != this.getAttribute("lastSearchText")) {
				if(me.timeout) {
					clearTimeout(me.timeout);
				}
				var txt = this;
				me.timeout = setTimeout(function() {me.doSearch(txt);},500);
			}
		} else {
			if(me.timeout) {
				clearTimeout(me.timeout);
			}
		}
	}
};

config.macros.search.onFocus = function(e)
{
	this.select();
};

//--
//-- Tabs macro
//--

config.macros.tabs.handler = function(place,macroName,params)
{
	var cookie = params[0];
	var numTabs = (params.length-1)/3;
	var wrapper = createTiddlyElement(null,"div",null,"tabsetWrapper " + cookie);
	var tabset = createTiddlyElement(wrapper,"div",null,"tabset");
	tabset.setAttribute("cookie",cookie);
	var validTab = false;
	var t;
	for(t=0; t<numTabs; t++) {
		var label = params[t*3+1];
		var prompt = params[t*3+2];
		var content = params[t*3+3];
		var tab = createTiddlyButton(tabset,label,prompt,this.onClickTab,"tab tabUnselected");
		createTiddlyElement(tab,"span",null,null," ",{style:"font-size:0pt;line-height:0px"});
		tab.setAttribute("tab",label);
		tab.setAttribute("content",content);
		tab.title = prompt;
		if(config.options[cookie] == label)
			validTab = true;
	}
	if(!validTab)
		config.options[cookie] = params[1];
	place.appendChild(wrapper);
	this.switchTab(tabset,config.options[cookie]);
};

config.macros.tabs.onClickTab = function(e)
{
	config.macros.tabs.switchTab(this.parentNode,this.getAttribute("tab"));
	return false;
};

config.macros.tabs.switchTab = function(tabset,tab)
{
	var cookie = tabset.getAttribute("cookie");
	var theTab = null;
	var nodes = tabset.childNodes;
	var t;
	for(t=0; t<nodes.length; t++) {
		if(nodes[t].getAttribute && nodes[t].getAttribute("tab") == tab) {
			theTab = nodes[t];
			theTab.className = "tab tabSelected";
		} else {
			nodes[t].className = "tab tabUnselected";
		}
	}
	if(theTab) {
		if(tabset.nextSibling && tabset.nextSibling.className == "tabContents")
			jQuery(tabset.nextSibling).remove();
		var tabContent = createTiddlyElement(null,"div",null,"tabContents");
		tabset.parentNode.insertBefore(tabContent,tabset.nextSibling);
		var contentTitle = theTab.getAttribute("content");
		wikify(store.getTiddlerText(contentTitle),tabContent,null,store.getTiddler(contentTitle));
		if(cookie) {
			config.options[cookie] = tab;
			saveOption(cookie);
		}
	}
};

//--
//-- Tiddler toolbar
//--

// Create a toolbar command button
config.macros.toolbar.createCommand = function(place,commandName,tiddler,className)
{
	if(typeof commandName != "string") {
		var c = null;
		var t;
		for(t in config.commands) {
			if(config.commands[t] == commandName)
				c = t;
		}
		commandName = c;
	}
	if((tiddler instanceof Tiddler) && (typeof commandName == "string")) {
		var command = config.commands[commandName];
		if(command.isEnabled ? command.isEnabled(tiddler) : this.isCommandEnabled(command,tiddler)) {
			var text = command.getText ? command.getText(tiddler) : this.getCommandText(command,tiddler);
			var tooltip = command.getTooltip ? command.getTooltip(tiddler) : this.getCommandTooltip(command,tiddler);
			var cmd = command.type == "popup" ? this.onClickPopup : this.onClickCommand;
			var btn = createTiddlyButton(null,text,tooltip,cmd);
			btn.setAttribute("commandName",commandName);
			btn.setAttribute("tiddler",tiddler.title);
			jQuery(btn).addClass("command_" + commandName);
			if(className)
				jQuery(btn).addClass(className);
			place.appendChild(btn);
		}
	}
};

config.macros.toolbar.isCommandEnabled = function(command,tiddler)
{
	var title = tiddler.title;
	var ro = tiddler.isReadOnly();
	var shadow = store.isShadowTiddler(title) && !store.tiddlerExists(title);
	return (!ro || (ro && !command.hideReadOnly)) && !(shadow && command.hideShadow);
};

config.macros.toolbar.getCommandText = function(command,tiddler)
{
	return (tiddler.isReadOnly() && command.readOnlyText) || command.text;
};

config.macros.toolbar.getCommandTooltip = function(command,tiddler)
{
	return (tiddler.isReadOnly() && command.readOnlyTooltip) || command.tooltip;
};

config.macros.toolbar.onClickCommand = function(ev)
{
	var e = ev || window.event;
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	var command = config.commands[this.getAttribute("commandName")];
	return command.handler(e,this,this.getAttribute("tiddler"));
};

config.macros.toolbar.onClickPopup = function(ev)
{
	var e = ev || window.event;
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	var popup = Popup.create(this);
	var command = config.commands[this.getAttribute("commandName")];
	var title = this.getAttribute("tiddler");
	popup.setAttribute("tiddler",title);
	command.handlePopup(popup,title);
	Popup.show();
	return false;
};

// Invoke the first command encountered from a given place that is tagged with a specified class
config.macros.toolbar.invokeCommand = function(place,className,event)
{
	var children = place.getElementsByTagName("a");
	var t;
	for(t=0; t<children.length; t++) {
		var c = children[t];
		if(jQuery(c).hasClass(className) && c.getAttribute && c.getAttribute("commandName")) {
			if(c.onclick instanceof Function)
				c.onclick.call(c,event);
			break;
		}
	}
};

config.macros.toolbar.onClickMore = function(ev)
{
	var e = this.nextSibling;
	e.style.display = "inline";
	this.style.display = "none";
	return false;
};

config.macros.toolbar.onClickLess = function(ev)
{
	var e = this.parentNode;
	var m = e.previousSibling;
	e.style.display = "none";
	m.style.display = "inline";
	return false;
};

config.macros.toolbar.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var t;
	for(t=0; t<params.length; t++) {
		var btn;
		var c = params[t];
		switch(c) {
		case "!":
			createTiddlyText(place,this.separator);
			break;
		case "*":
			createTiddlyElement(place,"br");
			break;
		case "<":
			btn = createTiddlyButton(place,this.lessLabel,this.lessPrompt,config.macros.toolbar.onClickLess);
			jQuery(btn).addClass("lessCommand");
			break;
		case ">":
			btn = createTiddlyButton(place,this.moreLabel,this.morePrompt,config.macros.toolbar.onClickMore);
			jQuery(btn).addClass("moreCommand");
			var e = createTiddlyElement(place,"span",null,"moreCommand");
			e.style.display = "none";
			place = e;
			break;
		default:
			var className = "";
			switch(c.substr(0,1)) {
			case "+":
				className = "defaultCommand";
				c = c.substr(1);
				break;
			case "-":
				className = "cancelCommand";
				c = c.substr(1);
				break;
			}
			if(config.commands[c]) {
				this.createCommand(place,c,tiddler,className);
			} else {
				this.customCommand(place,c,wikifier,tiddler);
			}
			break;
		}
	}
};

// Overrideable function to extend toolbar handler
config.macros.toolbar.customCommand = function(place,command,wikifier,tiddler)
{
};

//--
//-- Menu and toolbar commands
//--

config.commands.closeTiddler.handler = function(event,src,title)
{
	if(story.isDirty(title) && !readOnly) {
		if(!confirm(config.commands.cancelTiddler.warning.format([title])))
			return false;
	}
	story.setDirty(title,false);
	story.closeTiddler(title,true);
	return false;
};

config.commands.closeOthers.handler = function(event,src,title)
{
	story.closeAllTiddlers(title);
	return false;
};

config.commands.editTiddler.handler = function(event,src,title)
{
	clearMessage();
	var tiddlerElem = story.getTiddler(title);
	var fields = tiddlerElem.getAttribute("tiddlyFields");
	story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE,false,null,fields);
	var e = story.getTiddlerField(title,config.options.txtEditorFocus||"text");
	if(e) {
		setCaretPosition(e,0);
	}
	return false;
};

config.commands.saveTiddler.handler = function(event,src,title)
{
	var newTitle = story.saveTiddler(title,event.shiftKey);
	if(newTitle)
		story.displayTiddler(null,newTitle);
	return false;
};

config.commands.cancelTiddler.handler = function(event,src,title)
{
	if(story.hasChanges(title) && !readOnly) {
		if(!confirm(this.warning.format([title])))
			return false;
	}
	story.setDirty(title,false);
	story.displayTiddler(null,title);
	return false;
};

config.commands.deleteTiddler.handler = function(event,src,title)
{
	var deleteIt = true;
	if(config.options.chkConfirmDelete)
		deleteIt = confirm(this.warning.format([title]));
	if(deleteIt) {
		store.removeTiddler(title);
		story.closeTiddler(title,true);
		autoSaveChanges();
	}
	return false;
};

config.commands.permalink.handler = function(event,src,title)
{
	var t = encodeURIComponent(String.encodeTiddlyLink(title));
	if(window.location.hash != t)
		window.location.hash = t;
	return false;
};

config.commands.references.handlePopup = function(popup,title)
{
	var references = store.getReferringTiddlers(title);
	var c = false;
	var r;
	for(r=0; r<references.length; r++) {
		if(references[r].title != title && !references[r].isTagged("excludeLists")) {
			createTiddlyLink(createTiddlyElement(popup,"li"),references[r].title,true);
			c = true;
		}
	}
	if(!c)
		createTiddlyElement(popup,"li",null,"disabled",this.popupNone);
};

config.commands.jump.handlePopup = function(popup,title)
{
	story.forEachTiddler(function(title,element) {
		createTiddlyLink(createTiddlyElement(popup,"li"),title,true,null,false,null,true);
		});
};

config.commands.syncing.handlePopup = function(popup,title)
{
	var me = config.commands.syncing;
	var tiddler = store.fetchTiddler(title);
	if(!tiddler)
		return;
	var serverType = tiddler.getServerType();
	var serverHost = tiddler.fields["server.host"];
	var serverWorkspace = tiddler.fields["server.workspace"];
	if(!serverWorkspace)
		serverWorkspace = "";
	if(serverType) {
		var e = createTiddlyElement(popup,"li",null,"popupMessage");
		e.innerHTML = me.currentlySyncing.format([serverType,serverHost,serverWorkspace]);
	} else {
		createTiddlyElement(popup,"li",null,"popupMessage",me.notCurrentlySyncing);
	}
	if(serverType) {
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var btn = createTiddlyButton(createTiddlyElement(popup,"li"),this.captionUnSync,null,me.onChooseServer);
		btn.setAttribute("tiddler",title);
		btn.setAttribute("server.type","");
	}
	createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
	createTiddlyElement(popup,"li",null,"popupMessage",me.chooseServer);
	var feeds = store.getTaggedTiddlers("systemServer","title");
	var t;
	for(t=0; t<feeds.length; t++) {
		var f = feeds[t];
		var feedServerType = store.getTiddlerSlice(f.title,"Type");
		if(!feedServerType)
			feedServerType = "file";
		var feedServerHost = store.getTiddlerSlice(f.title,"URL");
		if(!feedServerHost)
			feedServerHost = "";
		var feedServerWorkspace = store.getTiddlerSlice(f.title,"Workspace");
		if(!feedServerWorkspace)
			feedServerWorkspace = "";
		var caption = f.title;
		if(serverType == feedServerType && serverHost == feedServerHost && serverWorkspace == feedServerWorkspace) {
			caption = me.currServerMarker + caption;
		} else {
			caption = me.notCurrServerMarker + caption;
		}
		btn = createTiddlyButton(createTiddlyElement(popup,"li"),caption,null,me.onChooseServer);
		btn.setAttribute("tiddler",title);
		btn.setAttribute("server.type",feedServerType);
		btn.setAttribute("server.host",feedServerHost);
		btn.setAttribute("server.workspace",feedServerWorkspace);
	}
};

config.commands.syncing.onChooseServer = function(e)
{
	var tiddler = this.getAttribute("tiddler");
	var serverType = this.getAttribute("server.type");
	if(serverType) {
		store.addTiddlerFields(tiddler,{
			"server.type": serverType,
			"server.host": this.getAttribute("server.host"),
			"server.workspace": this.getAttribute("server.workspace")
			});
	} else {
		store.setValue(tiddler,"server",null);
	}
	return false;
};

config.commands.fields.handlePopup = function(popup,title)
{
	var tiddler = store.fetchTiddler(title);
	if(!tiddler)
		return;
	var items = [];
	store.forEachField(tiddler,function(tiddler,fieldName,value){items.push({field:fieldName,value:value});},true);
	items.sort(function(a,b) {return a.field < b.field ? -1 : (a.field == b.field ? 0 : +1);});
	if(items.length > 0)
		ListView.create(popup,items,this.listViewTemplate);
	else
		createTiddlyElement(popup,"div",null,null,this.emptyText);
};

//--
//-- Tiddler() object
//--

function Tiddler(title)
{
	this.title = title;
	this.text = "";
	this.creator = null;
	this.modifier = null;
	this.created = new Date();
	this.modified = this.created;
	this.links = [];
	this.linksUpdated = false;
	this.tags = [];
	this.fields = {};
	return this;
}

Tiddler.prototype.getLinks = function()
{
	if(this.linksUpdated==false)
		this.changed();
	return this.links;
};

// Returns the fields that are inherited in string field:"value" field2:"value2" format
Tiddler.prototype.getInheritedFields = function()
{
	var f = {};
	var i;
	for(i in this.fields) {
		if(i=="server.host" || i=="server.workspace" || i=="wikiformat"|| i=="server.type") {
			f[i] = this.fields[i];
		}
	}
	return String.encodeHashMap(f);
};

// Increment the changeCount of a tiddler
Tiddler.prototype.incChangeCount = function()
{
	var c = this.fields['changecount'];
	c = c ? parseInt(c,10) : 0;
	this.fields['changecount'] = String(c+1);
};

// Clear the changeCount of a tiddler
Tiddler.prototype.clearChangeCount = function()
{
	if(this.fields['changecount']) {
		delete this.fields['changecount'];
	}
};

Tiddler.prototype.doNotSave = function()
{
	return this.fields['doNotSave'];
};

// Returns true if the tiddler has been updated since the tiddler was created or downloaded
Tiddler.prototype.isTouched = function()
{
	var changecount = this.fields.changecount || 0;
	return changecount > 0;
};

// Change the text and other attributes of a tiddler
Tiddler.prototype.set = function(title,text,modifier,modified,tags,created,fields,creator)
{
	this.assign(title,text,modifier,modified,tags,created,fields,creator);
	this.changed();
	return this;
};

// Change the text and other attributes of a tiddler without triggered a tiddler.changed() call
Tiddler.prototype.assign = function(title,text,modifier,modified,tags,created,fields,creator)
{
	if(title != undefined)
		this.title = title;
	if(text != undefined)
		this.text = text;
	if(modifier != undefined)
		this.modifier = modifier;
	if(modified != undefined)
		this.modified = modified;
	if(creator != undefined)
		this.creator = creator;
	if(created != undefined)
		this.created = created;
	if(fields != undefined)
		this.fields = fields;
	if(tags != undefined)
		this.tags = (typeof tags == "string") ? tags.readBracketedList() : tags;
	else if(this.tags == undefined)
		this.tags = [];
	return this;
};

// Get the tags for a tiddler as a string (space delimited, using [[brackets]] for tags containing spaces)
Tiddler.prototype.getTags = function()
{
	return String.encodeTiddlyLinkList(this.tags);
};

// Test if a tiddler carries a tag
Tiddler.prototype.isTagged = function(tag)
{
	return this.tags.indexOf(tag) != -1;
};

// Static method to convert "\n" to newlines, "\s" to "\"
Tiddler.unescapeLineBreaks = function(text)
{
	return text ? text.unescapeLineBreaks() : "";
};

// Convert newlines to "\n", "\" to "\s"
Tiddler.prototype.escapeLineBreaks = function()
{
	return this.text.escapeLineBreaks();
};

// Updates the secondary information (like links[] array) after a change to a tiddler
Tiddler.prototype.changed = function()
{
	this.links = [];
	var text = this.text;
	// remove 'quoted' text before scanning tiddler source
	text = text.replace(/\/%((?:.|\n)*?)%\//g,"").
		replace(/\{{3}((?:.|\n)*?)\}{3}/g,"").
		replace(/"""((?:.|\n)*?)"""/g,"").
		replace(/<nowiki\>((?:.|\n)*?)<\/nowiki\>/g,"").
		replace(/<html\>((?:.|\n)*?)<\/html\>/g,"").
		replace(/<script((?:.|\n)*?)<\/script\>/g,"");
	var t = this.autoLinkWikiWords() ? 0 : 1;
	var tiddlerLinkRegExp = t==0 ? config.textPrimitives.tiddlerAnyLinkRegExp : config.textPrimitives.tiddlerForcedLinkRegExp;
	tiddlerLinkRegExp.lastIndex = 0;
	var formatMatch = tiddlerLinkRegExp.exec(text);
	while(formatMatch) {
		var lastIndex = tiddlerLinkRegExp.lastIndex;
		if(t==0 && formatMatch[1] && formatMatch[1] != this.title) {
			// wikiWordLink
			if(formatMatch.index > 0) {
				var preRegExp = new RegExp(config.textPrimitives.unWikiLink+"|"+config.textPrimitives.anyLetter,"mg");
				preRegExp.lastIndex = formatMatch.index-1;
				var preMatch = preRegExp.exec(text);
				if(preMatch.index != formatMatch.index-1)
					this.links.pushUnique(formatMatch[1]);
			} else {
				this.links.pushUnique(formatMatch[1]);
			}
		}
		else if(formatMatch[2-t] && !config.formatterHelpers.isExternalLink(formatMatch[3-t])) // titledBrackettedLink
			this.links.pushUnique(formatMatch[3-t]);
		else if(formatMatch[4-t] && formatMatch[4-t] != this.title) // brackettedLink
			this.links.pushUnique(formatMatch[4-t]);
		tiddlerLinkRegExp.lastIndex = lastIndex;
		formatMatch = tiddlerLinkRegExp.exec(text);
	}
	this.linksUpdated = true;
};

Tiddler.prototype.getSubtitle = function()
{
	var modifier = this.modifier;
	if(!modifier)
		modifier = config.messages.subtitleUnknown || "";
	var modified = this.modified;
	if(modified)
		modified = modified.toLocaleString();
	else
		modified = config.messages.subtitleUnknown || "";
	var f = config.messages.tiddlerLinkTooltip || "%0 - %1, %2";
	return f.format([this.title,modifier,modified]);
};

Tiddler.prototype.isReadOnly = function()
{
	return readOnly;
};

Tiddler.prototype.autoLinkWikiWords = function()
{
	return !(this.isTagged("systemConfig") || this.isTagged("excludeMissing"));
};

Tiddler.prototype.getServerType = function()
{
	var serverType = null;
	if(this.fields['server.type'])
		serverType = this.fields['server.type'];
	if(!serverType)
		serverType = this.fields['wikiformat'];
	if(serverType && !config.adaptors[serverType])
		serverType = null;
	return serverType;
};

Tiddler.prototype.getAdaptor = function()
{
	var serverType = this.getServerType();
	return serverType ? new config.adaptors[serverType]() : null;
};

//--
//-- TiddlyWiki instance contains TiddlerS
//--

function TiddlyWiki(params)
{
	var tiddlers = {}; // Hashmap by name of tiddlers
	if(params && params.config) {
		this.config = config;
	}
	this.tiddlersUpdated = false;
	this.namedNotifications = []; // Array of {name:,notify:} of notification functions
	this.notificationLevel = 0;
	this.slices = {}; // map tiddlerName->(map sliceName->sliceValue). Lazy.
	this.clear = function() {
		tiddlers = {};
		this.setDirty(false);
	};
	this.fetchTiddler = function(title) {
		var t = tiddlers[title];
		return t instanceof Tiddler ? t : null;
	};
	this.deleteTiddler = function(title) {
		delete this.slices[title];
		delete tiddlers[title];
	};
	this.addTiddler = function(tiddler) {
		delete this.slices[tiddler.title];
		tiddlers[tiddler.title] = tiddler;
	};
	this.forEachTiddler = function(callback) {
		var t;
		for(t in tiddlers) {
			var tiddler = tiddlers[t];
			if(tiddler instanceof Tiddler)
				callback.call(this,t,tiddler);
		}
	};
}

TiddlyWiki.prototype.setDirty = function(dirty)
{
	this.dirty = dirty;
};

TiddlyWiki.prototype.isDirty = function()
{
	return this.dirty;
};

TiddlyWiki.prototype.tiddlerExists = function(title)
{
	var t = this.fetchTiddler(title);
	return t != undefined;
};

TiddlyWiki.prototype.isShadowTiddler = function(title)
{
	return config.shadowTiddlers[title] === undefined ? false : true;
};

TiddlyWiki.prototype.createTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler) {
		tiddler = new Tiddler(title);
		this.addTiddler(tiddler);
		this.setDirty(true);
	}
	return tiddler;
};

TiddlyWiki.prototype.getTiddler = function(title)
{
	var t = this.fetchTiddler(title);
	if(t != undefined)
		return t;
	else
		return null;
};

TiddlyWiki.prototype.getShadowTiddlerText = function(title)
{
	if(typeof config.shadowTiddlers[title] == "string")
		return config.shadowTiddlers[title];
	else
		return "";
};

// Retrieve tiddler contents
TiddlyWiki.prototype.getTiddlerText = function(title,defaultText)
{
	if(!title)
		return defaultText;
	var pos = title.indexOf(config.textPrimitives.sectionSeparator);
	var section = null;
	if(pos != -1) {
		section = title.substr(pos + config.textPrimitives.sectionSeparator.length);
		title = title.substr(0,pos);
	}
	pos = title.indexOf(config.textPrimitives.sliceSeparator);
	if(pos != -1) {
		var slice = this.getTiddlerSlice(title.substr(0,pos),title.substr(pos + config.textPrimitives.sliceSeparator.length));
		if(slice)
			return slice;
	}
	var tiddler = this.fetchTiddler(title);
	var text = tiddler ? tiddler.text : null;
	if(!tiddler && this.isShadowTiddler(title)) {
		text = this.getShadowTiddlerText(title);
	}
	if(text) {
		if(!section)
			return text;
		var re = new RegExp("(^!{1,6}[ \t]*" + section.escapeRegExp() + "[ \t]*\n)","mg");
		re.lastIndex = 0;
		var match = re.exec(text);
		if(match) {
			var t = text.substr(match.index+match[1].length);
			var re2 = /^!/mg;
			re2.lastIndex = 0;
			match = re2.exec(t); //# search for the next heading
			if(match)
				t = t.substr(0,match.index-1);//# don't include final \n
			return t;
		}
		return defaultText;
	}
	if(defaultText != undefined)
		return defaultText;
	return null;
};

TiddlyWiki.prototype.getRecursiveTiddlerText = function(title,defaultText,depth)
{
	var bracketRegExp = new RegExp("(?:\\[\\[([^\\]]+)\\]\\])","mg");
	var text = this.getTiddlerText(title,null);
	if(text == null)
		return defaultText;
	var textOut = [];
	var match,lastPos = 0;
	do {
		match = bracketRegExp.exec(text);
		if(match) {
			textOut.push(text.substr(lastPos,match.index-lastPos));
			if(match[1]) {
				if(depth <= 0)
					textOut.push(match[1]);
				else
					textOut.push(this.getRecursiveTiddlerText(match[1],"",depth-1));
			}
			lastPos = match.index + match[0].length;
		} else {
			textOut.push(text.substr(lastPos));
		}
	} while(match);
	return textOut.join("");
};

//TiddlyWiki.prototype.slicesRE = /(?:^([\'\/]{0,2})~?([\.\w]+)\:\1[\t\x20]*([^\n]+)[\t\x20]*$)|(?:^\|([\'\/]{0,2})~?([\.\w]+)\:?\4\|[\t\x20]*([^\n]+)[\t\x20]*\|$)/gm;
TiddlyWiki.prototype.slicesRE = /(?:^([\'\/]{0,2})~?([\.\w]+)\:\1[\t\x20]*([^\n]*)[\t\x20]*$)|(?:^\|([\'\/]{0,2})~?([\.\w]+)\:?\4\|[\t\x20]*([^\|\n]*)[\t\x20]*\|$)/gm;
// @internal
TiddlyWiki.prototype.calcAllSlices = function(title)
{
	var slices = {};
	var text = this.getTiddlerText(title,"");
	this.slicesRE.lastIndex = 0;
	var m = this.slicesRE.exec(text);
	while(m) {
		if(m[2])
			slices[m[2]] = m[3];
		else
			slices[m[5]] = m[6];
		m = this.slicesRE.exec(text);
	}
	return slices;
};

// Returns the slice of text of the given name
TiddlyWiki.prototype.getTiddlerSlice = function(title,sliceName)
{
	var slices = this.slices[title];
	if(!slices) {
		slices = this.calcAllSlices(title);
		this.slices[title] = slices;
	}
	return slices[sliceName];
};

// Build an hashmap of the specified named slices of a tiddler
TiddlyWiki.prototype.getTiddlerSlices = function(title,sliceNames)
{
	var t,r = {};
	for(t=0; t<sliceNames.length; t++) {
		var slice = this.getTiddlerSlice(title,sliceNames[t]);
		if(slice)
			r[sliceNames[t]] = slice;
	}
	return r;
};

TiddlyWiki.prototype.suspendNotifications = function()
{
	this.notificationLevel--;
};

TiddlyWiki.prototype.resumeNotifications = function()
{
	this.notificationLevel++;
};

// Invoke the notification handlers for a particular tiddler
TiddlyWiki.prototype.notify = function(title,doBlanket)
{
	if(!this.notificationLevel) {
	    var t;
		for(t=0; t<this.namedNotifications.length; t++) {
			var n = this.namedNotifications[t];
			if((n.name == null && doBlanket) || (n.name == title))
				n.notify(title);
		}
	}
};

// Invoke the notification handlers for all tiddlers
TiddlyWiki.prototype.notifyAll = function()
{
	if(!this.notificationLevel) {
	    var t;
		for(t=0; t<this.namedNotifications.length; t++) {
			var n = this.namedNotifications[t];
			if(n.name)
				n.notify(n.name);
		}
	}
};

// Add a notification handler to a tiddler
TiddlyWiki.prototype.addNotification = function(title,fn)
{
	var i;
	for(i=0; i<this.namedNotifications.length; i++) {
		if((this.namedNotifications[i].name == title) && (this.namedNotifications[i].notify == fn))
			return this;
	}
	this.namedNotifications.push({name: title, notify: fn});
	return this;
};

TiddlyWiki.prototype.removeTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		this.deleteTiddler(title);
		this.notify(title,true);
		this.setDirty(true);
	}
};

// Reset the sync status of a freshly synced tiddler
TiddlyWiki.prototype.resetTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		tiddler.clearChangeCount();
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.setTiddlerTag = function(title,status,tag)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		var t = tiddler.tags.indexOf(tag);
		if(t != -1)
			tiddler.tags.splice(t,1);
		if(status)
			tiddler.tags.push(tag);
		tiddler.changed();
		tiddler.incChangeCount();
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.addTiddlerFields = function(title,fields)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler)
		return;
	merge(tiddler.fields,fields);
	tiddler.changed();
	tiddler.incChangeCount();
	this.notify(title,true);
	this.setDirty(true);
};

// Store tiddler in TiddlyWiki instance
TiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags,fields,clearChangeCount,created,creator)
{
	var tiddler;
	if(title instanceof Tiddler) {
		tiddler = title;
		title = tiddler.title;
		newTitle = title;
	} else {
		tiddler = this.fetchTiddler(title);
		if(tiddler) {
			created = created || tiddler.created; // Preserve created date
			creator = creator || tiddler.creator;
			this.deleteTiddler(title);
		} else {
			created = created || modified;
			tiddler = new Tiddler();
		}
		fields = merge(merge({},fields),config.defaultCustomFields,true);
		tiddler.set(newTitle,newBody,modifier,modified,tags,created,fields,creator);
	}
	this.addTiddler(tiddler);
	if(clearChangeCount)
		tiddler.clearChangeCount();
	else
		tiddler.incChangeCount();
	if(title != newTitle)
		this.notify(title,true);
	this.notify(newTitle,true);
	if(window.location.protocol == "file:")
		this.setDirty(true);
	return tiddler;
};

TiddlyWiki.prototype.incChangeCount = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		tiddler.incChangeCount();
};

TiddlyWiki.prototype.getLoader = function()
{
	if(!this.loader)
		this.loader = new TW21Loader();
	return this.loader;
};

TiddlyWiki.prototype.getSaver = function()
{
	if(!this.saver)
		this.saver = new TW21Saver();
	return this.saver;
};

// Return all tiddlers formatted as an HTML string
TiddlyWiki.prototype.allTiddlersAsHtml = function()
{
	return this.getSaver().externalize(store);
};

// Load contents of a TiddlyWiki from an HTML DIV
TiddlyWiki.prototype.loadFromDiv = function(src,idPrefix,noUpdate)
{
	this.idPrefix = idPrefix;
	var storeElem = (typeof src == "string") ? document.getElementById(src) : src;
	if(!storeElem)
		return;
	var tiddlers = this.getLoader().loadTiddlers(this,storeElem.childNodes);
	this.setDirty(false);
	if(!noUpdate) {
		var i;
		for(i = 0;i<tiddlers.length; i++)
			tiddlers[i].changed();
	}
	jQuery(document).trigger("loadTiddlers");
};

// Load contents of a TiddlyWiki from a string
// Returns null if there's an error
TiddlyWiki.prototype.importTiddlyWiki = function(text)
{
	var posDiv = locateStoreArea(text);
	if(!posDiv)
		return null;
	var content = "<" + "html><" + "body>" + text.substring(posDiv[0],posDiv[1] + endSaveArea.length) + "<" + "/body><" + "/html>";
	// Create the iframe
	var iframe = document.createElement("iframe");
	iframe.style.display = "none";
	document.body.appendChild(iframe);
	var doc = iframe.document;
	if(iframe.contentDocument)
		doc = iframe.contentDocument; // For NS6
	else if(iframe.contentWindow)
		doc = iframe.contentWindow.document; // For IE5.5 and IE6
	// Put the content in the iframe
	doc.open();
	doc.writeln(content);
	doc.close();
	// Load the content into a TiddlyWiki() object
	var storeArea = doc.getElementById("storeArea");
	this.loadFromDiv(storeArea,"store");
	// Get rid of the iframe
	iframe.parentNode.removeChild(iframe);
	return this;
};

TiddlyWiki.prototype.updateTiddlers = function()
{
	this.tiddlersUpdated = true;
	this.forEachTiddler(function(title,tiddler) {
		tiddler.changed();
	});
};

// Return an array of tiddlers matching a search regular expression
TiddlyWiki.prototype.search = function(searchRegExp,sortField,excludeTag,match)
{
	var candidates = this.reverseLookup("tags",excludeTag,!!match);
	var t,results = [];
	for(t=0; t<candidates.length; t++) {
		if((candidates[t].title.search(searchRegExp) != -1) || (candidates[t].text.search(searchRegExp) != -1))
			results.push(candidates[t]);
	}
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
};

// Returns a list of all tags in use
//   excludeTag - if present, excludes tags that are themselves tagged with excludeTag
// Returns an array of arrays where [tag][0] is the name of the tag and [tag][1] is the number of occurances
TiddlyWiki.prototype.getTags = function(excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
	    var g,c;
		for(g=0; g<tiddler.tags.length; g++) {
			var tag = tiddler.tags[g];
			var n = true;
			for(c=0; c<results.length; c++) {
				if(results[c][0] == tag) {
					n = false;
					results[c][1]++;
				}
			}
			if(n && excludeTag) {
				var t = this.fetchTiddler(tag);
				if(t && t.isTagged(excludeTag))
					n = false;
			}
			if(n)
				results.push([tag,1]);
		}
	});
	results.sort(function(a,b) {return a[0].toLowerCase() < b[0].toLowerCase() ? -1 : (a[0].toLowerCase() == b[0].toLowerCase() ? 0 : +1);});
	return results;
};

// Return an array of the tiddlers that are tagged with a given tag
TiddlyWiki.prototype.getTaggedTiddlers = function(tag,sortField)
{
	return this.reverseLookup("tags",tag,true,sortField);
};

TiddlyWiki.prototype.getValueTiddlers = function(field,value,sortField)
{
	return this.reverseLookup(field,value,true,sortField);
};

// Return an array of the tiddlers that link to a given tiddler
TiddlyWiki.prototype.getReferringTiddlers = function(title,unusedParameter,sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	return this.reverseLookup("links",title,true,sortField);
};

// Return an array of the tiddlers that do or do not have a specified entry in the specified storage array (ie, "links" or "tags")
// lookupMatch == true to match tiddlers, false to exclude tiddlers
TiddlyWiki.prototype.reverseLookup = function(lookupField,lookupValue,lookupMatch,sortField)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		var f = !lookupMatch;
		var values;
		if(["links", "tags"].contains(lookupField)) {
			values = tiddler[lookupField];
		} else {
			var accessor = TiddlyWiki.standardFieldAccess[lookupField];
			if(accessor) {
				values = [ accessor.get(tiddler) ];
			} else {
				values = tiddler.fields[lookupField] ? [tiddler.fields[lookupField]] : [];
			}
		}
		var lookup;
		for(lookup=0; lookup<values.length; lookup++) {
			if(values[lookup] == lookupValue)
				f = lookupMatch;
		}
		if(f)
			results.push(tiddler);
	});
	if(!sortField)
		sortField = "title";
	return this.sortTiddlers(results,sortField);
};

// Return the tiddlers as a sorted array
TiddlyWiki.prototype.getTiddlers = function(field,excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(excludeTag == undefined || !tiddler.isTagged(excludeTag))
			results.push(tiddler);
	});
	if(field)
		results.sort(function(a,b) {return a[field] < b[field] ? -1 : (a[field] == b[field] ? 0 : +1);});
	return results;
};

// Return array of names of tiddlers that are referred to but not defined
TiddlyWiki.prototype.getMissingLinks = function()
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(tiddler.isTagged("excludeMissing") || tiddler.isTagged("systemConfig"))
			return;
		var n;
		for(n=0; n<tiddler.links.length;n++) {
			var link = tiddler.links[n];
			if(this.getTiddlerText(link,null) == null && !this.isShadowTiddler(link) && !config.macros[link])
				results.pushUnique(link);
		}
	});
	results.sort();
	return results;
};

// Return an array of names of tiddlers that are defined but not referred to
TiddlyWiki.prototype.getOrphans = function()
{
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(this.getReferringTiddlers(title).length == 0 && !tiddler.isTagged("excludeLists"))
			results.push(title);
	});
	results.sort();
	return results;
};

// Return an array of names of all the shadow tiddlers
TiddlyWiki.prototype.getShadowed = function()
{
	var t,results = [];
	for(t in config.shadowTiddlers) {
		if(this.isShadowTiddler(t))
			results.push(t);
	}
	results.sort();
	return results;
};

// Return an array of tiddlers that have been touched since they were downloaded or created
TiddlyWiki.prototype.getTouched = function()
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(tiddler.isTouched())
			results.push(tiddler);
		});
	results.sort();
	return results;
};

// Resolves a Tiddler reference or tiddler title into a Tiddler object, or null if it doesn't exist
TiddlyWiki.prototype.resolveTiddler = function(tiddler)
{
	var t = (typeof tiddler == "string") ? this.getTiddler(tiddler) : tiddler;
	return t instanceof Tiddler ? t : null;
};

// Sort a list of tiddlers
TiddlyWiki.prototype.sortTiddlers = function(tiddlers,field)
{
	var asc = +1;
	switch(field.substr(0,1)) {
	case "-":
		asc = -1;
		field = field.substr(1);
		break;
	case "+":
		field = field.substr(1);
		break;
	}
	if(TiddlyWiki.standardFieldAccess[field]) {
		if(field=="title") {
			tiddlers.sort(function(a,b) {return a[field].toLowerCase() < b[field].toLowerCase() ? -asc : (a[field].toLowerCase() == b[field].toLowerCase() ? 0 : asc);});
		} else {
			tiddlers.sort(function(a,b) {return a[field] < b[field] ? -asc : (a[field] == b[field] ? 0 : asc);});
		}
	} else {
		tiddlers.sort(function(a,b) {return a.fields[field] < b.fields[field] ? -asc : (a.fields[field] == b.fields[field] ? 0 : +asc);});
	}
	return tiddlers;
};

//--
//-- Filter a list of tiddlers
//--

config.filters = {
	tiddler: function(results,match) {
		var title = match[1]||match[4];
		var tiddler = this.fetchTiddler(title);
		if(tiddler) {
			results.pushUnique(tiddler);
		} else if(this.isShadowTiddler(title)) {
			tiddler = new Tiddler();
			tiddler.set(title,this.getTiddlerText(title));
			results.pushUnique(tiddler);
		} else {
			results.pushUnique(new Tiddler(title));
		}
		return results;
	},
	tag: function(results,match) {
		var m,matched = this.getTaggedTiddlers(match[3]);
		for(m=0; m<matched.length; m++) {
			results.pushUnique(matched[m]);
		}
		return results;
	},
	sort: function(results,match) {
		return this.sortTiddlers(results,match[3]);
	},
	limit: function(results,match) {
		return results.slice(0,parseInt(match[3],10));
	},
	field: function(results,match) {
		var m,matched = this.getValueTiddlers(match[2],match[3]);
		for (m = 0; m < matched.length; m++) {
			results.pushUnique(matched[m]);
		}
		return results;
	}
};

// Filter a list of tiddlers
TiddlyWiki.prototype.filterTiddlers = function(filter)
{
	var re = /([^\s\[\]]+)|(?:\[([ \w\.\-]+)\[([^\]]+)\]\])|(?:\[\[([^\]]+)\]\])/mg;

	var results = [];
	if(filter) {
		var match = re.exec(filter);
		while(match) {
			var handler = (match[1]||match[4])?'tiddler':config.filters[match[2]]?match[2]:'field';
			results = config.filters[handler].call(this,results,match);
			match = re.exec(filter);
		}
	}
	return results;
};
// Returns true if path is a valid field name (path),
// i.e. a sequence of identifiers, separated by "."
TiddlyWiki.isValidFieldName = function(name)
{
	var match = /[a-zA-Z_]\w*(\.[a-zA-Z_]\w*)*/.exec(name);
	return match && (match[0] == name);
};

// Throws an exception when name is not a valid field name.
TiddlyWiki.checkFieldName = function(name)
{
	if(!TiddlyWiki.isValidFieldName(name))
		throw config.messages.invalidFieldName.format([name]);
};

function StringFieldAccess(n,readOnly)
{
	this.set = readOnly ?
			function(t,v) {if(v != t[n]) throw config.messages.fieldCannotBeChanged.format([n]);} :
			function(t,v) {if(v != t[n]) {t[n] = v; return true;}};
	this.get = function(t) {return t[n];};
}

function DateFieldAccess(n)
{
	this.set = function(t,v) {
		var d = v instanceof Date ? v : Date.convertFromYYYYMMDDHHMM(v);
		if(d != t[n]) {
			t[n] = d; return true;
		}
	};
	this.get = function(t) {return t[n].convertToYYYYMMDDHHMM();};
}

function LinksFieldAccess(n)
{
	this.set = function(t,v) {
		var s = (typeof v == "string") ? v.readBracketedList() : v;
		if(s.toString() != t[n].toString()) {
			t[n] = s; return true;
		}
	};
	this.get = function(t) {return String.encodeTiddlyLinkList(t[n]);};
}

TiddlyWiki.standardFieldAccess = {
	// The set functions return true when setting the data has changed the value.
	"title":    new StringFieldAccess("title",true),
	// Handle the "tiddler" field name as the title
	"tiddler":  new StringFieldAccess("title",true),
	"text":     new StringFieldAccess("text"),
	"modifier": new StringFieldAccess("modifier"),
	"modified": new DateFieldAccess("modified"),
	"creator":  new StringFieldAccess("creator"),
	"created":  new DateFieldAccess("created"),
	"tags":     new LinksFieldAccess("tags")
};

TiddlyWiki.isStandardField = function(name)
{
	return TiddlyWiki.standardFieldAccess[name] != undefined;
};

// Sets the value of the given field of the tiddler to the value.
// Setting an ExtendedField's value to null or undefined removes the field.
// Setting a namespace to undefined removes all fields of that namespace.
// The fieldName is case-insensitive.
// All values will be converted to a string value.
TiddlyWiki.prototype.setValue = function(tiddler,fieldName,value)
{
	TiddlyWiki.checkFieldName(fieldName);
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return;
	fieldName = fieldName.toLowerCase();
	var isRemove = (value === undefined) || (value === null);
	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if(accessor) {
		if(isRemove)
			// don't remove StandardFields
			return;
		var h = TiddlyWiki.standardFieldAccess[fieldName];
		if(!h.set(t,value))
			return;
	} else {
		var oldValue = t.fields[fieldName];
		if(isRemove) {
			if(oldValue !== undefined) {
				// deletes a single field
				delete t.fields[fieldName];
			} else {
				// no concrete value is defined for the fieldName
				// so we guess this is a namespace path.
				// delete all fields in a namespace
				var re = new RegExp("^"+fieldName+"\\.");
				var dirty = false;
				var n;
				for(n in t.fields) {
					if(n.match(re)) {
						delete t.fields[n];
						dirty = true;
					}
				}
				if(!dirty)
					return;
			}
		} else {
			// the "normal" set case. value is defined (not null/undefined)
			// For convenience provide a nicer conversion Date->String
			value = value instanceof Date ? value.convertToYYYYMMDDHHMMSSMMM() : String(value);
			if(oldValue == value)
				return;
			t.fields[fieldName] = value;
		}
	}
	// When we are here the tiddler/store really was changed.
	this.notify(t.title,true);
	if(!fieldName.match(/^temp\./))
		this.setDirty(true);
};

// Returns the value of the given field of the tiddler.
// The fieldName is case-insensitive.
// Will only return String values (or undefined).
TiddlyWiki.prototype.getValue = function(tiddler,fieldName)
{
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return undefined;
	if(fieldName.indexOf(config.textPrimitives.sectionSeparator) === 0 || fieldName.indexOf(config.textPrimitives.sliceSeparator) === 0) {
		var sliceType = fieldName.substr(0, 2);
		var sliceName = fieldName.substring(2);
		return store.getTiddlerText("%0%1%2".format(t.title,sliceType,sliceName));
	} else {
		fieldName = fieldName.toLowerCase();
		var accessor = TiddlyWiki.standardFieldAccess[fieldName];
		if(accessor) {
			return accessor.get(t);
		}
	}
	return t.fields[fieldName];
};

// Calls the callback function for every field in the tiddler.
// When callback function returns a non-false value the iteration stops
// and that value is returned.
// The order of the fields is not defined.
// @param callback a function(tiddler,fieldName,value).
TiddlyWiki.prototype.forEachField = function(tiddler,callback,onlyExtendedFields)
{
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return undefined;
	var n,result;
	for(n in t.fields) {
		result = callback(t,n,t.fields[n]);
		if(result)
			return result;
		}
	if(onlyExtendedFields)
		return undefined;
	for(n in TiddlyWiki.standardFieldAccess) {
		if(n != "tiddler") {
			// even though the "title" field can also be referenced through the name "tiddler"
			// we only visit this field once.
			result = callback(t,n,TiddlyWiki.standardFieldAccess[n].get(t));
			if(result)
				return result;
		}
	}
	return undefined;
};

//--
//-- Story functions
//--

function Story(containerId,idPrefix)
{
	this.container = containerId;
	this.idPrefix = idPrefix;
	this.highlightRegExp = null;
	this.tiddlerId = function(title) {
		title = title.replace(/_/g, "__").replace(/ /g, "_");
		var id = this.idPrefix + title;
		return id==this.container ? this.idPrefix + "_" + title : id;
	};
	this.containerId = function() {
		return this.container;
	};
}

Story.prototype.getTiddler = function(title)
{
	return document.getElementById(this.tiddlerId(title));
};

Story.prototype.getContainer = function()
{
	return document.getElementById(this.containerId());
};

Story.prototype.forEachTiddler = function(fn)
{
	var place = this.getContainer();
	if(!place)
		return;
	var e = place.firstChild;
	while(e) {
		var n = e.nextSibling;
		var title = e.getAttribute("tiddler");
		fn.call(this,title,e);
		e = n;
	}
};

Story.prototype.displayDefaultTiddlers = function()
{
	this.displayTiddlers(null,store.filterTiddlers(store.getTiddlerText("DefaultTiddlers")));
};

Story.prototype.displayTiddlers = function(srcElement,titles,template,animate,unused,customFields,toggle)
{
	var t;
	for(t = titles.length-1;t>=0;t--)
		this.displayTiddler(srcElement,titles[t],template,animate,unused,customFields);
};

Story.prototype.displayTiddler = function(srcElement,tiddler,template,animate,unused,customFields,toggle,animationSrc)
{
	var title = (tiddler instanceof Tiddler) ? tiddler.title : tiddler;
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		if(toggle) {
			if(tiddlerElem.getAttribute("dirty") != "true")
				this.closeTiddler(title,true);
		} else {
			this.refreshTiddler(title,template,false,customFields);
		}
	} else {
		var place = this.getContainer();
		var before = this.positionTiddler(srcElement);
		tiddlerElem = this.createTiddler(place,before,title,template,customFields);
	}
	if(animationSrc && typeof animationSrc !== "string") {
		srcElement = animationSrc;
	}
	if(srcElement && typeof srcElement !== "string") {
		if(config.options.chkAnimate && (animate == undefined || animate == true) && anim && typeof Zoomer == "function" && typeof Scroller == "function")
			anim.startAnimating(new Zoomer(title,srcElement,tiddlerElem),new Scroller(tiddlerElem));
		else
			window.scrollTo(0,ensureVisible(tiddlerElem));
	}
	return tiddlerElem;
};

Story.prototype.positionTiddler = function(srcElement)
{
	var place = this.getContainer();
	var before = null;
	if(typeof srcElement == "string") {
		switch(srcElement) {
		case "top":
			before = place.firstChild;
			break;
		case "bottom":
			before = null;
			break;
		}
	} else {
		var after = this.findContainingTiddler(srcElement);
		if(after == null) {
			before = place.firstChild;
		} else if(after.nextSibling) {
			before = after.nextSibling;
			if(before.nodeType != 1)
				before = null;
		}
	}
	return before;
};

Story.prototype.createTiddler = function(place,before,title,template,customFields)
{
	var tiddlerElem = createTiddlyElement(null,"div",this.tiddlerId(title),"tiddler");
	tiddlerElem.setAttribute("refresh","tiddler");
	if(customFields)
		tiddlerElem.setAttribute("tiddlyFields",customFields);
	place.insertBefore(tiddlerElem,before);
	var defaultText = null;
	if(!store.tiddlerExists(title) && !store.isShadowTiddler(title))
		defaultText = this.loadMissingTiddler(title,customFields);
	this.refreshTiddler(title,template,false,customFields,defaultText);
	return tiddlerElem;
};

Story.prototype.loadMissingTiddler = function(title,fields,callback)
{
	var getTiddlerCallback = function(context)
	{
		if(context.status) {
			var t = context.tiddler;
			if(!t.created)
				t.created = new Date();
			if(!t.modified)
				t.modified = t.created;
			context.tiddler = store.saveTiddler(t.title,t.title,t.text,t.modifier,t.modified,t.tags,t.fields,true,t.created,t.creator);
			autoSaveChanges();
		} else {
			story.refreshTiddler(context.title,null,true);
		}
		context.adaptor.close();
		if(callback) {
			callback(context);
		}
	};
	var tiddler = new Tiddler(title);
	tiddler.fields = typeof fields == "string" ? fields.decodeHashMap() : fields||{};
	var context = {serverType:tiddler.getServerType()};
	if(!context.serverType)
		return "";
	context.host = tiddler.fields['server.host'];
	context.workspace = tiddler.fields['server.workspace'];
	var adaptor = new config.adaptors[context.serverType]();
	adaptor.getTiddler(title,context,null,getTiddlerCallback);
	return config.messages.loadingMissingTiddler.format([title,context.serverType,context.host,context.workspace]);
};

Story.prototype.chooseTemplateForTiddler = function(title,template)
{
	if(!template)
		template = DEFAULT_VIEW_TEMPLATE;
	if(template == DEFAULT_VIEW_TEMPLATE || template == DEFAULT_EDIT_TEMPLATE)
		template = config.tiddlerTemplates[template];
	return template;
};

Story.prototype.getTemplateForTiddler = function(title,template,tiddler)
{
	return store.getRecursiveTiddlerText(template,null,10);
};

Story.prototype.refreshTiddler = function(title,template,force,customFields,defaultText)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		if(tiddlerElem.getAttribute("dirty") == "true" && !force)
			return tiddlerElem;
		template = this.chooseTemplateForTiddler(title,template);
		var currTemplate = tiddlerElem.getAttribute("template");
		if((template != currTemplate) || force) {
			var tiddler = store.getTiddler(title);
			if(!tiddler) {
				tiddler = new Tiddler();
				if(store.isShadowTiddler(title)) {
					var tags = [];
					tiddler.set(title,store.getTiddlerText(title),config.views.wikified.shadowModifier,version.date,tags,version.date);
				} else {
					var text = template=="EditTemplate" ?
								config.views.editor.defaultText.format([title]) :
								config.views.wikified.defaultText.format([title]);
					text = defaultText || text;
					var fields = customFields ? customFields.decodeHashMap() : null;
					tiddler.set(title,text,config.views.wikified.defaultModifier,version.date,[],version.date,fields);
				}
			}
			tiddlerElem.setAttribute("tags",tiddler.tags.join(" "));
			tiddlerElem.setAttribute("tiddler",title);
			tiddlerElem.setAttribute("template",template);
			tiddlerElem.onmouseover = this.onTiddlerMouseOver;
			tiddlerElem.onmouseout = this.onTiddlerMouseOut;
			tiddlerElem.ondblclick = this.onTiddlerDblClick;
			tiddlerElem[window.event?"onkeydown":"onkeypress"] = this.onTiddlerKeyPress;
			tiddlerElem.innerHTML = this.getTemplateForTiddler(title,template,tiddler);
			applyHtmlMacros(tiddlerElem,tiddler);
			if(store.getTaggedTiddlers(title).length > 0)
				jQuery(tiddlerElem).addClass("isTag");
			else
				jQuery(tiddlerElem).removeClass("isTag");
			if(store.tiddlerExists(title)) {
				jQuery(tiddlerElem).removeClass("shadow");
				jQuery(tiddlerElem).removeClass("missing");
			} else {
				jQuery(tiddlerElem).addClass(store.isShadowTiddler(title) ? "shadow" : "missing");
			}
			if(customFields)
				this.addCustomFields(tiddlerElem,customFields);
		}
	}
	return tiddlerElem;
};

Story.prototype.addCustomFields = function(place,customFields)
{
	var fields = customFields.decodeHashMap();
	var w = createTiddlyElement(place,"div",null,"customFields");
	w.style.display = "none";
	var t;
	for(t in fields) {
		var e = document.createElement("input");
		e.setAttribute("type","text");
		e.setAttribute("value",fields[t]);
		w.appendChild(e);
		e.setAttribute("edit",t);
	}
};

Story.prototype.refreshAllTiddlers = function(force)
{
	var e = this.getContainer().firstChild;
	while(e) {
		var template = e.getAttribute("template");
		if(template && e.getAttribute("dirty") != "true") {
			this.refreshTiddler(e.getAttribute("tiddler"),force ? null : template,true);
		}
		e = e.nextSibling;
	}
};

Story.prototype.onTiddlerMouseOver = function(e)
{
	jQuery(this).addClass("selected");
};

Story.prototype.onTiddlerMouseOut = function(e)
{
	jQuery(this).removeClass("selected");
};

Story.prototype.onTiddlerDblClick = function(ev)
{
	var e = ev || window.event;
	var target = resolveTarget(e);
	if(target && target.nodeName.toLowerCase() != "input" && target.nodeName.toLowerCase() != "textarea") {
		if(document.selection && document.selection.empty)
			document.selection.empty();
		config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
		e.cancelBubble = true;
		if(e.stopPropagation) e.stopPropagation();
		return true;
	}
	return false;
};

Story.prototype.onTiddlerKeyPress = function(ev)
{
	var e = ev || window.event;
	clearMessage();
	var consume = false;
	var title = this.getAttribute("tiddler");
	var target = resolveTarget(e);
	switch(e.keyCode) {
	case 9: // Tab
		var ed = story.getTiddlerField(title,"text");
		if(target.tagName.toLowerCase() == "input" && ed.value==config.views.editor.defaultText.format([title])) {
			// moving from input field and editor still contains default text, so select it
			ed.focus();
			ed.select();
			consume = true;
		}
		if(config.options.chkInsertTabs && target.tagName.toLowerCase() == "textarea") {
			replaceSelection(target,String.fromCharCode(9));
			consume = true;
		}
		if(config.isOpera) {
			target.onblur = function() {
				this.focus();
				this.onblur = null;
			};
		}
		break;
	case 13: // Ctrl-Enter
	case 10: // Ctrl-Enter on IE PC
	case 77: // Ctrl-Enter is "M" on some platforms
		if(e.ctrlKey) {
			blurElement(this);
			config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
			consume = true;
		}
		break;
	case 27: // Escape
		blurElement(this);
		config.macros.toolbar.invokeCommand(this,"cancelCommand",e);
		consume = true;
		break;
	}
	e.cancelBubble = consume;
	if(consume) {
		if(e.stopPropagation) e.stopPropagation(); // Stop Propagation
		e.returnValue = true; // Cancel The Event in IE
		if(e.preventDefault ) e.preventDefault(); // Cancel The Event in Moz
	}
	return !consume;
};

Story.prototype.getTiddlerField = function(title,field)
{
	var tiddlerElem = this.getTiddler(title);
	var e = null;
	if(tiddlerElem) {
		var t,children = tiddlerElem.getElementsByTagName("*");
		for(t=0; t<children.length; t++) {
			var c = children[t];
			if(c.tagName.toLowerCase() == "input" || c.tagName.toLowerCase() == "textarea") {
				if(!e)
					e = c;
				if(c.getAttribute("edit") == field)
					e = c;
			}
		}
	}
	return e;
};

Story.prototype.focusTiddler = function(title,field)
{
	var e = this.getTiddlerField(title,field);
	if(e) {
		e.focus();
		e.select();
	}
};

Story.prototype.blurTiddler = function(title)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem && tiddlerElem.focus && tiddlerElem.blur) {
		tiddlerElem.focus();
		tiddlerElem.blur();
	}
};

Story.prototype.setTiddlerField = function(title,tag,mode,field)
{
	var c = this.getTiddlerField(title,field);
	var tags = c.value.readBracketedList();
	tags.setItem(tag,mode);
	c.value = String.encodeTiddlyLinkList(tags);
};

Story.prototype.setTiddlerTag = function(title,tag,mode)
{
	this.setTiddlerField(title,tag,mode,"tags");
};

Story.prototype.closeTiddler = function(title,animate,unused)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		clearMessage();
		this.scrubTiddler(tiddlerElem);
		if(config.options.chkAnimate && animate && anim && typeof Slider == "function")
			anim.startAnimating(new Slider(tiddlerElem,false,null,"all"));
		else {
			jQuery(tiddlerElem).remove();
		}
	}
};

Story.prototype.scrubTiddler = function(tiddlerElem)
{
	tiddlerElem.id = null;
};

Story.prototype.setDirty = function(title,dirty)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem)
		tiddlerElem.setAttribute("dirty",dirty ? "true" : "false");
};

Story.prototype.isDirty = function(title)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem)
		return tiddlerElem.getAttribute("dirty") == "true";
	return null;
};

Story.prototype.areAnyDirty = function()
{
	var r = false;
	this.forEachTiddler(function(title,element) {
		if(this.isDirty(title))
			r = true;
	});
	return r;
};

Story.prototype.closeAllTiddlers = function(exclude)
{
	clearMessage();
	this.forEachTiddler(function(title,element) {
		if((title != exclude) && element.getAttribute("dirty") != "true")
			this.closeTiddler(title);
	});
	window.scrollTo(0,ensureVisible(this.container));
};

Story.prototype.isEmpty = function()
{
	var place = this.getContainer();
	return place && place.firstChild == null;
};

Story.prototype.search = function(text,useCaseSensitive,useRegExp)
{
	this.closeAllTiddlers();
	highlightHack = new RegExp(useRegExp ? text : text.escapeRegExp(),useCaseSensitive ? "mg" : "img");
	var matches = store.search(highlightHack,"title","excludeSearch");
	this.displayTiddlers(null,matches);
	highlightHack = null;
	var q = useRegExp ? "/" : "'";
	if(matches.length > 0)
		displayMessage(config.macros.search.successMsg.format([matches.length.toString(),q + text + q]));
	else
		displayMessage(config.macros.search.failureMsg.format([q + text + q]));
};

Story.prototype.findContainingTiddler = function(e)
{
	while(e && !jQuery(e).hasClass("tiddler")) {
		e = jQuery(e).hasClass("popup") && Popup.stack[0] ? Popup.stack[0].root : e.parentNode;
	}
	return e;
};

Story.prototype.gatherSaveFields = function(e,fields)
{
	if(e && e.getAttribute) {
		var f = e.getAttribute("edit");
		if(f)
			fields[f] = e.value.replace(/\r/mg,"");
		if(e.hasChildNodes()) {
			var t,c = e.childNodes;
			for(t=0; t<c.length; t++)
				this.gatherSaveFields(c[t],fields);
		}
	}
};

Story.prototype.hasChanges = function(title)
{
	var e = this.getTiddler(title);
	if(e) {
		var fields = {};
		this.gatherSaveFields(e,fields);
		if(store.fetchTiddler(title)) {
		    var n;
			for(n in fields) {
				if(store.getValue(title,n) != fields[n]) //# tiddler changed
					return true;
			}
		} else {
			if(store.isShadowTiddler(title) && store.getShadowTiddlerText(title) == fields.text) { //# not checking for title or tags
				return false;
			} else { //# changed shadow or new tiddler
				return true;
			}
		}
	}
	return false;
};

Story.prototype.saveTiddler = function(title,minorUpdate)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		var fields = {};
		this.gatherSaveFields(tiddlerElem,fields);
		var newTitle = fields.title || title;
		if(!store.tiddlerExists(newTitle)) {
			newTitle = newTitle.trim();
			var creator = config.options.txtUserName;
		}
		if(store.tiddlerExists(newTitle) && newTitle != title) {
			if(!confirm(config.messages.overwriteWarning.format([newTitle.toString()])))
				return null;
				title = newTitle;
		}
		if(newTitle != title)
			this.closeTiddler(newTitle,false);
		tiddlerElem.id = this.tiddlerId(newTitle);
		tiddlerElem.setAttribute("tiddler",newTitle);
		tiddlerElem.setAttribute("template",DEFAULT_VIEW_TEMPLATE);
		tiddlerElem.setAttribute("dirty","false");
		if(config.options.chkForceMinorUpdate)
			minorUpdate = !minorUpdate;
		if(!store.tiddlerExists(newTitle))
			minorUpdate = false;
		var newDate = new Date();
		if(store.tiddlerExists(title)) {
			var t = store.fetchTiddler(title);
			var extendedFields = t.fields;
			creator = t.creator;
		} else {
			extendedFields = merge({},config.defaultCustomFields);
		}
		var n;
		for(n in fields) {
			if(!TiddlyWiki.isStandardField(n))
				extendedFields[n] = fields[n];
		}
		var tiddler = store.saveTiddler(title,newTitle,fields.text,minorUpdate ? undefined : config.options.txtUserName,minorUpdate ? undefined : newDate,fields.tags,extendedFields,null,null,creator);
		autoSaveChanges(null,[tiddler]);
		return newTitle;
	}
	return null;
};

Story.prototype.permaView = function()
{
	var links = [];
	this.forEachTiddler(function(title,element) {
		links.push(String.encodeTiddlyLink(title));
	});
	var t = encodeURIComponent(links.join(" "));
	if(t == "")
		t = "#";
	if(window.location.hash != t)
		window.location.hash = t;
};

Story.prototype.switchTheme = function(theme)
{
	if(safeMode)
		return;

	var isAvailable = function(title) {
		var s = title ? title.indexOf(config.textPrimitives.sectionSeparator) : -1;
		if(s!=-1)
			title = title.substr(0,s);
		return store.tiddlerExists(title) || store.isShadowTiddler(title);
	};

	var getSlice = function(theme,slice) {
		var r;
		if(readOnly)
			r = store.getTiddlerSlice(theme,slice+"ReadOnly") || store.getTiddlerSlice(theme,"Web"+slice);
		r = r || store.getTiddlerSlice(theme,slice);
		if(r && r.indexOf(config.textPrimitives.sectionSeparator)==0)
			r = theme + r;
		return isAvailable(r) ? r : slice;
	};

	var replaceNotification = function(i,name,theme,slice) {
		var newName = getSlice(theme,slice);
		if(name!=newName && store.namedNotifications[i].name==name) {
			store.namedNotifications[i].name = newName;
			return newName;
		}
		return name;
	};

	var pt = config.refresherData.pageTemplate;
	var vi = DEFAULT_VIEW_TEMPLATE;
	var vt = config.tiddlerTemplates[vi];
	var ei = DEFAULT_EDIT_TEMPLATE;
	var et = config.tiddlerTemplates[ei];

	var i;
	for(i=0; i<config.notifyTiddlers.length; i++) {
		var name = config.notifyTiddlers[i].name;
		switch(name) {
		case "PageTemplate":
			config.refresherData.pageTemplate = replaceNotification(i,config.refresherData.pageTemplate,theme,name);
			break;
		case "StyleSheet":
			removeStyleSheet(config.refresherData.styleSheet);
			config.refresherData.styleSheet = replaceNotification(i,config.refresherData.styleSheet,theme,name);
			break;
		case "ColorPalette":
			config.refresherData.colorPalette = replaceNotification(i,config.refresherData.colorPalette,theme,name);
			break;
		default:
			break;
		}
	}
	config.tiddlerTemplates[vi] = getSlice(theme,"ViewTemplate");
	config.tiddlerTemplates[ei] = getSlice(theme,"EditTemplate");
	if(!startingUp) {
		if(config.refresherData.pageTemplate!=pt || config.tiddlerTemplates[vi]!=vt || config.tiddlerTemplates[ei]!=et) {
			refreshAll();
			this.refreshAllTiddlers(true);
		} else {
			setStylesheet(store.getRecursiveTiddlerText(config.refresherData.styleSheet,"",10),config.refreshers.styleSheet);
		}
		config.options.txtTheme = theme;
		saveOption("txtTheme");
	}
};

//--
//-- Backstage
//--
// Backstage tasks
config.tasks.save.action = saveChanges;

var backstage = {
	area: null,
	toolbar: null,
	button: null,
	showButton: null,
	hideButton: null,
	cloak: null,
	panel: null,
	panelBody: null,
	panelFooter: null,
	currTabName: null,
	currTabElem: null,
	content: null,

	init: function() {
		var cmb = config.messages.backstage;
		this.area = document.getElementById("backstageArea");
		this.toolbar = jQuery("#backstageToolbar").empty()[0];
		this.button = jQuery("#backstageButton").empty()[0];
		this.button.style.display = "block";
		var t = cmb.open.text + " " + glyph("bentArrowLeft");
		this.showButton = createTiddlyButton(this.button,t,cmb.open.tooltip,
						function(e) {backstage.show(); return false;},null,"backstageShow");
		t = glyph("bentArrowRight") + " " + cmb.close.text;
		this.hideButton = createTiddlyButton(this.button,t,cmb.close.tooltip,
						function(e) {backstage.hide(); return false;},null,"backstageHide");
		this.cloak = document.getElementById("backstageCloak");
		this.panel = document.getElementById("backstagePanel");
		this.panelFooter = createTiddlyElement(this.panel,"div",null,"backstagePanelFooter");
		this.panelBody = createTiddlyElement(this.panel,"div",null,"backstagePanelBody");
		this.cloak.onmousedown = function(e) {backstage.switchTab(null);};
		createTiddlyText(this.toolbar,cmb.prompt);
		for(t=0; t<config.backstageTasks.length; t++) {
			var taskName = config.backstageTasks[t];
			var task = config.tasks[taskName];
			var handler = task.action ? this.onClickCommand : this.onClickTab;
			var text = task.text + (task.action ? "" : glyph("downTriangle"));
			var btn = createTiddlyButton(this.toolbar,text,task.tooltip,handler,"backstageTab");
			jQuery(btn).addClass(task.action ? "backstageAction" : "backstageTask");
			btn.setAttribute("task", taskName);
			}
		this.content = document.getElementById("contentWrapper");
		if(config.options.chkBackstage)
			this.show();
		else
			this.hide();
	},

	isVisible: function() {
		return this.area ? this.area.style.display == "block" : false;
	},

	show: function() {
		this.area.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.toolbar.style.left = findWindowWidth() + "px";
			var p = [{style: "left", start: findWindowWidth(), end: 0, template: "%0px"}];
			anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p));
		} else {
			backstage.area.style.left = "0px";
		}
		jQuery(this.showButton).hide();
		jQuery(this.hideButton).show();
		config.options.chkBackstage = true;
		saveOption("chkBackstage");
		jQuery(this.content).addClass("backstageVisible");
	},

	hide: function() {
		if(this.currTabElem) {
			this.switchTab(null);
		} else {
			backstage.toolbar.style.left = "0px";
			if(anim && config.options.chkAnimate) {
				var p = [{style: "left", start: 0, end: findWindowWidth(), template: "%0px"}];
				var c = function(element,properties) {backstage.area.style.display = "none";};
				anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p,c));
			} else {
				this.area.style.display = "none";
			}
			this.showButton.style.display = "block";
			this.hideButton.style.display = "none";
			config.options.chkBackstage = false;
			saveOption("chkBackstage");
			jQuery(this.content).removeClass("backstageVisible");
		}
	},

	onClickCommand: function(e) {
		var task = config.tasks[this.getAttribute("task")];
		if(task.action) {
			backstage.switchTab(null);
			task.action();
		}
		return false;
	},

	onClickTab: function(e) {
		backstage.switchTab(this.getAttribute("task"));
		return false;
	},

	// Switch to a given tab, or none if null is passed
	switchTab: function(tabName) {
		var tabElem = null;
		var e = this.toolbar.firstChild;
		while(e) {
			if(e.getAttribute && e.getAttribute("task") == tabName)
				tabElem = e;
			e = e.nextSibling;
		}
		if(tabName == backstage.currTabName) {
			backstage.hidePanel();
			return;
		}
		if(backstage.currTabElem) {
			jQuery(this.currTabElem).removeClass("backstageSelTab");
		}
		if(tabElem && tabName) {
			backstage.preparePanel();
			jQuery(tabElem).addClass("backstageSelTab");
			var task = config.tasks[tabName];
			wikify(task.content,backstage.panelBody,null,null);
			backstage.showPanel();
		} else if(backstage.currTabElem) {
			backstage.hidePanel();
		}
		backstage.currTabName = tabName;
		backstage.currTabElem = tabElem;
	},

	isPanelVisible: function() {
		return backstage.panel ? backstage.panel.style.display == "block" : false;
	},

	preparePanel: function() {
		backstage.cloak.style.height = findWindowHeight() + "px";
		backstage.cloak.style.display = "block";
		jQuery(backstage.panelBody).empty();
		return backstage.panelBody;
	},

	showPanel: function() {
		backstage.panel.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.panel.style.top = (-backstage.panel.offsetHeight) + "px";
			var p = [{style: "top", start: -backstage.panel.offsetHeight, end: 0, template: "%0px"}];
			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p),new Scroller(backstage.panel,false));
		} else {
			backstage.panel.style.top = "0px";
		}
		return backstage.panelBody;
	},

	hidePanel: function() {
		if(backstage.currTabElem)
			jQuery(backstage.currTabElem).removeClass("backstageSelTab");
		backstage.currTabElem = null;
		backstage.currTabName = null;
		if(anim && config.options.chkAnimate) {
			var p = [
				{style: "top", start: 0, end: -(backstage.panel.offsetHeight), template: "%0px"},
				{style: "display", atEnd: "none"}
			];
			var c = function(element,properties) {backstage.cloak.style.display = "none";};
			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p,c));
		} else {
			jQuery([backstage.panel,backstage.cloak]).hide();
		}
	}
};

config.macros.backstage = {};

config.macros.backstage.handler = function(place,macroName,params)
{
	var backstageTask = config.tasks[params[0]];
	if(backstageTask)
		createTiddlyButton(place,backstageTask.text,backstageTask.tooltip,function(e) {backstage.switchTab(params[0]); return false;});
};

//--
//-- ImportTiddlers macro
//--

config.macros.importTiddlers.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(readOnly) {
		createTiddlyElement(place,"div",null,"marked",this.readOnlyWarning);
		return;
	}
	var w = new Wizard();
	w.createWizard(place,this.wizardTitle);
	this.restart(w);
};

config.macros.importTiddlers.onCancel = function(e)
{
	var wizard = new Wizard(this);
	wizard.clear();
	config.macros.importTiddlers.restart(wizard);
	return false;
};

config.macros.importTiddlers.onClose = function(e)
{
	backstage.hidePanel();
	return false;
};

config.macros.importTiddlers.restart = function(wizard)
{
	var me = config.macros.importTiddlers;
	wizard.addStep(this.step1Title,this.step1Html);
	var t,s = wizard.getElement("selTypes");
	for(t in config.adaptors) {
		var e = createTiddlyElement(s,"option",null,null,config.adaptors[t].serverLabel || t);
		e.value = t;
	}
	if(config.defaultAdaptor)
		s.value = config.defaultAdaptor;
	s = wizard.getElement("selFeeds");
	var feeds = this.getFeeds();
	for(t in feeds) {
		e = createTiddlyElement(s,"option",null,null,t);
		e.value = t;
	}
	wizard.setValue("feeds",feeds);
	s.onchange = me.onFeedChange;
	var fileInput = wizard.getElement("txtBrowse");
	fileInput.onchange = me.onBrowseChange;
	fileInput.onkeyup = me.onBrowseChange;
	wizard.setButtons([{caption: this.openLabel, tooltip: this.openPrompt, onClick: me.onOpen}]);
	wizard.formElem.action = "javascript:;";
	wizard.formElem.onsubmit = function() {
		if(!this.txtPath || this.txtPath.value.length) //# check for manually entered path in first step
			this.lastChild.firstChild.onclick();
	};
};

config.macros.importTiddlers.getFeeds = function()
{
	var feeds = {};
	var t,tagged = store.getTaggedTiddlers("systemServer","title");
	for(t=0; t<tagged.length; t++) {
		var title = tagged[t].title;
		var serverType = store.getTiddlerSlice(title,"Type");
		if(!serverType)
			serverType = "file";
		feeds[title] = {title: title,
						url: store.getTiddlerSlice(title,"URL"),
						workspace: store.getTiddlerSlice(title,"Workspace"),
						workspaceList: store.getTiddlerSlice(title,"WorkspaceList"),
						tiddlerFilter: store.getTiddlerSlice(title,"TiddlerFilter"),
						serverType: serverType,
						description: store.getTiddlerSlice(title,"Description")};
	}
	return feeds;
};

config.macros.importTiddlers.onFeedChange = function(e)
{
	var wizard = new Wizard(this);
	var selTypes = wizard.getElement("selTypes");
	var fileInput = wizard.getElement("txtPath");
	var feeds = wizard.getValue("feeds");
	var f = feeds[this.value];
	if(f) {
		selTypes.value = f.serverType;
		fileInput.value = f.url;
		wizard.setValue("feedName",f.serverType);
		wizard.setValue("feedHost",f.url);
		wizard.setValue("feedWorkspace",f.workspace);
		wizard.setValue("feedWorkspaceList",f.workspaceList);
		wizard.setValue("feedTiddlerFilter",f.tiddlerFilter);
	}
	return false;
};

config.macros.importTiddlers.onBrowseChange = function(e)
{
	var wizard = new Wizard(this);
	var file = this.value;
	if(this.files && this.files[0]) {
		file = this.files[0].fileName;
		try {
			if(typeof(netscape) !== "undefined") {
				netscape.security.PrivilegeManager.enablePrivilege("UniversalFileRead");
			}
		} catch (ex) {
			showException(ex);
		}
	}
	var fileInput = wizard.getElement("txtPath");
	fileInput.value = config.macros.importTiddlers.getURLFromLocalPath(file);
	var serverType = wizard.getElement("selTypes");
	serverType.value = "file";
	return true;
};

config.macros.importTiddlers.getURLFromLocalPath = function(v)
{
	if(!v || !v.length)
		return v;
	v = v.replace(/\\/g,"/"); // use "/" for cross-platform consistency
	var u;
	var t = v.split(":");
	var p = t[1] || t[0]; // remove drive letter (if any)
	if(t[1] && (t[0] == "http" || t[0] == "https" || t[0] == "file")) {
		u = v;
	} else if(p.substr(0,1)=="/") {
		u = document.location.protocol + "//" + document.location.hostname + (t[1] ? "/" : "") + v;
	} else {
		var c = document.location.href.replace(/\\/g,"/");
		var pos = c.lastIndexOf("/");
		if(pos!=-1)
			c = c.substr(0,pos); // remove filename
		u = c + "/" + p;
	}
	return u;
};

config.macros.importTiddlers.onOpen = function(e)
{
	var me = config.macros.importTiddlers;
	var wizard = new Wizard(this);
	var fileInput = wizard.getElement("txtPath");
	var url = fileInput.value;
	var serverType = wizard.getElement("selTypes").value || config.defaultAdaptor;
	var adaptor = new config.adaptors[serverType]();
	wizard.setValue("adaptor",adaptor);
	wizard.setValue("serverType",serverType);
	wizard.setValue("host",url);
	adaptor.openHost(url,null,wizard,me.onOpenHost);
	wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusOpenHost);
	return false;
};

config.macros.importTiddlers.onOpenHost = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	var adaptor = wizard.getValue("adaptor");
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenHost: " + context.statusText);
	adaptor.getWorkspaceList(context,wizard,me.onGetWorkspaceList);
	wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusGetWorkspaceList);
};

config.macros.importTiddlers.onGetWorkspaceList = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onGetWorkspaceList: " + context.statusText);
	wizard.setValue("context",context);
	var workspace = wizard.getValue("feedWorkspace");
	if(!workspace && context.workspaces.length==1)
		workspace = context.workspaces[0].title;
	if(workspace) {
		context.adaptor.openWorkspace(workspace,context,wizard,me.onOpenWorkspace);
		wizard.setValue("workspace",workspace);
		wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusOpenWorkspace);
		return;
	}
	wizard.addStep(me.step2Title,me.step2Html);
	var t,s = wizard.getElement("selWorkspace");
	s.onchange = me.onWorkspaceChange;
	for(t=0; t<context.workspaces.length; t++) {
		var e = createTiddlyElement(s,"option",null,null,context.workspaces[t].title);
		e.value = context.workspaces[t].title;
	}
	var workspaceList = wizard.getValue("feedWorkspaceList");
	if(workspaceList) {
		var n,list = workspaceList.parseParams("workspace",null,false,true);
		for(n=1; n<list.length; n++) {
			if(context.workspaces.findByField("title",list[n].value) == null) {
				e = createTiddlyElement(s,"option",null,null,list[n].value);
				e.value = list[n].value;
			}
		}
	}
	if(workspace) {
		t = wizard.getElement("txtWorkspace");
		t.value = workspace;
	}
	wizard.setButtons([{caption: me.openLabel, tooltip: me.openPrompt, onClick: me.onChooseWorkspace}]);
};

config.macros.importTiddlers.onWorkspaceChange = function(e)
{
	var wizard = new Wizard(this);
	var t = wizard.getElement("txtWorkspace");
	t.value = this.value;
	this.selectedIndex = 0;
	return false;
};

config.macros.importTiddlers.onChooseWorkspace = function(e)
{
	var me = config.macros.importTiddlers;
	var wizard = new Wizard(this);
	var adaptor = wizard.getValue("adaptor");
	var workspace = wizard.getElement("txtWorkspace").value;
	wizard.setValue("workspace",workspace);
	var context = wizard.getValue("context");
	adaptor.openWorkspace(workspace,context,wizard,me.onOpenWorkspace);
	wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusOpenWorkspace);
	return false;
};

config.macros.importTiddlers.onOpenWorkspace = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenWorkspace: " + context.statusText);
	var adaptor = wizard.getValue("adaptor");
	adaptor.getTiddlerList(context,wizard,me.onGetTiddlerList,wizard.getValue("feedTiddlerFilter"));
	wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusGetTiddlerList);
};

config.macros.importTiddlers.onGetTiddlerList = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	if(context.status !== true) {
		var error = context.statusText||me.errorGettingTiddlerList;
		if(context.host.indexOf("file://") === 0) {
			error = me.errorGettingTiddlerListFile;
		} else {
			error = context.xhr && context.xhr.status == 404 ? me.errorGettingTiddlerListHttp404 :
				me.errorGettingTiddlerListHttp;
		}
		wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],"");
		jQuery("span.status", wizard.footerEl).html(error); // so error message can be html
		return;
	}
	// Extract data for the listview
	var listedTiddlers = [];
	if(context.tiddlers) {
		var n;
		for(n=0; n<context.tiddlers.length; n++) {
			var tiddler = context.tiddlers[n];
			listedTiddlers.push({
				title: tiddler.title,
				modified: tiddler.modified,
				modifier: tiddler.modifier,
				text: tiddler.text ? wikifyPlainText(tiddler.text,100) : "",
				tags: tiddler.tags,
				size: tiddler.text ? tiddler.text.length : 0,
				tiddler: tiddler
			});
		}
	}
	listedTiddlers.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
	// Display the listview
	wizard.addStep(me.step3Title,me.step3Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	var listView = ListView.create(listWrapper,listedTiddlers,me.listViewTemplate);
	wizard.setValue("listView",listView);
	wizard.setValue("context",context);
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler");
	txtSaveTiddler.value = me.generateSystemServerName(wizard);
	wizard.setButtons([
			{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel},
			{caption: me.importLabel, tooltip: me.importPrompt, onClick: me.doImport}
		]);
};

config.macros.importTiddlers.generateSystemServerName = function(wizard)
{
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var pattern = config.macros.importTiddlers[workspace ? "systemServerNamePattern" : "systemServerNamePatternNoWorkspace"];
	return pattern.format([serverType,host,workspace]);
};

config.macros.importTiddlers.saveServerTiddler = function(wizard)
{
	var me = config.macros.importTiddlers;
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler").value;
	if(store.tiddlerExists(txtSaveTiddler)) {
		if(!confirm(me.confirmOverwriteSaveTiddler.format([txtSaveTiddler])))
			return;
		store.suspendNotifications();
		store.removeTiddler(txtSaveTiddler);
		store.resumeNotifications();
	}
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var text = me.serverSaveTemplate.format([serverType,host,workspace]);
	store.saveTiddler(txtSaveTiddler,txtSaveTiddler,text,me.serverSaveModifier,new Date(),["systemServer"]);
};

config.macros.importTiddlers.doImport = function(e)
{
	var me = config.macros.importTiddlers;
	var wizard = new Wizard(this);
	if(wizard.getElement("chkSave").checked)
		me.saveServerTiddler(wizard);
	var chkSync = wizard.getElement("chkSync").checked;
	wizard.setValue("sync",chkSync);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	var adaptor = wizard.getValue("adaptor");
	var overwrite = [];
	var t;
	for(t=0; t<rowNames.length; t++) {
		if(store.tiddlerExists(rowNames[t]))
			overwrite.push(rowNames[t]);
	}
	if(overwrite.length > 0) {
		if(!confirm(me.confirmOverwriteText.format([overwrite.join(", ")])))
			return false;
	}
	wizard.addStep(me.step4Title.format([rowNames.length]),me.step4Html);
	for(t=0; t<rowNames.length; t++) {
		var link = document.createElement("div");
		createTiddlyLink(link,rowNames[t],true);
		var place = wizard.getElement("markReport");
		place.parentNode.insertBefore(link,place);
	}
	wizard.setValue("remainingImports",rowNames.length);
	wizard.setButtons([
			{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}
		],me.statusDoingImport);
	var wizardContext = wizard.getValue("context");
	var tiddlers = wizardContext ? wizardContext.tiddlers : [];
	for(t=0; t<rowNames.length; t++) {
		var context = {
			allowSynchronous:true,
			tiddler:tiddlers[tiddlers.findByField("title",rowNames[t])]
		};
		adaptor.getTiddler(rowNames[t],context,wizard,me.onGetTiddler);
	}
	return false;
};

config.macros.importTiddlers.onGetTiddler = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	if(!context.status)
		displayMessage("Error in importTiddlers.onGetTiddler: " + context.statusText);
	var tiddler = context.tiddler;
	store.suspendNotifications();
	store.saveTiddler(tiddler.title, tiddler.title, tiddler.text, tiddler.modifier, tiddler.modified, tiddler.tags, tiddler.fields, true, tiddler.created);
	if(!wizard.getValue("sync")) {
		store.setValue(tiddler.title,'server',null);
	}
	store.resumeNotifications();
	if(!context.isSynchronous)
		store.notify(tiddler.title,true);
	var remainingImports = wizard.getValue("remainingImports")-1;
	wizard.setValue("remainingImports",remainingImports);
	if(remainingImports == 0) {
		if(context.isSynchronous) {
			store.notifyAll();
			refreshDisplay();
		}
		wizard.setButtons([
				{caption: me.doneLabel, tooltip: me.donePrompt, onClick: me.onClose}
			],me.statusDoneImport);
		autoSaveChanges();
	}
};

//--
//-- Upgrade macro
//--

config.macros.upgrade.handler = function(place)
{
	var w = new Wizard();
	w.createWizard(place,this.wizardTitle);
	w.addStep(this.step1Title,this.step1Html.format([this.source,this.source]));
	w.setButtons([{caption: this.upgradeLabel, tooltip: this.upgradePrompt, onClick: this.onClickUpgrade}]);
};

config.macros.upgrade.onClickUpgrade = function(e)
{
	var me = config.macros.upgrade;
	var w = new Wizard(this);
	if(window.location.protocol != "file:") {
		alert(me.errorCantUpgrade);
		return false;
	}
	if(story.areAnyDirty() || store.isDirty()) {
		alert(me.errorNotSaved);
		return false;
	}
	var localPath = getLocalPath(document.location.toString());
	var backupPath = getBackupPath(localPath,me.backupExtension);
	w.setValue("backupPath",backupPath);
	w.setButtons([],me.statusPreparingBackup);
	var original = loadOriginal(localPath);
	w.setButtons([],me.statusSavingBackup);
	var backup = copyFile(backupPath,localPath);
	if(!backup)
		backup = saveFile(backupPath,original);
	if(!backup) {
		w.setButtons([],me.errorSavingBackup);
		alert(me.errorSavingBackup);
		return false;
	}
	w.setButtons([],me.statusLoadingCore);
	var options = {
		type:"GET",
		url:me.source,
		processData:false,
		success:function(data,textStatus,jqXHR) {
			me.onLoadCore(true,w,jqXHR.responseText,me.source,jqXHR);
		},
		error:function(jqXHR,textStatus,errorThrown) {
			me.onLoadCore(false,w,null,me.source,jqXHR);
		}
	};
	ajaxReq(options);
	return false;
};

config.macros.upgrade.onLoadCore = function(status,params,responseText,url,xhr)
{
	var me = config.macros.upgrade;
	var w = params;
	var errMsg;
	if(!status)
		errMsg = me.errorLoadingCore;
	var newVer = me.extractVersion(responseText);
	if(!newVer)
		errMsg = me.errorCoreFormat;
	if(errMsg) {
		w.setButtons([],errMsg);
		alert(errMsg);
		return;
	}
	var onStartUpgrade = function(e) {
		w.setButtons([],me.statusSavingCore);
		var localPath = getLocalPath(document.location.toString());
		saveFile(localPath,responseText);
		w.setButtons([],me.statusReloadingCore);
		var backupPath = w.getValue("backupPath");
		var newLoc = document.location.toString() + "?time=" + new Date().convertToYYYYMMDDHHMM() + "#upgrade:[[" + encodeURI(backupPath) + "]]";
		window.setTimeout(function () {window.location = newLoc;},10);
	};
	var step2 = [me.step2Html_downgrade,me.step2Html_restore,me.step2Html_upgrade][compareVersions(version,newVer) + 1];
	w.addStep(me.step2Title,step2.format([formatVersion(newVer),formatVersion(version)]));
	w.setButtons([{caption: me.startLabel, tooltip: me.startPrompt, onClick: onStartUpgrade},{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}]);
};

config.macros.upgrade.onCancel = function(e)
{
	var me = config.macros.upgrade;
	var w = new Wizard(this);
	w.addStep(me.step3Title,me.step3Html);
	w.setButtons([]);
	return false;
};

config.macros.upgrade.extractVersion = function(upgradeFile)
{
	var re = /^var version = \{title: "([^"]+)", major: (\d+), minor: (\d+), revision: (\d+)(, beta: (\d+)){0,1}, date: new Date\("([^"]+)"\)/mg;
	var m = re.exec(upgradeFile);
	return m ? {title: m[1], major: m[2], minor: m[3], revision: m[4], beta: m[6], date: new Date(m[7])} : null;
};

function upgradeFrom(path)
{
	var importStore = new TiddlyWiki();
	var tw = loadFile(path);
	if(window.netscape !== undefined)
		tw = convertUTF8ToUnicode(tw);
	importStore.importTiddlyWiki(tw);
	importStore.forEachTiddler(function(title,tiddler) {
		if(!store.getTiddler(title)) {
			store.addTiddler(tiddler);
		}
	});
	refreshDisplay();
	saveChanges(); //# To create appropriate Markup* sections
	alert(config.messages.upgradeDone.format([formatVersion()]));
	window.location = window.location.toString().substr(0,window.location.toString().lastIndexOf("?"));
}

//--
//-- Sync macro
//--

// Synchronisation handlers
config.syncers = {};

// Sync state.
var currSync = null;

// sync macro
config.macros.sync.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(!wikifier.isStatic)
		this.startSync(place);
};

config.macros.sync.cancelSync = function()
{
	currSync = null;
};

config.macros.sync.startSync = function(place)
{
	if(currSync)
		config.macros.sync.cancelSync();
	currSync = {};
	currSync.syncList = this.getSyncableTiddlers();
	currSync.syncTasks = this.createSyncTasks(currSync.syncList);
	this.preProcessSyncableTiddlers(currSync.syncList);
	var wizard = new Wizard();
	currSync.wizard = wizard;
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	currSync.listView = ListView.create(listWrapper,currSync.syncList,this.listViewTemplate);
	this.processSyncableTiddlers(currSync.syncList);
	wizard.setButtons([{caption: this.syncLabel, tooltip: this.syncPrompt, onClick: this.doSync}]);
};

config.macros.sync.getSyncableTiddlers = function()
{
	var list = [];
	store.forEachTiddler(function(title,tiddler) {
		var syncItem = {};
		syncItem.serverType = tiddler.getServerType();
		syncItem.serverHost = tiddler.fields['server.host'];
		if(syncItem.serverType && syncItem.serverHost) {
			syncItem.adaptor = new config.adaptors[syncItem.serverType]();
			syncItem.serverHost = syncItem.adaptor.fullHostName(syncItem.serverHost);
			syncItem.serverWorkspace = tiddler.fields['server.workspace'];
			syncItem.tiddler = tiddler;
			syncItem.title = tiddler.title;
			syncItem.isTouched = tiddler.isTouched();
			syncItem.selected = syncItem.isTouched;
			syncItem.syncStatus = config.macros.sync.syncStatusList[syncItem.isTouched ? "changedLocally" : "none"];
			syncItem.status = syncItem.syncStatus.text;
			list.push(syncItem);
		}
		});
	list.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
	return list;
};

config.macros.sync.preProcessSyncableTiddlers = function(syncList)
{
	var i;
	for(i=0; i<syncList.length; i++) {
		var si = syncList[i];
		si.serverUrl = si.adaptor.generateTiddlerInfo(si.tiddler).uri;
	}
};

config.macros.sync.processSyncableTiddlers = function(syncList)
{
	var i;
	for(i=0; i<syncList.length; i++) {
		var si = syncList[i];
		if(si.syncStatus.display)
			si.rowElement.style.display = si.syncStatus.display;
		if(si.syncStatus.className)
			si.rowElement.className = si.syncStatus.className;
	}
};

config.macros.sync.createSyncTasks = function(syncList)
{
	var i,syncTasks = [];
	for(i=0; i<syncList.length; i++) {
		var si = syncList[i];
		var j,r = null;
		for(j=0; j<syncTasks.length; j++) {
			var cst = syncTasks[j];
			if(si.serverType == cst.serverType && si.serverHost == cst.serverHost && si.serverWorkspace == cst.serverWorkspace)
				r = cst;
		}
		if(r) {
			si.syncTask = r;
			r.syncItems.push(si);
		} else {
			si.syncTask = this.createSyncTask(si);
			syncTasks.push(si.syncTask);
		}
	}
	return syncTasks;
};

config.macros.sync.createSyncTask = function(syncItem)
{
	var st = {};
	st.serverType = syncItem.serverType;
	st.serverHost = syncItem.serverHost;
	st.serverWorkspace = syncItem.serverWorkspace;
	st.syncItems = [syncItem];

	var getTiddlerListCallback = function(context,sycnItems) {
		var me = config.macros.sync;
		if(!context.status) {
			displayMessage(context.statusText);
			return false;
		}
		syncItems = context.userParams;
		var i,tiddlers = context.tiddlers;
		for(i=0; i<syncItems.length; i++) {
			var si = syncItems[i];
			var f = tiddlers.findByField("title",si.title);
			if(f !== null) {
				if(tiddlers[f].fields['server.page.revision'] > si.tiddler.fields['server.page.revision']) {
					si.syncStatus = me.syncStatusList[si.isTouched ? 'changedBoth' : 'changedServer'];
				}
			} else {
				si.syncStatus = me.syncStatusList.notFound;
			}
			me.updateSyncStatus(si);
		}
		return true;
	};

	var openWorkspaceCallback = function(context,syncItems) {
		if(context.status) {
			context.adaptor.getTiddlerList(context,syncItems,getTiddlerListCallback);
			return true;
		}
		displayMessage(context.statusText);
		return false;
	};

	var context = {host:st.serverHost,workspace:st.serverWorkspace};
	syncItem.adaptor.openHost(st.serverHost);
	syncItem.adaptor.openWorkspace(st.serverWorkspace,context,st.syncItems,openWorkspaceCallback);
	return st;
};

config.macros.sync.updateSyncStatus = function(syncItem)
{
	var e = syncItem.colElements["status"];
	jQuery(e).empty();
	createTiddlyText(e,syncItem.syncStatus.text);
	syncItem.rowElement.style.display = syncItem.syncStatus.display;
	if(syncItem.syncStatus.className)
		syncItem.rowElement.className = syncItem.syncStatus.className;
};

config.macros.sync.doSync = function(e)
{
	var me = config.macros.sync;
	var getTiddlerCallback = function(context,syncItem) {
		if(syncItem) {
			var tiddler = context.tiddler;
			store.saveTiddler(tiddler.title,tiddler.title,tiddler.text,tiddler.modifier,tiddler.modified,tiddler.tags,tiddler.fields,true,tiddler.created);
			syncItem.syncStatus = me.syncStatusList.gotFromServer;
			me.updateSyncStatus(syncItem);
		}
	};
	var putTiddlerCallback = function(context,syncItem) {
		if(syncItem) {
			store.resetTiddler(context.title);
			syncItem.syncStatus = me.syncStatusList.putToServer;
			me.updateSyncStatus(syncItem);
		}
	};

	var rowNames = ListView.getSelectedRows(currSync.listView);
	var i,sl = me.syncStatusList;
	for(i=0; i<currSync.syncList.length; i++) {
		var si = currSync.syncList[i];
		if(rowNames.indexOf(si.title) != -1) {
			var errorMsg = "Error in doSync: ";
			try {
				var r = true;
				switch(si.syncStatus) {
				case sl.changedServer:
					var context = {"workspace": si.serverWorkspace};
					r = si.adaptor.getTiddler(si.title,context,si,getTiddlerCallback);
					break;
				case sl.notFound:
				case sl.changedLocally:
				case sl.changedBoth:
					r = si.adaptor.putTiddler(si.tiddler,null,si,putTiddlerCallback);
					break;
				default:
					break;
				}
				if(!r)
					displayMessage(errorMsg + r);
			} catch(ex) {
				if(ex.name == "TypeError")
					displayMessage("sync operation unsupported: " + ex.message);
				else
					displayMessage(errorMsg + ex.message);
			}
		}
	}
	return false;
};

//--
//-- Manager UI for groups of tiddlers
//--

config.macros.plugins.handler = function(place,macroName,params,wikifier,paramString)
{
	var wizard = new Wizard();
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	listWrapper.setAttribute("refresh","macro");
	listWrapper.setAttribute("macroName","plugins");
	listWrapper.setAttribute("params",paramString);
	this.refresh(listWrapper,paramString);
};

config.macros.plugins.refresh = function(listWrapper,params)
{
	var me = config.macros.plugins;
	var wizard = new Wizard(listWrapper);
	var selectedRows = [];
	ListView.forEachSelector(listWrapper,function(e,rowName) {
			if(e.checked)
				selectedRows.push(e.getAttribute("rowName"));
		});
	jQuery(listWrapper).empty();
	params = params.parseParams("anon");
	var plugins = installedPlugins.slice(0);
	var t,tiddler,p;
	var configTiddlers = store.getTaggedTiddlers("systemConfig");
	for(t=0; t<configTiddlers.length; t++) {
		tiddler = configTiddlers[t];
		if(plugins.findByField("title",tiddler.title) == null) {
			p = getPluginInfo(tiddler);
			p.executed = false;
			p.log.splice(0,0,this.skippedText);
			plugins.push(p);
		}
	}
	for(t=0; t<plugins.length; t++) {
		p = plugins[t];
		p.size = p.tiddler.text ? p.tiddler.text.length : 0;
		p.forced = p.tiddler.isTagged("systemConfigForce");
		p.disabled = p.tiddler.isTagged("systemConfigDisable");
		p.Selected = selectedRows.indexOf(plugins[t].title) != -1;
	}
	if(plugins.length == 0) {
		createTiddlyElement(listWrapper,"em",null,null,this.noPluginText);
		wizard.setButtons([]);
	} else {
		var template = readOnly ? this.listViewTemplateReadOnly : this.listViewTemplate;
		var listView = ListView.create(listWrapper,plugins,template,this.onSelectCommand);
		wizard.setValue("listView",listView);
		if(!readOnly) {
			wizard.setButtons([
				{caption: me.removeLabel, tooltip: me.removePrompt, onClick: me.doRemoveTag},
				{caption: me.deleteLabel, tooltip: me.deletePrompt, onClick: me.doDelete}
			]);
		}
	}
};

config.macros.plugins.doRemoveTag = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		var t;
		for(t=0; t<rowNames.length; t++) {
			store.setTiddlerTag(rowNames[t],false,"systemConfig");
		}
		autoSaveChanges();
	}
};

config.macros.plugins.doDelete = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		if(confirm(config.macros.plugins.confirmDeleteText.format([rowNames.join(", ")]))) {
			var t;
			for(t=0; t<rowNames.length; t++) {
				store.removeTiddler(rowNames[t]);
				story.closeTiddler(rowNames[t],true);
			}
		}
		autoSaveChanges();
	}
};

//--
//-- Message area
//--

function getMessageDiv()
{
	var msgArea = document.getElementById("messageArea");
	if(!msgArea)
		return null;
	if(!msgArea.hasChildNodes())
		createTiddlyButton(createTiddlyElement(msgArea,"div",null,"messageToolbar"),
			config.messages.messageClose.text,
			config.messages.messageClose.tooltip,
			clearMessage);
	msgArea.style.display = "block";
	return createTiddlyElement(msgArea,"div");
}

function displayMessage(text,linkText)
{
	var e = getMessageDiv();
	if(!e) {
		alert(text);
		return;
	}
	if(linkText) {
		var link = createTiddlyElement(e,"a",null,null,text);
		link.href = linkText;
		link.target = "_blank";
	} else {
		e.appendChild(document.createTextNode(text));
	}
}

function clearMessage()
{
	var msgArea = document.getElementById("messageArea");
	if(msgArea) {
		jQuery(msgArea).empty();
		msgArea.style.display = "none";
	}
	return false;
}

//--
//-- Refresh mechanism
//--

config.notifyTiddlers = [
	{name: "SystemSettings", notify: onSystemSettingsChange},
	{name: "StyleSheetLayout", notify: refreshStyles},
	{name: "StyleSheetColors", notify: refreshStyles},
	{name: "StyleSheet", notify: refreshStyles},
	{name: "StyleSheetPrint", notify: refreshStyles},
	{name: "PageTemplate", notify: refreshPageTemplate},
	{name: "SiteTitle", notify: refreshPageTitle},
	{name: "SiteSubtitle", notify: refreshPageTitle},
	{name: "WindowTitle", notify: refreshPageTitle},
	{name: "ColorPalette", notify: refreshColorPalette},
	{name: null, notify: refreshDisplay}
];

config.refreshers = {
	link: function(e,changeList)
		{
		var title = e.getAttribute("tiddlyLink");
		refreshTiddlyLink(e,title);
		return true;
		},

	tiddler: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var template = e.getAttribute("template");
		if(changeList && (changeList.indexOf && changeList.indexOf(title) != -1) && !story.isDirty(title))
			story.refreshTiddler(title,template,true);
		else
			refreshElements(e,changeList);
		return true;
		},

	content: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var force = e.getAttribute("force");
		var args = e.getAttribute("args");
		if(force != null || changeList == null || (changeList.indexOf && changeList.indexOf(title) != -1)) {
			jQuery(e).empty();
			config.macros.tiddler.transclude(e,title,args);
			return true;
		} else
			return false;
		},

	macro: function(e,changeList)
		{
		var macro = e.getAttribute("macroName");
		var params = e.getAttribute("params");
		if(macro)
			macro = config.macros[macro];
		if(macro && macro.refresh)
			macro.refresh(e,params);
		return true;
		}
};

config.refresherData = {
	styleSheet: "StyleSheet",
	defaultStyleSheet: "StyleSheet",
	pageTemplate: "PageTemplate",
	defaultPageTemplate: "PageTemplate",
	colorPalette: "ColorPalette",
	defaultColorPalette: "ColorPalette"
};

function refreshElements(root,changeList)
{
	var c,nodes = root.childNodes;
	for(c=0; c<nodes.length; c++) {
		var e = nodes[c], type = null;
		if(e.getAttribute && (e.tagName ? e.tagName != "IFRAME" : true))
			type = e.getAttribute("refresh");
		var refresher = config.refreshers[type];
		var refreshed = false;
		if(refresher != undefined)
			refreshed = refresher(e,changeList);
		if(e.hasChildNodes() && !refreshed)
			refreshElements(e,changeList);
	}
}

function applyHtmlMacros(root,tiddler)
{
	var e = root.firstChild;
	while(e) {
		var nextChild = e.nextSibling;
		if(e.getAttribute) {
			var macro = e.getAttribute("macro");
			if(macro) {
				e.removeAttribute("macro");
				var params = "";
				var p = macro.indexOf(" ");
				if(p != -1) {
					params = macro.substr(p+1);
					macro = macro.substr(0,p);
				}
				invokeMacro(e,macro,params,null,tiddler);
			}
		}
		if(e.hasChildNodes())
			applyHtmlMacros(e,tiddler);
		e = nextChild;
	}
}

function refreshPageTemplate(title)
{
	var stash = jQuery("<div/>").appendTo("body").hide()[0];
	var display = story.getContainer();
	var nodes,t;
	if(display) {
		nodes = display.childNodes;
		for(t=nodes.length-1; t>=0; t--)
			stash.appendChild(nodes[t]);
	}
	var wrapper = document.getElementById("contentWrapper");

	var isAvailable = function(title) {
		var s = title ? title.indexOf(config.textPrimitives.sectionSeparator) : -1;
		if(s!=-1)
			title = title.substr(0,s);
		return store.tiddlerExists(title) || store.isShadowTiddler(title);
	};
	if(!title || !isAvailable(title))
		title = config.refresherData.pageTemplate;
	if(!isAvailable(title))
		title = config.refresherData.defaultPageTemplate; //# this one is always avaialable
	wrapper.innerHTML = store.getRecursiveTiddlerText(title,null,10);
	applyHtmlMacros(wrapper);
	refreshElements(wrapper);
	display = story.getContainer();
	jQuery(display).empty();
	if(!display)
		display = createTiddlyElement(wrapper,"div",story.containerId());
	nodes = stash.childNodes;
	for(t=nodes.length-1; t>=0; t--)
		display.appendChild(nodes[t]);
	jQuery(stash).remove();
}

function refreshDisplay(hint)
{
	if(typeof hint == "string")
		hint = [hint];
	var e = document.getElementById("contentWrapper");
	refreshElements(e,hint);
	if(backstage.isPanelVisible()) {
		e = document.getElementById("backstage");
		refreshElements(e,hint);
	}
}

function refreshPageTitle()
{
	document.title = getPageTitle();
}

function getPageTitle()
{
	return wikifyPlainText(store.getTiddlerText("WindowTitle",""),null,tiddler);
}

function refreshStyles(title,doc)
{
	setStylesheet(title == null ? "" : store.getRecursiveTiddlerText(title,"",10),title,doc || document);
}

function refreshColorPalette(title)
{
	if(!startingUp)
		refreshAll();
}

function refreshAll()
{
	refreshPageTemplate();
	refreshDisplay();
	refreshStyles("StyleSheetLayout");
	refreshStyles("StyleSheetColors");
	refreshStyles(config.refresherData.styleSheet);
	refreshStyles("StyleSheetPrint");
}

//--
//-- Option handling
//--

config.optionHandlers = {
	'txt': {
		get: function(name) {return encodeCookie(config.options[name].toString());},
		set: function(name,value) {config.options[name] = decodeCookie(value);}
	},
	'chk': {
		get: function(name) {return config.options[name] ? 'true' : 'false';},
		set: function(name,value) {config.options[name] = value == 'true';}
	}
};

function setOption(name,value)
{
	var optType = name.substr(0,3);
	if(config.optionHandlers[optType] && config.optionHandlers[optType].set)
		config.optionHandlers[optType].set(name,value);
}

// Gets the value of an option as a string. Most code should just read from config.options.* directly
function getOption(name)
{
	var optType = name.substr(0,3);
	return config.optionHandlers[optType] && config.optionHandlers[optType].get ? config.optionHandlers[optType].get(name) : null;
}

function loadOptions()
{
	if(safeMode)
		return;
	loadCookies();
	loadSystemSettings();
}
// @Deprecated; retained for backwards compatibility
var loadOptionsCookie = loadOptions;

function getCookies()
{
	var cookieList = document.cookie.split(';');
	var i,cookies = {};
	for(i=0; i<cookieList.length; i++) {
		var p = cookieList[i].indexOf('=');
		if(p != -1) {
			var name = cookieList[i].substr(0,p).trim();
			var value = cookieList[i].substr(p+1).trim();
			cookies[name] = value;
		}
	}
	return cookies;
}

function loadCookies()
{
	var i,cookies = getCookies();
	if(cookies['TiddlyWiki']) {
		cookies = cookies['TiddlyWiki'].decodeHashMap();
	}
	for(i in cookies) {
		if(config.optionsSource[i] != 'setting') {
			setOption(i,cookies[i]);
		}
	}
}

function loadSystemSettings()
{
	var key,settings = store.calcAllSlices('SystemSettings');
	config.optionsSource = {};
	for(key in settings) {
		setOption(key,settings[key]);
		config.optionsSource[key] = 'setting';
	}
}

function onSystemSettingsChange()
{
	if(!startingUp) {
		loadSystemSettings();
	}
}

function saveOption(name)
{
	if(safeMode)
		return;
	if(name.match(/[()\s]/g, '_')) {
		alert(config.messages.invalidCookie.format([name]));
		return;
	}
	saveCookie(name);
	if(config.optionsSource[name] == 'setting') {
		saveSystemSetting(name,true);
	}
}
// @Deprecated; retained for backwards compatibility
var saveOptionCookie = saveOption;

function removeCookie(name)
{
	document.cookie = name + '=; expires=Thu, 01-Jan-1970 00:00:01 UTC; path=/;';
}

function saveCookie(name)
{
	var key,cookies = {};
	for(key in config.options) {
		var value = getOption(key);
		value = value == null ? 'false' : value;
		cookies[key] = value;
	}
	document.cookie = 'TiddlyWiki=' + String.encodeHashMap(cookies) + '; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/';
	cookies = getCookies();
	var c;
	for(c in cookies) {
		var optType = c.substr(0,3);
		if(config.optionHandlers[optType])
			removeCookie(c);
	}
}

var systemSettingSave;
function commitSystemSettings(storeWasDirty)
{
	if(systemSettingSave) {
		window.clearTimeout(systemSettingSave);
	}
	systemSettingSave = window.setTimeout(function() {
		var tiddler = store.getTiddler('SystemSettings');
		if(storeWasDirty == false && story.areAnyDirty() == false) {
			saveChanges(null,[tiddler]);
		} else {
			autoSaveChanges(null,[tiddler]);
		}
	}, 1000);
}

function saveSystemSetting(name,saveFile)
{
	var title = 'SystemSettings';
	var slice = store.getTiddlerSlice(title,name);
	if(readOnly || slice === getOption(name)) {
		return; //# don't save if read-only or the option hasn't changed
	}
	var slices = store.calcAllSlices(title);
	var key;
	for(key in config.optionsSource) {
		var value = getOption(key) || '';
		if(slices[key] !== value) {
			slices[key] = value;
		}
	}
	var text = [];
	for(key in slices) {
		text.push('%0: %1'.format([key,slices[key]]));
	}
	text = text.sort().join('\n');
	var storeWasDirty = store.isDirty();
	var tiddler = store.getTiddler(title);
	if(tiddler) {
		tiddler.text = text;
		tiddler = store.saveTiddler(tiddler);
	} else {
		tiddler = store.saveTiddler(title,title,text,'System',new Date(),['excludeLists'],config.defaultCustomFields);
	}
	if(saveFile) {
		commitSystemSettings(storeWasDirty);
	}
}

function encodeCookie(s)
{
	return escape(convertUnicodeToHtmlEntities(s));
}

function decodeCookie(s)
{
	s = unescape(s);
	var re = /&#[0-9]{1,5};/g;
	return s.replace(re,function($0) {return String.fromCharCode(eval($0.replace(/[&#;]/g,'')));});
}

config.macros.option.genericCreate = function(place,type,opt,className,desc)
{
	var typeInfo = config.macros.option.types[type];
	var c = document.createElement(typeInfo.elementType);
	if(typeInfo.typeValue)
		c.setAttribute('type',typeInfo.typeValue);
	c[typeInfo.eventName] = typeInfo.onChange;
	c.setAttribute('option',opt);
	c.className = className || typeInfo.className;
	if(config.optionsDesc[opt])
		c.setAttribute('title',config.optionsDesc[opt]);
	place.appendChild(c);
	if(desc != 'no')
		createTiddlyText(place,config.optionsDesc[opt] || opt);
	c[typeInfo.valueField] = config.options[opt];
	return c;
};

config.macros.option.genericOnChange = function(e)
{
	var opt = this.getAttribute('option');
	if(opt) {
		var optType = opt.substr(0,3);
		var handler = config.macros.option.types[optType];
		if(handler.elementType && handler.valueField)
			config.macros.option.propagateOption(opt,handler.valueField,this[handler.valueField],handler.elementType,this);
	}
	return true;
};

config.macros.option.types = {
	'txt': {
		elementType: 'input',
		valueField: 'value',
		eventName: 'onchange',
		className: 'txtOptionInput',
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	},
	'chk': {
		elementType: 'input',
		valueField: 'checked',
		eventName: 'onclick',
		className: 'chkOptionInput',
		typeValue: 'checkbox',
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	}
};

config.macros.option.propagateOption = function(opt,valueField,value,elementType,elem)
{
	config.options[opt] = value;
	saveOption(opt);
	var t,nodes = document.getElementsByTagName(elementType);
	for(t=0; t<nodes.length; t++) {
		var optNode = nodes[t].getAttribute('option');
		if(opt == optNode && nodes[t]!=elem)
			nodes[t][valueField] = value;
	}
};

config.macros.option.handler = function(place,macroName,params,wikifier,paramString)
{
	params = paramString.parseParams('anon',null,true,false,false);
	var opt = (params[1] && params[1].name == 'anon') ? params[1].value : getParam(params,'name',null);
	var className = (params[2] && params[2].name == 'anon') ? params[2].value : getParam(params,'class',null);
	var desc = getParam(params,'desc','no');
	var type = opt.substr(0,3);
	var h = config.macros.option.types[type];
	if(h && h.create)
		h.create(place,type,opt,className,desc);
};

config.macros.options.handler = function(place,macroName,params,wikifier,paramString)
{
	params = paramString.parseParams('anon',null,true,false,false);
	var showUnknown = getParam(params,'showUnknown','no');
	var wizard = new Wizard();
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement('markList');
	var chkUnknown = wizard.getElement('chkUnknown');
	chkUnknown.checked = showUnknown == 'yes';
	chkUnknown.onchange = this.onChangeUnknown;
	var listWrapper = document.createElement('div');
	markList.parentNode.insertBefore(listWrapper,markList);
	wizard.setValue('listWrapper',listWrapper);
	this.refreshOptions(listWrapper,showUnknown == 'yes');
};

config.macros.options.refreshOptions = function(listWrapper,showUnknown)
{
	var n,opts = [];
	for(n in config.options) {
		var opt = {};
		opt.option = '';
		opt.name = n;
		opt.lowlight = !config.optionsDesc[n];
		opt.description = opt.lowlight ? this.unknownDescription : config.optionsDesc[n];
		if(!opt.lowlight || showUnknown)
			opts.push(opt);
	}
	opts.sort(function(a,b) {return a.name.substr(3) < b.name.substr(3) ? -1 : (a.name.substr(3) == b.name.substr(3) ? 0 : +1);});
	ListView.create(listWrapper,opts,this.listViewTemplate);
	for(n=0; n<opts.length; n++) {
		var type = opts[n].name.substr(0,3);
		var h = config.macros.option.types[type];
		if(h && h.create) {
			h.create(opts[n].colElements['option'],type,opts[n].name,null,'no');
		}
	}
};

config.macros.options.onChangeUnknown = function(e)
{
	var wizard = new Wizard(this);
	var listWrapper = wizard.getValue('listWrapper');
	jQuery(listWrapper).empty();
	config.macros.options.refreshOptions(listWrapper,this.checked);
	return false;
};

//--
//-- Saving
//--

var saveUsingSafari = false;

var startSaveArea = '<div id="' + 'storeArea">'; // Split up into two so that indexOf() of this source doesn't find it
var startSaveAreaRE = /<((div)|(DIV)) ((id)|(ID))=["']?storeArea['"]?>/; // Used for IE6
var endSaveArea = '</d' + 'iv>';
var endSaveAreaCaps = '</D' + 'IV>';

// If there are unsaved changes, force the user to confirm before exitting
function confirmExit()
{
	hadConfirmExit = true;
	if((store && store.isDirty && store.isDirty()) || (story && story.areAnyDirty && story.areAnyDirty()))
		return config.messages.confirmExit;
}

// Give the user a chance to save changes before exitting
function checkUnsavedChanges()
{
	if(store && store.isDirty && store.isDirty() && window.hadConfirmExit === false) {
		if(confirm(config.messages.unsavedChangesWarning))
			saveChanges();
	}
}

function updateLanguageAttribute(s)
{
	if(config.locale) {
		var mRE = /(<html(?:.*?)?)(?: xml:lang\="([a-z]+)")?(?: lang\="([a-z]+)")?>/;
		var m = mRE.exec(s);
		if(m) {
			var t = m[1];
			if(m[2])
				t += ' xml:lang="' + config.locale + '"';
			if(m[3])
				t += ' lang="' + config.locale + '"';
			t += ">";
			s = s.substr(0,m.index) + t + s.substr(m.index+m[0].length);
		}
	}
	return s;
}

function updateMarkupBlock(s,blockName,tiddlerName)
{
	return s.replaceChunk(
			"<!--%0-START-->".format([blockName]),
			"<!--%0-END-->".format([blockName]),
			"\n" + convertUnicodeToFileFormat(store.getRecursiveTiddlerText(tiddlerName,"")) + "\n");
}

function updateOriginal(original,posDiv,localPath)
{
	if(!posDiv)
		posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(config.messages.invalidFileError.format([localPath]));
		return null;
	}
	var revised = original.substr(0,posDiv[0] + startSaveArea.length) + "\n" +
				convertUnicodeToFileFormat(store.allTiddlersAsHtml()) + "\n" +
				original.substr(posDiv[1]);
	var newSiteTitle = convertUnicodeToFileFormat(getPageTitle()).htmlEncode();
	revised = revised.replaceChunk("<title"+">","</title"+">"," " + newSiteTitle + " ");
	revised = updateLanguageAttribute(revised);
	revised = updateMarkupBlock(revised,"PRE-HEAD","MarkupPreHead");
	revised = updateMarkupBlock(revised,"POST-HEAD","MarkupPostHead");
	revised = updateMarkupBlock(revised,"PRE-BODY","MarkupPreBody");
	revised = updateMarkupBlock(revised,"POST-SCRIPT","MarkupPostBody");
	return revised;
}

function locateStoreArea(original)
{
	// Locate the storeArea divs
	if(!original)
		return null;
	var posOpeningDiv = original.search(startSaveAreaRE);
	var limitClosingDiv = original.indexOf("<"+"!--POST-STOREAREA--"+">");
	if(limitClosingDiv == -1)
		limitClosingDiv = original.indexOf("<"+"!--POST-BODY-START--"+">");
	var start = limitClosingDiv == -1 ? original.length : limitClosingDiv;
	var posClosingDiv = original.lastIndexOf(endSaveArea,start);
	if(posClosingDiv == -1)
		posClosingDiv = original.lastIndexOf(endSaveAreaCaps,start);
	return (posOpeningDiv != -1 && posClosingDiv != -1) ? [posOpeningDiv,posClosingDiv] : null;
}

function autoSaveChanges(onlyIfDirty,tiddlers)
{
	if(config.options.chkAutoSave)
		saveChanges(onlyIfDirty,tiddlers);
}

function loadOriginal(localPath)
{
	return loadFile(localPath);
}

// Save this tiddlywiki with the pending changes
function saveChanges(onlyIfDirty,tiddlers)
{
	if(onlyIfDirty && !store.isDirty())
		return;
	clearMessage();
	var t0 = new Date();
	var msg = config.messages;
	var originalPath = document.location.toString();
	if(originalPath.substr(0,5) != "file:") {
		alert(msg.notFileUrlError);
		if(store.tiddlerExists(msg.saveInstructions))
			story.displayTiddler(null,msg.saveInstructions);
		return;
	}
	var localPath = getLocalPath(originalPath);
	var original = loadOriginal(localPath);
	if(original == null) {
		alert(msg.cantSaveError);
		if(store.tiddlerExists(msg.saveInstructions))
			story.displayTiddler(null,msg.saveInstructions);
		return;
	}
	var posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(msg.invalidFileError.format([localPath]));
		return;
	}
	saveMain(localPath,original,posDiv);
	if(config.options.chkSaveBackups)
		saveBackup(localPath,original);
	if(config.options.chkSaveEmptyTemplate)
		saveEmpty(localPath,original,posDiv);
	if(config.options.chkGenerateAnRssFeed && saveRss instanceof Function)
		saveRss(localPath);
	if(config.options.chkDisplayInstrumentation)
		displayMessage("saveChanges " + (new Date()-t0) + " ms");
}

function saveMain(localPath,original,posDiv)
{
	var save;
	try {
		var revised = updateOriginal(original,posDiv,localPath);
		save = saveFile(localPath,revised);
	} catch (ex) {
		showException(ex);
	}
	if(save) {
		displayMessage(config.messages.mainSaved,"file://" + localPath);
		store.setDirty(false);
	} else {
		alert(config.messages.mainFailed);
	}
}

function saveBackup(localPath,original)
{
	var backupPath = getBackupPath(localPath);
	var backup = copyFile(backupPath,localPath);
	if(!backup)
		backup = saveFile(backupPath,original);
	if(backup)
		displayMessage(config.messages.backupSaved,"file://" + backupPath);
	else
		alert(config.messages.backupFailed);
}

function saveEmpty(localPath,original,posDiv)
{
	var emptyPath,p;
	if((p = localPath.lastIndexOf("/")) != -1)
		emptyPath = localPath.substr(0,p) + "/";
	else if((p = localPath.lastIndexOf("\\")) != -1)
		emptyPath = localPath.substr(0,p) + "\\";
	else
		emptyPath = localPath + ".";
	emptyPath += "empty.html";
	var empty = original.substr(0,posDiv[0] + startSaveArea.length) + original.substr(posDiv[1]);
	var emptySave = saveFile(emptyPath,empty);
	if(emptySave)
		displayMessage(config.messages.emptySaved,"file://" + emptyPath);
	else
		alert(config.messages.emptyFailed);
}

function getLocalPath(origPath)
{
	var originalPath = convertUriToUTF8(origPath,config.options.txtFileSystemCharSet);
	// Remove any location or query part of the URL
	var argPos = originalPath.indexOf("?");
	if(argPos != -1)
		originalPath = originalPath.substr(0,argPos);
	var hashPos = originalPath.indexOf("#");
	if(hashPos != -1)
		originalPath = originalPath.substr(0,hashPos);
	// Convert file://localhost/ to file:///
	if(originalPath.indexOf("file://localhost/") == 0)
		originalPath = "file://" + originalPath.substr(16);
	// Convert to a native file format
	var localPath;
	if(originalPath.charAt(9) == ":") // pc local file
		localPath = unescape(originalPath.substr(8)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file://///") == 0) // FireFox pc network file
		localPath = "\\\\" + unescape(originalPath.substr(10)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file:///") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(7));
	else if(originalPath.indexOf("file:/") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(5));
	else // pc network file
		localPath = "\\\\" + unescape(originalPath.substr(7)).replace(new RegExp("/","g"),"\\");
	return localPath;
}

function getBackupPath(localPath,title,extension)
{
	var slash = "\\";
	var dirPathPos = localPath.lastIndexOf("\\");
	if(dirPathPos == -1) {
		dirPathPos = localPath.lastIndexOf("/");
		slash = "/";
	}
	var backupFolder = config.options.txtBackupFolder;
	if(!backupFolder || backupFolder == "")
		backupFolder = ".";
	var backupPath = localPath.substr(0,dirPathPos) + slash + backupFolder + localPath.substr(dirPathPos);
	backupPath = backupPath.substr(0,backupPath.lastIndexOf(".")) + ".";
	if(title)
		backupPath += title.replace(/[\\\/\*\?\":<> ]/g,"_") + ".";
	backupPath += (new Date()).convertToYYYYMMDDHHMMSSMMM() + "." + (extension || "html");
	return backupPath;
}

//--
//-- RSS Saving
//--

function saveRss(localPath)
{
	var rssPath = localPath.substr(0,localPath.lastIndexOf(".")) + ".xml";
	if(saveFile(rssPath,convertUnicodeToFileFormat(generateRss())))
		displayMessage(config.messages.rssSaved,"file://" + rssPath);
	else
		alert(config.messages.rssFailed);
}

tiddlerToRssItem = function(tiddler,uri)
{
	var s = "<title" + ">" + tiddler.title.htmlEncode() + "</title" + ">\n";
	s += "<description>" + wikifyStatic(tiddler.text,null,tiddler).htmlEncode() + "</description>\n";
	var i;
	for(i=0; i<tiddler.tags.length; i++)
		s += "<category>" + tiddler.tags[i] + "</category>\n";
	s += "<link>" + uri + "#" + encodeURIComponent(String.encodeTiddlyLink(tiddler.title)) + "</link>\n";
	s +="<pubDate>" + tiddler.modified.toGMTString() + "</pubDate>\n";
	return s;
};

function generateRss()
{
	var s = [];
	var d = new Date();
	var u = store.getTiddlerText("SiteUrl");
	// Assemble the header
	s.push("<" + "?xml version=\"1.0\"?" + ">");
	s.push("<rss version=\"2.0\">");
	s.push("<channel>");
	s.push("<title" + ">" + wikifyPlainText(store.getTiddlerText("SiteTitle",""),null,tiddler).htmlEncode() + "</title" + ">");
	if(u)
		s.push("<link>" + u.htmlEncode() + "</link>");
	s.push("<description>" + wikifyPlainText(store.getTiddlerText("SiteSubtitle",""),null,tiddler).htmlEncode() + "</description>");
	s.push("<language>" + config.locale + "</language>");
	s.push("<copyright>Copyright " + d.getFullYear() + " " + config.options.txtUserName.htmlEncode() + "</copyright>");
	s.push("<pubDate>" + d.toGMTString() + "</pubDate>");
	s.push("<lastBuildDate>" + d.toGMTString() + "</lastBuildDate>");
	s.push("<docs>http://blogs.law.harvard.edu/tech/rss</docs>");
	s.push("<generator>TiddlyWiki " + formatVersion() + "</generator>");
	// The body
	var tiddlers = store.getTiddlers("modified","excludeLists");
	var i,n = config.numRssItems > tiddlers.length ? 0 : tiddlers.length-config.numRssItems;
	for(i=tiddlers.length-1; i>=n; i--) {
		s.push("<item>\n" + tiddlerToRssItem(tiddlers[i],u) + "\n</item>");
	}
	// And footer
	s.push("</channel>");
	s.push("</rss>");
	// Save it all
	return s.join("\n");
}

//--
//-- Filesystem code
//--

function convertUTF8ToUnicode(u)
{
	return config.browser.isOpera || !window.netscape ? manualConvertUTF8ToUnicode(u) : mozConvertUTF8ToUnicode(u);
}

function manualConvertUTF8ToUnicode(utf)
{
	var uni = utf;
	var src = 0;
	var dst = 0;
	var b1, b2, b3;
	var c;
	while(src < utf.length) {
		b1 = utf.charCodeAt(src++);
		if(b1 < 0x80) {
			dst++;
		} else if(b1 < 0xE0) {
			b2 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0x1F) << 6) | (b2 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
		} else {
			b2 = utf.charCodeAt(src++);
			b3 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0xF) << 12) | ((b2 & 0x3F) << 6) | (b3 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
		}
	}
	return uni;
}

function mozConvertUTF8ToUnicode(u)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUTF8ToUnicode(u);
	} // fallback
	var s = converter.ConvertToUnicode(u);
	var fin = converter.Finish();
	return fin.length > 0 ? s+fin : s;
}

function convertUnicodeToFileFormat(s)
{
	return config.browser.isOpera || !window.netscape ? (config.browser.isIE ? convertUnicodeToHtmlEntities(s) : s) : mozConvertUnicodeToUTF8(s);
}

function convertUnicodeToHtmlEntities(s)
{
	var re = /[^\u0000-\u007F]/g;
	return s.replace(re,function($0) {return "&#" + $0.charCodeAt(0).toString() + ";";});
}

function convertUnicodeToUTF8(s)
{
// return convertUnicodeToFileFormat to allow plugin migration
	return convertUnicodeToFileFormat(s);
}

function manualConvertUnicodeToUTF8(s)
{
	return unescape(encodeURIComponent(s));
}

function mozConvertUnicodeToUTF8(s)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUnicodeToUTF8(s);
	} // fallback
	var u = converter.ConvertFromUnicode(s);
	var fin = converter.Finish();
	return fin.length > 0 ? u + fin : u;
}

function convertUriToUTF8(uri,charSet)
{
	if(window.netscape == undefined || charSet == undefined || charSet == "")
		return uri;
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/utf8converterservice;1"].getService(Components.interfaces.nsIUTF8ConverterService);
	} catch(ex) {
		return uri;
	}
	return converter.convertURISpecToUTF8(uri,charSet);
}

function copyFile(dest,source)
{
	return config.browser.isIE ? ieCopyFile(dest,source) : false;
}

function saveFile(fileUrl,content)
{
	var r = mozillaSaveFile(fileUrl,content);
	if(!r)
		r = ieSaveFile(fileUrl,content);
	if(!r)
		r = javaSaveFile(fileUrl,content);
	return r;
}

function loadFile(fileUrl)
{
	var r = mozillaLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = ieLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = javaLoadFile(fileUrl);
	return r;
}

function ieCreatePath(path)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
	} catch(ex) {
		return null;
	}

	var pos = path.lastIndexOf("\\");
	if(pos==-1)
		pos = path.lastIndexOf("/");
	if(pos!=-1)
		path = path.substring(0,pos+1);

	var scan = [path];
	var parent = fso.GetParentFolderName(path);
	while(parent && !fso.FolderExists(parent)) {
		scan.push(parent);
		parent = fso.GetParentFolderName(parent);
	}

	for(i=scan.length-1;i>=0;i--) {
		if(!fso.FolderExists(scan[i])) {
			fso.CreateFolder(scan[i]);
		}
	}
	return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function ieSaveFile(filePath,content)
{
	ieCreatePath(filePath);
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
	} catch(ex) {
		return null;
	}
	var file = fso.OpenTextFile(filePath,2,-1,0);
	file.Write(content);
	file.Close();
	return true;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function ieLoadFile(filePath)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		var file = fso.OpenTextFile(filePath,1);
		var content = file.ReadAll();
		file.Close();
	} catch(ex) {
		return null;
	}
	return content;
}

function ieCopyFile(dest,source)
{
	ieCreatePath(dest);
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		fso.GetFile(source).Copy(dest);
	} catch(ex) {
		return false;
	}
	return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function mozillaSaveFile(filePath,content)
{
	if(window.Components) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if(!file.exists())
				file.create(0,0x01B4);// 0x01B4 = 0664
			var out = Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);
			out.init(file,0x22,0x04,null);
			out.write(content,content.length);
			out.flush();
			out.close();
			return true;
		} catch(ex) {
			return false;
		}
	}
	return null;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function mozillaLoadFile(filePath)
{
	if(window.Components) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if(!file.exists())
				return null;
			var inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
			inputStream.init(file,0x01,0x04,null);
			var sInputStream = Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);
			sInputStream.init(inputStream);
			var contents = sInputStream.read(sInputStream.available());
			sInputStream.close();
			inputStream.close();
			return contents;
		} catch(ex) {
			return false;
		}
	}
	return null;
}

function javaUrlToFilename(url)
{
	var f = "//localhost";
	if(url.indexOf(f) == 0)
		return url.substring(f.length);
	var i = url.indexOf(":");
	return i > 0 ? url.substring(i-1) : url;
}

function javaSaveFile(filePath,content)
{
	try {
		if(document.applets["TiddlySaver"])
			return document.applets["TiddlySaver"].saveFile(javaUrlToFilename(filePath),"UTF-8",content);
	} catch(ex) {
	}
	try {
		var s = new java.io.PrintStream(new java.io.FileOutputStream(javaUrlToFilename(filePath)));
		s.print(content);
		s.close();
	} catch(ex2) {
		return null;
	}
	return true;
}

function javaLoadFile(filePath)
{
	try {
		if(document.applets["TiddlySaver"]) {
			var ret = document.applets["TiddlySaver"].loadFile(javaUrlToFilename(filePath),"UTF-8");
			if(!ret)
				return null;
			return String(ret);
		}
	} catch(ex) {
	}
	var content = [];
	try {
		var r = new java.io.BufferedReader(new java.io.FileReader(javaUrlToFilename(filePath)));
		var line;
		while((line = r.readLine()) != null)
			content.push(String(line));
		r.close();
	} catch(ex2) {
		return null;
	}
	return content.join("\n");
}

//--
//-- Server adaptor base class
//--

function AdaptorBase()
{
	this.host = null;
	this.store = null;
	return this;
}

AdaptorBase.prototype.close = function()
{
	return true;
};

AdaptorBase.prototype.fullHostName = function(host)
{
	if(!host)
		return '';
	host = host.trim();
	if(!host.match(/:\/\//))
		host = 'http://' + host;
	if(host.substr(host.length-1) == '/')
		host = host.substr(0,host.length-1);
	return host;
};

AdaptorBase.minHostName = function(host)
{
	return host;
};

AdaptorBase.prototype.setContext = function(context,userParams,callback)
{
	if(!context) context = {};
	context.userParams = userParams;
	if(callback) context.callback = callback;
	context.adaptor = this;
	if(!context.host)
		context.host = this.host;
	context.host = this.fullHostName(context.host);
	if(!context.workspace)
		context.workspace = this.workspace;
	return context;
};

// Open the specified host
AdaptorBase.prototype.openHost = function(host,context,userParams,callback)
{
	this.host = host;
	context = this.setContext(context,userParams,callback);
	context.status = true;
	if(callback)
		window.setTimeout(function() {context.callback(context,userParams);},10);
	return true;
};

// Open the specified workspace
AdaptorBase.prototype.openWorkspace = function(workspace,context,userParams,callback)
{
	this.workspace = workspace;
	context = this.setContext(context,userParams,callback);
	context.status = true;
	if(callback)
		window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

//--
//-- Server adaptor for talking to static TiddlyWiki files
//--

function FileAdaptor()
{
}

FileAdaptor.prototype = new AdaptorBase();

FileAdaptor.serverType = 'file';
FileAdaptor.serverLabel = 'TiddlyWiki';

FileAdaptor.loadTiddlyWikiSuccess = function(context,jqXHR)
{
	context.status = true;
	context.adaptor.store = new TiddlyWiki();
	if(!context.adaptor.store.importTiddlyWiki(jqXHR.responseText)) {
		context.statusText = config.messages.invalidFileError.format([context.host]);
		context.status = false;
	}
	context.complete(context,context.userParams);
};

FileAdaptor.loadTiddlyWikiError = function(context,jqXHR)
{
	context.status = false;
	context.statusText = jqXHR.message;
	context.complete(context,context.userParams);
};

// Get the list of workspaces on a given server
FileAdaptor.prototype.getWorkspaceList = function(context,userParams,callback)
{
	context = this.setContext(context,userParams,callback);
	context.workspaces = [{title:"(default)"}];
	context.status = true;
	if(callback)
		window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

// Gets the list of tiddlers within a given workspace
FileAdaptor.prototype.getTiddlerList = function(context,userParams,callback,filter)
{
	context = this.setContext(context,userParams,callback);
	if(!context.filter)
		context.filter = filter;
	context.complete = FileAdaptor.getTiddlerListComplete;
	if(this.store) {
		return context.complete(context,context.userParams);
	}
	var options = {
		type:"GET",
		url:context.host,
		processData:false,
		success:function(data,textStatus,jqXHR) {
			FileAdaptor.loadTiddlyWikiSuccess(context,jqXHR);
		},
		error:function(jqXHR,textStatus,errorThrown) {
			context.xhr = jqXHR;
			FileAdaptor.loadTiddlyWikiError(context,jqXHR);
		}
	};
	return ajaxReq(options);
};

FileAdaptor.getTiddlerListComplete = function(context,userParams)
{
	if(context.status) {
		if(context.filter) {
			context.tiddlers = context.adaptor.store.filterTiddlers(context.filter);
		} else {
			context.tiddlers = [];
			context.adaptor.store.forEachTiddler(function(title,tiddler) {context.tiddlers.push(tiddler);});
		}
		var i;
		for(i=0; i<context.tiddlers.length; i++) {
			context.tiddlers[i].fields['server.type'] = FileAdaptor.serverType;
			context.tiddlers[i].fields['server.host'] = AdaptorBase.minHostName(context.host);
			context.tiddlers[i].fields['server.page.revision'] = context.tiddlers[i].modified.convertToYYYYMMDDHHMM();
		}
		context.status = true;
	}
	if(context.callback) {
		window.setTimeout(function() {context.callback(context,userParams);},10);
	}
	return true;
};

FileAdaptor.prototype.generateTiddlerInfo = function(tiddler)
{
	var info = {};
	info.uri = tiddler.fields['server.host'] + "#" + tiddler.title;
	return info;
};

// Retrieve a tiddler from a given workspace on a given server
FileAdaptor.prototype.getTiddler = function(title,context,userParams,callback)
{
	context = this.setContext(context,userParams,callback);
	context.title = title;
	context.complete = FileAdaptor.getTiddlerComplete;
	if(context.adaptor.store) {
		return context.complete(context,context.userParams);
	}
	var options = {
		type:"GET",
		url:context.host,
		processData:false,
		success:function(data,textStatus,jqXHR) {
			FileAdaptor.loadTiddlyWikiSuccess(context,jqXHR);
		},
		error:function(jqXHR,textStatus,errorThrown) {
			FileAdaptor.loadTiddlyWikiError(context,jqXHR);
		}
	};
	return ajaxReq(options);
};

FileAdaptor.getTiddlerComplete = function(context,userParams)
{
	var t = context.adaptor.store.fetchTiddler(context.title);
	if(t) {
		t.fields['server.type'] = FileAdaptor.serverType;
		t.fields['server.host'] = AdaptorBase.minHostName(context.host);
		t.fields['server.page.revision'] = t.modified.convertToYYYYMMDDHHMM();
		context.tiddler = t;
		context.status = true;
	} else { //# tiddler does not exist in document
		context.status = false;
	}
	if(context.allowSynchronous) {
		context.isSynchronous = true;
		context.callback(context,userParams);
	} else {
		window.setTimeout(function() {context.callback(context,userParams);},10);
	}
	return true;
};

FileAdaptor.prototype.close = function()
{
	this.store = null;
};

config.adaptors[FileAdaptor.serverType] = FileAdaptor;

config.defaultAdaptor = FileAdaptor.serverType;

//--
//-- HTTP request code
//--

function ajaxReq(args)
{
	if(window.Components && window.netscape && window.netscape.security && document.location.protocol.indexOf("http") == -1)
		window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
	return jQuery.ajax(args);
}

function httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache)
{
	var httpSuccess = function(xhr) {
		try {
			// IE error sometimes returns 1223 when it should be 204 so treat it as success, see #1450
			return (!xhr.status && location.protocol === "file:") ||
				(xhr.status >= 200 && xhr.status < 300) ||
				xhr.status === 304 || xhr.status === 1223;
		} catch(e) {}
		return false;
	};

	var options = {
		type:type,
		url:url,
		processData:false,
		data:data,
		cache:!!allowCache,
		beforeSend: function(xhr) {
			var i;
			for(i in headers)
				xhr.setRequestHeader(i,headers[i]);
			xhr.setRequestHeader("X-Requested-With", "TiddlyWiki " + formatVersion());
		}
	};

	if(callback) {
		options.complete = function(xhr,textStatus) {
			if(httpSuccess(xhr))
				callback(true,params,xhr.responseText,url,xhr);
			else
				callback(false,params,null,url,xhr);
		};
	}
	if(contentType)
		options.contentType = contentType;
	if(username)
		options.username = username;
	if(password)
		options.password = password;
	if(window.Components && window.netscape && window.netscape.security && document.location.protocol.indexOf("http") == -1)
		window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
	return jQuery.ajax(options);
}
//--
//-- TiddlyWiki-specific utility functions
//--

// Returns TiddlyWiki version string
function formatVersion(v)
{
	v = v || version;
	return v.major + "." + v.minor + "." + v.revision +
		(v.alpha ? " (alpha " + v.alpha + ")" : "") +
		(v.beta ? " (beta " + v.beta + ")" : "");
}

function compareVersions(v1,v2)
{
	var x1,x2,i,a = ["major","minor","revision"];
	for(i = 0; i<a.length; i++) {
		x1 = v1[a[i]] || 0;
		x2 = v2[a[i]] || 0;
		if(x1<x2)
			return 1;
		if(x1>x2)
			return -1;
	}
	x1 = v1.beta || 9999;
	x2 = v2.beta || 9999;
	if(x1<x2)
		return 1;
	return x1 > x2 ? -1 : 0;
}

function merge(dst,src,preserveExisting)
{
	var i;
	for(i in src) {
		if(!preserveExisting || dst[i] === undefined)
			dst[i] = src[i];
	}
	return dst;
}

// Resolve the target object of an event
function resolveTarget(e)
{
	var obj;
	if(e.target)
		obj = e.target;
	else if(e.srcElement)
		obj = e.srcElement;
	if(obj.nodeType == 3) // defeat Safari bug
		obj = obj.parentNode;
	return obj;
}

// Returns a string containing the description of an exception, optionally prepended by a message
function exceptionText(e,message)
{
	var s = e.description || e.toString();
	return message ? "%0:\n%1".format([message,s]) : s;
}

// Displays an alert of an exception description with optional message
function showException(e,message)
{
	alert(exceptionText(e,message));
}

function alertAndThrow(m)
{
	alert(m);
	throw(m);
}

function glyph(name)
{
	var g = config.glyphs;
	var b = g.currBrowser;
	if(b == null) {
		b = 0;
		while(b < g.browsers.length-1 && !g.browsers[b]())
			b++;
		g.currBrowser = b;
	}
	if(!g.codes[name])
		return "";
	return g.codes[name][b];
}

function createTiddlyText(parent,text)
{
	return parent.appendChild(document.createTextNode(text));
}

function createTiddlyCheckbox(parent,caption,checked,onChange)
{
	var cb = document.createElement("input");
	cb.setAttribute("type","checkbox");
	cb.onclick = onChange;
	parent.appendChild(cb);
	cb.checked = checked;
	cb.className = "chkOptionInput";
	if(caption)
		wikify(caption,parent);
	return cb;
}

function createTiddlyElement(parent,element,id,className,text,attribs)
{
	var n,e = document.createElement(element);
	if(className != null)
		e.className = className;
	if(id != null)
		e.setAttribute("id",id);
	if(text != null)
		e.appendChild(document.createTextNode(text));
	if(attribs) {
		for(n in attribs) {
			e.setAttribute(n,attribs[n]);
		}
	}
	if(parent != null)
		parent.appendChild(e);
	return e;
}

function createTiddlyButton(parent,text,tooltip,action,className,id,accessKey,attribs)
{
	var i,btn = document.createElement("a");
	btn.setAttribute("href","javascript:;");
	if(action) {
		btn.onclick = action;
	}
	if(tooltip)
		btn.setAttribute("title",tooltip);
	if(text)
		btn.appendChild(document.createTextNode(text));
	btn.className = className || "button";
	if(id)
		btn.id = id;
	if(attribs) {
		for(i in attribs) {
			btn.setAttribute(i,attribs[i]);
		}
	}
	if(parent)
		parent.appendChild(btn);
	if(accessKey)
		btn.setAttribute("accessKey",accessKey);
	return btn;
}

function createExternalLink(place,url,label)
{
	var link = document.createElement("a");
	link.className = "externalLink";
	link.href = url;
	var f = config.messages.externalLinkTooltip;
	link.title = f ? f.format([url]) : url;
	if(config.options.chkOpenInNewWindow)
		link.target = "_blank";
	place.appendChild(link);
	if(label)
		createTiddlyText(link, label);
	return link;
}

function getTiddlyLinkInfo(title,currClasses)
{
	var classes = currClasses ? currClasses.split(" ") : [];
	classes.pushUnique("tiddlyLink");
	var tiddler = store.fetchTiddler(title);
	var subTitle;
	if(tiddler) {
		subTitle = tiddler.getSubtitle();
		classes.pushUnique("tiddlyLinkExisting");
		classes.remove("tiddlyLinkNonExisting");
		classes.remove("shadow");
	} else {
	    var f;
		classes.remove("tiddlyLinkExisting");
		classes.pushUnique("tiddlyLinkNonExisting");
		if(store.isShadowTiddler(title)) {
			f = config.messages.shadowedTiddlerToolTip;
			classes.pushUnique("shadow");
		} else {
			f = config.messages.undefinedTiddlerToolTip;
			classes.remove("shadow");
		}
		subTitle = f ? f.format([title]) : "";
	}
	if(typeof config.annotations[title]=="string")
		subTitle = config.annotations[title];
	return {classes: classes.join(" "),subTitle: subTitle};
}

// Event handler for clicking on a tiddly link
function onClickTiddlerLink(ev)
{
	var e = ev || window.event;
	var target = resolveTarget(e);
	var link = target;
	var title = null;
	var fields = null;
	var noToggle = null;
	do {
		title = link.getAttribute("tiddlyLink");
		fields = link.getAttribute("tiddlyFields");
		noToggle = link.getAttribute("noToggle");
		link = link.parentNode;
	} while(title == null && link != null);
	if(!store.isShadowTiddler(title)) {
		var f = fields ? fields.decodeHashMap() : {};
		fields = String.encodeHashMap(merge(f,config.defaultCustomFields,true));
	}
	if(title) {
		var toggling = e.metaKey || e.ctrlKey;
		if(config.options.chkToggleLinks)
			toggling = !toggling;
		if(noToggle)
			toggling = false;
		if(store.getTiddler(title))
			fields = null;
		story.displayTiddler(target,title,null,true,null,fields,toggling);
	}
	clearMessage();
	return false;
}

function createTiddlyLink(place,title,includeText,className,isStatic,linkedFromTiddler,noToggle)
{
	var title = jQuery.trim(title);
	var text = includeText ? title : null;
	var i = getTiddlyLinkInfo(title,className);
	var btn = isStatic ? createExternalLink(place,store.getTiddlerText("SiteUrl",null) + "#" + title) : createTiddlyButton(place,text,i.subTitle,onClickTiddlerLink,i.classes);
	if(isStatic)
		btn.className += ' ' + className;
	btn.setAttribute("refresh","link");
	btn.setAttribute("tiddlyLink",title);
	if(noToggle)
		btn.setAttribute("noToggle","true");
	if(linkedFromTiddler) {
		var fields = linkedFromTiddler.getInheritedFields();
		if(fields)
			btn.setAttribute("tiddlyFields",fields);
	}
	return btn;
}

function refreshTiddlyLink(e,title)
{
	var i = getTiddlyLinkInfo(title,e.className);
	e.className = i.classes;
	e.title = i.subTitle;
}

function createTiddlyDropDown(place,onchange,options,defaultValue)
{
	var sel = createTiddlyElement(place,"select");
	sel.onchange = onchange;
	var t;
	for(t=0; t<options.length; t++) {
		var e = createTiddlyElement(sel,"option",null,null,options[t].caption);
		e.value = options[t].name;
		if(options[t].name == defaultValue)
			e.selected = true;
	}
	return sel;
}

//--
//-- TiddlyWiki-specific popup utility functions
//--

// Event handler for 'open all' on a tiddler popup
function onClickTagOpenAll(ev)
{
	var tiddlers = store.getTaggedTiddlers(this.getAttribute("tag"));
	var sortby = this.getAttribute("sortby");
	if(sortby&&sortby.length) {
		store.sortTiddlers(tiddlers,sortby);
	}
	story.displayTiddlers(this,tiddlers);
	return false;
}

// Event handler for clicking on a tiddler tag
function onClickTag(ev)
{
	var e = ev || window.event;
	var popup = Popup.create(this);
	jQuery(popup).addClass("taggedTiddlerList");
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(popup && tag) {
		var tagged = tag.indexOf("[")==-1 ? store.getTaggedTiddlers(tag) : store.filterTiddlers(tag);
		var sortby = this.getAttribute("sortby");
		if(sortby&&sortby.length) {
			store.sortTiddlers(tagged,sortby);
		}
		var titles = [];
		var r;
		for(r=0;r<tagged.length;r++) {
			if(tagged[r].title != title)
				titles.push(tagged[r].title);
		}
		var lingo = config.views.wikified.tag;
		if(titles.length > 0) {
			var openAll = createTiddlyButton(createTiddlyElement(popup,"li"),lingo.openAllText.format([tag]),lingo.openAllTooltip,onClickTagOpenAll);
			openAll.setAttribute("tag",tag);
			openAll.setAttribute("sortby",sortby);
			createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
			for(r=0; r<titles.length; r++) {
				createTiddlyLink(createTiddlyElement(popup,"li"),titles[r],true);
			}
		} else {
			createTiddlyElement(popup,"li",null,"disabled",lingo.popupNone.format([tag]));
		}
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var h = createTiddlyLink(createTiddlyElement(popup,"li"),tag,false);
		createTiddlyText(h,lingo.openTag.format([tag]));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

// Create a button for a tag with a popup listing all the tiddlers that it tags
function createTagButton(place,tag,excludeTiddler,title,tooltip)
{
	var btn = createTiddlyButton(place,title||tag,(tooltip||config.views.wikified.tag.tooltip).format([tag]),onClickTag);
	btn.setAttribute("tag",tag);
	if(excludeTiddler)
		btn.setAttribute("tiddler",excludeTiddler);
	return btn;
}

function onClickTiddlyPopup(ev)
{
	var e = ev || window.event;
	var tiddler = this.tiddler;
	if(tiddler.text) {
		var popup = Popup.create(this,"div","popupTiddler");
		wikify(tiddler.text,popup,null,tiddler);
		Popup.show();
	}
	if(e) e.cancelBubble = true;
	if(e && e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyPopup(place,caption,tooltip,tiddler)
{
	if(tiddler.text) {
		createTiddlyLink(place,caption,true);
		var btn = createTiddlyButton(place,glyph("downArrow"),tooltip,onClickTiddlyPopup,"tiddlerPopupButton");
		btn.tiddler = tiddler;
	} else {
		createTiddlyText(place,caption);
	}
}

function onClickError(ev)
{
	var e = ev || window.event;
	var popup = Popup.create(this);
	var lines = this.getAttribute("errorText").split("\n");
	var t;
	for(t=0; t<lines.length; t++)
		createTiddlyElement(popup,"li",null,null,lines[t]);
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyError(place,title,text)
{
	var btn = createTiddlyButton(place,title,null,onClickError,"errorButton");
	if(text) btn.setAttribute("errorText",text);
}
//-
//- Animation engine
//-

function Animator()
{
	this.running = 0; // Incremented at start of each animation, decremented afterwards. If zero, the interval timer is disabled
	this.timerID = 0; // ID of the timer used for animating
	this.animations = []; // List of animations in progress
	return this;
}

// Start animation engine
Animator.prototype.startAnimating = function() //# Variable number of arguments
{
	var t;
	for(t=0; t<arguments.length; t++)
		this.animations.push(arguments[t]);
	if(this.running == 0) {
		var me = this;
		this.timerID = window.setInterval(function() {me.doAnimate(me);},10);
	}
	this.running += arguments.length;
};

// Perform an animation engine tick, calling each of the known animation modules
Animator.prototype.doAnimate = function(me)
{
	var a = 0;
	while(a < me.animations.length) {
		var animation = me.animations[a];
		if(animation.tick()) {
			a++;
		} else {
			me.animations.splice(a,1);
			if(--me.running == 0)
				window.clearInterval(me.timerID);
		}
	}
};

Animator.slowInSlowOut = function(progress)
{
	return(1-((Math.cos(progress * Math.PI)+1)/2));
};

//--
//-- Morpher animation
//--

// Animate a set of properties of an element
function Morpher(element,duration,properties,callback)
{
	this.element = element;
	this.duration = duration;
	this.properties = properties;
	this.startTime = new Date();
	this.endTime = Number(this.startTime) + duration;
	this.callback = callback;
	this.tick();
	return this;
}

Morpher.prototype.assignStyle = function(element,style,value)
{
	switch(style) {
	case "-tw-vertScroll":
		window.scrollTo(findScrollX(),value);
		break;
	case "-tw-horizScroll":
		window.scrollTo(value,findScrollY());
		break;
	default:
		element.style[style] = value;
		break;
	}
};

Morpher.prototype.stop = function()
{
	var t;
	for(t=0; t<this.properties.length; t++) {
		var p = this.properties[t];
		if(p.atEnd !== undefined) {
			this.assignStyle(this.element,p.style,p.atEnd);
		}
	}
	if(this.callback)
		this.callback(this.element,this.properties);
};

Morpher.prototype.tick = function()
{
	var currTime = Number(new Date());
	var t,progress = Animator.slowInSlowOut(Math.min(1,(currTime-this.startTime)/this.duration));
	for(t=0; t<this.properties.length; t++) {
		var p = this.properties[t];
		if(p.start !== undefined && p.end !== undefined) {
			var template = p.template || "%0";
			switch(p.format) {
			case undefined:
			case "style":
				var v = p.start + (p.end-p.start) * progress;
				this.assignStyle(this.element,p.style,template.format([v]));
				break;
			case "color":
				break;
			}
		}
	}
	if(currTime >= this.endTime) {
		this.stop();
		return false;
	}
	return true;
};

//--
//-- Zoomer animation
//--

function Zoomer(text,startElement,targetElement,unused)
{
	var e = createTiddlyElement(document.body,"div",null,"zoomer");
	createTiddlyElement(e,"div",null,null,text);
	var winWidth = findWindowWidth();
	var winHeight = findWindowHeight();
	var p = [
		{style: 'left', start: findPosX(startElement), end: findPosX(targetElement), template: '%0px'},
		{style: 'top', start: findPosY(startElement), end: findPosY(targetElement), template: '%0px'},
		{style: 'width', start: Math.min(startElement.scrollWidth,winWidth), end: Math.min(targetElement.scrollWidth,winWidth), template: '%0px', atEnd: 'auto'},
		{style: 'height', start: Math.min(startElement.scrollHeight,winHeight), end: Math.min(targetElement.scrollHeight,winHeight), template: '%0px', atEnd: 'auto'},
		{style: 'fontSize', start: 8, end: 24, template: '%0pt'}
	];
	var c = function(element,properties) {jQuery(element).remove();};
	return new Morpher(e,config.animDuration,p,c);
}

//--
//-- Scroller animation
//--

function Scroller(targetElement)
{
	var p = [{style: '-tw-vertScroll', start: findScrollY(), end: ensureVisible(targetElement)}];
	return new Morpher(targetElement,config.animDuration,p);
}

//--
//-- Slider animation
//--

// deleteMode - "none", "all" [delete target element and it's children], [only] "children" [but not the target element]
function Slider(element,opening,unused,deleteMode)
{
	element.style.overflow = 'hidden';
	if(opening)
		element.style.height = '0px'; // Resolves a Firefox flashing bug
	element.style.display = 'block';
	var height = element.scrollHeight;
	var p = [];
	var c = null;
	if(opening) {
		p.push({style: 'height', start: 0, end: height, template: '%0px', atEnd: 'auto'});
		p.push({style: 'opacity', start: 0, end: 1, template: '%0'});
		p.push({style: 'filter', start: 0, end: 100, template: 'alpha(opacity:%0)'});
	} else {
		p.push({style: 'height', start: height, end: 0, template: '%0px'});
		p.push({style: 'display', atEnd: 'none'});
		p.push({style: 'opacity', start: 1, end: 0, template: '%0'});
		p.push({style: 'filter', start: 100, end: 0, template: 'alpha(opacity:%0)'});
		switch(deleteMode) {
		case "all":
			c = function(element,properties) {jQuery(element).remove();};
			break;
		case "children":
			c = function(element,properties) {jQuery(element).empty();};
			break;
		}
	}
	return new Morpher(element,config.animDuration,p,c);
}

//--
//-- Popup menu
//--

var Popup = {
	stack: [] // Array of objects with members root: and popup:
	};

Popup.create = function(root,elem,className)
{
	var stackPosition = this.find(root,"popup");
	Popup.remove(stackPosition+1);
	var popup = createTiddlyElement(document.body,elem || "ol","popup",className || "popup");
	popup.stackPosition = stackPosition;
	Popup.stack.push({root: root, popup: popup});
	return popup;
};

Popup.onDocumentClick = function(ev)
{
	var e = ev || window.event;
	if(e.eventPhase == undefined)
		Popup.remove();
	else if(e.eventPhase == Event.BUBBLING_PHASE || e.eventPhase == Event.AT_TARGET)
		Popup.remove();
	return true;
};

Popup.show = function(valign,halign,offset)
{
	var curr = Popup.stack[Popup.stack.length-1];
	this.place(curr.root,curr.popup,valign,halign,offset);
	jQuery(curr.root).addClass("highlight");
	if(config.options.chkAnimate && anim && typeof Scroller == "function")
		anim.startAnimating(new Scroller(curr.popup));
	else
		window.scrollTo(0,ensureVisible(curr.popup));
};

Popup.place = function(root,popup,valign,halign,offset)
{
	if(!offset)
		offset = {x:0,y:0};
	if(popup.stackPosition >= 0 && !valign && !halign) {
		offset.x = offset.x + root.offsetWidth;
	} else {
		offset.x = (halign == "right") ? offset.x + root.offsetWidth : offset.x;
		offset.y = (valign == "top") ? offset.y : offset.y + root.offsetHeight;
	}
	var rootLeft = findPosX(root);
	var rootTop = findPosY(root);
	var popupLeft = rootLeft + offset.x;
	var popupTop = rootTop + offset.y;
	var winWidth = findWindowWidth();
	if(popup.offsetWidth > winWidth*0.75)
		popup.style.width = winWidth*0.75 + "px";
	var popupWidth = popup.offsetWidth;
	var scrollWidth = winWidth - document.body.offsetWidth;
	if(popupLeft + popupWidth > winWidth - scrollWidth - 1) {
		if(halign == "right")
			popupLeft = popupLeft - root.offsetWidth - popupWidth;
		else
			popupLeft = winWidth - popupWidth - scrollWidth - 1;
	}
	popup.style.left = popupLeft + "px";
	popup.style.top = popupTop + "px";
	popup.style.display = "block";
};

Popup.find = function(e)
{
	var t,pos = -1;
	for(t=this.stack.length-1; t>=0; t--) {
		if(isDescendant(e,this.stack[t].popup))
			pos = t;
	}
	return pos;
};

Popup.remove = function(pos)
{
	if(!pos) pos = 0;
	if(Popup.stack.length > pos) {
		Popup.removeFrom(pos);
	}
};

Popup.removeFrom = function(from)
{
	var t;
	for(t=Popup.stack.length-1; t>=from; t--) {
		var p = Popup.stack[t];
		jQuery(p.root).removeClass("highlight");
		jQuery(p.popup).remove();
	}
	Popup.stack = Popup.stack.slice(0,from);
};

//--
//-- Wizard support
//--

function Wizard(elem)
{
	if(elem) {
		this.formElem = findRelated(elem,"wizard","className");
		this.bodyElem = findRelated(this.formElem.firstChild,"wizardBody","className","nextSibling");
		this.footElem = findRelated(this.formElem.firstChild,"wizardFooter","className","nextSibling");
	} else {
		this.formElem = null;
		this.bodyElem = null;
		this.footElem = null;
	}
}

Wizard.prototype.setValue = function(name,value)
{
	jQuery(this.formElem).data(name, value);
};

Wizard.prototype.getValue = function(name)
{
	return this.formElem ? jQuery(this.formElem).data(name) : null;
};

Wizard.prototype.createWizard = function(place,title)
{
	this.formElem = createTiddlyElement(place,"form",null,"wizard");
	createTiddlyElement(this.formElem,"h1",null,null,title);
	this.bodyElem = createTiddlyElement(this.formElem,"div",null,"wizardBody");
	this.footElem = createTiddlyElement(this.formElem,"div",null,"wizardFooter");
	return this.formElem;
};

Wizard.prototype.clear = function()
{
	jQuery(this.bodyElem).empty();
};

Wizard.prototype.setButtons = function(buttonInfo,status)
{
	jQuery(this.footElem).empty();
	var t;
	for(t=0; t<buttonInfo.length; t++) {
		createTiddlyButton(this.footElem,buttonInfo[t].caption,buttonInfo[t].tooltip,buttonInfo[t].onClick);
		insertSpacer(this.footElem);
		}
	if(typeof status == "string") {
		createTiddlyElement(this.footElem,"span",null,"status",status);
	}
};

Wizard.prototype.addStep = function(stepTitle,html)
{
	jQuery(this.bodyElem).empty();
	var w = createTiddlyElement(this.bodyElem,"div");
	createTiddlyElement(w,"h2",null,null,stepTitle);
	var step = createTiddlyElement(w,"div",null,"wizardStep");
	step.innerHTML = html;
	applyHtmlMacros(step,tiddler);
};

Wizard.prototype.getElement = function(name)
{
	return this.formElem.elements[name];
};

//--
//-- ListView gadget
//--

var ListView = {};

// Create a listview
ListView.create = function(place,listObject,listTemplate,callback,className)
{
	var table = createTiddlyElement(place,"table",null,className || "listView twtable");
	var thead = createTiddlyElement(table,"thead");
	var t,r = createTiddlyElement(thead,"tr");
	for(t=0; t<listTemplate.columns.length; t++) {
		var columnTemplate = listTemplate.columns[t];
		var c = createTiddlyElement(r,"th");
		var colType = ListView.columnTypes[columnTemplate.type];
		if(colType && colType.createHeader) {
			colType.createHeader(c,columnTemplate,t);
			if(columnTemplate.className)
				jQuery(c).addClass(columnTemplate.className);
		}
	}
	var rc,tbody = createTiddlyElement(table,"tbody");
	for(rc=0; rc<listObject.length; rc++) {
		var rowObject = listObject[rc];
		r = createTiddlyElement(tbody,"tr");
		for(c=0; c<listTemplate.rowClasses.length; c++) {
			if(rowObject[listTemplate.rowClasses[c].field])
				jQuery(r).addClass(listTemplate.rowClasses[c].className);
		}
		rowObject.rowElement = r;
		rowObject.colElements = {};
		var cc;
		for(cc=0; cc<listTemplate.columns.length; cc++) {
			c = createTiddlyElement(r,"td");
			columnTemplate = listTemplate.columns[cc];
			var field = columnTemplate.field;
			colType = ListView.columnTypes[columnTemplate.type];
			if(colType && colType.createItem) {
				colType.createItem(c,rowObject,field,columnTemplate,cc,rc);
				if(columnTemplate.className)
					jQuery(c).addClass(columnTemplate.className);
			}
			rowObject.colElements[field] = c;
		}
	}
	if(callback && listTemplate.actions)
		createTiddlyDropDown(place,ListView.getCommandHandler(callback),listTemplate.actions);
	if(callback && listTemplate.buttons) {
		for(t=0; t<listTemplate.buttons.length; t++) {
			var a = listTemplate.buttons[t];
			if(a && a.name != "")
				createTiddlyButton(place,a.caption,null,ListView.getCommandHandler(callback,a.name,a.allowEmptySelection));
		}
	}
	return table;
};

ListView.getCommandHandler = function(callback,name,allowEmptySelection)
{
	return function(e) {
		var view = findRelated(this,"TABLE",null,"previousSibling");
		var tiddlers = [];
		ListView.forEachSelector(view,function(e,rowName) {
					if(e.checked)
						tiddlers.push(rowName);
					});
		if(tiddlers.length == 0 && !allowEmptySelection) {
			alert(config.messages.nothingSelected);
		} else {
			if(this.nodeName.toLowerCase() == "select") {
				callback(view,this.value,tiddlers);
				this.selectedIndex = 0;
			} else {
				callback(view,name,tiddlers);
			}
		}
	};
};

// Invoke a callback for each selector checkbox in the listview
ListView.forEachSelector = function(view,callback)
{
	var checkboxes = view.getElementsByTagName("input");
	var t,hadOne = false;
	for(t=0; t<checkboxes.length; t++) {
		var cb = checkboxes[t];
		if(cb.getAttribute("type") == "checkbox") {
			var rn = cb.getAttribute("rowName");
			if(rn) {
				callback(cb,rn);
				hadOne = true;
			}
		}
	}
	return hadOne;
};

ListView.getSelectedRows = function(view)
{
	var rowNames = [];
	ListView.forEachSelector(view,function(e,rowName) {
				if(e.checked)
					rowNames.push(rowName);
				});
	return rowNames;
};

ListView.columnTypes = {};

ListView.columnTypes.String = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyText(place,columnTemplate.title);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v);
		}
};

ListView.columnTypes.WikiText = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				wikify(v,place,null,null);
		}
};

ListView.columnTypes.Tiddler = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined && v.title)
				createTiddlyPopup(place,v.title,config.messages.listView.tiddlerTooltip,v);
		}
};

ListView.columnTypes.Size = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var msg = config.messages.sizeTemplates;
			var v = listObject[field];
			if(v != undefined) {
				var t = 0;
				while(t<msg.length-1 && v<msg[t].unit)
					t++;
				createTiddlyText(place,msg[t].template.format([Math.round(v/msg[t].unit)]));
			}
		}
};

ListView.columnTypes.Link = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			var c = columnTemplate.text;
			if(v != undefined)
				createExternalLink(place,v,c || v);
		}
};

ListView.columnTypes.Date = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v.formatString(columnTemplate.dateFormat));
		}
};

ListView.columnTypes.StringList = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				var t;
				for(t=0; t<v.length; t++) {
					createTiddlyText(place,v[t]);
					createTiddlyElement(place,"br");
				}
			}
		}
};

ListView.columnTypes.Selector = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyCheckbox(place,null,false,this.onHeaderChange);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],null);
			e.setAttribute("rowName",listObject[columnTemplate.rowName]);
		},
	onHeaderChange: function(e)
		{
			var state = this.checked;
			var view = findRelated(this,"TABLE");
			if(!view)
				return;
			ListView.forEachSelector(view,function(e,rowName) {
								e.checked = state;
							});
		}
};

ListView.columnTypes.Tags = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var tags = listObject[field];
			createTiddlyText(place,String.encodeTiddlyLinkList(tags));
		}
};

ListView.columnTypes.Boolean = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			if(listObject[field] == true)
				createTiddlyText(place,columnTemplate.trueText);
			if(listObject[field] == false)
				createTiddlyText(place,columnTemplate.falseText);
		}
};

ListView.columnTypes.TagCheckbox = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],this.onChange);
			e.setAttribute("tiddler",listObject.title);
			e.setAttribute("tag",columnTemplate.tag);
		},
	onChange : function(e)
		{
			var tag = this.getAttribute("tag");
			var tiddler = this.getAttribute("tiddler");
			store.setTiddlerTag(tiddler,this.checked,tag);
		}
};

ListView.columnTypes.TiddlerLink = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				var link = createTiddlyLink(place,listObject[columnTemplate.tiddlerLink],false,null);
				createTiddlyText(link,listObject[field]);
			}
		}
};

//--
//-- Augmented methods for the JavaScript Array() object
//--

// Add indexOf function if browser does not support it
if(!Array.indexOf) {
Array.prototype.indexOf = function(item,from)
{
	if(!from)
		from = 0;
	var i;
	for(i=from; i<this.length; i++) {
		if(this[i] === item)
			return i;
	}
	return -1;
};}

// Find an entry in a given field of the members of an array
Array.prototype.findByField = function(field,value)
{
	var t;
	for(t=0; t<this.length; t++) {
		if(this[t][field] === value)
			return t;
	}
	return null;
};

// Return whether an entry exists in an array
Array.prototype.contains = function(item)
{
	return this.indexOf(item) != -1;
};

// Adds, removes or toggles a particular value within an array
//  value - value to add
//  mode - +1 to add value, -1 to remove value, 0 to toggle it
Array.prototype.setItem = function(value,mode)
{
	var p = this.indexOf(value);
	if(mode == 0)
		mode = (p == -1) ? +1 : -1;
	if(mode == +1) {
		if(p == -1)
			this.push(value);
	} else if(mode == -1) {
		if(p != -1)
			this.splice(p,1);
	}
};

// Return whether one of a list of values exists in an array
Array.prototype.containsAny = function(items)
{
	var i;
	for(i=0; i<items.length; i++) {
		if(this.indexOf(items[i]) != -1)
			return true;
	}
	return false;
};

// Return whether all of a list of values exists in an array
Array.prototype.containsAll = function(items)
{
	var i;
	for(i = 0; i<items.length; i++) {
		if(this.indexOf(items[i]) == -1)
			return false;
	}
	return true;
};

// Push a new value into an array only if it is not already present in the array. If the optional unique parameter is false, it reverts to a normal push
Array.prototype.pushUnique = function(item,unique)
{
	if(unique === false) {
		this.push(item);
	} else {
		if(this.indexOf(item) == -1)
			this.push(item);
	}
};

Array.prototype.remove = function(item)
{
	var p = this.indexOf(item);
	if(p != -1)
		this.splice(p,1);
};

if(!Array.prototype.map) {
Array.prototype.map = function(fn,thisObj)
{
	var scope = thisObj || window;
	var i,j,a = [];
	for(i=0, j=this.length; i < j; ++i) {
		a.push(fn.call(scope,this[i],i,this));
	}
	return a;
};}

//--
//-- Augmented methods for the JavaScript String() object
//--

// Get characters from the right end of a string
String.prototype.right = function(n)
{
	return n < this.length ? this.slice(this.length-n) : this;
};

// Trim whitespace from both ends of a string
String.prototype.trim = function()
{
	return this.replace(/^\s*|\s*$/g,"");
};

// Convert a string from a CSS style property name to a JavaScript style name ("background-color" -> "backgroundColor")
String.prototype.unDash = function()
{
	var t,s = this.split("-");
	if(s.length > 1) {
		for(t=1; t<s.length; t++)
			s[t] = s[t].substr(0,1).toUpperCase() + s[t].substr(1);
	}
	return s.join("");
};

// Substitute substrings from an array into a format string that includes '%1'-type specifiers
String.prototype.format = function(s)
{
	var substrings = s && s.constructor == Array ? s : arguments;
	var subRegExp = /(?:%(\d+))/mg;
	var currPos = 0;
	var match,r = [];
	do {
		match = subRegExp.exec(this);
		if(match && match[1]) {
			if(match.index > currPos)
				r.push(this.substring(currPos,match.index));
			r.push(substrings[parseInt(match[1],10)]);
			currPos = subRegExp.lastIndex;
		}
	} while(match);
	if(currPos < this.length)
		r.push(this.substring(currPos,this.length));
	return r.join("");
};

// Escape any special RegExp characters with that character preceded by a backslash
String.prototype.escapeRegExp = function()
{
	var s = "\\^$*+?()=!|,{}[].";
	var t,c = this;
	for(t=0; t<s.length; t++)
		c = c.replace(new RegExp("\\" + s.substr(t,1),"g"),"\\" + s.substr(t,1));
	return c;
};

// Convert "\" to "\s", newlines to "\n" (and remove carriage returns)
String.prototype.escapeLineBreaks = function()
{
	return this.replace(/\\/mg,"\\s").replace(/\n/mg,"\\n").replace(/\r/mg,"");
};

// Convert "\n" to newlines, "\b" to " ", "\s" to "\" (and remove carriage returns)
String.prototype.unescapeLineBreaks = function()
{
	return this.replace(/\\n/mg,"\n").replace(/\\b/mg," ").replace(/\\s/mg,"\\").replace(/\r/mg,"");
};

// Convert & to "&amp;", < to "&lt;", > to "&gt;" and " to "&quot;"
String.prototype.htmlEncode = function()
{
	return this.replace(/&/mg,"&amp;").replace(/</mg,"&lt;").replace(/>/mg,"&gt;").replace(/\"/mg,"&quot;");
};

// Convert "&amp;" to &, "&lt;" to <, "&gt;" to > and "&quot;" to "
String.prototype.htmlDecode = function()
{
	return this.replace(/&lt;/mg,"<").replace(/&gt;/mg,">").replace(/&quot;/mg,"\"").replace(/&amp;/mg,"&");
};

// Parse a space-separated string of name:value parameters
// The result is an array of objects:
//   result[0] = object with a member for each parameter name, value of that member being an array of values
//   result[1..n] = one object for each parameter, with 'name' and 'value' members
String.prototype.parseParams = function(defaultName,defaultValue,allowEval,noNames,cascadeDefaults)
{
	var parseToken = function(match,p) {
		var n;
		if(match[p]) // Double quoted
			n = match[p];
		else if(match[p+1]) // Single quoted
			n = match[p+1];
		else if(match[p+2]) // Double-square-bracket quoted
			n = match[p+2];
		else if(match[p+3]) // Double-brace quoted
			try {
				n = match[p+3];
				if(allowEval && config.evaluateMacroParameters != "none") {
					if(config.evaluateMacroParameters == "restricted") {
						if(window.restrictedEval) {
							n = window.restrictedEval(n);
						}
					} else {
						n = window.eval(n);
					}
				}
			} catch(ex) {
				throw "Unable to evaluate {{" + match[p+3] + "}}: " + exceptionText(ex);
			}
		else if(match[p+4]) // Unquoted
			n = match[p+4];
		else if(match[p+5]) // empty quote
			n = "";
		return n;
	};
	var r = [{}];
	var dblQuote = "(?:\"((?:(?:\\\\\")|[^\"])+)\")";
	var sngQuote = "(?:'((?:(?:\\\\\')|[^'])+)')";
	var dblSquare = "(?:\\[\\[((?:\\s|\\S)*?)\\]\\])";
	var dblBrace = "(?:\\{\\{((?:\\s|\\S)*?)\\}\\})";
	var unQuoted = noNames ? "([^\"'\\s]\\S*)" : "([^\"':\\s][^\\s:]*)";
	var emptyQuote = "((?:\"\")|(?:''))";
	var skipSpace = "(?:\\s*)";
	var token = "(?:" + dblQuote + "|" + sngQuote + "|" + dblSquare + "|" + dblBrace + "|" + unQuoted + "|" + emptyQuote + ")";
	var re = noNames ? new RegExp(token,"mg") : new RegExp(skipSpace + token + skipSpace + "(?:(\\:)" + skipSpace + token + ")?","mg");
	var match;
	do {
		match = re.exec(this);
		if(match) {
			var n = parseToken(match,1);
			if(noNames) {
				r.push({name:"",value:n});
			} else {
				var v = parseToken(match,8);
				if(v == null && defaultName) {
					v = n;
					n = defaultName;
				} else if(v == null && defaultValue) {
					v = defaultValue;
				}
				r.push({name:n,value:v});
				if(cascadeDefaults) {
					defaultName = n;
					defaultValue = v;
				}
			}
		}
	} while(match);
	// Summarise parameters into first element
	var t;
	for(t=1; t<r.length; t++) {
		if(r[0][r[t].name])
			r[0][r[t].name].push(r[t].value);
		else
			r[0][r[t].name] = [r[t].value];
	}
	return r;
};

// Process a string list of macro parameters into an array. Parameters can be quoted with "", '',
// [[]], {{ }} or left unquoted (and therefore space-separated). Double-braces {{}} results in
// an *evaluated* parameter: e.g. {{config.options.txtUserName}} results in the current user's name.
String.prototype.readMacroParams = function(notAllowEval)
{
	var p = this.parseParams("list",null,!notAllowEval,true);
	var t,n = [];
	for(t=1; t<p.length; t++)
		n.push(p[t].value);
	return n;
};

// Process a string list of unique tiddler names into an array. Tiddler names that have spaces in them must be [[bracketed]]
String.prototype.readBracketedList = function(unique)
{
	var p = this.parseParams("list",null,false,true);
	var t,n = [];
	for(t=1; t<p.length; t++) {
		if(p[t].value)
			n.pushUnique(p[t].value,unique);
	}
	return n;
};

// Returns array with start and end index of chunk between given start and end marker, or undefined.
String.prototype.getChunkRange = function(start,end)
{
	var s = this.indexOf(start);
	if(s != -1) {
		s += start.length;
		var e = this.indexOf(end,s);
		if(e != -1)
			return [s,e];
	}
};

// Replace a chunk of a string given start and end markers
String.prototype.replaceChunk = function(start,end,sub)
{
	var r = this.getChunkRange(start,end);
	return r ? this.substring(0,r[0]) + sub + this.substring(r[1]) : this;
};

// Returns a chunk of a string between start and end markers, or undefined
String.prototype.getChunk = function(start,end)
{
	var r = this.getChunkRange(start,end);
	if(r)
		return this.substring(r[0],r[1]);
};


// Static method to bracket a string with double square brackets if it contains a space
String.encodeTiddlyLink = function(title)
{
	return title.indexOf(" ") == -1 ? title : "[[" + title + "]]";
};

// Static method to encodeTiddlyLink for every item in an array and join them with spaces
String.encodeTiddlyLinkList = function(list)
{
	if(list) {
		var t,results = [];
		for(t=0; t<list.length; t++)
			results.push(String.encodeTiddlyLink(list[t]));
		return results.join(" ");
	} else {
		return "";
	}
};

// Convert a string as a sequence of name:"value" pairs into a hashmap
String.prototype.decodeHashMap = function()
{
	var fields = this.parseParams("anon","",false);
	var t,r = {};
	for(t=1; t<fields.length; t++)
		r[fields[t].name] = fields[t].value;
	return r;
};

// Static method to encode a hashmap into a name:"value"... string
String.encodeHashMap = function(hashmap)
{
	var t,r = [];
	for(t in hashmap)
		r.push(t + ':"' + hashmap[t] + '"');
	return r.join(" ");
};

// Static method to left-pad a string with 0s to a certain width
String.zeroPad = function(n,d)
{
	var s = n.toString();
	if(s.length < d)
		s = "000000000000000000000000000".substr(0,d-s.length) + s;
	return s;
};

String.prototype.startsWith = function(prefix)
{
	return !prefix || this.substring(0,prefix.length) == prefix;
};

// Returns the first value of the given named parameter.
function getParam(params,name,defaultValue)
{
	if(!params)
		return defaultValue;
	var p = params[0][name];
	return p ? p[0] : defaultValue;
}

// Returns the first value of the given boolean named parameter.
function getFlag(params,name,defaultValue)
{
	return !!getParam(params,name,defaultValue);
}

//--
//-- Augmented methods for the JavaScript Date() object
//--

// Substitute date components into a string
Date.prototype.formatString = function(template)
{
	var t = template.replace(/0hh12/g,String.zeroPad(this.getHours12(),2));
	t = t.replace(/hh12/g,this.getHours12());
	t = t.replace(/0hh/g,String.zeroPad(this.getHours(),2));
	t = t.replace(/hh/g,this.getHours());
	t = t.replace(/mmm/g,config.messages.dates.shortMonths[this.getMonth()]);
	t = t.replace(/0mm/g,String.zeroPad(this.getMinutes(),2));
	t = t.replace(/mm/g,this.getMinutes());
	t = t.replace(/0ss/g,String.zeroPad(this.getSeconds(),2));
	t = t.replace(/ss/g,this.getSeconds());
	t = t.replace(/[ap]m/g,this.getAmPm().toLowerCase());
	t = t.replace(/[AP]M/g,this.getAmPm().toUpperCase());
	t = t.replace(/wYYYY/g,this.getYearForWeekNo());
	t = t.replace(/wYY/g,String.zeroPad(this.getYearForWeekNo()-2000,2));
	t = t.replace(/YYYY/g,this.getFullYear());
	t = t.replace(/YY/g,String.zeroPad(this.getFullYear()-2000,2));
	t = t.replace(/MMM/g,config.messages.dates.months[this.getMonth()]);
	t = t.replace(/0MM/g,String.zeroPad(this.getMonth()+1,2));
	t = t.replace(/MM/g,this.getMonth()+1);
	t = t.replace(/0WW/g,String.zeroPad(this.getWeek(),2));
	t = t.replace(/WW/g,this.getWeek());
	t = t.replace(/DDD/g,config.messages.dates.days[this.getDay()]);
	t = t.replace(/ddd/g,config.messages.dates.shortDays[this.getDay()]);
	t = t.replace(/0DD/g,String.zeroPad(this.getDate(),2));
	t = t.replace(/DDth/g,this.getDate()+this.daySuffix());
	t = t.replace(/DD/g,this.getDate());
	var tz = this.getTimezoneOffset();
	var atz = Math.abs(tz);
	t = t.replace(/TZD/g,(tz < 0 ? '+' : '-') + String.zeroPad(Math.floor(atz / 60),2) + ':' + String.zeroPad(atz % 60,2));
	t = t.replace(/\\/g,"");
	return t;
};

Date.prototype.getWeek = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if(d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week to calculate weekNo
	var n = Math.floor((dt.getTime()-new Date(dt.getFullYear(),0,1)+3600000)/86400000);
	return Math.floor(n/7)+1;
};

Date.prototype.getYearForWeekNo = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if(d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week
	return dt.getFullYear();
};

Date.prototype.getHours12 = function()
{
	var h = this.getHours();
	return h > 12 ? h-12 : ( h > 0 ? h : 12 );
};

Date.prototype.getAmPm = function()
{
	return this.getHours() >= 12 ? config.messages.dates.pm : config.messages.dates.am;
};

Date.prototype.daySuffix = function()
{
	return config.messages.dates.daySuffixes[this.getDate()-1];
};

// Convert a date to local YYYYMMDDHHMM string format
Date.prototype.convertToLocalYYYYMMDDHHMM = function()
{
	return this.getFullYear() + String.zeroPad(this.getMonth()+1,2) + String.zeroPad(this.getDate(),2) + String.zeroPad(this.getHours(),2) + String.zeroPad(this.getMinutes(),2);
};

// Convert a date to UTC YYYYMMDDHHMM string format
Date.prototype.convertToYYYYMMDDHHMM = function()
{
	return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2);
};

// Convert a date to UTC YYYYMMDD.HHMMSSMMM string format
Date.prototype.convertToYYYYMMDDHHMMSSMMM = function()
{
	return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + "." + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2) + String.zeroPad(this.getUTCSeconds(),2) + String.zeroPad(this.getUTCMilliseconds(),3) +"0";
};

// Static method to create a date from a UTC YYYYMMDDHHMM format string
Date.convertFromYYYYMMDDHHMM = function(d)
{
	d = d?d.replace(/[^0-9]/g, ""):"";
	return Date.convertFromYYYYMMDDHHMMSSMMM(d.substr(0,12));
};

// Static method to create a date from a UTC YYYYMMDDHHMMSS format string
Date.convertFromYYYYMMDDHHMMSS = function(d)
{
	d = d?d.replace(/[^0-9]/g, ""):"";
	return Date.convertFromYYYYMMDDHHMMSSMMM(d.substr(0,14));
};

// Static method to create a date from a UTC YYYYMMDDHHMMSSMMM format string
Date.convertFromYYYYMMDDHHMMSSMMM = function(d)
{
	d = d ? d.replace(/[^0-9]/g, "") : "";
	return new Date(Date.UTC(parseInt(d.substr(0,4),10),
			parseInt(d.substr(4,2),10)-1,
			parseInt(d.substr(6,2),10),
			parseInt(d.substr(8,2)||"00",10),
			parseInt(d.substr(10,2)||"00",10),
			parseInt(d.substr(12,2)||"00",10),
			parseInt(d.substr(14,3)||"000",10)));
};

//--
//-- RGB colour object
//--

// Construct an RGB colour object from a '#rrggbb', '#rgb' or 'rgb(n,n,n)' string or from separate r,g,b values
function RGB(r,g,b)
{
	this.r = 0;
	this.g = 0;
	this.b = 0;
	if(typeof r == "string") {
		if(r.substr(0,1) == "#") {
			if(r.length == 7) {
				this.r = parseInt(r.substr(1,2),16)/255;
				this.g = parseInt(r.substr(3,2),16)/255;
				this.b = parseInt(r.substr(5,2),16)/255;
			} else {
				this.r = parseInt(r.substr(1,1),16)/15;
				this.g = parseInt(r.substr(2,1),16)/15;
				this.b = parseInt(r.substr(3,1),16)/15;
			}
		} else {
			var rgbPattern = /rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/;
			var c = r.match(rgbPattern);
			if(c) {
				this.r = parseInt(c[1],10)/255;
				this.g = parseInt(c[2],10)/255;
				this.b = parseInt(c[3],10)/255;
			}
		}
	} else {
		this.r = r;
		this.g = g;
		this.b = b;
	}
	return this;
}

// Mixes this colour with another in a specified proportion
// c = other colour to mix
// f = 0..1 where 0 is this colour and 1 is the new colour
// Returns an RGB object
RGB.prototype.mix = function(c,f)
{
	return new RGB(this.r + (c.r-this.r) * f,this.g + (c.g-this.g) * f,this.b + (c.b-this.b) * f);
};

// Return an rgb colour as a #rrggbb format hex string
RGB.prototype.toString = function()
{
	var clamp = function(x,min,max) {
		return x < min ? min : (x > max ? max : x);
	};
	return "#" +
			("0" + Math.floor(clamp(this.r,0,1) * 255).toString(16)).right(2) +
			("0" + Math.floor(clamp(this.g,0,1) * 255).toString(16)).right(2) +
			("0" + Math.floor(clamp(this.b,0,1) * 255).toString(16)).right(2);
};

//--
//-- DOM utilities - many derived from www.quirksmode.org
//--

function drawGradient(place,horiz,locolors,hicolors)
{
	if(!hicolors)
		hicolors = locolors;
	var t;
	for(t=0; t<= 100; t+=2) {
		var bar = document.createElement("div");
		place.appendChild(bar);
		bar.style.position = "absolute";
		bar.style.left = horiz ? t + "%" : 0;
		bar.style.top = horiz ? 0 : t + "%";
		bar.style.width = horiz ? (101-t) + "%" : "100%";
		bar.style.height = horiz ? "100%" : (101-t) + "%";
		bar.style.zIndex = -1;
		var p = t/100*(locolors.length-1);
		var hc = hicolors[Math.floor(p)];
		if(typeof hc == "string")
			hc = new RGB(hc);
		var lc = locolors[Math.ceil(p)];
		if(typeof lc == "string")
			lc = new RGB(lc);
		bar.style.backgroundColor = hc.mix(lc,p-Math.floor(p)).toString();
	}
}

function addEvent(obj,type,fn)
{
	if(obj.attachEvent) {
		obj["e"+type+fn] = fn;
		obj[type+fn] = function(){obj["e"+type+fn](window.event);};
		obj.attachEvent("on"+type,obj[type+fn]);
	} else {
		obj.addEventListener(type,fn,false);
	}
}

function removeEvent(obj,type,fn)
{
	if(obj.detachEvent) {
		obj.detachEvent("on"+type,obj[type+fn]);
		obj[type+fn] = null;
	} else {
		obj.removeEventListener(type,fn,false);
	}
}

// Find the closest relative with a given property value (property defaults to tagName, relative defaults to parentNode)
function findRelated(e,value,name,relative)
{
	name = name || "tagName";
	relative = relative || "parentNode";
	if(name == "className") {
		while(e && !jQuery(e).hasClass(value)) {
			e = e[relative];
		}
	} else {
		while(e && e[name] != value) {
			e = e[relative];
		}
	}
	return e;
}

// Get the scroll position for window.scrollTo necessary to scroll a given element into view
function ensureVisible(e)
{
	var posTop = findPosY(e);
	var posBot = posTop + e.offsetHeight;
	var winTop = findScrollY();
	var winHeight = findWindowHeight();
	var winBot = winTop + winHeight;
	if(posTop < winTop) {
		return posTop;
	} else if(posBot > winBot) {
		if(e.offsetHeight < winHeight)
			return posTop - (winHeight - e.offsetHeight);
		else
			return posTop;
	} else {
		return winTop;
	}
}

// Get the current width of the display window
function findWindowWidth()
{
	return window.innerWidth || document.documentElement.clientWidth;
}

// Get the current height of the display window
function findWindowHeight()
{
	return window.innerHeight || document.documentElement.clientHeight;
}

// Get the current horizontal page scroll position
function findScrollX()
{
	return window.scrollX || document.documentElement.scrollLeft;
}

// Get the current vertical page scroll position
function findScrollY()
{
	return window.scrollY || document.documentElement.scrollTop;
}

function findPosX(obj)
{
	var curleft = 0;
	while(obj.offsetParent) {
		curleft += obj.offsetLeft;
		obj = obj.offsetParent;
	}
	return curleft;
}

function findPosY(obj)
{
	var curtop = 0;
	while(obj.offsetParent) {
		curtop += obj.offsetTop;
		obj = obj.offsetParent;
	}
	return curtop;
}

// Blur a particular element
function blurElement(e)
{
	if(e && e.focus && e.blur) {
		e.focus();
		e.blur();
	}
}

// Create a non-breaking space
function insertSpacer(place)
{
	var e = document.createTextNode(String.fromCharCode(160));
	if(place)
		place.appendChild(e);
	return e;
}

// Replace the current selection of a textarea or text input and scroll it into view
function replaceSelection(e,text)
{
	if(e.setSelectionRange) {
		var oldpos = e.selectionStart;
		var isRange = e.selectionEnd > e.selectionStart;
		e.value = e.value.substr(0,e.selectionStart) + text + e.value.substr(e.selectionEnd);
		e.setSelectionRange(isRange ? oldpos : oldpos + text.length,oldpos + text.length);
		var linecount = e.value.split("\n").length;
		var thisline = e.value.substr(0,e.selectionStart).split("\n").length-1;
		e.scrollTop = Math.floor((thisline - e.rows / 2) * e.scrollHeight / linecount);
	} else if(document.selection) {
		var range = document.selection.createRange();
		if(range.parentElement() == e) {
			var isCollapsed = range.text == "";
			range.text = text;
			if(!isCollapsed) {
				range.moveStart("character", -text.length);
				range.select();
			}
		}
	}
}

// Set the caret position in a text area
function setCaretPosition(e,pos)
{
	if(e.selectionStart || e.selectionStart == '0') {
		e.selectionStart = pos;
		e.selectionEnd = pos;
		e.focus();
	} else if(document.selection) {
		// IE support
		e.focus ();
		var sel = document.selection.createRange();
		sel.moveStart('character', -e.value.length);
		sel.moveStart('character',pos);
		sel.moveEnd('character',0);
		sel.select();
	}
}

// Returns the text of the given (text) node, possibly merging subsequent text nodes
function getNodeText(e)
{
	var t = "";
	while(e && e.nodeName == "#text") {
		t += e.nodeValue;
		e = e.nextSibling;
	}
	return t;
}

// Returns true if the element e has a given ancestor element
function isDescendant(e,ancestor)
{
	while(e) {
		if(e === ancestor)
			return true;
		e = e.parentNode;
	}
	return false;
}


// deprecate the following...

// Prevent an event from bubbling
function stopEvent(e)
{
	var ev = e || window.event;
	ev.cancelBubble = true;
	if(ev.stopPropagation) ev.stopPropagation();
	return false;
}

// Remove any event handlers or non-primitve custom attributes
function scrubNode(e)
{
	if(!config.browser.isIE)
		return;
	var att = e.attributes;
	if(att) {
		var t;
		for(t=0; t<att.length; t++) {
			var n = att[t].name;
			if(n !== "style" && (typeof e[n] === "function" || (typeof e[n] === "object" && e[n] != null))) {
				try {
					e[n] = null;
				} catch(ex) {
				}
			}
		}
	}
	var c = e.firstChild;
	while(c) {
		scrubNode(c);
		c = c.nextSibling;
	}
}

function setStylesheet(s,id,doc)
{
	jQuery.twStylesheet(s,{id:id,doc:doc});
}

function removeStyleSheet(id)
{
	jQuery.twStylesheet.remove({id:id});
}

//--
//-- LoaderBase and SaverBase
//--

function LoaderBase() {}

LoaderBase.prototype.loadTiddler = function(store,node,tiddlers)
{
	var title = this.getTitle(store,node);
	if(safeMode && store.isShadowTiddler(title))
		return;
	if(title) {
		var tiddler = store.createTiddler(title);
		this.internalizeTiddler(store,tiddler,title,node);
		tiddlers.push(tiddler);
	}
};

LoaderBase.prototype.loadTiddlers = function(store,nodes)
{
	var t,tiddlers = [];
	for(t = 0; t < nodes.length; t++) {
		try {
			this.loadTiddler(store,nodes[t],tiddlers);
		} catch(ex) {
			showException(ex,config.messages.tiddlerLoadError.format([this.getTitle(store,nodes[t])]));
		}
	}
	return tiddlers;
};

function SaverBase() {}

SaverBase.prototype.externalize = function(store)
{
	var results = [];
	var t,tiddlers = store.getTiddlers("title");
	for(t = 0; t < tiddlers.length; t++) {
		if(!tiddlers[t].doNotSave())
			results.push(this.externalizeTiddler(store, tiddlers[t]));
	}
	return results.join("\n");
};

//--
//-- TW21Loader (inherits from LoaderBase)
//--

function TW21Loader() {}

TW21Loader.prototype = new LoaderBase();

TW21Loader.prototype.getTitle = function(store,node)
{
	var title = null;
	if(node.getAttribute) {
		title = node.getAttribute("title");
		if(!title)
			title = node.getAttribute("tiddler");
	}
	if(!title && node.id) {
		var lenPrefix = store.idPrefix.length;
		if(node.id.substr(0,lenPrefix) == store.idPrefix)
			title = node.id.substr(lenPrefix);
	}
	return title;
};

TW21Loader.prototype.internalizeTiddler = function(store,tiddler,title,node)
{
	var e = node.firstChild;
	var text = null;
	if(node.getAttribute("tiddler")) {
		text = getNodeText(e).unescapeLineBreaks();
	} else {
		while(e.nodeName!="PRE" && e.nodeName!="pre") {
			e = e.nextSibling;
		}
		text = e.innerHTML.replace(/\r/mg,"").htmlDecode();
	}
	var creator = node.getAttribute("creator");
	var modifier = node.getAttribute("modifier");
	var c = node.getAttribute("created");
	var m = node.getAttribute("modified");
	var created = c ? Date.convertFromYYYYMMDDHHMMSS(c) : version.date;
	var modified = m ? Date.convertFromYYYYMMDDHHMMSS(m) : created;
	var tags = node.getAttribute("tags");
	var fields = {};
	var i,attrs = node.attributes;
	for(i = attrs.length-1; i >= 0; i--) {
		var name = attrs[i].name;
		if(attrs[i].specified && !TiddlyWiki.isStandardField(name)) {
			fields[name] = attrs[i].value.unescapeLineBreaks();
		}
	}
	tiddler.assign(title,text,modifier,modified,tags,created,fields,creator);
	return tiddler;
};

//--
//-- TW21Saver (inherits from SaverBase)
//--

function TW21Saver() {}

TW21Saver.prototype = new SaverBase();

TW21Saver.prototype.externalizeTiddler = function(store,tiddler)
{
	try {
		var extendedAttributes = "";
		var usePre = config.options.chkUsePreForStorage;
		store.forEachField(tiddler,
			function(tiddler,fieldName,value) {
				// don't store stuff from the temp namespace
				if(typeof value != "string")
					value = "";
				if(!fieldName.match(/^temp\./))
					extendedAttributes += ' %0="%1"'.format([fieldName,value.escapeLineBreaks().htmlEncode()]);
			},true);
		var created = tiddler.created;
		var modified = tiddler.modified;
		var attributes = tiddler.creator ? ' creator="' + tiddler.creator.htmlEncode() + '"' : "";
		attributes += tiddler.modifier ? ' modifier="' + tiddler.modifier.htmlEncode() + '"' : "";
		attributes += (usePre && created == version.date) ? "" :' created="' + created.convertToYYYYMMDDHHMM() + '"';
		attributes += (usePre && modified == created) ? "" : ' modified="' + modified.convertToYYYYMMDDHHMM() +'"';
		var tags = tiddler.getTags();
		if(!usePre || tags)
			attributes += ' tags="' + tags.htmlEncode() + '"';
		return ('<div %0="%1"%2%3>%4</'+'div>').format([
				usePre ? "title" : "tiddler",
				tiddler.title.htmlEncode(),
				attributes,
				extendedAttributes,
				usePre ? "\n<pre>" + tiddler.text.htmlEncode() + "</pre>\n" : tiddler.text.escapeLineBreaks().htmlEncode()
			]);
	} catch (ex) {
		throw exceptionText(ex,config.messages.tiddlerSaveError.format([tiddler.title]));
	}
};

//]]>
</script>
<script id="jsdeprecatedArea" type="text/javascript">
//<![CDATA[
//--
//-- Deprecated Crypto functions and associated conversion routines.
//-- Use the jQuery.encoding functions directly instead.
//--

// Crypto 'namespace'
function Crypto() {}

// Convert a string to an array of big-endian 32-bit words
Crypto.strToBe32s = function(str)
{
	return jQuery.encoding.strToBe32s(str);
};

// Convert an array of big-endian 32-bit words to a string
Crypto.be32sToStr = function(be)
{
	return jQuery.encoding.be32sToStr(be);
};

// Convert an array of big-endian 32-bit words to a hex string
Crypto.be32sToHex = function(be)
{
	return jQuery.encoding.be32sToHex(be);
};

// Return, in hex, the SHA-1 hash of a string
Crypto.hexSha1Str = function(str)
{
	return jQuery.encoding.digests.hexSha1Str(str);
};

// Return the SHA-1 hash of a string
Crypto.sha1Str = function(str)
{
	return jQuery.encoding.digests.sha1Str(str);
};

// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
Crypto.sha1 = function(x,blen)
{
	return jQuery.encoding.digests.sha1(x,blen);
};

//--
//-- Deprecated code
//--

// @Deprecated: Use createElementAndWikify and this.termRegExp instead
config.formatterHelpers.charFormatHelper = function(w)
{
	w.subWikify(createTiddlyElement(w.output,this.element),this.terminator);
};

// @Deprecated: Use enclosedTextHelper and this.lookaheadRegExp instead
config.formatterHelpers.monospacedByLineHelper = function(w)
{
	var lookaheadRegExp = new RegExp(this.lookahead,"mg");
	lookaheadRegExp.lastIndex = w.matchStart;
	var lookaheadMatch = lookaheadRegExp.exec(w.source);
	if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
		var text = lookaheadMatch[1];
		if(config.browser.isIE)
			text = text.replace(/\n/g,"\r");
		createTiddlyElement(w.output,"pre",null,null,text);
		w.nextMatch = lookaheadRegExp.lastIndex;
	}
};

// @Deprecated: Use <br> or <br /> instead of <<br>>
config.macros.br = {};
config.macros.br.handler = function(place)
{
	createTiddlyElement(place,"br");
};

// Find an entry in an array. Returns the array index or null
// @Deprecated: Use indexOf instead
Array.prototype.find = function(item)
{
	var i = this.indexOf(item);
	return i == -1 ? null : i;
};

// Load a tiddler from an HTML DIV. The caller should make sure to later call Tiddler.changed()
// @Deprecated: Use store.getLoader().internalizeTiddler instead
Tiddler.prototype.loadFromDiv = function(divRef,title)
{
	return store.getLoader().internalizeTiddler(store,this,title,divRef);
};

// Format the text for storage in an HTML DIV
// @Deprecated Use store.getSaver().externalizeTiddler instead.
Tiddler.prototype.saveToDiv = function()
{
	return store.getSaver().externalizeTiddler(store,this);
};

// @Deprecated: Use store.allTiddlersAsHtml() instead
function allTiddlersAsHtml()
{
	return store.allTiddlersAsHtml();
}

// @Deprecated: Use refreshPageTemplate instead
function applyPageTemplate(title)
{
	refreshPageTemplate(title);
}

// @Deprecated: Use story.displayTiddlers instead
function displayTiddlers(srcElement,titles,template,unused1,unused2,animate,unused3)
{
	story.displayTiddlers(srcElement,titles,template,animate);
}

// @Deprecated: Use story.displayTiddler instead
function displayTiddler(srcElement,title,template,unused1,unused2,animate,unused3)
{
	story.displayTiddler(srcElement,title,template,animate);
}

// @Deprecated: Use functions on right hand side directly instead
var createTiddlerPopup = Popup.create;
var scrollToTiddlerPopup = Popup.show;
var hideTiddlerPopup = Popup.remove;

// @Deprecated: Use right hand side directly instead
var regexpBackSlashEn = new RegExp("\\\\n","mg");
var regexpBackSlash = new RegExp("\\\\","mg");
var regexpBackSlashEss = new RegExp("\\\\s","mg");
var regexpNewLine = new RegExp("\n","mg");
var regexpCarriageReturn = new RegExp("\r","mg");

//--
//-- Deprecated FileAdaptor functions
//--

FileAdaptor.loadTiddlyWikiCallback = function(status,context,responseText,url,xhr)
{
	context.status = status;
	if(!status) {
		context.statusText = "Error reading file";
	} else {
		context.adaptor.store = new TiddlyWiki();
		if(!context.adaptor.store.importTiddlyWiki(responseText)) {
			context.statusText = config.messages.invalidFileError.format([url]);
			context.status = false;
		}
	}
	context.complete(context,context.userParams);
};

//--
//-- Deprecated HTTP request code
//-- Use the jQuery ajax functions directly instead
//--

function loadRemoteFile(url,callback,params)
{
	return httpReq("GET",url,callback,params);
}

function doHttp(type,url,data,contentType,username,password,callback,params,headers,allowCache)
{
	return httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache);
}

//--
//-- Deprecated String functions
//--

// @Deprecated: no direct replacement, since not used in core code
String.prototype.toJSONString = function()
{
	// Convert a string to it's JSON representation by encoding control characters, double quotes and backslash. See json.org
	var m = {
		'\b': '\\b',
		'\f': '\\f',
		'\n': '\\n',
		'\r': '\\r',
		'\t': '\\t',
		'"' : '\\"',
		'\\': '\\\\'
		};
	var replaceFn = function(a,b) {
		var c = m[b];
		if(c)
			return c;
		c = b.charCodeAt();
		return '\\u00' + Math.floor(c / 16).toString(16) + (c % 16).toString(16);
		};
	if(/["\\\x00-\x1f]/.test(this))
		return '"' + this.replace(/([\x00-\x1f\\"])/g,replaceFn) + '"';
	return '"' + this + '"';
};

//--
//-- Deprecated Tiddler code
//--

// @Deprecated: Use tiddlerToRssItem(tiddler,uri) instead
Tiddler.prototype.toRssItem = function(uri)
{
	return tiddlerToRssItem(this,uri);
};

// @Deprecated: Use "<item>\n" + tiddlerToRssItem(tiddler,uri)  + "\n</item>" instead
Tiddler.prototype.saveToRss = function(uri)
{
	return "<item>\n" + tiddlerToRssItem(this,uri) + "\n</item>";
};

// @Deprecated: Use jQuery.encoding.digests.hexSha1Str instead
Tiddler.prototype.generateFingerprint = function()
{
	return "0x" + Crypto.hexSha1Str(this.text);
};

//--
//-- Deprecated Number functions
//--

// @Deprecated: no direct replacement, since not used in core code
// Clamp a number to a range
Number.prototype.clamp = function(min,max)
{
	var c = this;
	if(c < min)
		c = min;
	if(c > max)
		c = max;
	return Number(c);
};

//--
//-- Deprecated utility functions
//-- Use the jQuery functions directly instead
//--

// Remove all children of a node
function removeChildren(e)
{
	jQuery(e).empty();
}

// Remove a node and all it's children
function removeNode(e)
{
	jQuery(e).remove();
}

// Return the content of an element as plain text with no formatting
function getPlainText(e)
{
	return jQuery(e).text();
}

function addClass(e,className)
{
	jQuery(e).addClass(className);
}

function removeClass(e,className)
{
	jQuery(e).removeClass(className);
}

function hasClass(e,className)
{
	return jQuery(e).hasClass(className);
}

//--
//-- Deprecated Wikifier code
//--

function wikifyPlain(title,theStore,limit)
{
	if(!theStore)
		theStore = store;
	if(theStore.tiddlerExists(title) || theStore.isShadowTiddler(title)) {
		return wikifyPlainText(theStore.getTiddlerText(title),limit,tiddler);
	} else {
		return "";
	}
}

//]]>
</script>
<script id="jslibArea" type="text/javascript">
//<![CDATA[
/*! jQuery v1.6.4 http://jquery.com/ | http://jquery.org/license */
(function(a,b){function cu(a){return f.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}function cr(a){if(!cg[a]){var b=c.body,d=f("<"+a+">").appendTo(b),e=d.css("display");d.remove();if(e==="none"||e===""){ch||(ch=c.createElement("iframe"),ch.frameBorder=ch.width=ch.height=0),b.appendChild(ch);if(!ci||!ch.createElement)ci=(ch.contentWindow||ch.contentDocument).document,ci.write((c.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>"),ci.close();d=ci.createElement(a),ci.body.appendChild(d),e=f.css(d,"display"),b.removeChild(ch)}cg[a]=e}return cg[a]}function cq(a,b){var c={};f.each(cm.concat.apply([],cm.slice(0,b)),function(){c[this]=a});return c}function cp(){cn=b}function co(){setTimeout(cp,0);return cn=f.now()}function cf(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function ce(){try{return new a.XMLHttpRequest}catch(b){}}function b$(a,c){a.dataFilter&&(c=a.dataFilter(c,a.dataType));var d=a.dataTypes,e={},g,h,i=d.length,j,k=d[0],l,m,n,o,p;for(g=1;g<i;g++){if(g===1)for(h in a.converters)typeof h=="string"&&(e[h.toLowerCase()]=a.converters[h]);l=k,k=d[g];if(k==="*")k=l;else if(l!=="*"&&l!==k){m=l+" "+k,n=e[m]||e["* "+k];if(!n){p=b;for(o in e){j=o.split(" ");if(j[0]===l||j[0]==="*"){p=e[j[1]+" "+k];if(p){o=e[o],o===!0?n=p:p===!0&&(n=o);break}}}}!n&&!p&&f.error("No conversion from "+m.replace(" "," to ")),n!==!0&&(c=n?n(c):p(o(c)))}}return c}function bZ(a,c,d){var e=a.contents,f=a.dataTypes,g=a.responseFields,h,i,j,k;for(i in g)i in d&&(c[g[i]]=d[i]);while(f[0]==="*")f.shift(),h===b&&(h=a.mimeType||c.getResponseHeader("content-type"));if(h)for(i in e)if(e[i]&&e[i].test(h)){f.unshift(i);break}if(f[0]in d)j=f[0];else{for(i in d){if(!f[0]||a.converters[i+" "+f[0]]){j=i;break}k||(k=i)}j=j||k}if(j){j!==f[0]&&f.unshift(j);return d[j]}}function bY(a,b,c,d){if(f.isArray(b))f.each(b,function(b,e){c||bA.test(a)?d(a,e):bY(a+"["+(typeof e=="object"||f.isArray(e)?b:"")+"]",e,c,d)});else if(!c&&b!=null&&typeof b=="object")for(var e in b)bY(a+"["+e+"]",b[e],c,d);else d(a,b)}function bX(a,c){var d,e,g=f.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((g[d]?a:e||(e={}))[d]=c[d]);e&&f.extend(!0,a,e)}function bW(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h=a[f],i=0,j=h?h.length:0,k=a===bP,l;for(;i<j&&(k||!l);i++)l=h[i](c,d,e),typeof l=="string"&&(!k||g[l]?l=b:(c.dataTypes.unshift(l),l=bW(a,c,d,e,l,g)));(k||!l)&&!g["*"]&&(l=bW(a,c,d,e,"*",g));return l}function bV(a){return function(b,c){typeof b!="string"&&(c=b,b="*");if(f.isFunction(c)){var d=b.toLowerCase().split(bL),e=0,g=d.length,h,i,j;for(;e<g;e++)h=d[e],j=/^\+/.test(h),j&&(h=h.substr(1)||"*"),i=a[h]=a[h]||[],i[j?"unshift":"push"](c)}}}function by(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=b==="width"?bt:bu;if(d>0){c!=="border"&&f.each(e,function(){c||(d-=parseFloat(f.css(a,"padding"+this))||0),c==="margin"?d+=parseFloat(f.css(a,c+this))||0:d-=parseFloat(f.css(a,"border"+this+"Width"))||0});return d+"px"}d=bv(a,b,b);if(d<0||d==null)d=a.style[b]||0;d=parseFloat(d)||0,c&&f.each(e,function(){d+=parseFloat(f.css(a,"padding"+this))||0,c!=="padding"&&(d+=parseFloat(f.css(a,"border"+this+"Width"))||0),c==="margin"&&(d+=parseFloat(f.css(a,c+this))||0)});return d+"px"}function bl(a,b){b.src?f.ajax({url:b.src,async:!1,dataType:"script"}):f.globalEval((b.text||b.textContent||b.innerHTML||"").replace(bd,"/*$0*/")),b.parentNode&&b.parentNode.removeChild(b)}function bk(a){f.nodeName(a,"input")?bj(a):"getElementsByTagName"in a&&f.grep(a.getElementsByTagName("input"),bj)}function bj(a){if(a.type==="checkbox"||a.type==="radio")a.defaultChecked=a.checked}function bi(a){return"getElementsByTagName"in a?a.getElementsByTagName("*"):"querySelectorAll"in a?a.querySelectorAll("*"):[]}function bh(a,b){var c;if(b.nodeType===1){b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase();if(c==="object")b.outerHTML=a.outerHTML;else if(c!=="input"||a.type!=="checkbox"&&a.type!=="radio"){if(c==="option")b.selected=a.defaultSelected;else if(c==="input"||c==="textarea")b.defaultValue=a.defaultValue}else a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value);b.removeAttribute(f.expando)}}function bg(a,b){if(b.nodeType===1&&!!f.hasData(a)){var c=f.expando,d=f.data(a),e=f.data(b,d);if(d=d[c]){var g=d.events;e=e[c]=f.extend({},d);if(g){delete e.handle,e.events={};for(var h in g)for(var i=0,j=g[h].length;i<j;i++)f.event.add(b,h+(g[h][i].namespace?".":"")+g[h][i].namespace,g[h][i],g[h][i].data)}}}}function bf(a,b){return f.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function V(a,b,c){b=b||0;if(f.isFunction(b))return f.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return f.grep(a,function(a,d){return a===b===c});if(typeof b=="string"){var d=f.grep(a,function(a){return a.nodeType===1});if(Q.test(b))return f.filter(b,d,!c);b=f.filter(b,d)}return f.grep(a,function(a,d){return f.inArray(a,b)>=0===c})}function U(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function M(a,b){return(a&&a!=="*"?a+".":"")+b.replace(y,"`").replace(z,"&")}function L(a){var b,c,d,e,g,h,i,j,k,l,m,n,o,p=[],q=[],r=f._data(this,"events");if(!(a.liveFired===this||!r||!r.live||a.target.disabled||a.button&&a.type==="click")){a.namespace&&(n=new RegExp("(^|\\.)"+a.namespace.split(".").join("\\.(?:.*\\.)?")+"(\\.|$)")),a.liveFired=this;var s=r.live.slice(0);for(i=0;i<s.length;i++)g=s[i],g.origType.replace(w,"")===a.type?q.push(g.selector):s.splice(i--,1);e=f(a.target).closest(q,a.currentTarget);for(j=0,k=e.length;j<k;j++){m=e[j];for(i=0;i<s.length;i++){g=s[i];if(m.selector===g.selector&&(!n||n.test(g.namespace))&&!m.elem.disabled){h=m.elem,d=null;if(g.preType==="mouseenter"||g.preType==="mouseleave")a.type=g.preType,d=f(a.relatedTarget).closest(g.selector)[0],d&&f.contains(h,d)&&(d=h);(!d||d!==h)&&p.push({elem:h,handleObj:g,level:m.level})}}}for(j=0,k=p.length;j<k;j++){e=p[j];if(c&&e.level>c)break;a.currentTarget=e.elem,a.data=e.handleObj.data,a.handleObj=e.handleObj,o=e.handleObj.origHandler.apply(e.elem,arguments);if(o===!1||a.isPropagationStopped()){c=e.level,o===!1&&(b=!1);if(a.isImmediatePropagationStopped())break}}return b}}function J(a,c,d){var e=f.extend({},d[0]);e.type=a,e.originalEvent={},e.liveFired=b,f.event.handle.call(c,e),e.isDefaultPrevented()&&d[0].preventDefault()}function D(){return!0}function C(){return!1}function m(a,c,d){var e=c+"defer",g=c+"queue",h=c+"mark",i=f.data(a,e,b,!0);i&&(d==="queue"||!f.data(a,g,b,!0))&&(d==="mark"||!f.data(a,h,b,!0))&&setTimeout(function(){!f.data(a,g,b,!0)&&!f.data(a,h,b,!0)&&(f.removeData(a,e,!0),i.resolve())},0)}function l(a){for(var b in a)if(b!=="toJSON")return!1;return!0}function k(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(j,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:f.isNaN(d)?i.test(d)?f.parseJSON(d):d:parseFloat(d)}catch(g){}f.data(a,c,d)}else d=b}return d}var c=a.document,d=a.navigator,e=a.location,f=function(){function K(){if(!e.isReady){try{c.documentElement.doScroll("left")}catch(a){setTimeout(K,1);return}e.ready()}}var e=function(a,b){return new e.fn.init(a,b,h)},f=a.jQuery,g=a.$,h,i=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,j=/\S/,k=/^\s+/,l=/\s+$/,m=/\d/,n=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,o=/^[\],:{}\s]*$/,p=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,q=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,r=/(?:^|:|,)(?:\s*\[)+/g,s=/(webkit)[ \/]([\w.]+)/,t=/(opera)(?:.*version)?[ \/]([\w.]+)/,u=/(msie) ([\w.]+)/,v=/(mozilla)(?:.*? rv:([\w.]+))?/,w=/-([a-z]|[0-9])/ig,x=/^-ms-/,y=function(a,b){return(b+"").toUpperCase()},z=d.userAgent,A,B,C,D=Object.prototype.toString,E=Object.prototype.hasOwnProperty,F=Array.prototype.push,G=Array.prototype.slice,H=String.prototype.trim,I=Array.prototype.indexOf,J={};e.fn=e.prototype={constructor:e,init:function(a,d,f){var g,h,j,k;if(!a)return this;if(a.nodeType){this.context=this[0]=a,this.length=1;return this}if(a==="body"&&!d&&c.body){this.context=c,this[0]=c.body,this.selector=a,this.length=1;return this}if(typeof a=="string"){a.charAt(0)!=="<"||a.charAt(a.length-1)!==">"||a.length<3?g=i.exec(a):g=[null,a,null];if(g&&(g[1]||!d)){if(g[1]){d=d instanceof e?d[0]:d,k=d?d.ownerDocument||d:c,j=n.exec(a),j?e.isPlainObject(d)?(a=[c.createElement(j[1])],e.fn.attr.call(a,d,!0)):a=[k.createElement(j[1])]:(j=e.buildFragment([g[1]],[k]),a=(j.cacheable?e.clone(j.fragment):j.fragment).childNodes);return e.merge(this,a)}h=c.getElementById(g[2]);if(h&&h.parentNode){if(h.id!==g[2])return f.find(a);this.length=1,this[0]=h}this.context=c,this.selector=a;return this}return!d||d.jquery?(d||f).find(a):this.constructor(d).find(a)}if(e.isFunction(a))return f.ready(a);a.selector!==b&&(this.selector=a.selector,this.context=a.context);return e.makeArray(a,this)},selector:"",jquery:"1.6.4",length:0,size:function(){return this.length},toArray:function(){return G.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=this.constructor();e.isArray(a)?F.apply(d,a):e.merge(d,a),d.prevObject=this,d.context=this.context,b==="find"?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")");return d},each:function(a,b){return e.each(this,a,b)},ready:function(a){e.bindReady(),B.done(a);return this},eq:function(a){return a===-1?this.slice(a):this.slice(a,+a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(G.apply(this,arguments),"slice",G.call(arguments).join(","))},map:function(a){return this.pushStack(e.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:F,sort:[].sort,splice:[].splice},e.fn.init.prototype=e.fn,e.extend=e.fn.extend=function(){var a,c,d,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;typeof i=="boolean"&&(l=i,i=arguments[1]||{},j=2),typeof i!="object"&&!e.isFunction(i)&&(i={}),k===j&&(i=this,--j);for(;j<k;j++)if((a=arguments[j])!=null)for(c in a){d=i[c],f=a[c];if(i===f)continue;l&&f&&(e.isPlainObject(f)||(g=e.isArray(f)))?(g?(g=!1,h=d&&e.isArray(d)?d:[]):h=d&&e.isPlainObject(d)?d:{},i[c]=e.extend(l,h,f)):f!==b&&(i[c]=f)}return i},e.extend({noConflict:function(b){a.$===e&&(a.$=g),b&&a.jQuery===e&&(a.jQuery=f);return e},isReady:!1,readyWait:1,holdReady:function(a){a?e.readyWait++:e.ready(!0)},ready:function(a){if(a===!0&&!--e.readyWait||a!==!0&&!e.isReady){if(!c.body)return setTimeout(e.ready,1);e.isReady=!0;if(a!==!0&&--e.readyWait>0)return;B.resolveWith(c,[e]),e.fn.trigger&&e(c).trigger("ready").unbind("ready")}},bindReady:function(){if(!B){B=e._Deferred();if(c.readyState==="complete")return setTimeout(e.ready,1);if(c.addEventListener)c.addEventListener("DOMContentLoaded",C,!1),a.addEventListener("load",e.ready,!1);else if(c.attachEvent){c.attachEvent("onreadystatechange",C),a.attachEvent("onload",e.ready);var b=!1;try{b=a.frameElement==null}catch(d){}c.documentElement.doScroll&&b&&K()}}},isFunction:function(a){return e.type(a)==="function"},isArray:Array.isArray||function(a){return e.type(a)==="array"},isWindow:function(a){return a&&typeof a=="object"&&"setInterval"in a},isNaN:function(a){return a==null||!m.test(a)||isNaN(a)},type:function(a){return a==null?String(a):J[D.call(a)]||"object"},isPlainObject:function(a){if(!a||e.type(a)!=="object"||a.nodeType||e.isWindow(a))return!1;try{if(a.constructor&&!E.call(a,"constructor")&&!E.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}var d;for(d in a);return d===b||E.call(a,d)},isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw a},parseJSON:function(b){if(typeof b!="string"||!b)return null;b=e.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(o.test(b.replace(p,"@").replace(q,"]").replace(r,"")))return(new Function("return "+b))();e.error("Invalid JSON: "+b)},parseXML:function(c){var d,f;try{a.DOMParser?(f=new DOMParser,d=f.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(g){d=b}(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&e.error("Invalid XML: "+c);return d},noop:function(){},globalEval:function(b){b&&j.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(x,"ms-").replace(w,y)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,d){var f,g=0,h=a.length,i=h===b||e.isFunction(a);if(d){if(i){for(f in a)if(c.apply(a[f],d)===!1)break}else for(;g<h;)if(c.apply(a[g++],d)===!1)break}else if(i){for(f in a)if(c.call(a[f],f,a[f])===!1)break}else for(;g<h;)if(c.call(a[g],g,a[g++])===!1)break;return a},trim:H?function(a){return a==null?"":H.call(a)}:function(a){return a==null?"":(a+"").replace(k,"").replace(l,"")},makeArray:function(a,b){var c=b||[];if(a!=null){var d=e.type(a);a.length==null||d==="string"||d==="function"||d==="regexp"||e.isWindow(a)?F.call(c,a):e.merge(c,a)}return c},inArray:function(a,b){if(!b)return-1;if(I)return I.call(b,a);for(var c=0,d=b.length;c<d;c++)if(b[c]===a)return c;return-1},merge:function(a,c){var d=a.length,e=0;if(typeof c.length=="number")for(var f=c.length;e<f;e++)a[d++]=c[e];else while(c[e]!==b)a[d++]=c[e++];a.length=d;return a},grep:function(a,b,c){var d=[],e;c=!!c;for(var f=0,g=a.length;f<g;f++)e=!!b(a[f],f),c!==e&&d.push(a[f]);return d},map:function(a,c,d){var f,g,h=[],i=0,j=a.length,k=a instanceof e||j!==b&&typeof j=="number"&&(j>0&&a[0]&&a[j-1]||j===0||e.isArray(a));if(k)for(;i<j;i++)f=c(a[i],i,d),f!=null&&(h[h.length]=f);else for(g in a)f=c(a[g],g,d),f!=null&&(h[h.length]=f);return h.concat.apply([],h)},guid:1,proxy:function(a,c){if(typeof c=="string"){var d=a[c];c=a,a=d}if(!e.isFunction(a))return b;var f=G.call(arguments,2),g=function(){return a.apply(c,f.concat(G.call(arguments)))};g.guid=a.guid=a.guid||g.guid||e.guid++;return g},access:function(a,c,d,f,g,h){var i=a.length;if(typeof c=="object"){for(var j in c)e.access(a,j,c[j],f,g,d);return a}if(d!==b){f=!h&&f&&e.isFunction(d);for(var k=0;k<i;k++)g(a[k],c,f?d.call(a[k],k,g(a[k],c)):d,h);return a}return i?g(a[0],c):b},now:function(){return(new Date).getTime()},uaMatch:function(a){a=a.toLowerCase();var b=s.exec(a)||t.exec(a)||u.exec(a)||a.indexOf("compatible")<0&&v.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},sub:function(){function a(b,c){return new a.fn.init(b,c)}e.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(d,f){f&&f instanceof e&&!(f instanceof a)&&(f=a(f));return e.fn.init.call(this,d,f,b)},a.fn.init.prototype=a.fn;var b=a(c);return a},browser:{}}),e.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){J["[object "+b+"]"]=b.toLowerCase()}),A=e.uaMatch(z),A.browser&&(e.browser[A.browser]=!0,e.browser.version=A.version),e.browser.webkit&&(e.browser.safari=!0),j.test(" ")&&(k=/^[\s\xA0]+/,l=/[\s\xA0]+$/),h=e(c),c.addEventListener?C=function(){c.removeEventListener("DOMContentLoaded",C,!1),e.ready()}:c.attachEvent&&(C=function(){c.readyState==="complete"&&(c.detachEvent("onreadystatechange",C),e.ready())});return e}(),g="done fail isResolved isRejected promise then always pipe".split(" "),h=[].slice;f.extend({_Deferred:function(){var a=[],b,c,d,e={done:function(){if(!d){var c=arguments,g,h,i,j,k;b&&(k=b,b=0);for(g=0,h=c.length;g<h;g++)i=c[g],j=f.type(i),j==="array"?e.done.apply(e,i):j==="function"&&a.push(i);k&&e.resolveWith(k[0],k[1])}return this},resolveWith:function(e,f){if(!d&&!b&&!c){f=f||[],c=1;try{while(a[0])a.shift().apply(e,f)}finally{b=[e,f],c=0}}return this},resolve:function(){e.resolveWith(this,arguments);return this},isResolved:function(){return!!c||!!b},cancel:function(){d=1,a=[];return this}};return e},Deferred:function(a){var b=f._Deferred(),c=f._Deferred(),d;f.extend(b,{then:function(a,c){b.done(a).fail(c);return this},always:function(){return b.done.apply(b,arguments).fail.apply(this,arguments)},fail:c.done,rejectWith:c.resolveWith,reject:c.resolve,isRejected:c.isResolved,pipe:function(a,c){return f.Deferred(function(d){f.each({done:[a,"resolve"],fail:[c,"reject"]},function(a,c){var e=c[0],g=c[1],h;f.isFunction(e)?b[a](function(){h=e.apply(this,arguments),h&&f.isFunction(h.promise)?h.promise().then(d.resolve,d.reject):d[g+"With"](this===b?d:this,[h])}):b[a](d[g])})}).promise()},promise:function(a){if(a==null){if(d)return d;d=a={}}var c=g.length;while(c--)a[g[c]]=b[g[c]];return a}}),b.done(c.cancel).fail(b.cancel),delete b.cancel,a&&a.call(b,b);return b},when:function(a){function i(a){return function(c){b[a]=arguments.length>1?h.call(arguments,0):c,--e||g.resolveWith(g,h.call(b,0))}}var b=arguments,c=0,d=b.length,e=d,g=d<=1&&a&&f.isFunction(a.promise)?a:f.Deferred();if(d>1){for(;c<d;c++)b[c]&&f.isFunction(b[c].promise)?b[c].promise().then(i(c),g.reject):--e;e||g.resolveWith(g,b)}else g!==a&&g.resolveWith(g,d?[a]:[]);return g.promise()}}),f.support=function(){var a=c.createElement("div"),b=c.documentElement,d,e,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;a.setAttribute("className","t"),a.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",d=a.getElementsByTagName("*"),e=a.getElementsByTagName("a")[0];if(!d||!d.length||!e)return{};g=c.createElement("select"),h=g.appendChild(c.createElement("option")),i=a.getElementsByTagName("input")[0],k={leadingWhitespace:a.firstChild.nodeType===3,tbody:!a.getElementsByTagName("tbody").length,htmlSerialize:!!a.getElementsByTagName("link").length,style:/top/.test(e.getAttribute("style")),hrefNormalized:e.getAttribute("href")==="/a",opacity:/^0.55$/.test(e.style.opacity),cssFloat:!!e.style.cssFloat,checkOn:i.value==="on",optSelected:h.selected,getSetAttribute:a.className!=="t",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},i.checked=!0,k.noCloneChecked=i.cloneNode(!0).checked,g.disabled=!0,k.optDisabled=!h.disabled;try{delete a.test}catch(v){k.deleteExpando=!1}!a.addEventListener&&a.attachEvent&&a.fireEvent&&(a.attachEvent("onclick",function(){k.noCloneEvent=!1}),a.cloneNode(!0).fireEvent("onclick")),i=c.createElement("input"),i.value="t",i.setAttribute("type","radio"),k.radioValue=i.value==="t",i.setAttribute("checked","checked"),a.appendChild(i),l=c.createDocumentFragment(),l.appendChild(a.firstChild),k.checkClone=l.cloneNode(!0).cloneNode(!0).lastChild.checked,a.innerHTML="",a.style.width=a.style.paddingLeft="1px",m=c.getElementsByTagName("body")[0],o=c.createElement(m?"div":"body"),p={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},m&&f.extend(p,{position:"absolute",left:"-1000px",top:"-1000px"});for(t in p)o.style[t]=p[t];o.appendChild(a),n=m||b,n.insertBefore(o,n.firstChild),k.appendChecked=i.checked,k.boxModel=a.offsetWidth===2,"zoom"in a.style&&(a.style.display="inline",a.style.zoom=1,k.inlineBlockNeedsLayout=a.offsetWidth===2,a.style.display="",a.innerHTML="<div style='width:4px;'></div>",k.shrinkWrapBlocks=a.offsetWidth!==2),a.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",q=a.getElementsByTagName("td"),u=q[0].offsetHeight===0,q[0].style.display="",q[1].style.display="none",k.reliableHiddenOffsets=u&&q[0].offsetHeight===0,a.innerHTML="",c.defaultView&&c.defaultView.getComputedStyle&&(j=c.createElement("div"),j.style.width="0",j.style.marginRight="0",a.appendChild(j),k.reliableMarginRight=(parseInt((c.defaultView.getComputedStyle(j,null)||{marginRight:0}).marginRight,10)||0)===0),o.innerHTML="",n.removeChild(o);if(a.attachEvent)for(t in{submit:1,change:1,focusin:1})s="on"+t,u=s in a,u||(a.setAttribute(s,"return;"),u=typeof a[s]=="function"),k[t+"Bubbles"]=u;o=l=g=h=m=j=a=i=null;return k}(),f.boxModel=f.support.boxModel;var i=/^(?:\{.*\}|\[.*\])$/,j=/([A-Z])/g;f.extend({cache:{},uuid:0,expando:"jQuery"+(f.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){a=a.nodeType?f.cache[a[f.expando]]:a[f.expando];return!!a&&!l(a)},data:function(a,c,d,e){if(!!f.acceptData(a)){var g,h,i=f.expando,j=typeof c=="string",k=a.nodeType,l=k?f.cache:a,m=k?a[f.expando]:a[f.expando]&&f.expando;if((!m||e&&m&&l[m]&&!l[m][i])&&j&&d===b)return;m||(k?a[f.expando]=m=++f.uuid:m=f.expando),l[m]||(l[m]={},k||(l[m].toJSON=f.noop));if(typeof c=="object"||typeof c=="function")e?l[m][i]=f.extend(l[m][i],c):l[m]=f.extend(l[m],c);g=l[m],e&&(g[i]||(g[i]={}),g=g[i]),d!==b&&(g[f.camelCase(c)]=d);if(c==="events"&&!g[c])return g[i]&&g[i].events;j?(h=g[c],h==null&&(h=g[f.camelCase(c)])):h=g;return h}},removeData:function(a,b,c){if(!!f.acceptData(a)){var d,e=f.expando,g=a.nodeType,h=g?f.cache:a,i=g?a[f.expando]:f.expando;if(!h[i])return;if(b){d=c?h[i][e]:h[i];if(d){d[b]||(b=f.camelCase(b)),delete d[b];if(!l(d))return}}if(c){delete h[i][e];if(!l(h[i]))return}var j=h[i][e];f.support.deleteExpando||!h.setInterval?delete h[i]:h[i]=null,j?(h[i]={},g||(h[i].toJSON=f.noop),h[i][e]=j):g&&(f.support.deleteExpando?delete a[f.expando]:a.removeAttribute?a.removeAttribute(f.expando):a[f.expando]=null)}},_data:function(a,b,c){return f.data(a,b,c,!0)},acceptData:function(a){if(a.nodeName){var b=f.noData[a.nodeName.toLowerCase()];if(b)return b!==!0&&a.getAttribute("classid")===b}return!0}}),f.fn.extend({data:function(a,c){var d=null;if(typeof a=="undefined"){if(this.length){d=f.data(this[0]);if(this[0].nodeType===1){var e=this[0].attributes,g;for(var h=0,i=e.length;h<i;h++)g=e[h].name,g.indexOf("data-")===0&&(g=f.camelCase(g.substring(5)),k(this[0],g,d[g]))}}return d}if(typeof a=="object")return this.each(function(){f.data(this,a)});var j=a.split(".");j[1]=j[1]?"."+j[1]:"";if(c===b){d=this.triggerHandler("getData"+j[1]+"!",[j[0]]),d===b&&this.length&&(d=f.data(this[0],a),d=k(this[0],a,d));return d===b&&j[1]?this.data(j[0]):d}return this.each(function(){var b=f(this),d=[j[0],c];b.triggerHandler("setData"+j[1]+"!",d),f.data(this,a,c),b.triggerHandler("changeData"+j[1]+"!",d)})},removeData:function(a){return this.each(function(){f.removeData(this,a)})}}),f.extend({_mark:function(a,c){a&&(c=(c||"fx")+"mark",f.data(a,c,(f.data(a,c,b,!0)||0)+1,!0))},_unmark:function(a,c,d){a!==!0&&(d=c,c=a,a=!1);if(c){d=d||"fx";var e=d+"mark",g=a?0:(f.data(c,e,b,!0)||1)-1;g?f.data(c,e,g,!0):(f.removeData(c,e,!0),m(c,d,"mark"))}},queue:function(a,c,d){if(a){c=(c||"fx")+"queue";var e=f.data(a,c,b,!0);d&&(!e||f.isArray(d)?e=f.data(a,c,f.makeArray(d),!0):e.push(d));return e||[]}},dequeue:function(a,b){b=b||"fx";var c=f.queue(a,b),d=c.shift(),e;d==="inprogress"&&(d=c.shift()),d&&(b==="fx"&&c.unshift("inprogress"),d.call(a,function(){f.dequeue(a,b)})),c.length||(f.removeData(a,b+"queue",!0),m(a,b,"queue"))}}),f.fn.extend({queue:function(a,c){typeof a!="string"&&(c=a,a="fx");if(c===b)return f.queue(this[0],a);return this.each(function(){var b=f.queue(this,a,c);a==="fx"&&b[0]!=="inprogress"&&f.dequeue(this,a)})},dequeue:function(a){return this.each(function(){f.dequeue(this,a)})},delay:function(a,b){a=f.fx?f.fx.speeds[a]||a:a,b=b||"fx";return this.queue(b,function(){var c=this;setTimeout(function(){f.dequeue(c,b)},a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){function m(){--h||d.resolveWith(e,[e])}typeof a!="string"&&(c=a,a=b),a=a||"fx";var d=f.Deferred(),e=this,g=e.length,h=1,i=a+"defer",j=a+"queue",k=a+"mark",l;while(g--)if(l=f.data(e[g],i,b,!0)||(f.data(e[g],j,b,!0)||f.data(e[g],k,b,!0))&&f.data(e[g],i,f._Deferred(),!0))h++,l.done(m);m();return d.promise()}});var n=/[\n\t\r]/g,o=/\s+/,p=/\r/g,q=/^(?:button|input)$/i,r=/^(?:button|input|object|select|textarea)$/i,s=/^a(?:rea)?$/i,t=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,u,v;f.fn.extend({attr:function(a,b){return f.access(this,a,b,!0,f.attr)},removeAttr:function(a){return this.each(function(){f.removeAttr(this,a)})},prop:function(a,b){return f.access(this,a,b,!0,f.prop)},removeProp:function(a){a=f.propFix[a]||a;return this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,g,h,i;if(f.isFunction(a))return this.each(function(b){f(this).addClass(a.call(this,b,this.className))});if(a&&typeof a=="string"){b=a.split(o);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1)if(!e.className&&b.length===1)e.className=a;else{g=" "+e.className+" ";for(h=0,i=b.length;h<i;h++)~g.indexOf(" "+b[h]+" ")||(g+=b[h]+" ");e.className=f.trim(g)}}}return this},removeClass:function(a){var c,d,e,g,h,i,j;if(f.isFunction(a))return this.each(function(b){f(this).removeClass(a.call(this,b,this.className))});if(a&&typeof a=="string"||a===b){c=(a||"").split(o);for(d=0,e=this.length;d<e;d++){g=this[d];if(g.nodeType===1&&g.className)if(a){h=(" "+g.className+" ").replace(n," ");for(i=0,j=c.length;i<j;i++)h=h.replace(" "+c[i]+" "," ");g.className=f.trim(h)}else g.className=""}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";if(f.isFunction(a))return this.each(function(c){f(this).toggleClass(a.call(this,c,this.className,b),b)});return this.each(function(){if(c==="string"){var e,g=0,h=f(this),i=b,j=a.split(o);while(e=j[g++])i=d?i:!h.hasClass(e),h[i?"addClass":"removeClass"](e)}else if(c==="undefined"||c==="boolean")this.className&&f._data(this,"__className__",this.className),this.className=this.className||a===!1?"":f._data(this,"__className__")||""})},hasClass:function(a){var b=" "+a+" ";for(var c=0,d=this.length;c<d;c++)if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(n," ").indexOf(b)>-1)return!0;return!1},val:function(a){var c,d,e=this[0];if(!arguments.length){if(e){c=f.valHooks[e.nodeName.toLowerCase()]||f.valHooks[e.type];if(c&&"get"in c&&(d=c.get(e,"value"))!==b)return d;d=e.value;return typeof d=="string"?d.replace(p,""):d==null?"":d}return b}var g=f.isFunction(a);return this.each(function(d){var e=f(this),h;if(this.nodeType===1){g?h=a.call(this,d,e.val()):h=a,h==null?h="":typeof h=="number"?h+="":f.isArray(h)&&(h=f.map(h,function(a){return a==null?"":a+""})),c=f.valHooks[this.nodeName.toLowerCase()]||f.valHooks[this.type];if(!c||!("set"in c)||c.set(this,h,"value")===b)this.value=h}})}}),f.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c=a.selectedIndex,d=[],e=a.options,g=a.type==="select-one";if(c<0)return null;for(var h=g?c:0,i=g?c+1:e.length;h<i;h++){var j=e[h];if(j.selected&&(f.support.optDisabled?!j.disabled:j.getAttribute("disabled")===null)&&(!j.parentNode.disabled||!f.nodeName(j.parentNode,"optgroup"))){b=f(j).val();if(g)return b;d.push(b)}}if(g&&!d.length&&e.length)return f(e[c]).val();return d},set:function(a,b){var c=f.makeArray(b);f(a).find("option").each(function(){this.selected=f.inArray(f(this).val(),c)>=0}),c.length||(a.selectedIndex=-1);return c}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attrFix:{tabindex:"tabIndex"},attr:function(a,c,d,e){var g=a.nodeType;if(!a||g===3||g===8||g===2)return b;if(e&&c in f.attrFn)return f(a)[c](d);if(!("getAttribute"in a))return f.prop(a,c,d);var h,i,j=g!==1||!f.isXMLDoc(a);j&&(c=f.attrFix[c]||c,i=f.attrHooks[c],i||(t.test(c)?i=v:u&&(i=u)));if(d!==b){if(d===null){f.removeAttr(a,c);return b}if(i&&"set"in i&&j&&(h=i.set(a,d,c))!==b)return h;a.setAttribute(c,""+d);return d}if(i&&"get"in i&&j&&(h=i.get(a,c))!==null)return h;h=a.getAttribute(c);return h===null?b:h},removeAttr:function(a,b){var c;a.nodeType===1&&(b=f.attrFix[b]||b,f.attr(a,b,""),a.removeAttribute(b),t.test(b)&&(c=f.propFix[b]||b)in a&&(a[c]=!1))},attrHooks:{type:{set:function(a,b){if(q.test(a.nodeName)&&a.parentNode)f.error("type property can't be changed");else if(!f.support.radioValue&&b==="radio"&&f.nodeName(a,"input")){var c=a.value;a.setAttribute("type",b),c&&(a.value=c);return b}}},value:{get:function(a,b){if(u&&f.nodeName(a,"button"))return u.get(a,b);return b in a?a.value:null},set:function(a,b,c){if(u&&f.nodeName(a,"button"))return u.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e=a.nodeType;if(!a||e===3||e===8||e===2)return b;var g,h,i=e!==1||!f.isXMLDoc(a);i&&(c=f.propFix[c]||c,h=f.propHooks[c]);return d!==b?h&&"set"in h&&(g=h.set(a,d,c))!==b?g:a[c]=d:h&&"get"in h&&(g=h.get(a,c))!==null?g:a[c]},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):r.test(a.nodeName)||s.test(a.nodeName)&&a.href?0:b}}}}),f.attrHooks.tabIndex=f.propHooks.tabIndex,v={get:function(a,c){var d;return f.prop(a,c)===!0||(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;b===!1?f.removeAttr(a,c):(d=f.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase()));return c}},f.support.getSetAttribute||(u=f.valHooks.button={get:function(a,c){var d;d=a.getAttributeNode(c);return d&&d.nodeValue!==""?d.nodeValue:b},set:function(a,b,d){var e=a.getAttributeNode(d);e||(e=c.createAttribute(d),a.setAttributeNode(e));return e.nodeValue=b+""}},f.each(["width","height"],function(a,b){f.attrHooks[b]=f.extend(f.attrHooks[b],{set:function(a,c){if(c===""){a.setAttribute(b,"auto");return c}}})})),f.support.hrefNormalized||f.each(["href","src","width","height"],function(a,c){f.attrHooks[c]=f.extend(f.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return d===null?b:d}})}),f.support.style||(f.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=""+b}}),f.support.optSelected||(f.propHooks.selected=f.extend(f.propHooks.selected,{get:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex);return null}})),f.support.checkOn||f.each(["radio","checkbox"],function(){f.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),f.each(["radio","checkbox"],function(){f.valHooks[this]=f.extend(f.valHooks[this],{set:function(a,b){if(f.isArray(b))return a.checked=f.inArray(f(a).val(),b)>=0}})});var w=/\.(.*)$/,x=/^(?:textarea|input|select)$/i,y=/\./g,z=/ /g,A=/[^\w\s.|`]/g,B=function(a){return a.replace(A,"\\$&")};f.event={add:function(a,c,d,e){if(a.nodeType!==3&&a.nodeType!==8){if(d===!1)d=C;else if(!d)return;var g,h;d.handler&&(g=d,d=g.handler),d.guid||(d.guid=f.guid++);var i=f._data(a);if(!i)return;var j=i.events,k=i.handle;j||(i.events=j={}),k||(i.handle=k=function(a){return typeof f!="undefined"&&(!a||f.event.triggered!==a.type)?f.event.handle.apply(k.elem,arguments):b}),k.elem=a,c=c.split(" ");var l,m=0,n;while(l=c[m++]){h=g?f.extend({},g):{handler:d,data:e},l.indexOf(".")>-1?(n=l.split("."),l=n.shift(),h.namespace=n.slice(0).sort().join(".")):(n=[],h.namespace=""),h.type=l,h.guid||(h.guid=d.guid);var o=j[l],p=f.event.special[l]||{};if(!o){o=j[l]=[];if(!p.setup||p.setup.call(a,e,n,k)===!1)a.addEventListener?a.addEventListener(l,k,!1):a.attachEvent&&a.attachEvent("on"+l,k)}p.add&&(p.add.call(a,h),h.handler.guid||(h.handler.guid=d.guid)),o.push(h),f.event.global[l]=!0}a=null}},global:{},remove:function(a,c,d,e){if(a.nodeType!==3&&a.nodeType!==8){d===!1&&(d=C);var g,h,i,j,k=0,l,m,n,o,p,q,r,s=f.hasData(a)&&f._data(a),t=s&&s.events;if(!s||!t)return;c&&c.type&&(d=c.handler,c=c.type);if(!c||typeof c=="string"&&c.charAt(0)==="."){c=c||"";for(h in t)f.event.remove(a,h+c);return}c=c.split(" ");while(h=c[k++]){r=h,q=null,l=h.indexOf(".")<0,m=[],l||(m=h.split("."),h=m.shift(),n=new RegExp("(^|\\.)"+f.map(m.slice(0).sort(),B).join("\\.(?:.*\\.)?")+"(\\.|$)")),p=t[h];if(!p)continue;if(!d){for(j=0;j<p.length;j++){q=p[j];if(l||n.test(q.namespace))f.event.remove(a,r,q.handler,j),p.splice(j--,1)}continue}o=f.event.special[h]||{};for(j=e||0;j<p.length;j++){q=p[j];if(d.guid===q.guid){if(l||n.test(q.namespace))e==null&&p.splice(j--,1),o.remove&&o.remove.call(a,q);if(e!=null)break}}if(p.length===0||e!=null&&p.length===1)(!o.teardown||o.teardown.call(a,m)===!1)&&f.removeEvent(a,h,s.handle),g=null,delete 
t[h]}if(f.isEmptyObject(t)){var u=s.handle;u&&(u.elem=null),delete s.events,delete s.handle,f.isEmptyObject(s)&&f.removeData(a,b,!0)}}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,g){var h=c.type||c,i=[],j;h.indexOf("!")>=0&&(h=h.slice(0,-1),j=!0),h.indexOf(".")>=0&&(i=h.split("."),h=i.shift(),i.sort());if(!!e&&!f.event.customEvent[h]||!!f.event.global[h]){c=typeof c=="object"?c[f.expando]?c:new f.Event(h,c):new f.Event(h),c.type=h,c.exclusive=j,c.namespace=i.join("."),c.namespace_re=new RegExp("(^|\\.)"+i.join("\\.(?:.*\\.)?")+"(\\.|$)");if(g||!e)c.preventDefault(),c.stopPropagation();if(!e){f.each(f.cache,function(){var a=f.expando,b=this[a];b&&b.events&&b.events[h]&&f.event.trigger(c,d,b.handle.elem)});return}if(e.nodeType===3||e.nodeType===8)return;c.result=b,c.target=e,d=d!=null?f.makeArray(d):[],d.unshift(c);var k=e,l=h.indexOf(":")<0?"on"+h:"";do{var m=f._data(k,"handle");c.currentTarget=k,m&&m.apply(k,d),l&&f.acceptData(k)&&k[l]&&k[l].apply(k,d)===!1&&(c.result=!1,c.preventDefault()),k=k.parentNode||k.ownerDocument||k===c.target.ownerDocument&&a}while(k&&!c.isPropagationStopped());if(!c.isDefaultPrevented()){var n,o=f.event.special[h]||{};if((!o._default||o._default.call(e.ownerDocument,c)===!1)&&(h!=="click"||!f.nodeName(e,"a"))&&f.acceptData(e)){try{l&&e[h]&&(n=e[l],n&&(e[l]=null),f.event.triggered=h,e[h]())}catch(p){}n&&(e[l]=n),f.event.triggered=b}}return c.result}},handle:function(c){c=f.event.fix(c||a.event);var d=((f._data(this,"events")||{})[c.type]||[]).slice(0),e=!c.exclusive&&!c.namespace,g=Array.prototype.slice.call(arguments,0);g[0]=c,c.currentTarget=this;for(var h=0,i=d.length;h<i;h++){var j=d[h];if(e||c.namespace_re.test(j.namespace)){c.handler=j.handler,c.data=j.data,c.handleObj=j;var k=j.handler.apply(this,g);k!==b&&(c.result=k,k===!1&&(c.preventDefault(),c.stopPropagation()));if(c.isImmediatePropagationStopped())break}}return c.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(a){if(a[f.expando])return a;var d=a;a=f.Event(d);for(var e=this.props.length,g;e;)g=this.props[--e],a[g]=d[g];a.target||(a.target=a.srcElement||c),a.target.nodeType===3&&(a.target=a.target.parentNode),!a.relatedTarget&&a.fromElement&&(a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement);if(a.pageX==null&&a.clientX!=null){var h=a.target.ownerDocument||c,i=h.documentElement,j=h.body;a.pageX=a.clientX+(i&&i.scrollLeft||j&&j.scrollLeft||0)-(i&&i.clientLeft||j&&j.clientLeft||0),a.pageY=a.clientY+(i&&i.scrollTop||j&&j.scrollTop||0)-(i&&i.clientTop||j&&j.clientTop||0)}a.which==null&&(a.charCode!=null||a.keyCode!=null)&&(a.which=a.charCode!=null?a.charCode:a.keyCode),!a.metaKey&&a.ctrlKey&&(a.metaKey=a.ctrlKey),!a.which&&a.button!==b&&(a.which=a.button&1?1:a.button&2?3:a.button&4?2:0);return a},guid:1e8,proxy:f.proxy,special:{ready:{setup:f.bindReady,teardown:f.noop},live:{add:function(a){f.event.add(this,M(a.origType,a.selector),f.extend({},a,{handler:L,guid:a.handler.guid}))},remove:function(a){f.event.remove(this,M(a.origType,a.selector),a)}},beforeunload:{setup:function(a,b,c){f.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}}},f.removeEvent=c.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)},f.Event=function(a,b){if(!this.preventDefault)return new f.Event(a,b);a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?D:C):this.type=a,b&&f.extend(this,b),this.timeStamp=f.now(),this[f.expando]=!0},f.Event.prototype={preventDefault:function(){this.isDefaultPrevented=D;var a=this.originalEvent;!a||(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=D;var a=this.originalEvent;!a||(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=D,this.stopPropagation()},isDefaultPrevented:C,isPropagationStopped:C,isImmediatePropagationStopped:C};var E=function(a){var b=a.relatedTarget,c=!1,d=a.type;a.type=a.data,b!==this&&(b&&(c=f.contains(this,b)),c||(f.event.handle.apply(this,arguments),a.type=d))},F=function(a){a.type=a.data,f.event.handle.apply(this,arguments)};f.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){f.event.special[a]={setup:function(c){f.event.add(this,b,c&&c.selector?F:E,a)},teardown:function(a){f.event.remove(this,b,a&&a.selector?F:E)}}}),f.support.submitBubbles||(f.event.special.submit={setup:function(a,b){if(!f.nodeName(this,"form"))f.event.add(this,"click.specialSubmit",function(a){var b=a.target,c=f.nodeName(b,"input")||f.nodeName(b,"button")?b.type:"";(c==="submit"||c==="image")&&f(b).closest("form").length&&J("submit",this,arguments)}),f.event.add(this,"keypress.specialSubmit",function(a){var b=a.target,c=f.nodeName(b,"input")||f.nodeName(b,"button")?b.type:"";(c==="text"||c==="password")&&f(b).closest("form").length&&a.keyCode===13&&J("submit",this,arguments)});else return!1},teardown:function(a){f.event.remove(this,".specialSubmit")}});if(!f.support.changeBubbles){var G,H=function(a){var b=f.nodeName(a,"input")?a.type:"",c=a.value;b==="radio"||b==="checkbox"?c=a.checked:b==="select-multiple"?c=a.selectedIndex>-1?f.map(a.options,function(a){return a.selected}).join("-"):"":f.nodeName(a,"select")&&(c=a.selectedIndex);return c},I=function(c){var d=c.target,e,g;if(!!x.test(d.nodeName)&&!d.readOnly){e=f._data(d,"_change_data"),g=H(d),(c.type!=="focusout"||d.type!=="radio")&&f._data(d,"_change_data",g);if(e===b||g===e)return;if(e!=null||g)c.type="change",c.liveFired=b,f.event.trigger(c,arguments[1],d)}};f.event.special.change={filters:{focusout:I,beforedeactivate:I,click:function(a){var b=a.target,c=f.nodeName(b,"input")?b.type:"";(c==="radio"||c==="checkbox"||f.nodeName(b,"select"))&&I.call(this,a)},keydown:function(a){var b=a.target,c=f.nodeName(b,"input")?b.type:"";(a.keyCode===13&&!f.nodeName(b,"textarea")||a.keyCode===32&&(c==="checkbox"||c==="radio")||c==="select-multiple")&&I.call(this,a)},beforeactivate:function(a){var b=a.target;f._data(b,"_change_data",H(b))}},setup:function(a,b){if(this.type==="file")return!1;for(var c in G)f.event.add(this,c+".specialChange",G[c]);return x.test(this.nodeName)},teardown:function(a){f.event.remove(this,".specialChange");return x.test(this.nodeName)}},G=f.event.special.change.filters,G.focus=G.beforeactivate}f.support.focusinBubbles||f.each({focus:"focusin",blur:"focusout"},function(a,b){function e(a){var c=f.event.fix(a);c.type=b,c.originalEvent={},f.event.trigger(c,null,c.target),c.isDefaultPrevented()&&a.preventDefault()}var d=0;f.event.special[b]={setup:function(){d++===0&&c.addEventListener(a,e,!0)},teardown:function(){--d===0&&c.removeEventListener(a,e,!0)}}}),f.each(["bind","one"],function(a,c){f.fn[c]=function(a,d,e){var g;if(typeof a=="object"){for(var h in a)this[c](h,d,a[h],e);return this}if(arguments.length===2||d===!1)e=d,d=b;c==="one"?(g=function(a){f(this).unbind(a,g);return e.apply(this,arguments)},g.guid=e.guid||f.guid++):g=e;if(a==="unload"&&c!=="one")this.one(a,d,e);else for(var i=0,j=this.length;i<j;i++)f.event.add(this[i],a,g,d);return this}}),f.fn.extend({unbind:function(a,b){if(typeof a=="object"&&!a.preventDefault)for(var c in a)this.unbind(c,a[c]);else for(var d=0,e=this.length;d<e;d++)f.event.remove(this[d],a,b);return this},delegate:function(a,b,c,d){return this.live(b,c,d,a)},undelegate:function(a,b,c){return arguments.length===0?this.unbind("live"):this.die(b,null,c,a)},trigger:function(a,b){return this.each(function(){f.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return f.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||f.guid++,d=0,e=function(c){var e=(f.data(this,"lastToggle"+a.guid)||0)%d;f.data(this,"lastToggle"+a.guid,e+1),c.preventDefault();return b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});var K={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};f.each(["live","die"],function(a,c){f.fn[c]=function(a,d,e,g){var h,i=0,j,k,l,m=g||this.selector,n=g?this:f(this.context);if(typeof a=="object"&&!a.preventDefault){for(var o in a)n[c](o,d,a[o],m);return this}if(c==="die"&&!a&&g&&g.charAt(0)==="."){n.unbind(g);return this}if(d===!1||f.isFunction(d))e=d||C,d=b;a=(a||"").split(" ");while((h=a[i++])!=null){j=w.exec(h),k="",j&&(k=j[0],h=h.replace(w,""));if(h==="hover"){a.push("mouseenter"+k,"mouseleave"+k);continue}l=h,K[h]?(a.push(K[h]+k),h=h+k):h=(K[h]||h)+k;if(c==="live")for(var p=0,q=n.length;p<q;p++)f.event.add(n[p],"live."+M(h,m),{data:d,selector:m,handler:e,origType:h,origHandler:e,preType:l});else n.unbind("live."+M(h,m),e)}return this}}),f.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error".split(" "),function(a,b){f.fn[b]=function(a,c){c==null&&(c=a,a=null);return arguments.length>0?this.bind(b,a,c):this.trigger(b)},f.attrFn&&(f.attrFn[b]=!0)}),function(){function u(a,b,c,d,e,f){for(var g=0,h=d.length;g<h;g++){var i=d[g];if(i){var j=!1;i=i[a];while(i){if(i.sizcache===c){j=d[i.sizset];break}if(i.nodeType===1){f||(i.sizcache=c,i.sizset=g);if(typeof b!="string"){if(i===b){j=!0;break}}else if(k.filter(b,[i]).length>0){j=i;break}}i=i[a]}d[g]=j}}}function t(a,b,c,d,e,f){for(var g=0,h=d.length;g<h;g++){var i=d[g];if(i){var j=!1;i=i[a];while(i){if(i.sizcache===c){j=d[i.sizset];break}i.nodeType===1&&!f&&(i.sizcache=c,i.sizset=g);if(i.nodeName.toLowerCase()===b){j=i;break}i=i[a]}d[g]=j}}}var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,d=0,e=Object.prototype.toString,g=!1,h=!0,i=/\\/g,j=/\W/;[0,0].sort(function(){h=!1;return 0});var k=function(b,d,f,g){f=f||[],d=d||c;var h=d;if(d.nodeType!==1&&d.nodeType!==9)return[];if(!b||typeof b!="string")return f;var i,j,n,o,q,r,s,t,u=!0,w=k.isXML(d),x=[],y=b;do{a.exec(""),i=a.exec(y);if(i){y=i[3],x.push(i[1]);if(i[2]){o=i[3];break}}}while(i);if(x.length>1&&m.exec(b))if(x.length===2&&l.relative[x[0]])j=v(x[0]+x[1],d);else{j=l.relative[x[0]]?[d]:k(x.shift(),d);while(x.length)b=x.shift(),l.relative[b]&&(b+=x.shift()),j=v(b,j)}else{!g&&x.length>1&&d.nodeType===9&&!w&&l.match.ID.test(x[0])&&!l.match.ID.test(x[x.length-1])&&(q=k.find(x.shift(),d,w),d=q.expr?k.filter(q.expr,q.set)[0]:q.set[0]);if(d){q=g?{expr:x.pop(),set:p(g)}:k.find(x.pop(),x.length===1&&(x[0]==="~"||x[0]==="+")&&d.parentNode?d.parentNode:d,w),j=q.expr?k.filter(q.expr,q.set):q.set,x.length>0?n=p(j):u=!1;while(x.length)r=x.pop(),s=r,l.relative[r]?s=x.pop():r="",s==null&&(s=d),l.relative[r](n,s,w)}else n=x=[]}n||(n=j),n||k.error(r||b);if(e.call(n)==="[object Array]")if(!u)f.push.apply(f,n);else if(d&&d.nodeType===1)for(t=0;n[t]!=null;t++)n[t]&&(n[t]===!0||n[t].nodeType===1&&k.contains(d,n[t]))&&f.push(j[t]);else for(t=0;n[t]!=null;t++)n[t]&&n[t].nodeType===1&&f.push(j[t]);else p(n,f);o&&(k(o,h,f,g),k.uniqueSort(f));return f};k.uniqueSort=function(a){if(r){g=h,a.sort(r);if(g)for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1)}return a},k.matches=function(a,b){return k(a,null,null,b)},k.matchesSelector=function(a,b){return k(b,null,null,[a]).length>0},k.find=function(a,b,c){var d;if(!a)return[];for(var e=0,f=l.order.length;e<f;e++){var g,h=l.order[e];if(g=l.leftMatch[h].exec(a)){var j=g[1];g.splice(1,1);if(j.substr(j.length-1)!=="\\"){g[1]=(g[1]||"").replace(i,""),d=l.find[h](g,b,c);if(d!=null){a=a.replace(l.match[h],"");break}}}}d||(d=typeof b.getElementsByTagName!="undefined"?b.getElementsByTagName("*"):[]);return{set:d,expr:a}},k.filter=function(a,c,d,e){var f,g,h=a,i=[],j=c,m=c&&c[0]&&k.isXML(c[0]);while(a&&c.length){for(var n in l.filter)if((f=l.leftMatch[n].exec(a))!=null&&f[2]){var o,p,q=l.filter[n],r=f[1];g=!1,f.splice(1,1);if(r.substr(r.length-1)==="\\")continue;j===i&&(i=[]);if(l.preFilter[n]){f=l.preFilter[n](f,j,d,i,e,m);if(!f)g=o=!0;else if(f===!0)continue}if(f)for(var s=0;(p=j[s])!=null;s++)if(p){o=q(p,f,s,j);var t=e^!!o;d&&o!=null?t?g=!0:j[s]=!1:t&&(i.push(p),g=!0)}if(o!==b){d||(j=i),a=a.replace(l.match[n],"");if(!g)return[];break}}if(a===h)if(g==null)k.error(a);else break;h=a}return j},k.error=function(a){throw"Syntax error, unrecognized expression: "+a};var l=k.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c=typeof b=="string",d=c&&!j.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var f=0,g=a.length,h;f<g;f++)if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1);a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}e&&k.filter(b,a,!0)},">":function(a,b){var c,d=typeof b=="string",e=0,f=a.length;if(d&&!j.test(b)){b=b.toLowerCase();for(;e<f;e++){c=a[e];if(c){var g=c.parentNode;a[e]=g.nodeName.toLowerCase()===b?g:!1}}}else{for(;e<f;e++)c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b);d&&k.filter(b,a,!0)}},"":function(a,b,c){var e,f=d++,g=u;typeof b=="string"&&!j.test(b)&&(b=b.toLowerCase(),e=b,g=t),g("parentNode",b,f,a,e,c)},"~":function(a,b,c){var e,f=d++,g=u;typeof b=="string"&&!j.test(b)&&(b=b.toLowerCase(),e=b,g=t),g("previousSibling",b,f,a,e,c)}},find:{ID:function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if(typeof b.getElementsByName!="undefined"){var c=[],d=b.getElementsByName(a[1]);for(var e=0,f=d.length;e<f;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return c.length===0?null:c}},TAG:function(a,b){if(typeof b.getElementsByTagName!="undefined")return b.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(i,"")+" ";if(f)return a;for(var g=0,h;(h=b[g])!=null;g++)h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1));return!1},ID:function(a){return a[1].replace(i,"")},TAG:function(a,b){return a[1].replace(i,"").toLowerCase()},CHILD:function(a){if(a[1]==="nth"){a[2]||k.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0,a[3]=b[3]-0}else a[2]&&k.error(a[0]);a[0]=d++;return a},ATTR:function(a,b,c,d,e,f){var g=a[1]=a[1].replace(i,"");!f&&l.attrMap[g]&&(a[1]=l.attrMap[g]),a[4]=(a[4]||a[5]||"").replace(i,""),a[2]==="~="&&(a[4]=" "+a[4]+" ");return a},PSEUDO:function(b,c,d,e,f){if(b[1]==="not")if((a.exec(b[3])||"").length>1||/^\w/.test(b[3]))b[3]=k(b[3],null,null,c);else{var g=k.filter(b[3],c,d,!0^f);d||e.push.apply(e,g);return!1}else if(l.match.POS.test(b[0])||l.match.CHILD.test(b[0]))return!0;return b},POS:function(a){a.unshift(!0);return a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){a.parentNode&&a.parentNode.selectedIndex;return a.selected===!0},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!k(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return a.nodeName.toLowerCase()==="input"&&"text"===c&&(b===c||b===null)},radio:function(a){return a.nodeName.toLowerCase()==="input"&&"radio"===a.type},checkbox:function(a){return a.nodeName.toLowerCase()==="input"&&"checkbox"===a.type},file:function(a){return a.nodeName.toLowerCase()==="input"&&"file"===a.type},password:function(a){return a.nodeName.toLowerCase()==="input"&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"submit"===a.type},image:function(a){return a.nodeName.toLowerCase()==="input"&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&"button"===a.type||b==="button"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return b===0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=l.filters[e];if(f)return f(a,c,b,d);if(e==="contains")return(a.textContent||a.innerText||k.getText([a])||"").indexOf(b[3])>=0;if(e==="not"){var g=b[3];for(var h=0,i=g.length;h<i;h++)if(g[h]===a)return!1;return!0}k.error(e)},CHILD:function(a,b){var c=b[1],d=a;switch(c){case"only":case"first":while(d=d.previousSibling)if(d.nodeType===1)return!1;if(c==="first")return!0;d=a;case"last":while(d=d.nextSibling)if(d.nodeType===1)return!1;return!0;case"nth":var e=b[2],f=b[3];if(e===1&&f===0)return!0;var g=b[0],h=a.parentNode;if(h&&(h.sizcache!==g||!a.nodeIndex)){var i=0;for(d=h.firstChild;d;d=d.nextSibling)d.nodeType===1&&(d.nodeIndex=++i);h.sizcache=g}var j=a.nodeIndex-f;return e===0?j===0:j%e===0&&j/e>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=l.attrHandle[c]?l.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return d==null?f==="!=":f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=l.setFilters[e];if(f)return f(a,c,b,d)}}},m=l.match.POS,n=function(a,b){return"\\"+(b-0+1)};for(var o in l.match)l.match[o]=new RegExp(l.match[o].source+/(?![^\[]*\])(?![^\(]*\))/.source),l.leftMatch[o]=new RegExp(/(^(?:.|\r|\n)*?)/.source+l.match[o].source.replace(/\\(\d+)/g,n));var p=function(a,b){a=Array.prototype.slice.call(a,0);if(b){b.push.apply(b,a);return b}return a};try{Array.prototype.slice.call(c.documentElement.childNodes,0)[0].nodeType}catch(q){p=function(a,b){var c=0,d=b||[];if(e.call(a)==="[object Array]")Array.prototype.push.apply(d,a);else if(typeof a.length=="number")for(var f=a.length;c<f;c++)d.push(a[c]);else for(;a[c];c++)d.push(a[c]);return d}}var r,s;c.documentElement.compareDocumentPosition?r=function(a,b){if(a===b){g=!0;return 0}if(!a.compareDocumentPosition||!b.compareDocumentPosition)return a.compareDocumentPosition?-1:1;return a.compareDocumentPosition(b)&4?-1:1}:(r=function(a,b){if(a===b){g=!0;return 0}if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[],h=a.parentNode,i=b.parentNode,j=h;if(h===i)return s(a,b);if(!h)return-1;if(!i)return 1;while(j)e.unshift(j),j=j.parentNode;j=i;while(j)f.unshift(j),j=j.parentNode;c=e.length,d=f.length;for(var k=0;k<c&&k<d;k++)if(e[k]!==f[k])return s(e[k],f[k]);return k===c?s(a,f[k],-1):s(e[k],b,1)},s=function(a,b,c){if(a===b)return c;var d=a.nextSibling;while(d){if(d===b)return-1;d=d.nextSibling}return 1}),k.getText=function(a){var b="",c;for(var d=0;a[d];d++)c=a[d],c.nodeType===3||c.nodeType===4?b+=c.nodeValue:c.nodeType!==8&&(b+=k.getText(c.childNodes));return b},function(){var a=c.createElement("div"),d="script"+(new Date).getTime(),e=c.documentElement;a.innerHTML="<a name='"+d+"'/>",e.insertBefore(a,e.firstChild),c.getElementById(d)&&(l.find.ID=function(a,c,d){if(typeof c.getElementById!="undefined"&&!d){var e=c.getElementById(a[1]);return e?e.id===a[1]||typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id").nodeValue===a[1]?[e]:b:[]}},l.filter.ID=function(a,b){var c=typeof a.getAttributeNode!="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b}),e.removeChild(a),e=a=null}(),function(){var a=c.createElement("div");a.appendChild(c.createComment("")),a.getElementsByTagName("*").length>0&&(l.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){var d=[];for(var e=0;c[e];e++)c[e].nodeType===1&&d.push(c[e]);c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!="undefined"&&a.firstChild.getAttribute("href")!=="#"&&(l.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),c.querySelectorAll&&function(){var a=k,b=c.createElement("div"),d="__sizzle__";b.innerHTML="<p class='TEST'></p>";if(!b.querySelectorAll||b.querySelectorAll(".TEST").length!==0){k=function(b,e,f,g){e=e||c;if(!g&&!k.isXML(e)){var h=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(h&&(e.nodeType===1||e.nodeType===9)){if(h[1])return p(e.getElementsByTagName(b),f);if(h[2]&&l.find.CLASS&&e.getElementsByClassName)return p(e.getElementsByClassName(h[2]),f)}if(e.nodeType===9){if(b==="body"&&e.body)return p([e.body],f);if(h&&h[3]){var i=e.getElementById(h[3]);if(!i||!i.parentNode)return p([],f);if(i.id===h[3])return p([i],f)}try{return p(e.querySelectorAll(b),f)}catch(j){}}else if(e.nodeType===1&&e.nodeName.toLowerCase()!=="object"){var m=e,n=e.getAttribute("id"),o=n||d,q=e.parentNode,r=/^\s*[+~]/.test(b);n?o=o.replace(/'/g,"\\$&"):e.setAttribute("id",o),r&&q&&(e=e.parentNode);try{if(!r||q)return p(e.querySelectorAll("[id='"+o+"'] "+b),f)}catch(s){}finally{n||m.removeAttribute("id")}}}return a(b,e,f,g)};for(var e in a)k[e]=a[e];b=null}}(),function(){var a=c.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(b){var d=!b.call(c.createElement("div"),"div"),e=!1;try{b.call(c.documentElement,"[test!='']:sizzle")}catch(f){e=!0}k.matchesSelector=function(a,c){c=c.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!k.isXML(a))try{if(e||!l.match.PSEUDO.test(c)&&!/!=/.test(c)){var f=b.call(a,c);if(f||!d||a.document&&a.document.nodeType!==11)return f}}catch(g){}return k(c,null,null,[a]).length>0}}}(),function(){var a=c.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(!!a.getElementsByClassName&&a.getElementsByClassName("e").length!==0){a.lastChild.className="e";if(a.getElementsByClassName("e").length===1)return;l.order.splice(1,0,"CLASS"),l.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!="undefined"&&!c)return b.getElementsByClassName(a[1])},a=null}}(),c.documentElement.contains?k.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:c.documentElement.compareDocumentPosition?k.contains=function(a,b){return!!(a.compareDocumentPosition(b)&16)}:k.contains=function(){return!1},k.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1};var v=function(a,b){var c,d=[],e="",f=b.nodeType?[b]:b;while(c=l.match.PSEUDO.exec(a))e+=c[0],a=a.replace(l.match.PSEUDO,"");a=l.relative[a]?a+"*":a;for(var g=0,h=f.length;g<h;g++)k(a,f[g],d);return k.filter(e,d)};f.find=k,f.expr=k.selectors,f.expr[":"]=f.expr.filters,f.unique=k.uniqueSort,f.text=k.getText,f.isXMLDoc=k.isXML,f.contains=k.contains}();var N=/Until$/,O=/^(?:parents|prevUntil|prevAll)/,P=/,/,Q=/^.[^:#\[\.,]*$/,R=Array.prototype.slice,S=f.expr.match.POS,T={children:!0,contents:!0,next:!0,prev:!0};f.fn.extend({find:function(a){var b=this,c,d;if(typeof a!="string")return f(a).filter(function(){for(c=0,d=b.length;c<d;c++)if(f.contains(b[c],this))return!0});var e=this.pushStack("","find",a),g,h,i;for(c=0,d=this.length;c<d;c++){g=e.length,f.find(a,this[c],e);if(c>0)for(h=g;h<e.length;h++)for(i=0;i<g;i++)if(e[i]===e[h]){e.splice(h--,1);break}}return e},has:function(a){var b=f(a);return this.filter(function(){for(var a=0,c=b.length;a<c;a++)if(f.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(V(this,a,!1),"not",a)},filter:function(a){return this.pushStack(V(this,a,!0),"filter",a)},is:function(a){return!!a&&(typeof a=="string"?f.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c=[],d,e,g=this[0];if(f.isArray(a)){var h,i,j={},k=1;if(g&&a.length){for(d=0,e=a.length;d<e;d++)i=a[d],j[i]||(j[i]=S.test(i)?f(i,b||this.context):i);while(g&&g.ownerDocument&&g!==b){for(i in j)h=j[i],(h.jquery?h.index(g)>-1:f(g).is(h))&&c.push({selector:i,elem:g,level:k});g=g.parentNode,k++}}return c}var l=S.test(a)||typeof a!="string"?f(a,b||this.context):0;for(d=0,e=this.length;d<e;d++){g=this[d];while(g){if(l?l.index(g)>-1:f.find.matchesSelector(g,a)){c.push(g);break}g=g.parentNode;if(!g||!g.ownerDocument||g===b||g.nodeType===11)break}}c=c.length>1?f.unique(c):c;return this.pushStack(c,"closest",a)},index:function(a){if(!a)return this[0]&&this[0].parentNode?this.prevAll().length:-1;if(typeof a=="string")return f.inArray(this[0],f(a));return f.inArray(a.jquery?a[0]:a,this)},add:function(a,b){var c=typeof a=="string"?f(a,b):f.makeArray(a&&a.nodeType?[a]:a),d=f.merge(this.get(),c);return this.pushStack(U(c[0])||U(d[0])?d:f.unique(d))},andSelf:function(){return this.add(this.prevObject)}}),f.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return f.dir(a,"parentNode")},parentsUntil:function(a,b,c){return f.dir(a,"parentNode",c)},next:function(a){return f.nth(a,2,"nextSibling")},prev:function(a){return f.nth(a,2,"previousSibling")},nextAll:function(a){return f.dir(a,"nextSibling")},prevAll:function(a){return f.dir(a,"previousSibling")},nextUntil:function(a,b,c){return f.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return f.dir(a,"previousSibling",c)},siblings:function(a){return f.sibling(a.parentNode.firstChild,a)},children:function(a){return f.sibling(a.firstChild)},contents:function(a){return f.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:f.makeArray(a.childNodes)}},function(a,b){f.fn[a]=function(c,d){var e=f.map(this,b,c),g=R.call(arguments);N.test(a)||(d=c),d&&typeof d=="string"&&(e=f.filter(d,e)),e=this.length>1&&!T[a]?f.unique(e):e,(this.length>1||P.test(d))&&O.test(a)&&(e=e.reverse());return this.pushStack(e,a,g.join(","))}}),f.extend({filter:function(a,b,c){c&&(a=":not("+a+")");return b.length===1?f.find.matchesSelector(b[0],a)?[b[0]]:[]:f.find.matches(a,b)},dir:function(a,c,d){var e=[],g=a[c];while(g&&g.nodeType!==9&&(d===b||g.nodeType!==1||!f(g).is(d)))g.nodeType===1&&e.push(g),g=g[c];return e},nth:function(a,b,c,d){b=b||1;var e=0;for(;a;a=a[c])if(a.nodeType===1&&++e===b)break;return a},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling)a.nodeType===1&&a!==b&&c.push(a);return c}});var W=/ jQuery\d+="(?:\d+|null)"/g,X=/^\s+/,Y=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,Z=/<([\w:]+)/,$=/<tbody/i,_=/<|&#?\w+;/,ba=/<(?:script|object|embed|option|style)/i,bb=/checked\s*(?:[^=]|=\s*.checked.)/i,bc=/\/(java|ecma)script/i,bd=/^\s*<!(?:\[CDATA\[|\-\-)/,be={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};be.optgroup=be.option,be.tbody=be.tfoot=be.colgroup=be.caption=be.thead,be.th=be.td,f.support.htmlSerialize||(be._default=[1,"div<div>","</div>"]),f.fn.extend({text:function(a){if(f.isFunction(a))return this.each(function(b){var c=f(this);c.text(a.call(this,b,c.text()))});if(typeof a!="object"&&a!==b)return this.empty().append((this[0]&&this[0].ownerDocument||c).createTextNode(a));return f.text(this)},wrapAll:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapAll(a.call(this,b))});if(this[0]){var b=f(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapInner(a.call(this,b))});return this.each(function(){var b=f(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){return this.each(function(){f(this).wrapAll(a)})},unwrap:function(){return this.parent().each(function(){f.nodeName(this,"body")||f(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=f(arguments[0]);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,f(arguments[0]).toArray());return a}},remove:function(a,b){for(var c=0,d;(d=this[c])!=null;c++)if(!a||f.filter(a,[d]).length)!b&&d.nodeType===1&&(f.cleanData(d.getElementsByTagName("*")),f.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d);return this},empty:function(){for(var a=0,b;(b=this[a])!=null;a++){b.nodeType===1&&f.cleanData(b.getElementsByTagName("*"));while(b.firstChild)b.removeChild(b.firstChild)}return this},clone:function(a,b){a=a==null?!1:a,b=b==null?a:b;return this.map(function(){return f.clone(this,a,b)})},html:function(a){if(a===b)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(W,""):null;if(typeof a=="string"&&!ba.test(a)&&(f.support.leadingWhitespace||!X.test(a))&&!be[(Z.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Y,"<$1></$2>");try{for(var c=0,d=this.length;c<d;c++)this[c].nodeType===1&&(f.cleanData(this[c].getElementsByTagName("*")),this[c].innerHTML=a)}catch(e){this.empty().append(a)}}else f.isFunction(a)?this.each(function(b){var c=f(this);c.html(a.call(this,b,c.html()))}):this.empty().append(a);return this},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(f.isFunction(a))return this.each(function(b){var c=f(this),d=c.html();c.replaceWith(a.call(this,b,d))});typeof a!="string"&&(a=f(a).detach());return this.each(function(){var b=this.nextSibling,c=this.parentNode;f(this).remove(),b?f(b).before(a):f(c).append(a)})}return this.length?this.pushStack(f(f.isFunction(a)?a():a),"replaceWith",a):this},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){var e,g,h,i,j=a[0],k=[];if(!f.support.checkClone&&arguments.length===3&&typeof j=="string"&&bb.test(j))return this.each(function(){f(this).domManip(a,c,d,!0)});if(f.isFunction(j))return this.each(function(e){var g=f(this);a[0]=j.call(this,e,c?g.html():b),g.domManip(a,c,d)});if(this[0]){i=j&&j.parentNode,f.support.parentNode&&i&&i.nodeType===11&&i.childNodes.length===this.length?e={fragment:i}:e=f.buildFragment(a,this,k),h=e.fragment,h.childNodes.length===1?g=h=h.firstChild:g=h.firstChild;if(g){c=c&&f.nodeName(g,"tr");for(var l=0,m=this.length,n=m-1;l<m;l++)d.call(c?bf(this[l],g):this[l],e.cacheable||m>1&&l<n?f.clone(h,!0,!0):h)}k.length&&f.each(k,bl)}return this}}),f.buildFragment=function(a,b,d){var e,g,h,i;b&&b[0]&&(i=b[0].ownerDocument||b[0]),i.createDocumentFragment||(i=c),a.length===1&&typeof a[0]=="string"&&a[0].length<512&&i===c&&a[0].charAt(0)==="<"&&!ba.test(a[0])&&(f.support.checkClone||!bb.test(a[0]))&&(g=!0,h=f.fragments[a[0]],h&&h!==1&&(e=h)),e||(e=i.createDocumentFragment(),f.clean
(a,i,e,d)),g&&(f.fragments[a[0]]=h?e:1);return{fragment:e,cacheable:g}},f.fragments={},f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){f.fn[a]=function(c){var d=[],e=f(c),g=this.length===1&&this[0].parentNode;if(g&&g.nodeType===11&&g.childNodes.length===1&&e.length===1){e[b](this[0]);return this}for(var h=0,i=e.length;h<i;h++){var j=(h>0?this.clone(!0):this).get();f(e[h])[b](j),d=d.concat(j)}return this.pushStack(d,a,e.selector)}}),f.extend({clone:function(a,b,c){var d=a.cloneNode(!0),e,g,h;if((!f.support.noCloneEvent||!f.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!f.isXMLDoc(a)){bh(a,d),e=bi(a),g=bi(d);for(h=0;e[h];++h)g[h]&&bh(e[h],g[h])}if(b){bg(a,d);if(c){e=bi(a),g=bi(d);for(h=0;e[h];++h)bg(e[h],g[h])}}e=g=null;return d},clean:function(a,b,d,e){var g;b=b||c,typeof b.createElement=="undefined"&&(b=b.ownerDocument||b[0]&&b[0].ownerDocument||c);var h=[],i;for(var j=0,k;(k=a[j])!=null;j++){typeof k=="number"&&(k+="");if(!k)continue;if(typeof k=="string")if(!_.test(k))k=b.createTextNode(k);else{k=k.replace(Y,"<$1></$2>");var l=(Z.exec(k)||["",""])[1].toLowerCase(),m=be[l]||be._default,n=m[0],o=b.createElement("div");o.innerHTML=m[1]+k+m[2];while(n--)o=o.lastChild;if(!f.support.tbody){var p=$.test(k),q=l==="table"&&!p?o.firstChild&&o.firstChild.childNodes:m[1]==="<table>"&&!p?o.childNodes:[];for(i=q.length-1;i>=0;--i)f.nodeName(q[i],"tbody")&&!q[i].childNodes.length&&q[i].parentNode.removeChild(q[i])}!f.support.leadingWhitespace&&X.test(k)&&o.insertBefore(b.createTextNode(X.exec(k)[0]),o.firstChild),k=o.childNodes}var r;if(!f.support.appendChecked)if(k[0]&&typeof (r=k.length)=="number")for(i=0;i<r;i++)bk(k[i]);else bk(k);k.nodeType?h.push(k):h=f.merge(h,k)}if(d){g=function(a){return!a.type||bc.test(a.type)};for(j=0;h[j];j++)if(e&&f.nodeName(h[j],"script")&&(!h[j].type||h[j].type.toLowerCase()==="text/javascript"))e.push(h[j].parentNode?h[j].parentNode.removeChild(h[j]):h[j]);else{if(h[j].nodeType===1){var s=f.grep(h[j].getElementsByTagName("script"),g);h.splice.apply(h,[j+1,0].concat(s))}d.appendChild(h[j])}}return h},cleanData:function(a){var b,c,d=f.cache,e=f.expando,g=f.event.special,h=f.support.deleteExpando;for(var i=0,j;(j=a[i])!=null;i++){if(j.nodeName&&f.noData[j.nodeName.toLowerCase()])continue;c=j[f.expando];if(c){b=d[c]&&d[c][e];if(b&&b.events){for(var k in b.events)g[k]?f.event.remove(j,k):f.removeEvent(j,k,b.handle);b.handle&&(b.handle.elem=null)}h?delete j[f.expando]:j.removeAttribute&&j.removeAttribute(f.expando),delete d[c]}}}});var bm=/alpha\([^)]*\)/i,bn=/opacity=([^)]*)/,bo=/([A-Z]|^ms)/g,bp=/^-?\d+(?:px)?$/i,bq=/^-?\d/,br=/^([\-+])=([\-+.\de]+)/,bs={position:"absolute",visibility:"hidden",display:"block"},bt=["Left","Right"],bu=["Top","Bottom"],bv,bw,bx;f.fn.css=function(a,c){if(arguments.length===2&&c===b)return this;return f.access(this,a,c,!0,function(a,c,d){return d!==b?f.style(a,c,d):f.css(a,c)})},f.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=bv(a,"opacity","opacity");return c===""?"1":c}return a.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":f.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!!a&&a.nodeType!==3&&a.nodeType!==8&&!!a.style){var g,h,i=f.camelCase(c),j=a.style,k=f.cssHooks[i];c=f.cssProps[i]||i;if(d===b){if(k&&"get"in k&&(g=k.get(a,!1,e))!==b)return g;return j[c]}h=typeof d,h==="string"&&(g=br.exec(d))&&(d=+(g[1]+1)*+g[2]+parseFloat(f.css(a,c)),h="number");if(d==null||h==="number"&&isNaN(d))return;h==="number"&&!f.cssNumber[i]&&(d+="px");if(!k||!("set"in k)||(d=k.set(a,d))!==b)try{j[c]=d}catch(l){}}},css:function(a,c,d){var e,g;c=f.camelCase(c),g=f.cssHooks[c],c=f.cssProps[c]||c,c==="cssFloat"&&(c="float");if(g&&"get"in g&&(e=g.get(a,!0,d))!==b)return e;if(bv)return bv(a,c)},swap:function(a,b,c){var d={};for(var e in b)d[e]=a.style[e],a.style[e]=b[e];c.call(a);for(e in b)a.style[e]=d[e]}}),f.curCSS=f.css,f.each(["height","width"],function(a,b){f.cssHooks[b]={get:function(a,c,d){var e;if(c){if(a.offsetWidth!==0)return by(a,b,d);f.swap(a,bs,function(){e=by(a,b,d)});return e}},set:function(a,b){if(!bp.test(b))return b;b=parseFloat(b);if(b>=0)return b+"px"}}}),f.support.opacity||(f.cssHooks.opacity={get:function(a,b){return bn.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=f.isNaN(b)?"":"alpha(opacity="+b*100+")",g=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&f.trim(g.replace(bm,""))===""){c.removeAttribute("filter");if(d&&!d.filter)return}c.filter=bm.test(g)?g.replace(bm,e):g+" "+e}}),f(function(){f.support.reliableMarginRight||(f.cssHooks.marginRight={get:function(a,b){var c;f.swap(a,{display:"inline-block"},function(){b?c=bv(a,"margin-right","marginRight"):c=a.style.marginRight});return c}})}),c.defaultView&&c.defaultView.getComputedStyle&&(bw=function(a,c){var d,e,g;c=c.replace(bo,"-$1").toLowerCase();if(!(e=a.ownerDocument.defaultView))return b;if(g=e.getComputedStyle(a,null))d=g.getPropertyValue(c),d===""&&!f.contains(a.ownerDocument.documentElement,a)&&(d=f.style(a,c));return d}),c.documentElement.currentStyle&&(bx=function(a,b){var c,d=a.currentStyle&&a.currentStyle[b],e=a.runtimeStyle&&a.runtimeStyle[b],f=a.style;!bp.test(d)&&bq.test(d)&&(c=f.left,e&&(a.runtimeStyle.left=a.currentStyle.left),f.left=b==="fontSize"?"1em":d||0,d=f.pixelLeft+"px",f.left=c,e&&(a.runtimeStyle.left=e));return d===""?"auto":d}),bv=bw||bx,f.expr&&f.expr.filters&&(f.expr.filters.hidden=function(a){var b=a.offsetWidth,c=a.offsetHeight;return b===0&&c===0||!f.support.reliableHiddenOffsets&&(a.style.display||f.css(a,"display"))==="none"},f.expr.filters.visible=function(a){return!f.expr.filters.hidden(a)});var bz=/%20/g,bA=/\[\]$/,bB=/\r?\n/g,bC=/#.*$/,bD=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,bE=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,bF=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,bG=/^(?:GET|HEAD)$/,bH=/^\/\//,bI=/\?/,bJ=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bK=/^(?:select|textarea)/i,bL=/\s+/,bM=/([?&])_=[^&]*/,bN=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,bO=f.fn.load,bP={},bQ={},bR,bS,bT=["*/"]+["*"];try{bR=e.href}catch(bU){bR=c.createElement("a"),bR.href="",bR=bR.href}bS=bN.exec(bR.toLowerCase())||[],f.fn.extend({load:function(a,c,d){if(typeof a!="string"&&bO)return bO.apply(this,arguments);if(!this.length)return this;var e=a.indexOf(" ");if(e>=0){var g=a.slice(e,a.length);a=a.slice(0,e)}var h="GET";c&&(f.isFunction(c)?(d=c,c=b):typeof c=="object"&&(c=f.param(c,f.ajaxSettings.traditional),h="POST"));var i=this;f.ajax({url:a,type:h,dataType:"html",data:c,complete:function(a,b,c){c=a.responseText,a.isResolved()&&(a.done(function(a){c=a}),i.html(g?f("<div>").append(c.replace(bJ,"")).find(g):c)),d&&i.each(d,[c,b,a])}});return this},serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?f.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||bK.test(this.nodeName)||bE.test(this.type))}).map(function(a,b){var c=f(this).val();return c==null?null:f.isArray(c)?f.map(c,function(a,c){return{name:b.name,value:a.replace(bB,"\r\n")}}):{name:b.name,value:c.replace(bB,"\r\n")}}).get()}}),f.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){f.fn[b]=function(a){return this.bind(b,a)}}),f.each(["get","post"],function(a,c){f[c]=function(a,d,e,g){f.isFunction(d)&&(g=g||e,e=d,d=b);return f.ajax({type:c,url:a,data:d,success:e,dataType:g})}}),f.extend({getScript:function(a,c){return f.get(a,b,c,"script")},getJSON:function(a,b,c){return f.get(a,b,c,"json")},ajaxSetup:function(a,b){b?bX(a,f.ajaxSettings):(b=a,a=f.ajaxSettings),bX(a,b);return a},ajaxSettings:{url:bR,isLocal:bF.test(bS[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":bT},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":f.parseJSON,"text xml":f.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:bV(bP),ajaxTransport:bV(bQ),ajax:function(a,c){function w(a,c,l,m){if(s!==2){s=2,q&&clearTimeout(q),p=b,n=m||"",v.readyState=a>0?4:0;var o,r,u,w=c,x=l?bZ(d,v,l):b,y,z;if(a>=200&&a<300||a===304){if(d.ifModified){if(y=v.getResponseHeader("Last-Modified"))f.lastModified[k]=y;if(z=v.getResponseHeader("Etag"))f.etag[k]=z}if(a===304)w="notmodified",o=!0;else try{r=b$(d,x),w="success",o=!0}catch(A){w="parsererror",u=A}}else{u=w;if(!w||a)w="error",a<0&&(a=0)}v.status=a,v.statusText=""+(c||w),o?h.resolveWith(e,[r,w,v]):h.rejectWith(e,[v,w,u]),v.statusCode(j),j=b,t&&g.trigger("ajax"+(o?"Success":"Error"),[v,d,o?r:u]),i.resolveWith(e,[v,w]),t&&(g.trigger("ajaxComplete",[v,d]),--f.active||f.event.trigger("ajaxStop"))}}typeof a=="object"&&(c=a,a=b),c=c||{};var d=f.ajaxSetup({},c),e=d.context||d,g=e!==d&&(e.nodeType||e instanceof f)?f(e):f.event,h=f.Deferred(),i=f._Deferred(),j=d.statusCode||{},k,l={},m={},n,o,p,q,r,s=0,t,u,v={readyState:0,setRequestHeader:function(a,b){if(!s){var c=a.toLowerCase();a=m[c]=m[c]||a,l[a]=b}return this},getAllResponseHeaders:function(){return s===2?n:null},getResponseHeader:function(a){var c;if(s===2){if(!o){o={};while(c=bD.exec(n))o[c[1].toLowerCase()]=c[2]}c=o[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){s||(d.mimeType=a);return this},abort:function(a){a=a||"abort",p&&p.abort(a),w(0,a);return this}};h.promise(v),v.success=v.done,v.error=v.fail,v.complete=i.done,v.statusCode=function(a){if(a){var b;if(s<2)for(b in a)j[b]=[j[b],a[b]];else b=a[v.status],v.then(b,b)}return this},d.url=((a||d.url)+"").replace(bC,"").replace(bH,bS[1]+"//"),d.dataTypes=f.trim(d.dataType||"*").toLowerCase().split(bL),d.crossDomain==null&&(r=bN.exec(d.url.toLowerCase()),d.crossDomain=!(!r||r[1]==bS[1]&&r[2]==bS[2]&&(r[3]||(r[1]==="http:"?80:443))==(bS[3]||(bS[1]==="http:"?80:443)))),d.data&&d.processData&&typeof d.data!="string"&&(d.data=f.param(d.data,d.traditional)),bW(bP,d,c,v);if(s===2)return!1;t=d.global,d.type=d.type.toUpperCase(),d.hasContent=!bG.test(d.type),t&&f.active++===0&&f.event.trigger("ajaxStart");if(!d.hasContent){d.data&&(d.url+=(bI.test(d.url)?"&":"?")+d.data,delete d.data),k=d.url;if(d.cache===!1){var x=f.now(),y=d.url.replace(bM,"$1_="+x);d.url=y+(y===d.url?(bI.test(d.url)?"&":"?")+"_="+x:"")}}(d.data&&d.hasContent&&d.contentType!==!1||c.contentType)&&v.setRequestHeader("Content-Type",d.contentType),d.ifModified&&(k=k||d.url,f.lastModified[k]&&v.setRequestHeader("If-Modified-Since",f.lastModified[k]),f.etag[k]&&v.setRequestHeader("If-None-Match",f.etag[k])),v.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+(d.dataTypes[0]!=="*"?", "+bT+"; q=0.01":""):d.accepts["*"]);for(u in d.headers)v.setRequestHeader(u,d.headers[u]);if(d.beforeSend&&(d.beforeSend.call(e,v,d)===!1||s===2)){v.abort();return!1}for(u in{success:1,error:1,complete:1})v[u](d[u]);p=bW(bQ,d,c,v);if(!p)w(-1,"No Transport");else{v.readyState=1,t&&g.trigger("ajaxSend",[v,d]),d.async&&d.timeout>0&&(q=setTimeout(function(){v.abort("timeout")},d.timeout));try{s=1,p.send(l,w)}catch(z){s<2?w(-1,z):f.error(z)}}return v},param:function(a,c){var d=[],e=function(a,b){b=f.isFunction(b)?b():b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=f.ajaxSettings.traditional);if(f.isArray(a)||a.jquery&&!f.isPlainObject(a))f.each(a,function(){e(this.name,this.value)});else for(var g in a)bY(g,a[g],c,e);return d.join("&").replace(bz,"+")}}),f.extend({active:0,lastModified:{},etag:{}});var b_=f.now(),ca=/(\=)\?(&|$)|\?\?/i;f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return f.expando+"_"+b_++}}),f.ajaxPrefilter("json jsonp",function(b,c,d){var e=b.contentType==="application/x-www-form-urlencoded"&&typeof b.data=="string";if(b.dataTypes[0]==="jsonp"||b.jsonp!==!1&&(ca.test(b.url)||e&&ca.test(b.data))){var g,h=b.jsonpCallback=f.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,i=a[h],j=b.url,k=b.data,l="$1"+h+"$2";b.jsonp!==!1&&(j=j.replace(ca,l),b.url===j&&(e&&(k=k.replace(ca,l)),b.data===k&&(j+=(/\?/.test(j)?"&":"?")+b.jsonp+"="+h))),b.url=j,b.data=k,a[h]=function(a){g=[a]},d.always(function(){a[h]=i,g&&f.isFunction(i)&&a[h](g[0])}),b.converters["script json"]=function(){g||f.error(h+" was not called");return g[0]},b.dataTypes[0]="json";return"script"}}),f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){f.globalEval(a);return a}}}),f.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),f.ajaxTransport("script",function(a){if(a.crossDomain){var d,e=c.head||c.getElementsByTagName("head")[0]||c.documentElement;return{send:function(f,g){d=c.createElement("script"),d.async="async",a.scriptCharset&&(d.charset=a.scriptCharset),d.src=a.url,d.onload=d.onreadystatechange=function(a,c){if(c||!d.readyState||/loaded|complete/.test(d.readyState))d.onload=d.onreadystatechange=null,e&&d.parentNode&&e.removeChild(d),d=b,c||g(200,"success")},e.insertBefore(d,e.firstChild)},abort:function(){d&&d.onload(0,1)}}}});var cb=a.ActiveXObject?function(){for(var a in cd)cd[a](0,1)}:!1,cc=0,cd;f.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&ce()||cf()}:ce,function(a){f.extend(f.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})}(f.ajaxSettings.xhr()),f.support.ajax&&f.ajaxTransport(function(c){if(!c.crossDomain||f.support.cors){var d;return{send:function(e,g){var h=c.xhr(),i,j;c.username?h.open(c.type,c.url,c.async,c.username,c.password):h.open(c.type,c.url,c.async);if(c.xhrFields)for(j in c.xhrFields)h[j]=c.xhrFields[j];c.mimeType&&h.overrideMimeType&&h.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(j in e)h.setRequestHeader(j,e[j])}catch(k){}h.send(c.hasContent&&c.data||null),d=function(a,e){var j,k,l,m,n;try{if(d&&(e||h.readyState===4)){d=b,i&&(h.onreadystatechange=f.noop,cb&&delete cd[i]);if(e)h.readyState!==4&&h.abort();else{j=h.status,l=h.getAllResponseHeaders(),m={},n=h.responseXML,n&&n.documentElement&&(m.xml=n),m.text=h.responseText;try{k=h.statusText}catch(o){k=""}!j&&c.isLocal&&!c.crossDomain?j=m.text?200:404:j===1223&&(j=204)}}}catch(p){e||g(-1,p)}m&&g(j,k,m,l)},!c.async||h.readyState===4?d():(i=++cc,cb&&(cd||(cd={},f(a).unload(cb)),cd[i]=d),h.onreadystatechange=d)},abort:function(){d&&d(0,1)}}}});var cg={},ch,ci,cj=/^(?:toggle|show|hide)$/,ck=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,cl,cm=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],cn;f.fn.extend({show:function(a,b,c){var d,e;if(a||a===0)return this.animate(cq("show",3),a,b,c);for(var g=0,h=this.length;g<h;g++)d=this[g],d.style&&(e=d.style.display,!f._data(d,"olddisplay")&&e==="none"&&(e=d.style.display=""),e===""&&f.css(d,"display")==="none"&&f._data(d,"olddisplay",cr(d.nodeName)));for(g=0;g<h;g++){d=this[g];if(d.style){e=d.style.display;if(e===""||e==="none")d.style.display=f._data(d,"olddisplay")||""}}return this},hide:function(a,b,c){if(a||a===0)return this.animate(cq("hide",3),a,b,c);for(var d=0,e=this.length;d<e;d++)if(this[d].style){var g=f.css(this[d],"display");g!=="none"&&!f._data(this[d],"olddisplay")&&f._data(this[d],"olddisplay",g)}for(d=0;d<e;d++)this[d].style&&(this[d].style.display="none");return this},_toggle:f.fn.toggle,toggle:function(a,b,c){var d=typeof a=="boolean";f.isFunction(a)&&f.isFunction(b)?this._toggle.apply(this,arguments):a==null||d?this.each(function(){var b=d?a:f(this).is(":hidden");f(this)[b?"show":"hide"]()}):this.animate(cq("toggle",3),a,b,c);return this},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=f.speed(b,c,d);if(f.isEmptyObject(a))return this.each(e.complete,[!1]);a=f.extend({},a);return this[e.queue===!1?"each":"queue"](function(){e.queue===!1&&f._mark(this);var b=f.extend({},e),c=this.nodeType===1,d=c&&f(this).is(":hidden"),g,h,i,j,k,l,m,n,o;b.animatedProperties={};for(i in a){g=f.camelCase(i),i!==g&&(a[g]=a[i],delete a[i]),h=a[g],f.isArray(h)?(b.animatedProperties[g]=h[1],h=a[g]=h[0]):b.animatedProperties[g]=b.specialEasing&&b.specialEasing[g]||b.easing||"swing";if(h==="hide"&&d||h==="show"&&!d)return b.complete.call(this);c&&(g==="height"||g==="width")&&(b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],f.css(this,"display")==="inline"&&f.css(this,"float")==="none"&&(f.support.inlineBlockNeedsLayout?(j=cr(this.nodeName),j==="inline"?this.style.display="inline-block":(this.style.display="inline",this.style.zoom=1)):this.style.display="inline-block"))}b.overflow!=null&&(this.style.overflow="hidden");for(i in a)k=new f.fx(this,b,i),h=a[i],cj.test(h)?k[h==="toggle"?d?"show":"hide":h]():(l=ck.exec(h),m=k.cur(),l?(n=parseFloat(l[2]),o=l[3]||(f.cssNumber[i]?"":"px"),o!=="px"&&(f.style(this,i,(n||1)+o),m=(n||1)/k.cur()*m,f.style(this,i,m+o)),l[1]&&(n=(l[1]==="-="?-1:1)*n+m),k.custom(m,n,o)):k.custom(m,h,""));return!0})},stop:function(a,b){a&&this.queue([]),this.each(function(){var a=f.timers,c=a.length;b||f._unmark(!0,this);while(c--)a[c].elem===this&&(b&&a[c](!0),a.splice(c,1))}),b||this.dequeue();return this}}),f.each({slideDown:cq("show",1),slideUp:cq("hide",1),slideToggle:cq("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){f.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),f.extend({speed:function(a,b,c){var d=a&&typeof a=="object"?f.extend({},a):{complete:c||!c&&b||f.isFunction(a)&&a,duration:a,easing:c&&b||b&&!f.isFunction(b)&&b};d.duration=f.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in f.fx.speeds?f.fx.speeds[d.duration]:f.fx.speeds._default,d.old=d.complete,d.complete=function(a){f.isFunction(d.old)&&d.old.call(this),d.queue!==!1?f.dequeue(this):a!==!1&&f._unmark(this)};return d},easing:{linear:function(a,b,c,d){return c+d*a},swing:function(a,b,c,d){return(-Math.cos(a*Math.PI)/2+.5)*d+c}},timers:[],fx:function(a,b,c){this.options=b,this.elem=a,this.prop=c,b.orig=b.orig||{}}}),f.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(f.fx.step[this.prop]||f.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null))return this.elem[this.prop];var a,b=f.css(this.elem,this.prop);return isNaN(a=parseFloat(b))?!b||b==="auto"?0:b:a},custom:function(a,b,c){function g(a){return d.step(a)}var d=this,e=f.fx;this.startTime=cn||co(),this.start=a,this.end=b,this.unit=c||this.unit||(f.cssNumber[this.prop]?"":"px"),this.now=this.start,this.pos=this.state=0,g.elem=this.elem,g()&&f.timers.push(g)&&!cl&&(cl=setInterval(e.tick,e.interval))},show:function(){this.options.orig[this.prop]=f.style(this.elem,this.prop),this.options.show=!0,this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),f(this.elem).show()},hide:function(){this.options.orig[this.prop]=f.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(a){var b=cn||co(),c=!0,d=this.elem,e=this.options,g,h;if(a||b>=e.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),e.animatedProperties[this.prop]=!0;for(g in e.animatedProperties)e.animatedProperties[g]!==!0&&(c=!1);if(c){e.overflow!=null&&!f.support.shrinkWrapBlocks&&f.each(["","X","Y"],function(a,b){d.style["overflow"+b]=e.overflow[a]}),e.hide&&f(d).hide();if(e.hide||e.show)for(var i in e.animatedProperties)f.style(d,i,e.orig[i]);e.complete.call(d)}return!1}e.duration==Infinity?this.now=b:(h=b-this.startTime,this.state=h/e.duration,this.pos=f.easing[e.animatedProperties[this.prop]](this.state,h,0,1,e.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update();return!0}},f.extend(f.fx,{tick:function(){for(var a=f.timers,b=0;b<a.length;++b)a[b]()||a.splice(b--,1);a.length||f.fx.stop()},interval:13,stop:function(){clearInterval(cl),cl=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){f.style(a.elem,"opacity",a.now)},_default:function(a){a.elem.style&&a.elem.style[a.prop]!=null?a.elem.style[a.prop]=(a.prop==="width"||a.prop==="height"?Math.max(0,a.now):a.now)+a.unit:a.elem[a.prop]=a.now}}}),f.expr&&f.expr.filters&&(f.expr.filters.animated=function(a){return f.grep(f.timers,function(b){return a===b.elem}).length});var cs=/^t(?:able|d|h)$/i,ct=/^(?:body|html)$/i;"getBoundingClientRect"in c.documentElement?f.fn.offset=function(a){var b=this[0],c;if(a)return this.each(function(b){f.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return f.offset.bodyOffset(b);try{c=b.getBoundingClientRect()}catch(d){}var e=b.ownerDocument,g=e.documentElement;if(!c||!f.contains(g,b))return c?{top:c.top,left:c.left}:{top:0,left:0};var h=e.body,i=cu(e),j=g.clientTop||h.clientTop||0,k=g.clientLeft||h.clientLeft||0,l=i.pageYOffset||f.support.boxModel&&g.scrollTop||h.scrollTop,m=i.pageXOffset||f.support.boxModel&&g.scrollLeft||h.scrollLeft,n=c.top+l-j,o=c.left+m-k;return{top:n,left:o}}:f.fn.offset=function(a){var b=this[0];if(a)return this.each(function(b){f.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return f.offset.bodyOffset(b);f.offset.initialize();var c,d=b.offsetParent,e=b,g=b.ownerDocument,h=g.documentElement,i=g.body,j=g.defaultView,k=j?j.getComputedStyle(b,null):b.currentStyle,l=b.offsetTop,m=b.offsetLeft;while((b=b.parentNode)&&b!==i&&b!==h){if(f.offset.supportsFixedPosition&&k.position==="fixed")break;c=j?j.getComputedStyle(b,null):b.currentStyle,l-=b.scrollTop,m-=b.scrollLeft,b===d&&(l+=b.offsetTop,m+=b.offsetLeft,f.offset.doesNotAddBorder&&(!f.offset.doesAddBorderForTableAndCells||!cs.test(b.nodeName))&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),e=d,d=b.offsetParent),f.offset.subtractsBorderForOverflowNotVisible&&c.overflow!=="visible"&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),k=c}if(k.position==="relative"||k.position==="static")l+=i.offsetTop,m+=i.offsetLeft;f.offset.supportsFixedPosition&&k.position==="fixed"&&(l+=Math.max(h.scrollTop,i.scrollTop),m+=Math.max(h.scrollLeft,i.scrollLeft));return{top:l,left:m}},f.offset={initialize:function(){var a=c.body,b=c.createElement("div"),d,e,g,h,i=parseFloat(f.css(a,"marginTop"))||0,j="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>";f.extend(b.style,{position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"}),b.innerHTML=j,a.insertBefore(b,a.firstChild),d=b.firstChild,e=d.firstChild,h=d.nextSibling.firstChild.firstChild,this.doesNotAddBorder=e.offsetTop!==5,this.doesAddBorderForTableAndCells=h.offsetTop===5,e.style.position="fixed",e.style.top="20px",this.supportsFixedPosition=e.offsetTop===20||e.offsetTop===15,e.style.position=e.style.top="",d.style.overflow="hidden",d.style.position="relative",this.subtractsBorderForOverflowNotVisible=e.offsetTop===-5,this.doesNotIncludeMarginInBodyOffset=a.offsetTop!==i,a.removeChild(b),f.offset.initialize=f.noop},bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;f.offset.initialize(),f.offset.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(f.css(a,"marginTop"))||0,c+=parseFloat(f.css(a,"marginLeft"))||0);return{top:b,left:c}},setOffset:function(a,b,c){var d=f.css(a,"position");d==="static"&&(a.style.position="relative");var e=f(a),g=e.offset(),h=f.css(a,"top"),i=f.css(a,"left"),j=(d==="absolute"||d==="fixed")&&f.inArray("auto",[h,i])>-1,k={},l={},m,n;j?(l=e.position(),m=l.top,n=l.left):(m=parseFloat(h)||0,n=parseFloat(i)||0),f.isFunction(b)&&(b=b.call(a,c,g)),b.top!=null&&(k.top=b.top-g.top+m),b.left!=null&&(k.left=b.left-g.left+n),"using"in b?b.using.call(a,k):e.css(k)}},f.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),c=this.offset(),d=ct.test(b[0].nodeName)?{top:0,left:0}:b.offset();c.top-=parseFloat(f.css(a,"marginTop"))||0,c.left-=parseFloat(f.css(a,"marginLeft"))||0,d.top+=parseFloat(f.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(f.css(b[0],"borderLeftWidth"))||0;return{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||c.body;while(a&&!ct.test(a.nodeName)&&f.css(a,"position")==="static")a=a.offsetParent;return a})}}),f.each(["Left","Top"],function(a,c){var d="scroll"+c;f.fn[d]=function(c){var e,g;if(c===b){e=this[0];if(!e)return null;g=cu(e);return g?"pageXOffset"in g?g[a?"pageYOffset":"pageXOffset"]:f.support.boxModel&&g.document.documentElement[d]||g.document.body[d]:e[d]}return this.each(function(){g=cu(this),g?g.scrollTo(a?f(g).scrollLeft():c,a?c:f(g).scrollTop()):this[d]=c})}}),f.each(["Height","Width"],function(a,c){var d=c.toLowerCase();f.fn["inner"+c]=function(){var a=this[0];return a&&a.style?parseFloat(f.css(a,d,"padding")):null},f.fn["outer"+c]=function(a){var b=this[0];return b&&b.style?parseFloat(f.css(b,d,a?"margin":"border")):null},f.fn[d]=function(a){var e=this[0];if(!e)return a==null?null:this;if(f.isFunction(a))return this.each(function(b){var c=f(this);c[d](a.call(this,b,c[d]()))});if(f.isWindow(e)){var g=e.document.documentElement["client"+c],h=e.document.body;return e.document.compatMode==="CSS1Compat"&&g||h&&h["client"+c]||g}if(e.nodeType===9)return Math.max(e.documentElement["client"+c],e.body["scroll"+c],e.documentElement["scroll"+c],e.body["offset"+c],e.documentElement["offset"+c]);if(a===b){var i=f.css(e,d),j=parseFloat(i);return f.isNaN(j)?i:j}return this.css(d,typeof a=="string"?a:a+"px")}}),a.jQuery=a.$=f})(window);
//]]>
</script>
<script id="jqueryArea" type="text/javascript">
//<![CDATA[
/*
jQuery.encoding.digests.sha1.js

SHA-1 digest and associated utility functions

Copyright (c) UnaMesa Association 2009

Dual licensed under the MIT and GPL licenses:
  http://www.opensource.org/licenses/mit-license.php
  http://www.gnu.org/licenses/gpl.html
*/

(function($) {

if(!$.encoding)
	$.encoding = {};
	$.extend($.encoding,{
		strToBe32s: function(str) {
			// Convert a string to an array of big-endian 32-bit words
			var be=[];
			var len=Math.floor(str.length/4);
			var i, j;
			for(i=0, j=0; i<len; i++, j+=4) {
				be[i]=((str.charCodeAt(j)&0xff) << 24)|((str.charCodeAt(j+1)&0xff) << 16)|((str.charCodeAt(j+2)&0xff) << 8)|(str.charCodeAt(j+3)&0xff);
			}
			while(j<str.length) {
				be[j>>2] |= (str.charCodeAt(j)&0xff)<<(24-(j*8)%32);
				j++;
			}
			return be;
		},
		be32sToStr: function(be) {
			// Convert an array of big-endian 32-bit words to a string
			var str='';
			for(var i=0;i<be.length*32;i+=8) {
				str += String.fromCharCode((be[i>>5]>>>(24-i%32)) & 0xff);
			}
			return str;
		},
		be32sToHex: function(be) {
			// Convert an array of big-endian 32-bit words to a hex string
			var hex='0123456789ABCDEF';
			var str='';
			for(var i=0;i<be.length*4;i++) {
				str += hex.charAt((be[i>>2]>>((3-i%4)*8+4))&0xF) + hex.charAt((be[i>>2]>>((3-i%4)*8))&0xF);
			}
			return str;
		}
	});
})(jQuery);


(function($) {

if(!$.encoding.digests)
	$.encoding.digests = {};
	$.extend($.encoding.digests,{
		hexSha1Str: function(str) {
			// Return, in hex, the SHA-1 hash of a string
			return $.encoding.be32sToHex($.encoding.digests.sha1Str(str));
		},
		sha1Str: function(str) {
			// Return the SHA-1 hash of a string
			return sha1($.encoding.strToBe32s(str),str.length);
		},
		sha1: function(x,blen) {
			// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
			return sha1($.encoding.strToBe32s(str),str.length);
		}
	});

	// Private functions.
	function sha1(x,blen) {
		// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
		function add32(a,b) {
			// Add 32-bit integers, wrapping at 32 bits
			// Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
			var lsw=(a&0xFFFF)+(b&0xFFFF);
			var msw=(a>>16)+(b>>16)+(lsw>>16);
			return (msw<<16)|(lsw&0xFFFF);
		}
		function AA(a,b,c,d,e) {
			// Cryptographic round helper function. Add five 32-bit integers, wrapping at 32 bits, second parameter is rotated left 5 bits before the addition
			// Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
			b=(b>>>27)|(b<<5);
			var lsw=(a&0xFFFF)+(b&0xFFFF)+(c&0xFFFF)+(d&0xFFFF)+(e&0xFFFF);
			var msw=(a>>16)+(b>>16)+(c>>16)+(d>>16)+(e>>16)+(lsw>>16);
			return (msw<<16)|(lsw&0xFFFF);
		}
		function RR(w,j) {
			// Cryptographic round helper function.
			var n=w[j-3]^w[j-8]^w[j-14]^w[j-16];
			return (n>>>31)|(n<<1);
		}

		var len=blen*8;
		x[len>>5] |= 0x80 << (24-len%32);
		x[((len+64>>9)<<4)+15]=len;
		var w=new Array(80);

		var k1=0x5A827999;
		var k2=0x6ED9EBA1;
		var k3=0x8F1BBCDC;
		var k4=0xCA62C1D6;

		var h0=0x67452301;
		var h1=0xEFCDAB89;
		var h2=0x98BADCFE;
		var h3=0x10325476;
		var h4=0xC3D2E1F0;

		for(var i=0;i<x.length;i+=16) {
			var j=0;
			var t;
			var a=h0;
			var b=h1;
			var c=h2;
			var d=h3;
			var e=h4;
			while(j<16) {
				w[j]=x[i+j];
				t=AA(e,a,d^(b&(c^d)),w[j],k1);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<20) {
				w[j]=RR(w,j);
				t=AA(e,a,d^(b&(c^d)),w[j],k1);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<40) {
				w[j]=RR(w,j);
				t=AA(e,a,b^c^d,w[j],k2);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<60) {
				w[j]=RR(w,j);
				t=AA(e,a,(b&c)|(d&(b|c)),w[j],k3);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<80) {
				w[j]=RR(w,j);
				t=AA(e,a,b^c^d,w[j],k4);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			h0=add32(h0,a);
			h1=add32(h1,b);
			h2=add32(h2,c);
			h3=add32(h3,d);
			h4=add32(h4,e);
		}
		return [h0,h1,h2,h3,h4];
	}
})(jQuery);
/*
jQuery.twStylesheet.js

jQuery plugin to dynamically insert CSS rules into a document

Usage:
  jQuery.twStylesheet applies style definitions
  jQuery.twStylesheet.remove neutralizes style definitions

Copyright (c) UnaMesa Association 2009

Triple licensed under the BSD, MIT and GPL licenses:
  http://www.opensource.org/licenses/bsd-license.php
  http://www.opensource.org/licenses/mit-license.php
  http://www.gnu.org/licenses/gpl.html
*/

(function($) {

var defaultId = "customStyleSheet"; // XXX: rename to dynamicStyleSheet?

// Add or replace a style sheet
// css argument is a string of CSS rule sets
// options.id is an optional name identifying the style sheet
// options.doc is an optional document reference
// N.B.: Uses DOM methods instead of jQuery to ensure cross-browser comaptibility.
$.twStylesheet = function(css, options) {
	options = options || {};
	var id = options.id || defaultId;
	var doc = options.doc || document;
	var el = doc.getElementById(id);
	if(doc.createStyleSheet) { // IE-specific handling
		if(el) {
			el.parentNode.removeChild(el);
		}
		doc.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd",
			'&nbsp;<style id="' + id + '" type="text/css">' + css + '</style>'); // fails without &nbsp;
	} else { // modern browsers
		if(el) {
			el.replaceChild(doc.createTextNode(css), el.firstChild);
		} else {
			el = doc.createElement("style");
			el.type = "text/css";
			el.id = id;
			el.appendChild(doc.createTextNode(css));
			doc.getElementsByTagName("head")[0].appendChild(el);
		}
	}
};

// Remove existing style sheet
// options.id is an optional name identifying the style sheet
// options.doc is an optional document reference
$.twStylesheet.remove = function(options) {
	options = options || {};
	var id = options.id || defaultId;
	var doc = options.doc || document;
	var el = doc.getElementById(id);
	if(el) {
		el.parentNode.removeChild(el);
	}
};

})(jQuery);
//]]>
</script>
<script type="text/javascript">
//<![CDATA[
if(useJavaSaver)
	document.write("<applet style='position:absolute;left:-1px' name='TiddlySaver' code='TiddlySaver.class' archive='TiddlySaver.jar' width='1' height='1'></applet>");
//]]>
</script>
<!--POST-SCRIPT-START-->

<!--POST-SCRIPT-END-->
</body>
</html>
